# GMP系统认证子系统场景描述和验收标准

## 文档信息
- **文档版本**: v1.0
- **创建日期**: 2025-11-21
- **最后更新**: 2025-11-21
- **作者**: 业务分析师
- **审核人**: 质量保证工程师

## 目录
1. [概述](#概述)
2. [典型使用场景](#典型使用场景)
3. [业务流程场景](#业务流程场景)
4. [异常处理场景](#异常处理场景)
5. [验收标准定义](#验收标准定义)
6. [测试验收标准](#测试验收标准)
7. [性能验收标准](#性能验收标准)
8. [安全验收标准](#安全验收标准)

---

## 概述

### 文档目的
本文档详细描述了GMP系统认证子系统的典型使用场景和全面的验收标准，为系统测试和验收提供明确的依据。

### 场景分类
- **正常使用场景**: 标准认证业务流程的完整描述
- **异常处理场景**: 边界条件和异常情况的处理
- **集成测试场景**: 与其他系统的协作场景
- **性能测试场景**: 负载和压力测试场景

### GMP特殊要求
- **合规性验证**: 所有认证操作必须符合GMP法规要求
- **审计可追溯**: 关键认证操作必须支持完整审计追踪
- **数据完整性**: 重要认证数据变更必须经过严格验证
- **权限分离**: 敏感操作必须实施职责分离原则
- **安全等级**: 认证系统必须达到企业级安全标准

---

## 典型使用场景

### 场景1: 用户登录验证全流程

#### 场景描述
生产部技术员李明在2025年11月21日需要登录GMP系统进行日常工作，系统需要完成安全的身份验证和权限授权流程。

#### 参与角色
- **用户李明**: 生产技术员
- **系统管理员**: 认证系统管理员
- **安全审计员**: 安全监控人员
- **部门经理**: 权限确认人
- **认证服务**: 认证子系统

#### 详细流程
**步骤1: 访问系统 (08:30)**
- 李明在办公电脑浏览器中输入GMP系统地址
- 系统重定向到认证页面，显示公司LOGO和欢迎信息
- 浏览器自动加载最新的安全策略和证书
- 系统检查用户浏览器环境和安全状态

**步骤2: 用户认证 (08:31)**
- 李明输入用户名: liming@company.com
- 输入密码: ******** (8位复杂密码)
- 选择登录方式: 密码 + 短信验证
- 点击"登录"按钮

**步骤3: 系统验证 (08:31-08:32)**
- 认证服务验证用户名和密码格式
- 调用用户服务查询用户信息:
  - 用户ID: USER_202511210001
  - 状态: ACTIVE
  - 部门: 生产部
  - 职位: 生产技术员
  - 账户状态: 正常
- 验证密码哈希值是否匹配
- 检查用户是否被锁定或禁用
- 发送短信验证码到李明手机: 138****1234

**步骤4: 多因子验证 (08:32)**
- 李明输入短信验证码: 567891
- 系统验证验证码有效性和时效性（5分钟有效期）
- 确认验证码发送设备和用户注册设备一致
- 记录多因子验证结果

**步骤5: 权限计算 (08:33)**
- 系统查询用户所属组织和角色:
  - 主组织: GMP制药公司
  - 部门: 生产部
  - 角色: 生产技术员 (PROD_TECH)
  - 权限范围: 生产相关模块读/写权限
- 计算动态权限（基于时间和地点）
- 生成JWT令牌，包含权限信息
- 设置会话超时: 8小时

**步骤6: 登录成功 (08:33)**
- 系统重定向到用户主页面
- 显示用户信息: "欢迎，李明 - 生产技术员"
- 加载用户个性化设置和快捷菜单
- 记录登录审计日志:
  - 时间: 2025-11-21 08:33:15
  - 用户: liming@company.com
  - IP地址: 192.168.1.100
  - 浏览器: Chrome 119.0
  - 登录方式: 密码+短信
  - 状态: 成功

**步骤7: 会话管理 (08:33-16:33)**
- 系统实时监控用户活动状态
- 自动保存用户操作历史
- 定期刷新用户权限（每小时检查一次）
- 支持会话暂停和恢复功能
- 16:33自动提醒用户会话即将超时

#### 期望结果
- ✅ 李明成功登录并获得正确的权限
- ✅ 多因子验证流程顺畅完成
- ✅ 系统安全记录完整的认证日志
- ✅ 用户界面响应快速，用户体验良好

### 场景2: 管理员创建用户账户

#### 场景描述
HR专员王芳需要为新入职员工张伟创建GMP系统账户，确保用户能够正常访问系统和获得适当权限。

#### 参与角色
- **HR专员王芳**: 用户账户创建者
- **系统管理员**: 权限确认者
- **新员工张伟**: 账户使用者
- **部门经理**: 角色确认人

#### 详细流程
**步骤1: 账户创建请求 (09:00)**
- 王芳登录HR系统，查看新员工入职信息
- 确认张伟已完成所有入职手续
- 系统自动检测需要创建GMP账户的员工
- 王芳点击"创建GMP账户"按钮

**步骤2: 用户信息录入 (09:01)**
- 系统显示用户创建表单，自动填充基础信息:
  - 姓名: 张伟
  - 邮箱: zhangwei@company.com
  - 部门: 质量部
  - 职位: 质量检验员
  - 直接主管: 李经理
- 王芳补充额外信息:
  - 联系电话: 139****5678
  - 紧急联系人: 张的妻子 138****9999
  - 岗位等级: L3
  - 工作地点: A厂区

**步骤3: 权限分配 (09:02)**
- 系统根据职位自动推荐权限组合:
  - 基础权限: 查看个人信息、修改密码
  - 质量部权限: 质量检验记录、质量报告查看
  - 检验员权限: 样品检测、设备使用审批
  - 系统自动排除敏感权限: 财务数据、系统管理
- 王芳审核并确认权限分配
- 系统验证权限分配的合规性

**步骤4: 密码策略应用 (09:03)**
- 系统生成符合策略的临时密码: Gmp@2025Wz
- 密码复杂度检查: ✅ 包含大写字母
- 密码复杂度检查: ✅ 包含小写字母
- 密码复杂度检查: ✅ 包含数字
- 密码复杂度检查: ✅ 包含特殊字符
- 密码长度检查: ✅ 12位字符
- 设置密码过期时间: 30天

**步骤5: 账户验证 (09:04)**
- 系统验证邮箱格式: zhangwei@company.com ✅
- 检查邮箱唯一性: 该邮箱未注册 ✅
- 验证手机号格式: 139****5678 ✅
- 确认部门信息: 质量部存在 ✅
- 检查角色配置: 质量检验员角色有效 ✅

**步骤6: 账户创建 (09:05)**
- 系统生成用户ID: USER_202511210007
- 哈希处理用户密码
- 创建用户档案
- 初始化权限集合
- 设置账户状态: 待激活
- 发送欢迎邮件给张伟

**步骤7: 激活流程 (09:06)**
- 张伟收到系统欢迎邮件，包含初始登录信息
- 邮件内容:
  - 用户名: zhangwei@company.com
  - 临时密码: Gmp@2025Wz
  - 首次登录提示修改密码
  - 系统使用指南链接
- 系统标记账户创建完成
- 王芳收到创建成功通知

**步骤8: 首次登录 (10:30)**
- 张伟使用临时密码登录系统
- 系统检测到首次登录，强制要求修改密码
- 张伟设置新密码: Gmp@Quality2025
- 系统验证新密码符合策略
- 更新密码哈希值
- 账户状态更新为: ACTIVE
- 记录首次登录审计日志

#### 期望结果
- ✅ 张伟账户创建成功，获得正确的权限
- ✅ 密码策略严格执行，安全合规
- ✅ 激活流程完整，用户体验良好
- ✅ 审计日志完整记录所有操作

### 场景3: 密码重置和恢复

#### 场景描述
用户李明忘记登录密码，需要通过安全流程重置密码并恢复对系统的访问。

#### 参与角色
- **用户李明**: 密码重置请求者
- **系统管理员**: 重置确认者
- **安全审计员**: 安全验证人员
- **HR专员**: 身份确认人员

#### 详细流程
**步骤1: 密码重置请求 (14:20)**
- 李明在登录页面点击"忘记密码"链接
- 系统显示密码重置页面
- 李明输入注册邮箱: liming@company.com
- 李明输入手机号: 138****1234
- 点击"提交重置请求"

**步骤2: 身份验证 (14:21)**
- 系统验证邮箱格式和注册状态: ✅ 有效
- 系统验证手机号格式和匹配性: ✅ 匹配
- 查询用户安全验证问题:
  - 首次登录时间: 2025-11-15 09:30
  - 注册IP地址: 192.168.1.100
  - 最后登录时间: 2025-11-21 08:33
- 系统要求李明确认最后登录信息
- 李明确认信息正确

**步骤3: 多重验证 (14:22)**
- 系统发送6位验证码到邮箱: liming@company.com
- 邮件主题: "GMP系统密码重置验证"
- 系统发送6位验证码到手机: 138****1234
- 短信内容: "您的验证码是: 892461，5分钟内有效"
- 李明需要输入邮箱验证码和手机验证码

**步骤4: 安全检查 (14:23)**
- 系统验证邮箱验证码: 892461 ✅ 有效
- 系统验证手机验证码: 462891 ✅ 有效
- 检查用户账户状态: ACTIVE ✅
- 检查最近登录异常: 无异常登录记录 ✅
- 检查密码重置频率: 30天内首次 ✅
- 更新安全验证计数

**步骤5: 重置授权 (14:24)**
- 系统要求用户输入新密码要求
- 李明输入新密码: Gmp@Safe2025
- 系统实时检查密码强度:
  - 长度: 13字符 ✅
  - 包含大写字母: G, S ✅
  - 包含小写字母: mp, afe ✅
  - 包含数字: 2025 ✅
  - 包含特殊字符: @ ✅
  - 密码历史检查: 新密码与历史密码不同 ✅
- 系统确认密码符合策略要求

**步骤6: 密码重置执行 (14:25)**
- 系统生成重置令牌: RESET_TOKEN_202511211425
- 更新用户密码哈希值
- 记录重置操作日志:
  - 时间: 2025-11-21 14:25:30
  - 用户: liming@company.com
  - 操作: 密码重置
  - IP地址: 192.168.1.100
  - 验证方式: 邮箱+手机
  - 操作者: 系统自动
- 使所有现有会话失效

**步骤7: 重置确认 (14:26)**
- 系统发送密码重置成功通知:
  - 邮件通知: "您的密码已成功重置"
  - 短信通知: "密码重置成功，请使用新密码登录"
- 系统记录用户确认时间
- 重置令牌设置为已使用状态
- 李明收到重置成功通知

**步骤8: 登录验证 (14:30)**
- 李明使用新密码尝试登录
- 系统验证用户名和密码: ✅ 匹配
- 检测到密码刚刚重置，系统强制用户完成安全检查
- 李明确认设备安全状态
- 系统生成新的JWT令牌
- 用户成功登录系统
- 记录密码重置后的首次登录

#### 期望结果
- ✅ 密码重置流程安全可靠，防止恶意操作
- ✅ 多重验证机制有效防止账号被盗用
- ✅ 用户能够顺利恢复账户访问权限
- ✅ 所有操作都有完整的审计记录

### 场景4: 会话超时和安全管理

#### 场景描述
用户李明在系统中工作8小时后会话即将超时，系统需要安全处理会话终止和用户提醒。

#### 参与角色
- **用户李明**: 系统使用者
- **系统管理员**: 会话监控者
- **安全审计员**: 安全监控人员

#### 详细流程
**步骤1: 会话监控启动 (08:33)**
- 李明成功登录系统，JWT令牌生成
- 令牌有效期: 8小时 (08:33-16:33)
- 系统启动会话监控计时器
- 设置多个提醒节点: 7小时、7.5小时、7.8小时

**步骤2: 活动监控 (08:33-15:30)**
- 系统实时监控用户操作活动:
  - 页面点击: 监控
  - 数据查询: 监控
  - 报表生成: 监控
  - 键盘输入: 监控
- 用户活跃度评分: 基于操作频率和时间间隔
- 系统检测用户是否长时间无操作

**步骤3: 首次超时提醒 (15:30)**
- 距离会话超时还有1小时
- 系统弹出温和提醒: "您已使用系统7小时，为保护系统安全，建议您保存工作成果"
- 李明选择"继续工作"或"保存并退出"
- 系统记录提醒响应

**步骤4: 二次超时提醒 (15:55)**
- 距离会话超时还有30分钟
- 系统再次提醒: "会话将在30分钟后自动退出，请及时保存您的工作"
- 提供选项: "继续工作" 或 "安全退出"
- 李明选择"继续工作"
- 系统延长会话30分钟至16:33

**步骤5: 最后警告 (16:25)**
- 距离会话超时还有8分钟
- 系统显示强制性提醒: "系统即将自动退出，请立即保存您的未保存工作"
- 禁用继续工作选项
- 倒计时显示: "将在8分钟后自动退出"
- 系统开始准备会话终止操作

**步骤6: 会话终止 (16:33)**
- 会话超时，系统自动执行终止流程
- 保存用户当前工作状态（如果有未保存数据）
- 清除用户权限令牌
- 结束所有活跃会话
- 记录会话终止审计日志:
  - 时间: 2025-11-21 16:33:15
  - 用户: liming@company.com
  - 终止原因: 会话超时
  - 会话时长: 8小时0分钟
  - 最后操作: 2025-11-21 16:30:45

**步骤7: 用户重新登录 (16:35)**
- 李明返回工作状态，发现会话已终止
- 系统显示: "会话已超时，请重新登录"
- 提供快速登录选项（记住用户信息）
- 李明快速重新登录
- 系统恢复用户工作状态
- 生成新的会话令牌

#### 期望结果
- ✅ 会话超时机制有效保护系统安全
- ✅ 用户体验良好，有充分的时间保存工作
- ✅ 会话管理精确，时间计算准确
- ✅ 审计日志完整记录会话管理过程

---

## 验收标准定义

### 功能性验收标准

#### 用户界面验收标准
1. **界面友好性**
   - 所有认证界面支持中文显示
   - 字体大小适合不同年龄层用户
   - 颜色对比度符合WCAG 2.1 AA标准
   - 响应式设计支持不同屏幕尺寸

2. **操作简便性**
   - 登录操作步骤不超过3步
   - 密码重置流程不超过5步
   - 支持快捷键操作
   - 操作结果即时反馈

3. **数据展示**
   - 用户信息显示清晰完整
   - 权限信息可视化展示
   - 安全状态实时显示
   - 操作历史可查询

#### 业务功能验收标准
1. **用户认证功能**
   - 支持多种认证方式（密码、短信、生物识别）
   - 认证成功率 ≥ 99.9%
   - 多因子认证安全可靠
   - 支持单点登录（SSO）

2. **权限管理功能**
   - 基于角色的权限控制（RBAC）
   - 权限实时生效，支持动态授权
   - 权限最小化原则严格执行
   - 权限变更可追溯审计

3. **会话管理功能**
   - 会话生命周期可配置
   - 会话超时自动处理
   - 支持会话暂停和恢复
   - 并发会话控制

4. **安全管理功能**
   - 密码策略灵活配置
   - 密码强度实时检查
   - 异常登录检测和告警
   - 安全审计日志完整

### 非功能性验收标准

#### 性能验收标准
1. **响应时间**
   - 登录响应时间 < 3秒
   - 权限验证响应时间 < 1秒
   - 会话验证响应时间 < 0.5秒
   - 密码重置流程 < 30秒

2. **并发性能**
   - 支持5000+并发用户登录
   - 高峰期CPU使用率 < 70%
   - 数据库连接池使用率 < 60%
   - 内存使用率 < 70%

#### 安全验收标准
1. **身份认证安全**
   - 支持多因子认证（MFA）
   - 密码哈希算法符合安全标准（bcrypt/argon2）
   - 会话令牌安全管理（JWT + HTTPS）
   - 防暴力破解机制

2. **数据安全保护**
   - 敏感数据加密存储
   - 传输数据加密（TLS 1.3）
   - 访问控制细粒度管理
   - 审计日志完整性

3. **合规性安全**
   - 符合GMP法规要求
   - 支持审计追踪
   - 权限分离原则
   - 数据完整性验证

#### 可用性验收标准
1. **系统可用性**
   - 系统正常运行时间 > 99.95%
   - 计划内维护时间 < 2小时/月
   - 故障平均修复时间 < 2小时
   - 数据备份成功率 > 99.99%

---

## 测试验收标准

### 功能测试验收
1. **单元测试覆盖率** ≥ 90%
2. **集成测试通过率** 100%
3. **系统测试通过率** 100%
4. **用户验收测试通过率** 100%

### 安全测试验收
1. **渗透测试通过率** 100%
2. **漏洞扫描通过率** 100%
3. **密码安全测试** 100%
4. **会话安全测试** 100%

### 自动化测试验收
1. **自动化测试覆盖率** ≥ 85%
2. **回归测试自动化率** ≥ 95%
3. **性能测试自动化** ≥ 90%
4. **安全测试覆盖率** ≥ 80%

---

## 性能验收标准

### 负载测试验收
1. **100并发用户** - 响应时间 < 2秒，通过率100%
2. **1000并发用户** - 响应时间 < 3秒，通过率98%+
3. **5000并发用户** - 响应时间 < 5秒，通过率95%+

### 压力测试验收
1. **CPU使用率** < 80%
2. **内存使用率** < 75%
3. **磁盘I/O使用率** < 70%
4. **网络带宽使用率** < 60%

---

## 安全验收标准

### 身份安全验收
1. **密码安全策略** 强制复杂度要求，通过率100%
2. **会话管理安全** 超时自动退出，准确性100%
3. **多因子认证** 支持多种验证方式，稳定性100%
4. **登录异常检测** 异常登录行为告警，准确性95%+

### 数据安全验收
1. **数据加密存储** AES-256加密算法，实现率100%
2. **传输加密** TLS 1.3协议，覆盖率100%
3. **访问控制** 基于角色的细粒度控制，准确性100%
4. **审计日志** 完整记录所有操作，可追溯性100%

### 合规性验收
1. **GMP法规符合性** 通过专业机构认证
2. **数据保护法规** 符合个人信息保护要求
3. **审计追踪** 满足监管要求，完整性100%
4. **权限分离** 实施职责分离原则，隔离性100%

---

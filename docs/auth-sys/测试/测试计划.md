# 认证系统测试计划

## 文档信息
- **文档版本**: v1.1
- **创建日期**: 2025-11-22
- **最后更新**: 2025-11-30
- **作者**: 测试工程师
- **审核人**: 质量保证工程师

## 目录
1. [概述](#概述)
2. [测试范围](#测试范围)
3. [测试策略](#测试策略)
4. [测试环境](#测试环境)
5. [测试用例](#测试用例)
6. [测试进度安排](#测试进度安排)
7. [风险评估](#风险评估)
8. [测试交付物](#测试交付物)

---

## 概述

### 文档目的
本文档定义了GMP系统认证子系统的测试计划，包括测试范围、策略、环境、用例和进度安排等内容，确保认证系统符合GMP法规要求并满足业务需求。本计划与测试方案保持一致，确保测试执行的系统性和完整性。

### 参考文档
- [认证子系统需求规格说明书](../用户需求/04_详细需求.md)
- [认证子系统详细设计文档](../系统软件自身需求/认证子系统总体设计.md)
- [认证子系统API接口文档](../认证系统文档综合说明文档.md)
- [认证子系统测试方案](认证子系统测试方案.md)
- [GMP系统安全规范](../../GMP系统安全规范.md)

### GMP特殊要求
- **合规性验证**: 所有功能必须符合GMP法规要求
- **审计可追溯**: 关键操作必须支持完整审计追踪
- **数据完整性**: 认证相关信息必须加密存储和传输
- **权限分离**: 认证与授权操作必须实施职责分离原则
- **电子签名**: 支持符合GMP要求的电子签名功能
- **数据备份与恢复**: 认证数据必须定期备份，支持快速恢复

---

## 测试范围

### 包含的功能模块
1. **用户认证模块**
   - 用户登录/登出
   - JWT令牌生成、验证、刷新与黑名单管理
   - 密码重置与修改
   - 多因素认证（MFA/TOTP）
   - 账户锁定与解锁
   
2. **用户管理模块**
   - 用户增删改查
   - 用户状态管理（启用/禁用）
   - 用户信息维护
   - 用户组织关联
   - 密码策略管理
   
3. **角色权限模块**
   - 角色管理（创建、编辑、删除）
   - 权限分配与验证
   - 基于角色的权限控制（RBAC）
   - 权限继承机制
   - 角色-用户关联管理
   
4. **组织结构模块**
   - 组织创建、编辑、删除
   - 组织层级管理
   - 组织-用户关联
   
5. **安全审计模块**
   - 登录日志记录与查询
   - 操作行为审计
   - 异常访问检测与告警
   - 审计日志导出功能

### 不包含的内容
- 第三方认证集成（如LDAP、OAuth等）
- 生物识别认证方式
- 硬件安全模块集成

---

## 测试策略

### 测试类型
1. **单元测试**
   - 验证各服务类、工具类的方法逻辑正确性
   - 覆盖范围：所有核心业务逻辑
   - 覆盖率目标：90%以上（行覆盖率、分支覆盖率、类覆盖率、方法覆盖率）
   - 测试工具：JUnit 5、Mockito
   - 执行人员：开发工程师
   
2. **集成测试**
   - 验证各模块间的接口调用正确性
   - 验证数据库操作正确性
   - 验证服务层与数据访问层的集成
   - 测试工具：Spring Boot Test、TestRestTemplate、H2
   - 执行人员：测试工程师
   
3. **接口测试**
   - 验证RESTful API的功能正确性
   - 验证请求/响应数据格式
   - 验证API错误处理
   - 测试工具：Postman、RestAssured
   - 执行人员：测试工程师
   
4. **安全测试**
   - 验证认证机制安全性
   - 验证权限控制有效性
   - 验证数据传输加密
   - 验证SQL注入、XSS、CSRF等攻击防护
   - 验证GMP合规性
   - 测试工具：OWASP ZAP、Burp Suite、SonarQube
   - 执行人员：安全工程师
   
5. **性能测试**
   - 验证并发用户登录能力
   - 验证令牌验证响应时间
   - 验证系统在高负载下的稳定性
   - 测试工具：JMeter、Grafana、Prometheus
   - 执行人员：性能工程师
   
6. **兼容性测试**
   - 验证不同浏览器的支持情况
   - 验证不同设备的适配情况
   - 验证不同数据库版本的兼容性
   - 测试工具：Selenium WebDriver、BrowserStack
   - 执行人员：测试工程师

### 测试方法
- **黑盒测试**: 验证功能是否符合需求，不考虑内部实现
- **白盒测试**: 验证代码逻辑是否正确，覆盖所有分支和边界情况
- **灰盒测试**: 结合前后端验证业务流程，验证系统集成
- **自动化测试**: 对核心功能和回归测试采用自动化测试，提高测试效率
- **手动测试**: 对复杂业务流程和UI交互采用手动测试

---

## 测试环境

### 测试环境配置

| 环境类型 | 配置描述 | 部署位置 |
|----------|----------|----------|
| 开发测试环境 | 单节点部署，配置精简，使用H2数据库 | 开发服务器 |
| 集成测试环境 | 多节点部署，配置完整，使用PostgreSQL和Redis | 集成服务器 |
| 性能测试环境 | 生产级配置，监控完善，与生产环境相似 | 性能测试服务器 |
| 安全测试环境 | 隔离网络，特殊配置，禁用外部访问 | 安全测试服务器 |

### 硬件环境

| 资源类型 | 开发测试环境 | 集成测试环境 | 性能测试环境 | 安全测试环境 |
|----------|--------------|--------------|--------------|--------------|
| CPU | 4核 | 8核 | 16核 | 8核 |
| 内存 | 8GB | 16GB | 32GB | 16GB |
| 存储 | SSD 200GB | SSD 500GB | SSD 1TB | SSD 500GB |
| 网络 | 千兆网络 | 千兆网络 | 万兆网络 | 隔离千兆网络 |

### 软件环境

| 组件 | 版本 | 用途 | 环境 |
|------|------|------|------|
| 操作系统 | Ubuntu 24.04 | 服务器环境 | 所有环境 |
| JDK | OpenJDK 17 | 运行环境 | 所有环境 |
| 数据库 | PostgreSQL 14+ | 数据存储 | 集成、性能、安全环境 |
| 数据库 | H2 2.1.214 | 数据存储 | 开发测试环境 |
| 缓存 | Redis 7+ | 会话缓存 | 集成、性能、安全环境 |
| Web框架 | Spring Boot 3.0+ | 应用框架 | 所有环境 |
| 安全框架 | Spring Security 6.0+ | 安全框架 | 所有环境 |
| 令牌库 | JWT 0.11.5 | 令牌处理 | 所有环境 |
| Web服务器 | Nginx 1.20 | 反向代理 | 集成、性能、安全环境 |

### 测试工具环境

| 工具名称 | 版本 | 用途 | 执行环境 |
|----------|------|------|----------|
| JUnit 5 | 5.8.2 | 单元测试 | 开发测试环境 |
| Mockito | 4.5.1 | 单元测试 | 开发测试环境 |
| Spring Boot Test | 3.0.5 | 集成测试 | 开发测试环境 |
| Postman | 9.28.0 | API测试 | 集成测试环境 |
| RestAssured | 5.3.0 | API测试 | 集成测试环境 |
| JMeter | 5.5 | 性能测试 | 性能测试环境 |
| Selenium | 4.5.0 | 端到端测试 | 集成测试环境 |
| OWASP ZAP | 2.12.0 | 安全扫描 | 安全测试环境 |
| Burp Suite | 2022.8 | 渗透测试 | 安全测试环境 |
| SonarQube | 9.7 | 代码质量分析 | 集成测试环境 |
| JaCoCo | 0.8.8 | 代码覆盖率分析 | 开发测试环境 |
| Grafana | 9.2.0 | 监控 | 所有环境 |
| Prometheus | 2.40.0 | 性能监控 | 性能测试环境 |

### 网络环境
- 内网环境，支持HTTPS协议
- 网络延迟 < 10ms
- 带宽 >= 100Mbps
- 安全测试环境与外部网络隔离

---

## 测试用例

### 功能测试用例

#### TC-AUTH-001: 用户正常登录
- **前置条件**: 存在有效的用户账户
- **测试步骤**:
  1. 访问登录页面
  2. 输入正确的用户名和密码
  3. 点击登录按钮
- **预期结果**: 
  1. 登录成功，返回JWT访问令牌和刷新令牌
  2. 记录登录日志
  3. 跳转至首页
  4. 响应时间 < 500ms

#### TC-AUTH-002: 用户登录失败（密码错误）
- **前置条件**: 存在有效的用户账户
- **测试步骤**:
  1. 访问登录页面
  2. 输入正确的用户名和错误的密码
  3. 点击登录按钮
- **预期结果**: 
  1. 登录失败，提示密码错误
  2. 不返回令牌
  3. 记录失败日志
  4. 失败次数累计

#### TC-AUTH-003: 多因素认证登录
- **前置条件**: 用户已启用多因素认证
- **测试步骤**:
  1. 访问登录页面
  2. 输入正确的用户名和密码
  3. 输入正确的TOTP验证码
  4. 点击登录按钮
- **预期结果**: 
  1. 登录成功，返回JWT令牌
  2. 记录登录日志
  3. 跳转至首页

#### TC-AUTH-004: 账户锁定
- **前置条件**: 存在有效的用户账户
- **测试步骤**:
  1. 访问登录页面
  2. 连续输入5次错误密码
  3. 第6次尝试登录
- **预期结果**: 
  1. 提示账户已锁定
  2. 记录账户锁定日志
  3. 无法登录系统

#### TC-USER-001: 创建用户
- **前置条件**: 以管理员身份登录系统
- **测试步骤**:
  1. 进入用户管理页面
  2. 点击创建用户按钮
  3. 输入用户信息（用户名、密码、角色、组织等）
  4. 点击保存按钮
- **预期结果**: 
  1. 用户创建成功，显示在用户列表中
  2. 记录用户创建日志
  3. 密码以加密形式存储

#### TC-ROLE-001: 角色权限分配
- **前置条件**: 以管理员身份登录系统
- **测试步骤**:
  1. 进入角色管理页面
  2. 选择一个角色，点击权限分配按钮
  3. 勾选多个权限
  4. 点击保存按钮
- **预期结果**: 
  1. 权限分配成功，角色拥有相应权限
  2. 记录权限分配日志
  3. 关联用户获得相应权限

#### TC-PWD-001: 密码复杂度验证
- **前置条件**: 以管理员身份登录系统，密码策略已配置
- **测试步骤**:
  1. 进入用户管理页面
  2. 创建用户，输入不符合复杂度要求的密码
  3. 点击保存按钮
- **预期结果**: 
  1. 提示密码不符合复杂度要求
  2. 用户创建失败
  3. 记录密码验证失败日志

### 安全测试用例

#### TC-SEC-001: SQL注入防护
- **前置条件**: 系统处于运行状态
- **测试步骤**:
  1. 在登录表单用户名字段输入：' OR '1'='1
  2. 输入任意密码
  3. 点击登录按钮
- **预期结果**: 
  1. 系统拒绝非法输入
  2. 返回安全错误提示
  3. 记录安全事件日志

#### TC-SEC-002: XSS攻击防护
- **前置条件**: 以管理员身份登录系统
- **测试步骤**:
  1. 进入用户管理页面
  2. 创建用户，在用户名字段输入：<script>alert('XSS')</script>
  3. 点击保存按钮
  4. 查看用户列表
- **预期结果**: 
  1. 系统过滤恶意代码
  2. 正常保存合法信息
  3. 显示安全的用户名

#### TC-SEC-003: 越权访问测试
- **前置条件**: 以普通用户身份登录系统
- **测试步骤**:
  1. 尝试直接访问管理员API端点（如/api/admin/users）
  2. 查看响应结果
- **预期结果**: 
  1. 访问被拒绝，返回403错误
  2. 记录越权访问日志

#### TC-SEC-004: JWT令牌篡改
- **前置条件**: 已登录系统，获取有效的JWT令牌
- **测试步骤**:
  1. 修改JWT令牌中的角色信息
  2. 使用修改后的令牌访问受限资源
  3. 查看响应结果
- **预期结果**: 
  1. 令牌验证失败，返回401错误
  2. 记录令牌篡改事件日志

### 性能测试用例

#### TC-PERF-001: 并发登录性能
- **前置条件**: 准备1000个测试账户
- **测试步骤**:
  1. 使用JMeter同时发起1000个登录请求
  2. 记录响应时间和成功率
  3. 监控系统资源使用情况
- **预期结果**: 
  1. 平均响应时间 < 500ms
  2. 成功率 > 99%
  3. CPU使用率 < 80%
  4. 内存使用率 < 80%

#### TC-PERF-002: 令牌验证性能
- **前置条件**: 已获取有效的JWT令牌
- **测试步骤**:
  1. 使用JMeter同时发起2000个令牌验证请求
  2. 记录响应时间和成功率
- **预期结果**: 
  1. 平均响应时间 < 100ms
  2. 成功率 > 99.9%

#### TC-PERF-003: 系统耐久性能
- **前置条件**: 准备500个测试账户
- **测试步骤**:
  1. 使用JMeter设置持续负载（500并发用户）
  2. 运行测试24小时
  3. 监控系统资源使用情况和响应时间
- **预期结果**: 
  1. 系统稳定运行，无崩溃
  2. 平均响应时间 < 800ms
  3. 无内存泄漏
  4. 成功率 > 99%

---

## 测试进度安排

| 阶段 | 时间 | 任务 | 负责人 | 状态 |
|------|------|------|--------|------|
| 测试准备 | 2025-11-19 至 2025-11-21 | 搭建测试环境，准备测试数据，编写测试用例 | 测试工程师 | 已完成 |
| 单元测试 | 2025-11-22 至 2025-11-24 | 执行单元测试，修复发现的问题，生成单元测试报告 | 开发工程师 | 已完成 |
| 集成测试 | 2025-11-25 至 2025-11-28 | 执行集成测试，API测试，修复发现的问题，生成集成测试报告 | 测试工程师 | 已完成 |
| 功能测试 | 2025-11-29 至 2025-12-03 | 执行端到端功能测试，UI测试，修复发现的问题，生成功能测试报告 | 测试工程师 | 进行中 |
| 安全测试 | 2025-12-07 至 2025-12-10 | 执行安全扫描，渗透测试，合规性检查，生成安全测试报告 | 安全工程师 | 待执行 |
| 性能测试 | 2025-12-04 至 2025-12-06 | 执行负载测试，压力测试，耐久测试，生成性能测试报告 | 性能工程师 | 待执行 |
| 兼容性测试 | 2025-12-07 至 2025-12-09 | 执行浏览器兼容性测试，设备兼容性测试，生成兼容性测试报告 | 测试工程师 | 待执行 |
| 回归测试 | 2025-12-11 至 2025-12-13 | 验证缺陷修复情况，执行全量回归测试，生成回归测试报告 | 测试工程师 | 待执行 |
| 测试总结 | 2025-12-14 至 2025-12-15 | 编写测试报告，测试总结，覆盖率分析 | 测试经理 | 待执行 |

---

## 风险评估

| 风险项 | 描述 | 可能性 | 影响程度 | 应对措施 | 状态 |
|--------|------|--------|----------|----------|------|
| 测试环境风险 | 测试环境不足以模拟生产环境的负载 | 中 | 高 | 增加测试环境资源，采用与生产环境相似的配置，使用云环境进行性能测试 | 已缓解 |
| 测试数据风险 | 测试数据不全面导致某些场景未覆盖 | 中 | 中 | 基于业务场景设计测试数据，覆盖各种边界情况，使用自动化工具生成测试数据 | 已缓解 |
| 时间风险 | 测试周期可能不够，导致测试不充分 | 高 | 高 | 提前规划测试时间，优先测试关键功能，并行执行测试任务，使用自动化测试工具提高效率 | 进行中 |
| 技术风险 | 某些安全测试需要专业工具和技能 | 中 | 中 | 引入专业安全测试工具，培训测试人员，聘请外部安全专家进行渗透测试 | 已缓解 |
| 依赖风险 | 依赖其他系统的接口或组件 | 中 | 高 | 建立mock服务，减少对外部依赖的影响，与依赖系统团队密切协作 | 已缓解 |
| 覆盖率风险 | 测试覆盖率不达标，导致系统质量风险 | 高 | 高 | 制定覆盖率目标，使用覆盖率工具监控，定期分析覆盖率报告，补充测试用例 | 进行中 |
| 环境不稳定 | 测试环境频繁出现故障 | 中 | 中 | 提前准备备用环境，定期备份测试环境配置 | 已缓解 |
| 人员不足 | 测试人员临时缺席 | 低 | 中 | 安排人员备份，交叉培训，确保关键任务有多人可执行 | 已缓解 |
| 需求变更 | 需求发生重大变化 | 中 | 高 | 加强需求评审，建立变更管理流程，及时调整测试计划 | 已缓解 |
| 工具缺陷 | 测试工具存在bug | 低 | 低 | 准备替代方案，及时更新工具版本，报告工具缺陷 | 已缓解 |

---

## 测试交付物

### 测试过程中交付
1. 测试用例文档（Excel/TestLink）
2. 测试执行记录（TestLink/自动化测试报告）
3. 缺陷报告（Jira/缺陷管理系统）
4. 每日测试进展报告

### 测试完成后交付
1. 测试计划文档（当前文档）
2. 测试方案文档
3. 测试执行报告
4. 测试覆盖率报告
5. 性能测试报告
6. 安全测试报告
7. 兼容性测试报告
8. 回归测试报告
9. 测试总结报告
10. 自动化测试脚本
11. 测试数据生成脚本

### 交付物质量要求
- 文档内容完整、准确、清晰
- 测试用例覆盖所有功能点和边界情况
- 测试报告包含详细的测试结果和分析
- 缺陷报告包含复现步骤、预期结果和实际结果
- 自动化测试脚本可重复执行，维护性好

---

## 测试通过标准

| 标准类型 | 通过标准 |
|----------|----------|
| 功能测试 | 所有关键功能测试用例通过率100%，非关键功能测试用例通过率≥95% |
| 单元测试 | 代码覆盖率≥90%（行覆盖率、分支覆盖率、类覆盖率、方法覆盖率） |
| 集成测试 | 所有集成测试用例通过率≥98% |
| 性能测试 | 响应时间满足要求，系统稳定性良好，无内存泄漏 |
| 安全测试 | 无严重安全漏洞，中等级别漏洞≤2个，低级别漏洞≤5个 |
| 兼容性测试 | 所有支持的浏览器、操作系统兼容性良好，通过率≥98% |
| 合规性 | 满足GMP安全合规要求，审计日志完整可追溯 |

---

*文档版本：v1.1*
*审核状态：待审核*
*下次更新：2025-12-15*
# GMPç³»ç»Ÿç”¨æˆ·æƒé™ç®¡ç†æ•°æ®åº“è®¾è®¡

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

| å±æ€§ | å€¼ |
|------|---|
| æ–‡æ¡£æ ‡é¢˜ | GMPç³»ç»Ÿç”¨æˆ·æƒé™ç®¡ç†æ•°æ®åº“è®¾è®¡ |
| ç‰ˆæœ¬å· | v1.0.0 |
| åˆ›å»ºæ—¥æœŸ | 2025å¹´11æœˆ20æ—¥ |
| ä½œè€… | GMPç³»ç»Ÿå¼€å‘å›¢é˜Ÿ |
| çŠ¶æ€ | è‰ç¨¿ |

## 1. è®¾è®¡ç›®æ ‡ä¸åŸåˆ™

### 1.1 è®¾è®¡ç›®æ ‡

1. æ”¯æŒå¤æ‚çš„ç»„ç»‡ç»“æ„ç®¡ç†ï¼ŒåŒ…æ‹¬ç»„ç»‡å±‚çº§ã€éƒ¨é—¨å…³ç³»
2. å®ç°çµæ´»çš„è§’è‰²æƒé™ä½“ç³»ï¼Œæ»¡è¶³GMPå„å­ç³»ç»Ÿéœ€æ±‚
3. ç¡®ä¿ç³»ç»Ÿå®‰å…¨æ€§å’ŒGMPåˆè§„æ€§
4. æä¾›é«˜æ•ˆçš„æ•°æ®æŸ¥è¯¢å’Œæƒé™éªŒè¯æ€§èƒ½
5. æ”¯æŒç³»ç»Ÿæ‰©å±•æ€§å’Œæœªæ¥åŠŸèƒ½å¢å¼º

### 1.2 è®¾è®¡åŸåˆ™

1. **å®‰å…¨æ€§ä¼˜å…ˆ**ï¼šæ‰€æœ‰æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨ï¼Œæ“ä½œæ—¥å¿—å®Œæ•´è®°å½•
2. **åˆè§„æ€§è®¾è®¡**ï¼šç¬¦åˆGMPå’Œ21 CFR Part 11è¦æ±‚
3. **é«˜å†…èšä½è€¦åˆ**ï¼šæ¨¡å—é—´è¾¹ç•Œæ¸…æ™°ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šåˆç†è®¾è®¡ç´¢å¼•å’ŒæŸ¥è¯¢ç­–ç•¥
5. **æ•°æ®å®Œæ•´æ€§**ï¼šé€šè¿‡å¤–é”®çº¦æŸã€è§¦å‘å™¨ç­‰ç¡®ä¿æ•°æ®ä¸€è‡´æ€§

## 2. æ•°æ®åº“æŠ€æœ¯é€‰å‹

| ç±»åˆ« | æŠ€æœ¯ | ç‰ˆæœ¬ | é€‰å‹ç†ç”± |
|------|------|------|----------|
| æ•°æ®åº“ç±»å‹ | å…³ç³»å‹æ•°æ®åº“ | PostgreSQL 13 | æ”¯æŒå¤æ‚æŸ¥è¯¢ã€äº‹åŠ¡å®Œæ•´æ€§å’ŒJSONæ•°æ®ç±»å‹ï¼Œé€‚åˆGMPç³»ç»Ÿçš„ä¸¥æ ¼è¦æ±‚ |
| ç¼“å­˜ | Redis | 7.2 | ç”¨äºç¼“å­˜æƒé™æ•°æ®ã€ä¼šè¯ä¿¡æ¯ï¼Œæå‡æ€§èƒ½ |
| ORMæ¡†æ¶ | Hibernate JPA | - | ç®€åŒ–æ•°æ®åº“æ“ä½œï¼Œæ”¯æŒå¯¹è±¡å…³ç³»æ˜ å°„ |

## 3. å®ä½“å…³ç³»å›¾

```mermaid
erd
    // ç»„ç»‡ç»“æ„ç›¸å…³å®ä½“
    [Organization] {
        +long org_id PK
        varchar(255) name
        varchar(255) code
        varchar(1000) description
        long parent_id FK > Organization
        int level
        timestamp created_at
        timestamp updated_at
        varchar(50) created_by
        varchar(50) updated_by
    }

    [Department] {
        +long dept_id PK
        varchar(255) name
        varchar(255) code
        varchar(1000) description
        long org_id FK > Organization
        long parent_dept_id FK > Department
        int level
        timestamp created_at
        timestamp updated_at
        varchar(50) created_by
        varchar(50) updated_by
    }

    // ç”¨æˆ·ç›¸å…³å®ä½“
    [User] {
        +long user_id PK
        varchar(100) username
        varchar(255) password_hash
        varchar(255) full_name
        varchar(255) email
        varchar(20) phone_number
        long dept_id FK > Department
        varchar(50) status
        date hire_date
        date last_login_date
        timestamp created_at
        timestamp updated_at
        varchar(50) created_by
        varchar(50) updated_by
    }

    [UserProfile] {
        +long profile_id PK
        long user_id FK > User
        jsonb additional_info
        varchar(100) position
        varchar(255) photo_url
        timestamp updated_at
    }

    [UserLoginHistory] {
        +long history_id PK
        long user_id FK > User
        varchar(50) ip_address
        varchar(255) user_agent
        varchar(50) login_status
        timestamp login_time
    }

    // è§’è‰²ç›¸å…³å®ä½“
    [Role] {
        +long role_id PK
        varchar(255) name
        varchar(255) code
        varchar(1000) description
        varchar(50) type
        boolean is_temp
        timestamp expire_date
        timestamp created_at
        timestamp updated_at
        varchar(50) created_by
        varchar(50) updated_by
    }

    [RoleHierarchy] {
        +long parent_role_id PK, FK > Role
        +long child_role_id PK, FK > Role
    }

    [UserRole] {
        +long user_id PK, FK > User
        +long role_id PK, FK > Role
        boolean active
        timestamp assigned_at
        varchar(50) assigned_by
        timestamp expired_at
    }

    // æƒé™ç›¸å…³å®ä½“
    [Permission] {
        +long perm_id PK
        varchar(255) code
        varchar(255) name
        varchar(1000) description
        varchar(100) resource_type
        varchar(255) resource_id
        varchar(50) action
        varchar(100) group_name
        timestamp created_at
        timestamp updated_at
        varchar(50) created_by
        varchar(50) updated_by
    }

    [RolePermission] {
        +long role_id PK, FK > Role
        +long perm_id PK, FK > Permission
        timestamp assigned_at
        varchar(50) assigned_by
    }

    // GMPç‰¹æ®ŠåŠŸèƒ½ç›¸å…³å®ä½“
    [ElectronicSignature] {
        +long signature_id PK
        long user_id FK > User
        varchar(255) reason
        varchar(255) object_type
        varchar(255) object_id
        varchar(255) signature_data
        timestamp signed_at
    }

    [AuditLog] {
        +long log_id PK
        long user_id FK > User
        varchar(255) operation
        varchar(255) resource_type
        varchar(255) resource_id
        jsonb before_data
        jsonb after_data
        varchar(50) result
        varchar(100) ip_address
        varchar(255) user_agent
        timestamp operation_time
    }

    // å…³è”å…³ç³»
    Organization ||--o{ Department : contains
    Department ||--o{ User : employs
    User ||--o{ UserProfile : has
    User ||--o{ UserLoginHistory : generates
    User ||--o{ UserRole : assigned
    UserRole ||--o{ Role : references
    Role ||--o{ RoleHierarchy : has_child
    Role ||--o{ RoleHierarchy : has_parent
    Role ||--o{ RolePermission : assigned
    RolePermission ||--o{ Permission : references
    User ||--o{ ElectronicSignature : creates
    User ||--o{ AuditLog : performs
```

## 4. è¡¨ç»“æ„è¯¦ç»†è®¾è®¡

### 4.1 ç»„ç»‡ç»“æ„ç›¸å…³è¡¨

#### organizationè¡¨ï¼ˆç»„ç»‡è¡¨ï¼‰

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸ | æè¿° |
|-------|---------|------|------|
| org_id | BIGSERIAL | PRIMARY KEY | ç»„ç»‡ID |
| name | VARCHAR(255) | NOT NULL | ç»„ç»‡åç§° |
| code | VARCHAR(255) | UNIQUE NOT NULL | ç»„ç»‡ä»£ç  |
| description | VARCHAR(1000) | | ç»„ç»‡æè¿° |
| parent_id | BIGINT | REFERENCES organization(org_id) | çˆ¶ç»„ç»‡IDï¼Œç”¨äºæ„å»ºç»„ç»‡æ ‘ |
| level | INTEGER | NOT NULL DEFAULT 1 | ç»„ç»‡å±‚çº§ |
| created_at | TIMESTAMP | NOT NULL DEFAULT CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | NOT NULL DEFAULT CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |
| created_by | VARCHAR(50) | | åˆ›å»ºäºº |
| updated_by | VARCHAR(50) | | æ›´æ–°äºº |

#### departmentè¡¨ï¼ˆéƒ¨é—¨è¡¨ï¼‰

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸ | æè¿° |
|-------|---------|------|------|
| dept_id | BIGSERIAL | PRIMARY KEY | éƒ¨é—¨ID |
| name | VARCHAR(255) | NOT NULL | éƒ¨é—¨åç§° |
| code | VARCHAR(255) | UNIQUE NOT NULL | éƒ¨é—¨ä»£ç  |
| description | VARCHAR(1000) | | éƒ¨é—¨æè¿° |
| org_id | BIGINT | REFERENCES organization(org_id) NOT NULL | æ‰€å±ç»„ç»‡ID |
| parent_dept_id | BIGINT | REFERENCES department(dept_id) | çˆ¶éƒ¨é—¨IDï¼Œç”¨äºæ„å»ºéƒ¨é—¨æ ‘ |
| level | INTEGER | NOT NULL DEFAULT 1 | éƒ¨é—¨å±‚çº§ |
| created_at | TIMESTAMP | NOT NULL DEFAULT CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | NOT NULL DEFAULT CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |
| created_by | VARCHAR(50) | | åˆ›å»ºäºº |
| updated_by | VARCHAR(50) | | æ›´æ–°äºº |

### 4.2 ç”¨æˆ·ç›¸å…³è¡¨

#### userè¡¨ï¼ˆç”¨æˆ·è¡¨ï¼‰

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸ | æè¿° |
|-------|---------|------|------|
| user_id | BIGSERIAL | PRIMARY KEY | ç”¨æˆ·ID |
| username | VARCHAR(100) | UNIQUE NOT NULL | ç”¨æˆ·å |
| password_hash | VARCHAR(255) | NOT NULL | å¯†ç å“ˆå¸Œå€¼ |
| full_name | VARCHAR(255) | NOT NULL | å…¨å |
| email | VARCHAR(255) | UNIQUE NOT NULL | ç”µå­é‚®ç®± |
| phone_number | VARCHAR(20) | | ç”µè¯å·ç  |
| dept_id | BIGINT | REFERENCES department(dept_id) | æ‰€å±éƒ¨é—¨ID |
| status | VARCHAR(50) | NOT NULL DEFAULT 'ACTIVE' | ç”¨æˆ·çŠ¶æ€(ACTIVE/INACTIVE/LOCKED) |
| hire_date | DATE | | å…¥èŒæ—¥æœŸ |
| last_login_date | TIMESTAMP | | æœ€åç™»å½•æ—¶é—´ |
| created_at | TIMESTAMP | NOT NULL DEFAULT CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | NOT NULL DEFAULT CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |
| created_by | VARCHAR(50) | | åˆ›å»ºäºº |
| updated_by | VARCHAR(50) | | æ›´æ–°äºº |

#### user_profileè¡¨ï¼ˆç”¨æˆ·è¯¦ç»†ä¿¡æ¯è¡¨ï¼‰

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸ | æè¿° |
|-------|---------|------|------|
| profile_id | BIGSERIAL | PRIMARY KEY | æ¡£æ¡ˆID |
| user_id | BIGINT | REFERENCES user(user_id) UNIQUE NOT NULL | ç”¨æˆ·ID |
| additional_info | JSONB | | é¢å¤–ä¿¡æ¯ï¼ˆçµæ´»å­˜å‚¨ï¼‰ |
| position | VARCHAR(100) | | èŒä½ |
| photo_url | VARCHAR(255) | | ç…§ç‰‡URL |
| updated_at | TIMESTAMP | NOT NULL DEFAULT CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

#### user_login_historyè¡¨ï¼ˆç”¨æˆ·ç™»å½•å†å²è¡¨ï¼‰

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸ | æè¿° |
|-------|---------|------|------|
| history_id | BIGSERIAL | PRIMARY KEY | å†å²è®°å½•ID |
| user_id | BIGINT | REFERENCES user(user_id) NOT NULL | ç”¨æˆ·ID |
| ip_address | VARCHAR(50) | | ç™»å½•IPåœ°å€ |
| user_agent | VARCHAR(255) | | ç”¨æˆ·ä»£ç† |
| login_status | VARCHAR(50) | NOT NULL | ç™»å½•çŠ¶æ€(SUCCESS/FAILURE) |
| login_time | TIMESTAMP | NOT NULL DEFAULT CURRENT_TIMESTAMP | ç™»å½•æ—¶é—´ |

### 4.3 è§’è‰²ç›¸å…³è¡¨

#### roleè¡¨ï¼ˆè§’è‰²è¡¨ï¼‰

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸ | æè¿° |
|-------|---------|------|------|
| role_id | BIGSERIAL | PRIMARY KEY | è§’è‰²ID |
| name | VARCHAR(255) | NOT NULL | è§’è‰²åç§° |
| code | VARCHAR(255) | UNIQUE NOT NULL | è§’è‰²ä»£ç  |
| description | VARCHAR(1000) | | è§’è‰²æè¿° |
| type | VARCHAR(50) | NOT NULL DEFAULT 'NORMAL' | è§’è‰²ç±»å‹(NORMAL/TEMP/SYSTEM) |
| is_temp | BOOLEAN | NOT NULL DEFAULT false | æ˜¯å¦ä¸ºä¸´æ—¶è§’è‰² |
| expire_date | TIMESTAMP | | è¿‡æœŸæ—¥æœŸï¼ˆä¸´æ—¶è§’è‰²æœ‰æ•ˆï¼‰ |
| created_at | TIMESTAMP | NOT NULL DEFAULT CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | NOT NULL DEFAULT CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |
| created_by | VARCHAR(50) | | åˆ›å»ºäºº |
| updated_by | VARCHAR(50) | | æ›´æ–°äºº |

#### role_hierarchyè¡¨ï¼ˆè§’è‰²å±‚çº§å…³ç³»è¡¨ï¼‰

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸ | æè¿° |
|-------|---------|------|------|
| parent_role_id | BIGINT | REFERENCES role(role_id) NOT NULL | çˆ¶è§’è‰²ID |
| child_role_id | BIGINT | REFERENCES role(role_id) NOT NULL | å­è§’è‰²ID |
| PRIMARY KEY | (parent_role_id, child_role_id) | | å¤åˆä¸»é”® |

#### user_roleè¡¨ï¼ˆç”¨æˆ·è§’è‰²å…³è”è¡¨ï¼‰

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸ | æè¿° |
|-------|---------|------|------|
| user_id | BIGINT | REFERENCES user(user_id) NOT NULL | ç”¨æˆ·ID |
| role_id | BIGINT | REFERENCES role(role_id) NOT NULL | è§’è‰²ID |
| active | BOOLEAN | NOT NULL DEFAULT true | æ˜¯å¦æœ‰æ•ˆ |
| assigned_at | TIMESTAMP | NOT NULL DEFAULT CURRENT_TIMESTAMP | åˆ†é…æ—¶é—´ |
| assigned_by | VARCHAR(50) | | åˆ†é…äºº |
| expired_at | TIMESTAMP | | è¿‡æœŸæ—¶é—´ |
| PRIMARY KEY | (user_id, role_id) | | å¤åˆä¸»é”® |

### 4.4 æƒé™ç›¸å…³è¡¨

#### permissionè¡¨ï¼ˆæƒé™è¡¨ï¼‰

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸ | æè¿° |
|-------|---------|------|------|
| perm_id | BIGSERIAL | PRIMARY KEY | æƒé™ID |
| code | VARCHAR(255) | UNIQUE NOT NULL | æƒé™ä»£ç  |
| name | VARCHAR(255) | NOT NULL | æƒé™åç§° |
| description | VARCHAR(1000) | | æƒé™æè¿° |
| resource_type | VARCHAR(100) | | èµ„æºç±»å‹ |
| resource_id | VARCHAR(255) | | èµ„æºID |
| action | VARCHAR(50) | NOT NULL | æ“ä½œç±»å‹(CREATE/READ/UPDATE/DELETE/EXECUTE) |
| group_name | VARCHAR(100) | | æƒé™åˆ†ç»„ |
| created_at | TIMESTAMP | NOT NULL DEFAULT CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | NOT NULL DEFAULT CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |
| created_by | VARCHAR(50) | | åˆ›å»ºäºº |
| updated_by | VARCHAR(50) | | æ›´æ–°äºº |

#### role_permissionè¡¨ï¼ˆè§’è‰²æƒé™å…³è”è¡¨ï¼‰

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸ | æè¿° |
|-------|---------|------|------|
| role_id | BIGINT | REFERENCES role(role_id) NOT NULL | è§’è‰²ID |
| perm_id | BIGINT | REFERENCES permission(perm_id) NOT NULL | æƒé™ID |
| assigned_at | TIMESTAMP | NOT NULL DEFAULT CURRENT_TIMESTAMP | åˆ†é…æ—¶é—´ |
| assigned_by | VARCHAR(50) | | åˆ†é…äºº |
| PRIMARY KEY | (role_id, perm_id) | | å¤åˆä¸»é”® |

### 4.5 GMPç‰¹æ®ŠåŠŸèƒ½ç›¸å…³è¡¨

#### electronic_signatureè¡¨ï¼ˆç”µå­ç­¾åè¡¨ï¼‰

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸ | æè¿° |
|-------|---------|------|------|
| signature_id | BIGSERIAL | PRIMARY KEY | ç­¾åID |
| user_id | BIGINT | REFERENCES user(user_id) NOT NULL | ç”¨æˆ·ID |
| reason | VARCHAR(255) | NOT NULL | ç­¾ååŸå›  |
| object_type | VARCHAR(255) | NOT NULL | å¯¹è±¡ç±»å‹ |
| object_id | VARCHAR(255) | NOT NULL | å¯¹è±¡ID |
| signature_data | VARCHAR(255) | NOT NULL | ç­¾åæ•°æ® |
| signed_at | TIMESTAMP | NOT NULL DEFAULT CURRENT_TIMESTAMP | ç­¾åæ—¶é—´ |

#### audit_logè¡¨ï¼ˆå®¡è®¡æ—¥å¿—è¡¨ï¼‰

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸ | æè¿° |
|-------|---------|------|------|
| log_id | BIGSERIAL | PRIMARY KEY | æ—¥å¿—ID |
| user_id | BIGINT | REFERENCES user(user_id) | ç”¨æˆ·ID |
| operation | VARCHAR(255) | NOT NULL | æ“ä½œç±»å‹ |
| resource_type | VARCHAR(255) | | èµ„æºç±»å‹ |
| resource_id | VARCHAR(255) | | èµ„æºID |
| before_data | JSONB | | æ“ä½œå‰æ•°æ® |
| after_data | JSONB | | æ“ä½œåæ•°æ® |
| result | VARCHAR(50) | NOT NULL | æ“ä½œç»“æœ(SUCCESS/FAILURE) |
| ip_address | VARCHAR(100) | | IPåœ°å€ |
| user_agent | VARCHAR(255) | | ç”¨æˆ·ä»£ç† |
| operation_time | TIMESTAMP | NOT NULL DEFAULT CURRENT_TIMESTAMP | æ“ä½œæ—¶é—´ |

## 5. ç´¢å¼•è®¾è®¡

### 5.1 ä¸»é”®å’Œå¤–é”®ç´¢å¼•
- æ‰€æœ‰ä¸»é”®å·²è‡ªåŠ¨åˆ›å»ºç´¢å¼•
- æ‰€æœ‰å¤–é”®å­—æ®µå»ºè®®åˆ›å»ºç´¢å¼•ä»¥æé«˜æŸ¥è¯¢æ€§èƒ½

### 5.2 æ€§èƒ½ä¼˜åŒ–ç´¢å¼•

```sql
-- ç»„ç»‡å’Œéƒ¨é—¨æŸ¥è¯¢ä¼˜åŒ–
CREATE INDEX idx_organization_parent_id ON organization(parent_id);
CREATE INDEX idx_department_org_id ON department(org_id);
CREATE INDEX idx_department_parent_dept_id ON department(parent_dept_id);

-- ç”¨æˆ·æŸ¥è¯¢ä¼˜åŒ–
CREATE INDEX idx_user_username ON user(username);
CREATE INDEX idx_user_email ON user(email);
CREATE INDEX idx_user_dept_id ON user(dept_id);
CREATE INDEX idx_user_status ON user(status);

-- ç”¨æˆ·ç™»å½•å†å²æŸ¥è¯¢ä¼˜åŒ–
CREATE INDEX idx_user_login_history_user_id ON user_login_history(user_id);
CREATE INDEX idx_user_login_history_login_time ON user_login_history(login_time);

-- è§’è‰²æƒé™æŸ¥è¯¢ä¼˜åŒ–
CREATE INDEX idx_role_code ON role(code);
CREATE INDEX idx_permission_code ON permission(code);
CREATE INDEX idx_permission_group_name ON permission(group_name);

-- å®¡è®¡æ—¥å¿—æŸ¥è¯¢ä¼˜åŒ–
CREATE INDEX idx_audit_log_user_id ON audit_log(user_id);
CREATE INDEX idx_audit_log_operation_time ON audit_log(operation_time);
CREATE INDEX idx_audit_log_operation ON audit_log(operation);
CREATE INDEX idx_audit_log_resource_type ON audit_log(resource_type);
```

## 6. æ•°æ®çº¦æŸä¸å®Œæ•´æ€§è§„åˆ™

### 6.1 ä¸šåŠ¡è§„åˆ™çº¦æŸ

1. **å¾ªç¯å¼•ç”¨çº¦æŸ**ï¼šé€šè¿‡åº”ç”¨å±‚é€»è¾‘ç¡®ä¿ç»„ç»‡å’Œéƒ¨é—¨å±‚çº§ä¸å‡ºç°å¾ªç¯å¼•ç”¨
2. **è§’è‰²æœ‰æ•ˆæœŸçº¦æŸ**ï¼šä¸´æ—¶è§’è‰²å¿…é¡»è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œè¿‡æœŸåè‡ªåŠ¨å¤±æ•ˆ
3. **æƒé™æœ‰æ•ˆæ€§çº¦æŸ**ï¼šåˆ é™¤æƒé™å‰æ£€æŸ¥æ˜¯å¦è¢«è§’è‰²ä½¿ç”¨ï¼Œå·²ä½¿ç”¨çš„æƒé™ä¸å¯åˆ é™¤
4. **è§’è‰²æœ‰æ•ˆæ€§çº¦æŸ**ï¼šåˆ é™¤è§’è‰²å‰æ£€æŸ¥æ˜¯å¦è¢«ç”¨æˆ·ä½¿ç”¨ï¼Œå·²ä½¿ç”¨çš„è§’è‰²ä¸å¯åˆ é™¤

### 6.2 æ•°æ®ä¸€è‡´æ€§è§¦å‘å™¨

```sql
-- ç¤ºä¾‹ï¼šæ›´æ–°ç”¨æˆ·æ—¶è®°å½•å®¡è®¡æ—¥å¿—çš„è§¦å‘å™¨å‡½æ•°
CREATE OR REPLACE FUNCTION audit_user_update()
RETURNS TRIGGER AS $$
BEGIN
    INSERT INTO audit_log(user_id, operation, resource_type, resource_id, before_data, after_data, result, ip_address, user_agent)
    VALUES (
        current_setting('app.current_user_id')::BIGINT, 
        'UPDATE', 
        'USER', 
        OLD.user_id::TEXT,
        row_to_json(OLD),
        row_to_json(NEW),
        'SUCCESS',
        current_setting('app.client_ip', true),
        current_setting('app.user_agent', true)
    );
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- ä¸ºuserè¡¨åˆ›å»ºæ›´æ–°è§¦å‘å™¨
CREATE TRIGGER trg_audit_user_update
AFTER UPDATE ON user
FOR EACH ROW EXECUTE FUNCTION audit_user_update();
```

## 7. æ•°æ®è¿ç§»ç­–ç•¥

### 7.1 è¿ç§»è®¡åˆ’

1. **æ•°æ®å¤‡ä»½**ï¼šè¿ç§»å‰å¯¹ç°æœ‰æ•°æ®è¿›è¡Œå®Œæ•´å¤‡ä»½
2. **ç»“æ„è¿ç§»**ï¼šåˆ›å»ºæ–°è¡¨ç»“æ„ï¼Œä½†ä¿ç•™æ—§è¡¨ä»¥ç¡®ä¿å›æ»šèƒ½åŠ›
3. **æ•°æ®è½¬æ¢**ï¼šç¼–å†™è„šæœ¬å°†æ—§æ•°æ®è½¬æ¢ä¸ºæ–°ç»“æ„
4. **éªŒè¯æµ‹è¯•**ï¼šéªŒè¯æ•°æ®å®Œæ•´æ€§å’Œä¸šåŠ¡é€»è¾‘æ­£ç¡®æ€§
5. **åˆ‡æ¢ä¸Šçº¿**ï¼šå°†åº”ç”¨åˆ‡æ¢åˆ°æ–°çš„æ•°æ®ç»“æ„

### 7.2 è¿ç§»è„šæœ¬ç¤ºä¾‹

```sql
-- åˆ›å»ºæ–°è¡¨
CREATE TABLE new_user (
    -- æ–°è¡¨ç»“æ„å®šä¹‰
);

-- æ•°æ®è¿ç§»
INSERT INTO new_user (user_id, username, password_hash, ...)
SELECT user_id, username, password_hash, ...
FROM user;

-- è¿ç§»ç”¨æˆ·è§’è‰²å…³ç³»
INSERT INTO user_role (user_id, role_id, active, assigned_at)
SELECT user_id, role_id, true, CURRENT_TIMESTAMP
FROM user_role_old;
```

## 8. æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **æƒé™ç¼“å­˜ç­–ç•¥**ï¼š
   - ä½¿ç”¨Redisç¼“å­˜ç”¨æˆ·æƒé™æ•°æ®ï¼Œè¿‡æœŸæ—¶é—´è®¾ç½®ä¸º5-15åˆ†é’Ÿ
   - æƒé™å˜æ›´æ—¶ä¸»åŠ¨æ¸…é™¤ç›¸å…³ç¼“å­˜

2. **æŸ¥è¯¢ä¼˜åŒ–**ï¼š
   - å¯¹äºå¸¸ç”¨çš„æƒé™æ£€æŸ¥ï¼Œé¢„è®¡ç®—å¹¶ç¼“å­˜ç»“æœ
   - å®ç°æƒé™æ‰¹é‡éªŒè¯æ¥å£ï¼Œå‡å°‘æ•°æ®åº“æŸ¥è¯¢æ¬¡æ•°

3. **åˆ†åŒºç­–ç•¥**ï¼š
   - å¯¹å®¡è®¡æ—¥å¿—ç­‰å¤§æ•°æ®é‡è¡¨æŒ‰æ—¶é—´åˆ†åŒº
   - å®šæœŸå½’æ¡£å†å²æ•°æ®ä»¥æé«˜æŸ¥è¯¢æ€§èƒ½

4. **è¿æ¥æ± ä¼˜åŒ–**ï¼š
   - åˆç†é…ç½®æ•°æ®åº“è¿æ¥æ± å¤§å°ï¼ˆå»ºè®®åˆå§‹10ï¼Œæœ€å¤§50ï¼‰
   - å®ç°è¿æ¥æ± ç›‘æ§å’ŒåŠ¨æ€è°ƒæ•´

## 9. å®‰å…¨è€ƒè™‘

1. **æ•°æ®åŠ å¯†**ï¼š
   - å¯†ç ä½¿ç”¨BCryptç®—æ³•åŠ å¯†
   - æ•æ„Ÿé…ç½®ä¿¡æ¯ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–å¯†é’¥ç®¡ç†ç³»ç»Ÿ

2. **è®¿é—®æ§åˆ¶**ï¼š
   - å®ç°åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶(RBAC)
   - å…³é”®æ“ä½œéœ€è¦äºŒæ¬¡éªŒè¯

3. **å®¡è®¡è¿½è¸ª**ï¼š
   - æ‰€æœ‰å…³é”®æ“ä½œå¿…é¡»è®°å½•è¯¦ç»†å®¡è®¡æ—¥å¿—
   - æ”¯æŒæŒ‰ç”¨æˆ·ã€æ—¶é—´ã€æ“ä½œç±»å‹ç­‰å¤šç»´åº¦æŸ¥è¯¢

## 10. æ‰©å±•æ€§è®¾è®¡

1. **æ¨¡å—åŒ–è®¾è®¡**ï¼š
   - ç»„ç»‡ç»“æ„ã€ç”¨æˆ·ç®¡ç†ã€è§’è‰²æƒé™å¯ç‹¬ç«‹æ‰©å±•
   - æ”¯æŒå­ç³»ç»Ÿç‰¹å®šçš„æƒé™å®šä¹‰å’Œæ‰©å±•

2. **æ’ä»¶æ¶æ„**ï¼š
   - æ”¯æŒé€šè¿‡æ’ä»¶æ–¹å¼æ‰©å±•è®¤è¯æ–¹å¼ï¼ˆå¦‚LDAPã€OAuthï¼‰
   - æ”¯æŒè‡ªå®šä¹‰æƒé™éªŒè¯è§„åˆ™

3. **APIè®¾è®¡**ï¼š
   - æä¾›RESTful APIä¾›å„å­ç³»ç»Ÿé›†æˆ
   - æ”¯æŒæƒé™æ‰¹é‡æŸ¥è¯¢å’ŒéªŒè¯æ¥å£

---

*æœ¬æ•°æ®åº“è®¾è®¡åŸºäºå¯¹ç°æœ‰ç³»ç»Ÿçš„è¯„ä¼°å’ŒGMPå„å­ç³»ç»Ÿçš„éœ€æ±‚åˆ†æï¼Œæ—¨åœ¨æä¾›ä¸€ä¸ªå®Œæ•´ã€å®‰å…¨ã€é«˜æ€§èƒ½çš„ç”¨æˆ·æƒé™ç®¡ç†æ•°æ®ç»“æ„ã€‚*
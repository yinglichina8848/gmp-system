# 设备管理系统测试计划

## 文档信息
- **文档版本**: v1.1
- **创建日期**: 2025-11-22
- **最后更新**: 2025-11-23
- **作者**: 测试工程师
- **审核人**: 质量保证工程师
- **更新内容**: 新增认证与安全管理模块测试内容

## 目录
1. [概述](#概述)
2. [测试范围](#测试范围)
3. [测试策略](#测试策略)
4. [测试环境](#测试环境)
5. [测试用例](#测试用例)
6. [测试进度安排](#测试进度安排)
7. [风险评估](#风险评估)
8. [测试交付物](#测试交付物)

---

## 概述

### 文档目的
本文档定义了GMP系统设备管理子系统的测试计划，包括测试范围、策略、环境、用例和进度安排等内容，确保设备管理系统符合GMP法规要求并满足业务需求。

### 参考文档
- [设备管理系统总体需求](01_总体需求.md)
- [设备管理系统详细需求](06_详细需求.md)
- [用户故事编写文档](用户故事编写文档.md)
- [认证子系统接口规范](../auth-sys/README.md)
- [21 CFR Part 11法规要求](https://www.fda.gov/regulatory-information/search-fda-guidance-documents/part-11-electronic-records-electronic-signatures-scope-and-application)

### GMP特殊要求
- **合规性验证**: 所有功能必须符合GMP法规要求
- **审计可追溯**: 关键操作必须支持完整审计追踪
- **数据完整性**: 设备相关信息必须准确记录和存储
- **权限分离**: 设备操作与审核必须实施职责分离原则

---

## 测试范围

### 包含的功能模块
1. **设备档案管理模块**
   - 设备基本信息管理
   - 设备技术资料管理
   - 设备分类管理
   
2. **设备状态管理模块**
   - 设备运行状态跟踪
   - 设备维修状态管理
   - 设备停用报废管理
   
3. **设备维护保养模块**
   - 维护计划制定与执行
   - 保养计划制定与执行
   - 维保记录管理
   
4. **设备校准管理模块**
   - 校准计划管理
   - 校准执行记录
   - 校准证书管理
   
5. **设备审计追踪模块**
   - 设备全生命周期追踪
   - 操作日志记录
   - 变更历史查询
   
6. **认证与安全管理模块**
   - 认证子系统集成
   - 单点登录(SSO)功能
   - 电子签名管理
   - 审计日志管理
   - 权限矩阵验证

### 不包含的内容
- 大型设备的3D模型展示
- 与外部设备监控系统的实时数据对接
- 移动端专用APP功能

---

## 测试策略

### 测试类型
1. **单元测试**
   - 验证各服务类的方法逻辑正确性
   - 覆盖率目标：85%以上
   
2. **集成测试**
   - 验证各模块间的接口调用正确性
   - 验证数据库操作正确性
   
3. **接口测试**
   - 验证RESTful API的功能正确性
   - 验证请求/响应数据格式
   
4. **业务流程测试**
   - 验证设备全生命周期管理流程
   - 验证维保计划执行流程
   
5. **安全测试**
   - 验证认证子系统集成功能
   - 验证单点登录(SSO)认证流程
   - 验证数据访问权限控制
   - 验证敏感操作审批流程
   - 验证电子签名的有效性和不可篡改性
   - 验证审计日志的完整性和准确性
   - 验证21 CFR Part 11合规性要求
   
6. **性能测试**
   - 验证大量设备数据查询性能
   - 验证并发操作处理能力

### 测试方法
- **黑盒测试**: 验证功能是否符合需求
- **白盒测试**: 验证代码逻辑是否正确
- **灰盒测试**: 结合前后端验证业务流程

---

## 测试环境

### 硬件环境
| 组件 | 配置 | 数量 |
|------|------|------|
| 应用服务器 | 4核CPU, 8GB内存 | 1台 |
| 数据库服务器 | 4核CPU, 8GB内存, 100GB存储 | 1台 |
| 文件存储服务器 | 4核CPU, 8GB内存, 500GB存储 | 1台 |
| 测试客户端 | 2核CPU, 4GB内存 | 2台 |

### 软件环境
| 软件 | 版本 | 说明 |
|------|------|------|
| 操作系统 | Ubuntu 24.04 | 服务器环境 |
| JDK | OpenJDK 17 | 运行环境 |
| 数据库 | PostgreSQL 13 | 数据存储 |
| 文件存储 | MinIO | 文档存储 |
| Web服务器 | Nginx 1.20 | 反向代理 |
| 测试工具 | JUnit 5, Postman | 测试执行 |

### 网络环境
- 内网环境，支持HTTPS协议
- 网络延迟 < 10ms
- 带宽 >= 100Mbps

---

## 测试用例

### 功能测试用例

#### TC001: 设备档案创建
- **前置条件**: 用户具有设备管理员权限
- **测试步骤**:
  1. 登录系统，进入设备管理模块
  2. 点击"新增设备"按钮
  3. 填写设备基本信息和技术参数
  4. 上传设备技术文档
  5. 提交保存
- **预期结果**: 
  1. 设备档案成功创建
  2. 系统生成设备编号
  3. 技术文档成功上传并关联
  4. 操作日志被记录

#### TC002: 设备维护计划执行
- **前置条件**: 存在待执行的设备维护计划
- **测试步骤**:
  1. 登录系统，进入维护计划页面
  2. 查看待执行的维护计划
  3. 点击"执行维护"按钮
  4. 填写维护执行记录
  5. 提交执行结果
- **预期结果**: 
  1. 维护计划状态更新为"已完成"
  2. 维护记录被保存
  3. 下次维护计划自动生成
  4. 操作日志被记录

#### TC003: 设备报废流程
- **前置条件**: 存在需要报废的设备
- **测试步骤**:
  1. 登录系统，选择目标设备
  2. 点击"申请报废"按钮
  3. 填写报废原因和说明
  4. 提交报废申请
  5. 审批人员审核通过
- **预期结果**: 
  1. 设备状态变更为"报废"
  2. 设备不可再使用
  3. 审批流程完整记录
  4. 操作日志被记录

### 安全测试用例

#### TC004: 权限访问控制
- **前置条件**: 不同角色的用户账户
- **测试步骤**:
  1. 使用普通用户账号登录
  2. 尝试访问设备报废功能
- **预期结果**: 
  1. 系统拒绝访问
  2. 提示权限不足

#### TC005: 数据完整性验证
- **前置条件**: 系统中有设备档案数据
- **测试步骤**:  
  1. 尝试直接修改数据库中设备信息
  2. 查询设备信息
- **预期结果**: 
  1. 数据库修改被拒绝或触发告警
  2. 系统数据保持一致

### 认证与安全测试用例

#### TC006: 认证子系统集成测试
- **前置条件**: 认证子系统已部署并运行
- **测试步骤**:  
  1. 通过设备管理系统登录界面访问
  2. 跳转到认证子系统登录页面
  3. 输入有效凭证登录
  4. 验证是否成功跳转回设备管理系统
- **预期结果**: 
  1. 成功跳转到认证子系统登录页面
  2. 登录后成功跳转回设备管理系统
  3. 用户会话状态正确维护

#### TC007: 电子签名功能测试
- **前置条件**: 存在需要电子签名确认的设备维护记录
- **测试步骤**:  
  1. 登录系统，进入维护记录详情页面
  2. 点击"签名确认"按钮
  3. 输入用户名和密码，确认签名意图
  4. 提交签名
- **预期结果**: 
  1. 签名成功并关联到维护记录
  2. 签名信息包含用户ID、时间戳和意图
  3. 生成对应的审计日志
  4. 签名记录不可修改

#### TC008: 双人复核电子签名测试
- **前置条件**: 存在需要双人复核的关键设备操作
- **测试步骤**:  
  1. 操作人员完成操作并进行一级电子签名
  2. 审核人员登录系统，查看待复核操作
  3. 审核人员进行二级电子签名确认
- **预期结果**: 
  1. 一级签名成功记录
  2. 二级签名成功关联到一级签名
  3. 系统记录完整的双人签名流程
  4. 操作在二级签名后生效

#### TC009: 审计日志完整性测试
- **前置条件**: 系统正常运行
- **测试步骤**:  
  1. 执行多种设备操作（创建、修改、删除、维护等）
  2. 执行电子签名操作
  3. 登录/登出系统多次
  4. 查询审计日志
- **预期结果**: 
  1. 所有操作都有对应的审计日志记录
  2. 日志包含用户、时间、操作类型、详情等完整信息
  3. 日志不可修改或删除
  4. 查询功能正常工作

#### TC010: 21 CFR Part 11合规性测试
- **前置条件**: 系统完整功能已实现
- **测试步骤**:  
  1. 验证电子记录的创建、修改、删除控制
  2. 验证电子签名的唯一性、不可否认性
  3. 验证系统访问控制和权限管理
  4. 验证审计日志的完整性和保留
  5. 验证系统变更控制
- **预期结果**: 
  1. 系统符合21 CFR Part 11所有适用要求
  2. 电子记录受保护不被未授权修改
  3. 电子签名可明确标识签名人
  4. 审计跟踪完整记录所有关键操作

---

## 测试进度安排

| 阶段 | 时间 | 任务 | 负责人 |
|------|------|------|--------|
| 需求分析 | 1天 | 分析测试需求，编写测试用例 | 测试工程师 |
| 测试准备 | 1天 | 搭建测试环境，准备测试数据 | 测试工程师 |
| 单元测试 | 3天 | 执行单元测试，修复缺陷 | 开发工程师 |
| 集成测试 | 2天 | 执行集成测试，验证接口 | 测试工程师 |
| 系统测试 | 4天 | 执行系统测试，验证功能 | 测试工程师 |
| 业务流程测试 | 2天 | 执行业务流程测试 | 测试工程师 |
| 安全测试 | 3天 | 执行安全测试，验证防护 | 安全工程师 |
| 认证与电子签名测试 | 2天 | 验证认证子系统集成、电子签名功能、审计日志 | 安全工程师 |
| 合规性测试 | 1天 | 验证21 CFR Part 11合规性要求 | 质量保证工程师 |
| 性能测试 | 2天 | 执行性能测试，优化瓶颈 | 性能工程师 |
| 回归测试 | 1天 | 验证缺陷修复情况 | 测试工程师 |
| 测试总结 | 1天 | 编写测试报告 | 测试经理 |

---

## 风险评估

| 风险项 | 描述 | 影响程度 | 应对措施 |
|--------|------|----------|----------|
| 环境不稳定 | 测试环境频繁出现故障 | 高 | 提前准备备用环境 |
| 人员不足 | 测试人员临时缺席 | 中 | 安排人员备份 |
| 需求变更 | 需求发生重大变化 | 高 | 加强需求评审 |
| 工具缺陷 | 测试工具存在bug | 低 | 准备替代方案 |
| 数据准备 | 测试数据量大且复杂 | 中 | 提前准备数据脚本 |
| 认证子系统集成失败 | 与认证子系统连接出现问题 | 高 | 提前与认证子系统团队协调，准备降级方案 |
| 电子签名合规性不足 | 电子签名功能不符合21 CFR Part 11要求 | 高 | 邀请合规专家参与测试，参考FDA指南 |
| 安全漏洞 | 系统存在未发现的安全漏洞 | 高 | 增加渗透测试，引入安全专家评审 |

---

## 测试交付物

### 测试过程中交付
1. 测试用例文档
2. 测试执行记录
3. 缺陷报告

### 测试完成后交付
1. 测试计划文档
2. 测试报告
3. 测试覆盖率报告
4. 性能测试报告
5. 安全测试报告
6. 业务流程测试报告
7. 认证子系统集成测试报告
8. 电子签名功能测试报告
9. 审计日志验证报告
10. 21 CFR Part 11合规性测试报告
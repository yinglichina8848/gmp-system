<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.9.8" xml:lang="en-US">
  <compounddef id="DocumentPermissionServiceImpl_8java" kind="file" language="Java">
    <compoundname>DocumentPermissionServiceImpl.java</compoundname>
    <includes local="no">com.gmp.edms.entity.Document</includes>
    <incdepgraph>
      <node id="1">
        <label>edms-service/src/main/java/com/gmp/edms/service/impl/DocumentPermissionServiceImpl.java</label>
        <link refid="DocumentPermissionServiceImpl_8java"/>
        <childnode refid="2" relation="include">
        </childnode>
      </node>
      <node id="2">
        <label>com.gmp.edms.entity.Document</label>
      </node>
    </incdepgraph>
    <innerclass refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl" prot="public">com::gmp::edms::service::impl::DocumentPermissionServiceImpl</innerclass>
    <innerclass refid="interfacecom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionPolicy" prot="private">com::gmp::edms::service::impl::DocumentPermissionServiceImpl::PermissionPolicy</innerclass>
    <innerclass refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1DocumentOwnerPolicy" prot="private">com::gmp::edms::service::impl::DocumentPermissionServiceImpl::DocumentOwnerPolicy</innerclass>
    <innerclass refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1DepartmentPolicy" prot="private">com::gmp::edms::service::impl::DocumentPermissionServiceImpl::DepartmentPolicy</innerclass>
    <innerclass refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1ConfidentialityPolicy" prot="private">com::gmp::edms::service::impl::DocumentPermissionServiceImpl::ConfidentialityPolicy</innerclass>
    <innerclass refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1StatusPolicy" prot="private">com::gmp::edms::service::impl::DocumentPermissionServiceImpl::StatusPolicy</innerclass>
    <innerclass refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext" prot="private">com::gmp::edms::service::impl::DocumentPermissionServiceImpl::PermissionContext</innerclass>
    <innernamespace refid="namespacecom_1_1gmp_1_1edms_1_1service_1_1impl">com::gmp::edms::service::impl</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="keyword">package<sp/></highlight><highlight class="normal">com.gmp.edms.service.impl;</highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>com.gmp.edms.entity.Document;</highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>com.gmp.edms.entity.DocumentCategory;</highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>com.gmp.edms.repository.DocumentRepository;</highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>com.gmp.edms.service.DocumentPermissionService;</highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>org.slf4j.Logger;</highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>org.slf4j.LoggerFactory;</highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>org.springframework.beans.factory.annotation.Autowired;</highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>org.springframework.stereotype.Service;</highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.lang.reflect.Field;</highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.lang.reflect.Method;</highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.time.LocalDateTime;</highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.ArrayList;</highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.HashSet;</highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.List;</highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.Set;</highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.stream.Collectors;</highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight></codeline>
<codeline lineno="25"><highlight class="normal">@Service</highlight></codeline>
<codeline lineno="26" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl" kindref="compound">DocumentPermissionServiceImpl</ref><sp/></highlight><highlight class="keyword">implements</highlight><highlight class="normal"><sp/><ref refid="interfacecom_1_1gmp_1_1edms_1_1service_1_1DocumentPermissionService" kindref="compound">DocumentPermissionService</ref><sp/>{</highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight></codeline>
<codeline lineno="28" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1afa5c8dbe6fe6b1d287765bea458592e0" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>Logger<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1afa5c8dbe6fe6b1d287765bea458592e0" kindref="member">log</ref><sp/>=<sp/>LoggerFactory.getLogger(<ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl" kindref="compound">DocumentPermissionServiceImpl</ref>.class);</highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight></codeline>
<codeline lineno="30"><highlight class="normal"><sp/><sp/><sp/><sp/>@Autowired</highlight></codeline>
<codeline lineno="31" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a22ca9dea7b3537fdeca080851752a5fb" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>DocumentRepository<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a22ca9dea7b3537fdeca080851752a5fb" kindref="member">documentRepository</ref>;</highlight></codeline>
<codeline lineno="32"><highlight class="normal"></highlight></codeline>
<codeline lineno="33"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>假设的配置信息</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="34" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a5bfe3224c41ab960e89ff1a0e37bd713" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>Set&lt;String&gt;<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a5bfe3224c41ab960e89ff1a0e37bd713" kindref="member">adminUsers</ref><sp/>=<sp/>Set.of(</highlight><highlight class="stringliteral">&quot;admin&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;system&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;gmp_admin&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="35"><highlight class="normal"></highlight></codeline>
<codeline lineno="36"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="37" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1ac7c390c7bed721d7c801fa9488f33811" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1ac7c390c7bed721d7c801fa9488f33811" kindref="member">hasPermission</ref>(String<sp/>userId,<sp/>Long<sp/>documentId,<sp/><ref refid="enumcom_1_1gmp_1_1edms_1_1service_1_1DocumentPermissionService_1_1PermissionType" kindref="compound">PermissionType</ref><sp/>permission)<sp/>{</highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>1.<sp/>获取用户角色</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Set&lt;String&gt;<sp/>userRoles<sp/>=<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a1d26a58d598c1f8f7dc7b37e02bd00ce" kindref="member">getUserRoles</ref>(userId);</highlight></codeline>
<codeline lineno="41"><highlight class="normal"></highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>2.<sp/>获取文档权限策略</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Document<sp/>document<sp/>=<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a22ca9dea7b3537fdeca080851752a5fb" kindref="member">documentRepository</ref>.findById(documentId)</highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.orElseThrow(()<sp/>-&gt;<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classRuntimeException" kindref="compound">RuntimeException</ref>(</highlight><highlight class="stringliteral">&quot;文档不存在:<sp/>&quot;</highlight><highlight class="normal"><sp/>+<sp/>documentId));</highlight></codeline>
<codeline lineno="45"><highlight class="normal"></highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;PermissionPolicy&gt;<sp/>policies<sp/>=<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a820ea93d15bb39248e1a10530608e82a" kindref="member">getDocumentPolicies</ref>(document);</highlight></codeline>
<codeline lineno="47"><highlight class="normal"></highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>3.<sp/>权限计算：角色<sp/>+<sp/>策略<sp/>+<sp/>上下文</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext" kindref="compound">PermissionContext</ref><sp/>context<sp/>=<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a371390666c246641a7a26f557481f4df" kindref="member">getContext</ref>(userId,<sp/>document);</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a0c1ade445d1ba388327b8bd2d68af201" kindref="member">evaluatePermissions</ref>(userRoles,<sp/>policies,<sp/>permission,<sp/>context);</highlight></codeline>
<codeline lineno="51"><highlight class="normal"></highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(Exception<sp/>e)<sp/>{</highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>异常情况下默认拒绝访问</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="57"><highlight class="normal"></highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="59" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a8c7065181dfed328acceddd5959cf81f" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a8c7065181dfed328acceddd5959cf81f" kindref="member">hasCreatePermission</ref>(String<sp/>userId,<sp/>Long<sp/>categoryId)<sp/>{</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>检查用户是否有在指定分类下创建文档的权限</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Set&lt;String&gt;<sp/>userRoles<sp/>=<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a1d26a58d598c1f8f7dc7b37e02bd00ce" kindref="member">getUserRoles</ref>(userId);</highlight></codeline>
<codeline lineno="62"><highlight class="normal"></highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>管理员可以在任何分类下创建文档</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a6ae738e5b2b23a3a7fdc60fb60be50ee" kindref="member">isAdmin</ref>(userRoles))<sp/>{</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="67"><highlight class="normal"></highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>检查分类权限</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1ab9c267ffeeba1315ff726048b61eed98" kindref="member">hasCategoryPermission</ref>(userId,<sp/>categoryId,<sp/><ref refid="enumcom_1_1gmp_1_1edms_1_1service_1_1DocumentPermissionService_1_1PermissionType" kindref="compound">PermissionType</ref>.<ref refid="enumcom_1_1gmp_1_1edms_1_1service_1_1DocumentPermissionService_1_1PermissionType_1aa90403d5f3fb670c84dee438294b1df6" kindref="member">EDIT</ref>);</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="71"><highlight class="normal"></highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="73" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1ad4b9efad7a1c47825924b0460d5148b3" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>Set&lt;PermissionType&gt;<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1ad4b9efad7a1c47825924b0460d5148b3" kindref="member">getUserPermissions</ref>(String<sp/>userId,<sp/>Long<sp/>documentId)<sp/>{</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Set&lt;PermissionType&gt;<sp/>permissions<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>HashSet&lt;&gt;();</highlight></codeline>
<codeline lineno="75"><highlight class="normal"></highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Document<sp/>document<sp/>=<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a22ca9dea7b3537fdeca080851752a5fb" kindref="member">documentRepository</ref>.findById(documentId).orElse(</highlight><highlight class="keyword">null</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(document<sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>permissions;</highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="80"><highlight class="normal"></highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Set&lt;String&gt;<sp/>userRoles<sp/>=<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a1d26a58d598c1f8f7dc7b37e02bd00ce" kindref="member">getUserRoles</ref>(userId);</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;PermissionPolicy&gt;<sp/>policies<sp/>=<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a820ea93d15bb39248e1a10530608e82a" kindref="member">getDocumentPolicies</ref>(document);</highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext" kindref="compound">PermissionContext</ref><sp/>context<sp/>=<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a371390666c246641a7a26f557481f4df" kindref="member">getContext</ref>(userId,<sp/>document);</highlight></codeline>
<codeline lineno="84"><highlight class="normal"></highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="enumcom_1_1gmp_1_1edms_1_1service_1_1DocumentPermissionService_1_1PermissionType" kindref="compound">PermissionType</ref><sp/>permission<sp/>:<sp/><ref refid="enumcom_1_1gmp_1_1edms_1_1service_1_1DocumentPermissionService_1_1PermissionType" kindref="compound">PermissionType</ref>.values())<sp/>{</highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a0c1ade445d1ba388327b8bd2d68af201" kindref="member">evaluatePermissions</ref>(userRoles,<sp/>policies,<sp/>permission,<sp/>context))<sp/>{</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>permissions.add(permission);</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="90"><highlight class="normal"></highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>permissions;</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="93"><highlight class="normal"></highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="95" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1ad5cd24b3caa2374a8bbcc649d4532c20" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1ad5cd24b3caa2374a8bbcc649d4532c20" kindref="member">canApprove</ref>(String<sp/>userId,<sp/>Long<sp/>documentId)<sp/>{</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1ac7c390c7bed721d7c801fa9488f33811" kindref="member">hasPermission</ref>(userId,<sp/>documentId,<sp/><ref refid="enumcom_1_1gmp_1_1edms_1_1service_1_1DocumentPermissionService_1_1PermissionType" kindref="compound">PermissionType</ref>.<ref refid="enumcom_1_1gmp_1_1edms_1_1service_1_1DocumentPermissionService_1_1PermissionType_1aac149bf30c3ed1cb41d9a056ef810417" kindref="member">APPROVE</ref>);</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="98"><highlight class="normal"></highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="100" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1afca196bc1ac7e3f70f04288e8f12f8c0" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1afca196bc1ac7e3f70f04288e8f12f8c0" kindref="member">canView</ref>(String<sp/>userId,<sp/>Long<sp/>documentId)<sp/>{</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1ac7c390c7bed721d7c801fa9488f33811" kindref="member">hasPermission</ref>(userId,<sp/>documentId,<sp/><ref refid="enumcom_1_1gmp_1_1edms_1_1service_1_1DocumentPermissionService_1_1PermissionType" kindref="compound">PermissionType</ref>.<ref refid="enumcom_1_1gmp_1_1edms_1_1service_1_1DocumentPermissionService_1_1PermissionType_1aec890097acc7208bfb2d4ff159c6da81" kindref="member">VIEW</ref>);</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="103"><highlight class="normal"></highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="105" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a60dbf9239a4aa9f5d313b2c83ca22ced" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a60dbf9239a4aa9f5d313b2c83ca22ced" kindref="member">canEdit</ref>(String<sp/>userId,<sp/>Long<sp/>documentId)<sp/>{</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1ac7c390c7bed721d7c801fa9488f33811" kindref="member">hasPermission</ref>(userId,<sp/>documentId,<sp/><ref refid="enumcom_1_1gmp_1_1edms_1_1service_1_1DocumentPermissionService_1_1PermissionType" kindref="compound">PermissionType</ref>.<ref refid="enumcom_1_1gmp_1_1edms_1_1service_1_1DocumentPermissionService_1_1PermissionType_1aa90403d5f3fb670c84dee438294b1df6" kindref="member">EDIT</ref>);</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="108"><highlight class="normal"></highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="110" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a0e449a4e96b6d46b4ef9919360fa93bb" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a0e449a4e96b6d46b4ef9919360fa93bb" kindref="member">canDelete</ref>(String<sp/>userId,<sp/>Long<sp/>documentId)<sp/>{</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1ac7c390c7bed721d7c801fa9488f33811" kindref="member">hasPermission</ref>(userId,<sp/>documentId,<sp/><ref refid="enumcom_1_1gmp_1_1edms_1_1service_1_1DocumentPermissionService_1_1PermissionType" kindref="compound">PermissionType</ref>.<ref refid="enumcom_1_1gmp_1_1edms_1_1service_1_1DocumentPermissionService_1_1PermissionType_1a915fc3c890df8f37cb310865d810d2f1" kindref="member">DELETE</ref>);</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="113"><highlight class="normal"></highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="115" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1ae67b0c2a3383ccd3a4656305e0f1276d" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1ae67b0c2a3383ccd3a4656305e0f1276d" kindref="member">canDownload</ref>(String<sp/>userId,<sp/>Long<sp/>documentId)<sp/>{</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1ac7c390c7bed721d7c801fa9488f33811" kindref="member">hasPermission</ref>(userId,<sp/>documentId,<sp/><ref refid="enumcom_1_1gmp_1_1edms_1_1service_1_1DocumentPermissionService_1_1PermissionType" kindref="compound">PermissionType</ref>.<ref refid="enumcom_1_1gmp_1_1edms_1_1service_1_1DocumentPermissionService_1_1PermissionType_1a2c0e50007976a74faccaf533d5e090b8" kindref="member">DOWNLOAD</ref>);</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="118"><highlight class="normal"></highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="120" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a6b4947a64c432f64f2129607f43dee58" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>Set&lt;Long&gt;<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a6b4947a64c432f64f2129607f43dee58" kindref="member">getAccessibleDocumentIds</ref>(String<sp/>userId,<sp/><ref refid="enumcom_1_1gmp_1_1edms_1_1service_1_1DocumentPermissionService_1_1PermissionType" kindref="compound">PermissionType</ref><sp/>permission)<sp/>{</highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>获取所有文档，然后根据权限过滤</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;Document&gt;<sp/>allDocuments<sp/>=<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a22ca9dea7b3537fdeca080851752a5fb" kindref="member">documentRepository</ref>.findAll();</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Set&lt;Long&gt;<sp/>accessibleIds<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>HashSet&lt;&gt;();</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(Document<sp/>doc<sp/>:<sp/>allDocuments)<sp/>{</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>使用反射获取id</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>java.lang.reflect.Field<sp/>idField<sp/>=<sp/>Document.class.getDeclaredField(</highlight><highlight class="stringliteral">&quot;id&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>idField.setAccessible(</highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Long<sp/>docId<sp/>=<sp/>(Long)<sp/>idField.get(doc);</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1ac7c390c7bed721d7c801fa9488f33811" kindref="member">hasPermission</ref>(userId,<sp/>docId,<sp/>permission))<sp/>{</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>accessibleIds.add(docId);</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(Exception<sp/>e)<sp/>{</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>处理异常，跳过该文档</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>accessibleIds;</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="139"><highlight class="normal"></highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="141" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a829c9ced031c437a6b872d5b537b5cfa" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a829c9ced031c437a6b872d5b537b5cfa" kindref="member">hasPermissionWithTimeWindow</ref>(String<sp/>userId,<sp/>Long<sp/>documentId,<sp/><ref refid="enumcom_1_1gmp_1_1edms_1_1service_1_1DocumentPermissionService_1_1PermissionType" kindref="compound">PermissionType</ref><sp/>permission,</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>LocalDateTime<sp/>currentTime)<sp/>{</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>基于时间窗口的权限检查</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Document<sp/>document<sp/>=<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a22ca9dea7b3537fdeca080851752a5fb" kindref="member">documentRepository</ref>.findById(documentId).orElse(</highlight><highlight class="keyword">null</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(document<sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="148"><highlight class="normal"></highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>检查文档是否在有效期内</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>LocalDateTime<sp/>effectiveDate<sp/>=<sp/>(LocalDateTime)<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a46844b43875199ee3328a9a3e498bf3a" kindref="member">getFieldValue</ref>(document,<sp/></highlight><highlight class="stringliteral">&quot;effectiveDate&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(effectiveDate<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal"><sp/>&amp;&amp;<sp/>currentTime.isBefore(effectiveDate))<sp/>{</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="154"><highlight class="normal"></highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>LocalDateTime<sp/>expiryDate<sp/>=<sp/>(LocalDateTime)<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a46844b43875199ee3328a9a3e498bf3a" kindref="member">getFieldValue</ref>(document,<sp/></highlight><highlight class="stringliteral">&quot;expiryDate&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(expiryDate<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal"><sp/>&amp;&amp;<sp/>currentTime.isAfter(expiryDate))<sp/>{</highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="159"><highlight class="normal"></highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1ac7c390c7bed721d7c801fa9488f33811" kindref="member">hasPermission</ref>(userId,<sp/>documentId,<sp/>permission);</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="162"><highlight class="normal"></highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="164" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a9a5d805830db9269d1b57395abcf0caf" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a9a5d805830db9269d1b57395abcf0caf" kindref="member">hasPermissionWithLocation</ref>(String<sp/>userId,<sp/>Long<sp/>documentId,<sp/><ref refid="enumcom_1_1gmp_1_1edms_1_1service_1_1DocumentPermissionService_1_1PermissionType" kindref="compound">PermissionType</ref><sp/>permission,</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>String<sp/>location)<sp/>{</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>基于地理位置的权限检查</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>这里可以实现IP地址限制、地理位置限制等</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1ac7c390c7bed721d7c801fa9488f33811" kindref="member">hasPermission</ref>(userId,<sp/>documentId,<sp/>permission);</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="170"><highlight class="normal"></highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>私有辅助方法</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="172"><highlight class="normal"></highlight></codeline>
<codeline lineno="173" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a1d26a58d598c1f8f7dc7b37e02bd00ce" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>Set&lt;String&gt;<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a1d26a58d598c1f8f7dc7b37e02bd00ce" kindref="member">getUserRoles</ref>(String<sp/>userId)<sp/>{</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>这里应该从用户服务或权限服务获取用户角色</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>简化实现</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Set&lt;String&gt;<sp/>roles<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>HashSet&lt;&gt;();</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a5bfe3224c41ab960e89ff1a0e37bd713" kindref="member">adminUsers</ref>.contains(userId))<sp/>{</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>roles.add(</highlight><highlight class="stringliteral">&quot;ADMIN&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>roles.add(</highlight><highlight class="stringliteral">&quot;ROLE_SYSTEM_ADMIN&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>roles.add(</highlight><highlight class="stringliteral">&quot;ROLE_OPERATOR&quot;</highlight><highlight class="normal">);<sp/></highlight><highlight class="comment">//<sp/>默认角色</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>roles;</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="184"><highlight class="normal"></highlight></codeline>
<codeline lineno="185" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a820ea93d15bb39248e1a10530608e82a" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>List&lt;PermissionPolicy&gt;<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a820ea93d15bb39248e1a10530608e82a" kindref="member">getDocumentPolicies</ref>(Document<sp/>document)<sp/>{</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>根据文档属性生成权限策略</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>List.of(</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1DocumentOwnerPolicy" kindref="compound">DocumentOwnerPolicy</ref>((String)<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a46844b43875199ee3328a9a3e498bf3a" kindref="member">getFieldValue</ref>(document,<sp/></highlight><highlight class="stringliteral">&quot;author&quot;</highlight><highlight class="normal">)),</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1DepartmentPolicy" kindref="compound">DepartmentPolicy</ref>((String)<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a46844b43875199ee3328a9a3e498bf3a" kindref="member">getFieldValue</ref>(document,<sp/></highlight><highlight class="stringliteral">&quot;ownerDepartment&quot;</highlight><highlight class="normal">)),</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1ConfidentialityPolicy" kindref="compound">ConfidentialityPolicy</ref>((String)<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a46844b43875199ee3328a9a3e498bf3a" kindref="member">getFieldValue</ref>(document,<sp/></highlight><highlight class="stringliteral">&quot;confidentialityLevel&quot;</highlight><highlight class="normal">)),</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1StatusPolicy" kindref="compound">StatusPolicy</ref>((String)<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a46844b43875199ee3328a9a3e498bf3a" kindref="member">getFieldValue</ref>(document,<sp/></highlight><highlight class="stringliteral">&quot;status&quot;</highlight><highlight class="normal">)));</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="193"><highlight class="normal"></highlight></codeline>
<codeline lineno="197" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a46844b43875199ee3328a9a3e498bf3a" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>Object<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a46844b43875199ee3328a9a3e498bf3a" kindref="member">getFieldValue</ref>(Object<sp/>obj,<sp/>String<sp/>fieldName)<sp/>{</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(obj<sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal"><sp/>||<sp/>fieldName<sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="201"><highlight class="normal"></highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>尝试通过字段访问</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Field<sp/>field<sp/>=<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1adc47699f485d672a8244a593f366cd3c" kindref="member">findField</ref>(obj.getClass(),<sp/>fieldName);</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(field<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>field.setAccessible(</highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>field.get(obj);</highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>尝试通过getter方法获取</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>String<sp/>getterName<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;get&quot;</highlight><highlight class="normal"><sp/>+<sp/>Character.toUpperCase(fieldName.charAt(0))<sp/>+<sp/>fieldName.substring(1);</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Method<sp/>getter<sp/>=<sp/>obj.getClass().getMethod(getterName);</highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>getter.invoke(obj);</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(NoSuchMethodException<sp/>e)<sp/>{</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>如果getter不存在，返回null</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(Exception<sp/>e)<sp/>{</highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1afa5c8dbe6fe6b1d287765bea458592e0" kindref="member">log</ref>.error(</highlight><highlight class="stringliteral">&quot;获取字段值失败:<sp/>{}.{}&quot;</highlight><highlight class="normal">,<sp/>obj.getClass().getSimpleName(),<sp/>fieldName,<sp/>e);</highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="223"><highlight class="normal"></highlight></codeline>
<codeline lineno="227" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1adc47699f485d672a8244a593f366cd3c" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>Field<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1adc47699f485d672a8244a593f366cd3c" kindref="member">findField</ref>(Class&lt;?&gt;<sp/>clazz,<sp/>String<sp/>fieldName)<sp/>{</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Class&lt;?&gt;<sp/>currentClass<sp/>=<sp/>clazz;</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(currentClass<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal"><sp/>&amp;&amp;<sp/>currentClass<sp/>!=<sp/>Object.class)<sp/>{</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>currentClass.getDeclaredField(fieldName);</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(NoSuchFieldException<sp/>e)<sp/>{</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>currentClass<sp/>=<sp/>currentClass.getSuperclass();</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="238"><highlight class="normal"></highlight></codeline>
<codeline lineno="239" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a371390666c246641a7a26f557481f4df" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext" kindref="compound">PermissionContext</ref><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a371390666c246641a7a26f557481f4df" kindref="member">getContext</ref>(String<sp/>userId,<sp/>Document<sp/>document)<sp/>{</highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext" kindref="compound">PermissionContext</ref><sp/>context<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext" kindref="compound">PermissionContext</ref>();</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>context.<ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a2784d6a23d50e223c2b5843bb0ce0985" kindref="member">setUserId</ref>(userId);</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>使用反射获取documentId</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>java.lang.reflect.Field<sp/>idField<sp/>=<sp/>Document.class.getDeclaredField(</highlight><highlight class="stringliteral">&quot;id&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>idField.setAccessible(</highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>context.<ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1ae4af17d590cb15a523e26bd0e3845513" kindref="member">setDocumentId</ref>((Long)<sp/>idField.get(document));</highlight></codeline>
<codeline lineno="247"><highlight class="normal"></highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>使用反射获取documentType</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>java.lang.reflect.Field<sp/>typeField<sp/>=<sp/>Document.class.getDeclaredField(</highlight><highlight class="stringliteral">&quot;documentType&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>typeField.setAccessible(</highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>context.<ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a8852b13c701429e0dec85bb7b8587e36" kindref="member">setDocumentType</ref>((String)<sp/>typeField.get(document));</highlight></codeline>
<codeline lineno="252"><highlight class="normal"></highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>使用反射获取confidentialityLevel</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>java.lang.reflect.Field<sp/>levelField<sp/>=<sp/>Document.class.getDeclaredField(</highlight><highlight class="stringliteral">&quot;confidentialityLevel&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>levelField.setAccessible(</highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>context.<ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a2bd43872513afa653e165e6f98c9fa75" kindref="member">setConfidentialityLevel</ref>((String)<sp/>levelField.get(document));</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(Exception<sp/>e)<sp/>{</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>处理异常，设置默认值</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>context.<ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1ae4af17d590cb15a523e26bd0e3845513" kindref="member">setDocumentId</ref>(</highlight><highlight class="keyword">null</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>context.<ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a8852b13c701429e0dec85bb7b8587e36" kindref="member">setDocumentType</ref>(</highlight><highlight class="keyword">null</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>context.<ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a2bd43872513afa653e165e6f98c9fa75" kindref="member">setConfidentialityLevel</ref>(</highlight><highlight class="keyword">null</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>context.<ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a708788b65ddf1a24bbdf11e03c35c60f" kindref="member">setCurrentTime</ref>(LocalDateTime.now());</highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>context;</highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="266"><highlight class="normal"></highlight></codeline>
<codeline lineno="267" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a0c1ade445d1ba388327b8bd2d68af201" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a0c1ade445d1ba388327b8bd2d68af201" kindref="member">evaluatePermissions</ref>(Set&lt;String&gt;<sp/>roles,<sp/>List&lt;PermissionPolicy&gt;<sp/>policies,</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="enumcom_1_1gmp_1_1edms_1_1service_1_1DocumentPermissionService_1_1PermissionType" kindref="compound">PermissionType</ref><sp/>required,<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext" kindref="compound">PermissionContext</ref><sp/>context)<sp/>{</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>支持复杂的权限规则：</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>-<sp/>基于角色的访问控制</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>-<sp/>基于属性的访问控制</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>-<sp/>时间窗口限制</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>-<sp/>地理位置限制</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="274"><highlight class="normal"></highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>1.<sp/>检查管理员权限</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a6ae738e5b2b23a3a7fdc60fb60be50ee" kindref="member">isAdmin</ref>(roles))<sp/>{</highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="279"><highlight class="normal"></highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>2.<sp/>检查文档所有者权限</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(context.<ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a433d9f75bfcdf5a0c8e34e10ef6176f7" kindref="member">getUserId</ref>().equals(<ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a4ac18ad537ee4e6475eaff52a834a159" kindref="member">getDocumentAuthor</ref>(context.<ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a54832eee4948d6b5d68afa90e9ae8169" kindref="member">getDocumentId</ref>())))<sp/>{</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="284"><highlight class="normal"></highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>3.<sp/>评估策略权限</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>policies.stream()</highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.anyMatch(policy<sp/>-&gt;<sp/>policy.evaluate(roles,<sp/>required,<sp/>context));</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="289"><highlight class="normal"></highlight></codeline>
<codeline lineno="290" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a6ae738e5b2b23a3a7fdc60fb60be50ee" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a6ae738e5b2b23a3a7fdc60fb60be50ee" kindref="member">isAdmin</ref>(Set&lt;String&gt;<sp/>roles)<sp/>{</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>roles.stream().anyMatch(</highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>role<sp/>-&gt;<sp/>role.equals(</highlight><highlight class="stringliteral">&quot;ADMIN&quot;</highlight><highlight class="normal">)<sp/>||<sp/>role.equals(</highlight><highlight class="stringliteral">&quot;ROLE_SYSTEM_ADMIN&quot;</highlight><highlight class="normal">)<sp/>||<sp/>role.equals(</highlight><highlight class="stringliteral">&quot;ROLE_GMP_ADMIN&quot;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="294"><highlight class="normal"></highlight></codeline>
<codeline lineno="295" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a4ac18ad537ee4e6475eaff52a834a159" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a4ac18ad537ee4e6475eaff52a834a159" kindref="member">getDocumentAuthor</ref>(Long<sp/>documentId)<sp/>{</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Document<sp/>document<sp/>=<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a22ca9dea7b3537fdeca080851752a5fb" kindref="member">documentRepository</ref>.findById(documentId).orElse(</highlight><highlight class="keyword">null</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(document<sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>java.lang.reflect.Field<sp/>authorField<sp/>=<sp/>Document.class.getDeclaredField(</highlight><highlight class="stringliteral">&quot;author&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>authorField.setAccessible(</highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(String)<sp/>authorField.get(document);</highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(Exception<sp/>e)<sp/>{</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="308"><highlight class="normal"></highlight></codeline>
<codeline lineno="309" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1ab9c267ffeeba1315ff726048b61eed98" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1ab9c267ffeeba1315ff726048b61eed98" kindref="member">hasCategoryPermission</ref>(String<sp/>userId,<sp/>Long<sp/>categoryId,<sp/><ref refid="enumcom_1_1gmp_1_1edms_1_1service_1_1DocumentPermissionService_1_1PermissionType" kindref="compound">PermissionType</ref><sp/>permission)<sp/>{</highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>检查分类权限的逻辑</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;<sp/></highlight><highlight class="comment">//<sp/>简化实现</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="313"><highlight class="normal"></highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>权限策略接口和实现类</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="315"><highlight class="normal"></highlight></codeline>
<codeline lineno="316" refid="interfacecom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionPolicy" refkind="compound"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">interface<sp/></highlight><highlight class="normal"><ref refid="interfacecom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionPolicy" kindref="compound">PermissionPolicy</ref><sp/>{</highlight></codeline>
<codeline lineno="317" refid="interfacecom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionPolicy_1aa1c45efbc5538fbaec71e0e909e91303" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/><ref refid="interfacecom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionPolicy_1aa1c45efbc5538fbaec71e0e909e91303" kindref="member">evaluate</ref>(Set&lt;String&gt;<sp/>roles,<sp/><ref refid="enumcom_1_1gmp_1_1edms_1_1service_1_1DocumentPermissionService_1_1PermissionType" kindref="compound">PermissionType</ref><sp/>permission,<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext" kindref="compound">PermissionContext</ref><sp/>context);</highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="319"><highlight class="normal"></highlight></codeline>
<codeline lineno="320" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1DocumentOwnerPolicy" refkind="compound"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1DocumentOwnerPolicy" kindref="compound">DocumentOwnerPolicy</ref><sp/></highlight><highlight class="keyword">implements</highlight><highlight class="normal"><sp/><ref refid="interfacecom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionPolicy" kindref="compound">PermissionPolicy</ref><sp/>{</highlight></codeline>
<codeline lineno="321" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1DocumentOwnerPolicy_1a35302a81249d8e1e818c15e3f6dc91a1" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1DocumentOwnerPolicy_1a35302a81249d8e1e818c15e3f6dc91a1" kindref="member">documentOwner</ref>;</highlight></codeline>
<codeline lineno="322"><highlight class="normal"></highlight></codeline>
<codeline lineno="323" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1DocumentOwnerPolicy_1a812660d07e3f4169eea7eca7bc9f2f14" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1DocumentOwnerPolicy_1a812660d07e3f4169eea7eca7bc9f2f14" kindref="member">DocumentOwnerPolicy</ref>(String<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1DocumentOwnerPolicy_1a35302a81249d8e1e818c15e3f6dc91a1" kindref="member">documentOwner</ref>)<sp/>{</highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this.documentOwner<sp/>=<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1DocumentOwnerPolicy_1a35302a81249d8e1e818c15e3f6dc91a1" kindref="member">documentOwner</ref>;</highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="326"><highlight class="normal"></highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="328" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1DocumentOwnerPolicy_1a44211c0c38ca4fc48795b14ace2e9297" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1DocumentOwnerPolicy_1a44211c0c38ca4fc48795b14ace2e9297" kindref="member">evaluate</ref>(Set&lt;String&gt;<sp/>roles,<sp/><ref refid="enumcom_1_1gmp_1_1edms_1_1service_1_1DocumentPermissionService_1_1PermissionType" kindref="compound">PermissionType</ref><sp/>permission,<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext" kindref="compound">PermissionContext</ref><sp/>context)<sp/>{</highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>context.<ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a433d9f75bfcdf5a0c8e34e10ef6176f7" kindref="member">getUserId</ref>().equals(<ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1DocumentOwnerPolicy_1a35302a81249d8e1e818c15e3f6dc91a1" kindref="member">documentOwner</ref>);</highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="332"><highlight class="normal"></highlight></codeline>
<codeline lineno="333" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1DepartmentPolicy" refkind="compound"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1DepartmentPolicy" kindref="compound">DepartmentPolicy</ref><sp/></highlight><highlight class="keyword">implements</highlight><highlight class="normal"><sp/><ref refid="interfacecom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionPolicy" kindref="compound">PermissionPolicy</ref><sp/>{</highlight></codeline>
<codeline lineno="334" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1DepartmentPolicy_1adc7467d2e587f6701db292bcfd99abfb" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1DepartmentPolicy_1adc7467d2e587f6701db292bcfd99abfb" kindref="member">department</ref>;</highlight></codeline>
<codeline lineno="335"><highlight class="normal"></highlight></codeline>
<codeline lineno="336" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1DepartmentPolicy_1ab1fe8963a077f2406271ee717aa5dbc0" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1DepartmentPolicy_1ab1fe8963a077f2406271ee717aa5dbc0" kindref="member">DepartmentPolicy</ref>(String<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1DepartmentPolicy_1adc7467d2e587f6701db292bcfd99abfb" kindref="member">department</ref>)<sp/>{</highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this.department<sp/>=<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1DepartmentPolicy_1adc7467d2e587f6701db292bcfd99abfb" kindref="member">department</ref>;</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="339"><highlight class="normal"></highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="341" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1DepartmentPolicy_1a2cd467f339d3b4c87b14adf574497bff" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1DepartmentPolicy_1a2cd467f339d3b4c87b14adf574497bff" kindref="member">evaluate</ref>(Set&lt;String&gt;<sp/>roles,<sp/><ref refid="enumcom_1_1gmp_1_1edms_1_1service_1_1DocumentPermissionService_1_1PermissionType" kindref="compound">PermissionType</ref><sp/>permission,<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext" kindref="compound">PermissionContext</ref><sp/>context)<sp/>{</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>同部门权限检查</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;<sp/></highlight><highlight class="comment">//<sp/>简化实现</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="346"><highlight class="normal"></highlight></codeline>
<codeline lineno="347" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1ConfidentialityPolicy" refkind="compound"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1ConfidentialityPolicy" kindref="compound">ConfidentialityPolicy</ref><sp/></highlight><highlight class="keyword">implements</highlight><highlight class="normal"><sp/><ref refid="interfacecom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionPolicy" kindref="compound">PermissionPolicy</ref><sp/>{</highlight></codeline>
<codeline lineno="348" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1ConfidentialityPolicy_1a5655f13a246033d02798f9db1c482310" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1ConfidentialityPolicy_1a5655f13a246033d02798f9db1c482310" kindref="member">confidentialityLevel</ref>;</highlight></codeline>
<codeline lineno="349"><highlight class="normal"></highlight></codeline>
<codeline lineno="350" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1ConfidentialityPolicy_1a7c13a8594be22fb2bc8b0c7552f3f090" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1ConfidentialityPolicy_1a7c13a8594be22fb2bc8b0c7552f3f090" kindref="member">ConfidentialityPolicy</ref>(String<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1ConfidentialityPolicy_1a5655f13a246033d02798f9db1c482310" kindref="member">confidentialityLevel</ref>)<sp/>{</highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this.confidentialityLevel<sp/>=<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1ConfidentialityPolicy_1a5655f13a246033d02798f9db1c482310" kindref="member">confidentialityLevel</ref>;</highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="353"><highlight class="normal"></highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="355" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1ConfidentialityPolicy_1aae225461392791341584419b4bf133f2" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1ConfidentialityPolicy_1aae225461392791341584419b4bf133f2" kindref="member">evaluate</ref>(Set&lt;String&gt;<sp/>roles,<sp/><ref refid="enumcom_1_1gmp_1_1edms_1_1service_1_1DocumentPermissionService_1_1PermissionType" kindref="compound">PermissionType</ref><sp/>permission,<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext" kindref="compound">PermissionContext</ref><sp/>context)<sp/>{</highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>根据保密级别检查权限</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(</highlight><highlight class="stringliteral">&quot;RESTRICTED&quot;</highlight><highlight class="normal">.equals(<ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1ConfidentialityPolicy_1a5655f13a246033d02798f9db1c482310" kindref="member">confidentialityLevel</ref>)<sp/>&amp;&amp;<sp/>!<ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1a6ae738e5b2b23a3a7fdc60fb60be50ee" kindref="member">isAdmin</ref>(roles))<sp/>{</highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="363"><highlight class="normal"></highlight></codeline>
<codeline lineno="364" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1StatusPolicy" refkind="compound"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1StatusPolicy" kindref="compound">StatusPolicy</ref><sp/></highlight><highlight class="keyword">implements</highlight><highlight class="normal"><sp/><ref refid="interfacecom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionPolicy" kindref="compound">PermissionPolicy</ref><sp/>{</highlight></codeline>
<codeline lineno="365" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1StatusPolicy_1ab38af9ef8ad709035a61907ecd585aea" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1StatusPolicy_1ab38af9ef8ad709035a61907ecd585aea" kindref="member">documentStatus</ref>;</highlight></codeline>
<codeline lineno="366"><highlight class="normal"></highlight></codeline>
<codeline lineno="367" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1StatusPolicy_1a24b8308fd037bf8cf48dee0f5135c274" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1StatusPolicy_1a24b8308fd037bf8cf48dee0f5135c274" kindref="member">StatusPolicy</ref>(String<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1StatusPolicy_1ab38af9ef8ad709035a61907ecd585aea" kindref="member">documentStatus</ref>)<sp/>{</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this.documentStatus<sp/>=<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1StatusPolicy_1ab38af9ef8ad709035a61907ecd585aea" kindref="member">documentStatus</ref>;</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="370"><highlight class="normal"></highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="372" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1StatusPolicy_1a11c0a88d991b845b526a9f48f06c5c18" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1StatusPolicy_1a11c0a88d991b845b526a9f48f06c5c18" kindref="member">evaluate</ref>(Set&lt;String&gt;<sp/>roles,<sp/><ref refid="enumcom_1_1gmp_1_1edms_1_1service_1_1DocumentPermissionService_1_1PermissionType" kindref="compound">PermissionType</ref><sp/>permission,<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext" kindref="compound">PermissionContext</ref><sp/>context)<sp/>{</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>根据文档状态检查权限</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(</highlight><highlight class="stringliteral">&quot;WITHDRAWN&quot;</highlight><highlight class="normal">.equals(<ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1StatusPolicy_1ab38af9ef8ad709035a61907ecd585aea" kindref="member">documentStatus</ref>))<sp/>{</highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="380"><highlight class="normal"></highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>权限上下文类</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="382"><highlight class="normal"></highlight></codeline>
<codeline lineno="383" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext" refkind="compound"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext" kindref="compound">PermissionContext</ref><sp/>{</highlight></codeline>
<codeline lineno="384" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a134e24f43ceaf2e31cb37dcaa8a364e3" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a134e24f43ceaf2e31cb37dcaa8a364e3" kindref="member">userId</ref>;</highlight></codeline>
<codeline lineno="385" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1acaf4567be34fb7c14f110d648053b637" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>Long<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1acaf4567be34fb7c14f110d648053b637" kindref="member">documentId</ref>;</highlight></codeline>
<codeline lineno="386" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a5e17bf633897b3e7b0f56712e32e3486" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a5e17bf633897b3e7b0f56712e32e3486" kindref="member">documentType</ref>;</highlight></codeline>
<codeline lineno="387" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a31b418ce47a0e36991b02b8d5ee1ba45" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a31b418ce47a0e36991b02b8d5ee1ba45" kindref="member">confidentialityLevel</ref>;</highlight></codeline>
<codeline lineno="388" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1af66d5c6383bfdba259e2f22d420c5af1" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>LocalDateTime<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1af66d5c6383bfdba259e2f22d420c5af1" kindref="member">currentTime</ref>;</highlight></codeline>
<codeline lineno="389"><highlight class="normal"></highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Getters<sp/>and<sp/>setters</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="391" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a433d9f75bfcdf5a0c8e34e10ef6176f7" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a433d9f75bfcdf5a0c8e34e10ef6176f7" kindref="member">getUserId</ref>()<sp/>{</highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a134e24f43ceaf2e31cb37dcaa8a364e3" kindref="member">userId</ref>;</highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="394"><highlight class="normal"></highlight></codeline>
<codeline lineno="395" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a2784d6a23d50e223c2b5843bb0ce0985" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a2784d6a23d50e223c2b5843bb0ce0985" kindref="member">setUserId</ref>(String<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a134e24f43ceaf2e31cb37dcaa8a364e3" kindref="member">userId</ref>)<sp/>{</highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this.userId<sp/>=<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a134e24f43ceaf2e31cb37dcaa8a364e3" kindref="member">userId</ref>;</highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="398"><highlight class="normal"></highlight></codeline>
<codeline lineno="399" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a54832eee4948d6b5d68afa90e9ae8169" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>Long<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a54832eee4948d6b5d68afa90e9ae8169" kindref="member">getDocumentId</ref>()<sp/>{</highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1acaf4567be34fb7c14f110d648053b637" kindref="member">documentId</ref>;</highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="402"><highlight class="normal"></highlight></codeline>
<codeline lineno="403" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1ae4af17d590cb15a523e26bd0e3845513" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1ae4af17d590cb15a523e26bd0e3845513" kindref="member">setDocumentId</ref>(Long<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1acaf4567be34fb7c14f110d648053b637" kindref="member">documentId</ref>)<sp/>{</highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this.documentId<sp/>=<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1acaf4567be34fb7c14f110d648053b637" kindref="member">documentId</ref>;</highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="406"><highlight class="normal"></highlight></codeline>
<codeline lineno="407" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a9182a145d0442dc831a4a009b9ad5663" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a9182a145d0442dc831a4a009b9ad5663" kindref="member">getDocumentType</ref>()<sp/>{</highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a5e17bf633897b3e7b0f56712e32e3486" kindref="member">documentType</ref>;</highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="410"><highlight class="normal"></highlight></codeline>
<codeline lineno="411" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a8852b13c701429e0dec85bb7b8587e36" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a8852b13c701429e0dec85bb7b8587e36" kindref="member">setDocumentType</ref>(String<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a5e17bf633897b3e7b0f56712e32e3486" kindref="member">documentType</ref>)<sp/>{</highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this.documentType<sp/>=<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a5e17bf633897b3e7b0f56712e32e3486" kindref="member">documentType</ref>;</highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="414"><highlight class="normal"></highlight></codeline>
<codeline lineno="415" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a0780422f3a5045d0d15c3c38136b9d4c" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a0780422f3a5045d0d15c3c38136b9d4c" kindref="member">getConfidentialityLevel</ref>()<sp/>{</highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a31b418ce47a0e36991b02b8d5ee1ba45" kindref="member">confidentialityLevel</ref>;</highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="418"><highlight class="normal"></highlight></codeline>
<codeline lineno="419" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a2bd43872513afa653e165e6f98c9fa75" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a2bd43872513afa653e165e6f98c9fa75" kindref="member">setConfidentialityLevel</ref>(String<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a31b418ce47a0e36991b02b8d5ee1ba45" kindref="member">confidentialityLevel</ref>)<sp/>{</highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this.confidentialityLevel<sp/>=<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a31b418ce47a0e36991b02b8d5ee1ba45" kindref="member">confidentialityLevel</ref>;</highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="422"><highlight class="normal"></highlight></codeline>
<codeline lineno="423" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1ae1878942aa57a4997df478fbbf839b21" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>LocalDateTime<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1ae1878942aa57a4997df478fbbf839b21" kindref="member">getCurrentTime</ref>()<sp/>{</highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1af66d5c6383bfdba259e2f22d420c5af1" kindref="member">currentTime</ref>;</highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="426"><highlight class="normal"></highlight></codeline>
<codeline lineno="427" refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a708788b65ddf1a24bbdf11e03c35c60f" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1a708788b65ddf1a24bbdf11e03c35c60f" kindref="member">setCurrentTime</ref>(LocalDateTime<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1af66d5c6383bfdba259e2f22d420c5af1" kindref="member">currentTime</ref>)<sp/>{</highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this.currentTime<sp/>=<sp/><ref refid="classcom_1_1gmp_1_1edms_1_1service_1_1impl_1_1DocumentPermissionServiceImpl_1_1PermissionContext_1af66d5c6383bfdba259e2f22d420c5af1" kindref="member">currentTime</ref>;</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="431"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="edms-service/src/main/java/com/gmp/edms/service/impl/DocumentPermissionServiceImpl.java"/>
  </compounddef>
</doxygen>

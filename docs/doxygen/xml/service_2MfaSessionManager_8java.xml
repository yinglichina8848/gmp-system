<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.9.8" xml:lang="en-US">
  <compounddef id="service_2MfaSessionManager_8java" kind="file" language="Java">
    <compoundname>MfaSessionManager.java</compoundname>
    <includes local="no">com.gmp.auth.entity.User</includes>
    <incdepgraph>
      <node id="1">
        <label>auth-service/src/main/java/com/gmp/auth/service/MfaSessionManager.java</label>
        <link refid="service_2MfaSessionManager_8java"/>
        <childnode refid="2" relation="include">
        </childnode>
      </node>
      <node id="2">
        <label>com.gmp.auth.entity.User</label>
      </node>
    </incdepgraph>
    <innerclass refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager" prot="public">com::gmp::auth::service::MfaSessionManager</innerclass>
    <innerclass refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession" prot="public">com::gmp::auth::service::MfaSessionManager::MfaSession</innerclass>
    <innernamespace refid="namespacecom_1_1gmp_1_1auth_1_1service">com::gmp::auth::service</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="keyword">package<sp/></highlight><highlight class="normal">com.gmp.auth.service;</highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>com.gmp.auth.entity.User;</highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>org.springframework.stereotype.Component;</highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.time.LocalDateTime;</highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.Map;</highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.UUID;</highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.concurrent.ConcurrentHashMap;</highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.concurrent.TimeUnit;</highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal">@Component</highlight></codeline>
<codeline lineno="15" refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager" kindref="compound">MfaSessionManager</ref><sp/>{</highlight></codeline>
<codeline lineno="16"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="17"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>会话超时时间（分钟）</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="18" refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1a16ff6b33d21b454718c05061663af4cb" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1a16ff6b33d21b454718c05061663af4cb" kindref="member">SESSION_TIMEOUT_MINUTES</ref><sp/>=<sp/>10;</highlight></codeline>
<codeline lineno="19"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="20"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>存储会话信息的Map，key为会话ID，value为会话信息</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="21" refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1aea67d7c86cef90763cbfe1c71ed46be4" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>Map&lt;String,<sp/>MfaSession&gt;<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1aea67d7c86cef90763cbfe1c71ed46be4" kindref="member">sessions</ref><sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>ConcurrentHashMap&lt;&gt;();</highlight></codeline>
<codeline lineno="22"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="26" refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1a1adfa09c2062d2b32861f43035515a68" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1a1adfa09c2062d2b32861f43035515a68" kindref="member">createSession</ref>(User<sp/>user)<sp/>{</highlight></codeline>
<codeline lineno="27"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>String<sp/>sessionId<sp/>=<sp/>UUID.randomUUID().toString();</highlight></codeline>
<codeline lineno="28"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession" kindref="compound">MfaSession</ref><sp/>session<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession" kindref="compound">MfaSession</ref>(sessionId,<sp/>user,<sp/>LocalDateTime.now());</highlight></codeline>
<codeline lineno="29"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1aea67d7c86cef90763cbfe1c71ed46be4" kindref="member">sessions</ref>.put(sessionId,<sp/>session);</highlight></codeline>
<codeline lineno="30"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>sessionId;</highlight></codeline>
<codeline lineno="31"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="32"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="36" refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1aa26dd449561742077d4a10620671c847" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession" kindref="compound">MfaSession</ref><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1aa26dd449561742077d4a10620671c847" kindref="member">getSession</ref>(String<sp/>sessionId)<sp/>{</highlight></codeline>
<codeline lineno="37"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(sessionId<sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession" kindref="compound">MfaSession</ref><sp/>session<sp/>=<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1aea67d7c86cef90763cbfe1c71ed46be4" kindref="member">sessions</ref>.get(sessionId);</highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(session<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>检查会话是否过期</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1a3919299276ffea6bff739f3c3f6a7c78" kindref="member">isSessionExpired</ref>(session))<sp/>{</highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1a520811b94222ae61889928d98962cfc7" kindref="member">invalidateSession</ref>(sessionId);</highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>session;</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="56" refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1a520811b94222ae61889928d98962cfc7" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1a520811b94222ae61889928d98962cfc7" kindref="member">invalidateSession</ref>(String<sp/>sessionId)<sp/>{</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(sessionId<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1aea67d7c86cef90763cbfe1c71ed46be4" kindref="member">sessions</ref>.remove(sessionId);</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="65" refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1a3919299276ffea6bff739f3c3f6a7c78" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1a3919299276ffea6bff739f3c3f6a7c78" kindref="member">isSessionExpired</ref>(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession" kindref="compound">MfaSession</ref><sp/>session)<sp/>{</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>session.<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1ab677e37592627722ba0fdd217d05dc91" kindref="member">getCreatedAt</ref>().plusMinutes(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1a16ff6b33d21b454718c05061663af4cb" kindref="member">SESSION_TIMEOUT_MINUTES</ref>).isBefore(LocalDateTime.now());</highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="72" refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1a6121d9c31c1deb3b42292886c6f57859" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1a6121d9c31c1deb3b42292886c6f57859" kindref="member">cleanupExpiredSessions</ref>()<sp/>{</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>LocalDateTime<sp/>now<sp/>=<sp/>LocalDateTime.now();</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1aea67d7c86cef90763cbfe1c71ed46be4" kindref="member">sessions</ref>.forEach((sessionId,<sp/>session)<sp/>-&gt;<sp/>{</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(session.getCreatedAt().plusMinutes(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1a16ff6b33d21b454718c05061663af4cb" kindref="member">SESSION_TIMEOUT_MINUTES</ref>).isBefore(now))<sp/>{</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sessions.remove(sessionId);</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="84" refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession" refkind="compound"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession" kindref="compound">MfaSession</ref><sp/>{</highlight></codeline>
<codeline lineno="85" refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1aa396c77e929a9515cacffcc6eb534a19" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1aa396c77e929a9515cacffcc6eb534a19" kindref="member">sessionId</ref>;</highlight></codeline>
<codeline lineno="86" refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1a7251dc413345bb895d1629474bf896bd" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>User<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1a7251dc413345bb895d1629474bf896bd" kindref="member">user</ref>;</highlight></codeline>
<codeline lineno="87" refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1a365886f6c4454f74c5d6786251d1b34f" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>LocalDateTime<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1a365886f6c4454f74c5d6786251d1b34f" kindref="member">createdAt</ref>;</highlight></codeline>
<codeline lineno="88" refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1a647602722b53fdd4957776a7a76004fc" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1a647602722b53fdd4957776a7a76004fc" kindref="member">failedAttempts</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="89" refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1af9bbb8a17fa277d8f8d3ce7fea4be6fb" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>LocalDateTime<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1af9bbb8a17fa277d8f8d3ce7fea4be6fb" kindref="member">lastVerificationAttempt</ref>;</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="91" refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1afd3bdb24a186fff1152ba8c795bf6019" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1afd3bdb24a186fff1152ba8c795bf6019" kindref="member">MfaSession</ref>(String<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1aa396c77e929a9515cacffcc6eb534a19" kindref="member">sessionId</ref>,<sp/>User<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1a7251dc413345bb895d1629474bf896bd" kindref="member">user</ref>,<sp/>LocalDateTime<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1a365886f6c4454f74c5d6786251d1b34f" kindref="member">createdAt</ref>)<sp/>{</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this.sessionId<sp/>=<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1aa396c77e929a9515cacffcc6eb534a19" kindref="member">sessionId</ref>;</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this.user<sp/>=<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1a7251dc413345bb895d1629474bf896bd" kindref="member">user</ref>;</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this.createdAt<sp/>=<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1a365886f6c4454f74c5d6786251d1b34f" kindref="member">createdAt</ref>;</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="97" refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1a24d110832a9d42b495b36b97e6c89e67" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1a24d110832a9d42b495b36b97e6c89e67" kindref="member">getSessionId</ref>()<sp/>{</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1aa396c77e929a9515cacffcc6eb534a19" kindref="member">sessionId</ref>;</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="101" refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1ae39c1b55bfc4017dcd69a74e14d0ca64" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>User<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1ae39c1b55bfc4017dcd69a74e14d0ca64" kindref="member">getUser</ref>()<sp/>{</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1a7251dc413345bb895d1629474bf896bd" kindref="member">user</ref>;</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="105" refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1ab677e37592627722ba0fdd217d05dc91" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>LocalDateTime<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1ab677e37592627722ba0fdd217d05dc91" kindref="member">getCreatedAt</ref>()<sp/>{</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1a365886f6c4454f74c5d6786251d1b34f" kindref="member">createdAt</ref>;</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="109" refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1a9ef2617f221bb0b3164008cae3475614" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1a9ef2617f221bb0b3164008cae3475614" kindref="member">getFailedAttempts</ref>()<sp/>{</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1a647602722b53fdd4957776a7a76004fc" kindref="member">failedAttempts</ref>;</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="113" refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1a6072de9c89ebe386215bca8c0a57198c" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1a6072de9c89ebe386215bca8c0a57198c" kindref="member">incrementFailedAttempts</ref>()<sp/>{</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this.failedAttempts++;</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this.lastVerificationAttempt<sp/>=<sp/>LocalDateTime.now();</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="118" refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1a2c1ed76c2ec10f0a18275934353b6f86" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>LocalDateTime<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1a2c1ed76c2ec10f0a18275934353b6f86" kindref="member">getLastVerificationAttempt</ref>()<sp/>{</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1af9bbb8a17fa277d8f8d3ce7fea4be6fb" kindref="member">lastVerificationAttempt</ref>;</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="125" refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1aad1690ba0002c0f7ad96f34b8ebd6462" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1aad1690ba0002c0f7ad96f34b8ebd6462" kindref="member">isLocked</ref>()<sp/>{</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1MfaSessionManager_1_1MfaSession_1a647602722b53fdd4957776a7a76004fc" kindref="member">failedAttempts</ref><sp/>&gt;=<sp/>5;<sp/></highlight><highlight class="comment">//<sp/>5次失败尝试后锁定</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="129"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="auth-service/src/main/java/com/gmp/auth/service/MfaSessionManager.java"/>
  </compounddef>
</doxygen>

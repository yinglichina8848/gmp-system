<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.9.8" xml:lang="en-US">
  <compounddef id="JwtConfig_8java" kind="file" language="Java">
    <compoundname>JwtConfig.java</compoundname>
    <includes local="no">io.jsonwebtoken</includes>
    <incdepgraph>
      <node id="1">
        <label>auth-service/src/main/java/com/gmp/auth/config/JwtConfig.java</label>
        <link refid="JwtConfig_8java"/>
        <childnode refid="2" relation="include">
        </childnode>
      </node>
      <node id="2">
        <label>io.jsonwebtoken</label>
      </node>
    </incdepgraph>
    <innerclass refid="classcom_1_1gmp_1_1auth_1_1config_1_1JwtConfig" prot="public">com::gmp::auth::config::JwtConfig</innerclass>
    <innerclass refid="interfacecom_1_1gmp_1_1auth_1_1config_1_1JwtConfig_1_1ClaimsResolver" prot="private">com::gmp::auth::config::JwtConfig::ClaimsResolver</innerclass>
    <innernamespace refid="namespacecom_1_1gmp_1_1auth_1_1config">com::gmp::auth::config</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="keyword">package<sp/></highlight><highlight class="normal">com.gmp.auth.config;</highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>io.jsonwebtoken.*;</highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>io.jsonwebtoken.security.Keys;</highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>org.slf4j.Logger;</highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>org.slf4j.LoggerFactory;</highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>org.springframework.beans.factory.annotation.Value;</highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>org.springframework.stereotype.Component;</highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>javax.crypto.SecretKey;</highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.*;</highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal">@Component</highlight></codeline>
<codeline lineno="19" refid="classcom_1_1gmp_1_1auth_1_1config_1_1JwtConfig" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classcom_1_1gmp_1_1auth_1_1config_1_1JwtConfig" kindref="compound">JwtConfig</ref><sp/>{</highlight></codeline>
<codeline lineno="20"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="21" refid="classcom_1_1gmp_1_1auth_1_1config_1_1JwtConfig_1a0ea6e092acb6298bb3dd403f5f5cf8fa" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>Logger<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1config_1_1JwtConfig_1a0ea6e092acb6298bb3dd403f5f5cf8fa" kindref="member">log</ref><sp/>=<sp/>LoggerFactory.getLogger(<ref refid="classcom_1_1gmp_1_1auth_1_1config_1_1JwtConfig" kindref="compound">JwtConfig</ref>.class);</highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"><sp/><sp/><sp/><sp/>@Value(</highlight><highlight class="stringliteral">&quot;${jwt.secret:gmp-auth-jwt-secret-key-2024-very-secure-long-key}&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="24" refid="classcom_1_1gmp_1_1auth_1_1config_1_1JwtConfig_1a5a8ee77c6d6288e95148ae88a7363682" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>private<sp/>String<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1config_1_1JwtConfig_1a5a8ee77c6d6288e95148ae88a7363682" kindref="member">secret</ref>;</highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"><sp/><sp/><sp/><sp/>@Value(&quot;${jwt.expiration:86400000}</highlight><highlight class="stringliteral">&quot;)</highlight></codeline>
<codeline lineno="27" refid="classcom_1_1gmp_1_1auth_1_1config_1_1JwtConfig_1a46afee1180842d7df5cdfd23533d8c94" refkind="member"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>private<sp/>long<sp/>expiration;</highlight></codeline>
<codeline lineno="28"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="29"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>@Value(&quot;</highlight><highlight class="normal">${jwt.refresh-<ref refid="classcom_1_1gmp_1_1auth_1_1config_1_1JwtConfig_1a46afee1180842d7df5cdfd23533d8c94" kindref="member">expiration</ref>:604800000}</highlight><highlight class="stringliteral">&quot;)</highlight></codeline>
<codeline lineno="30" refid="classcom_1_1gmp_1_1auth_1_1config_1_1JwtConfig_1a57de4d7d4cd05c0b867649f8be93a886" refkind="member"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>private<sp/>long<sp/>refreshExpiration;</highlight></codeline>
<codeline lineno="31"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="32"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>@Value(&quot;</highlight><highlight class="normal">${jwt.issuer:gmp-system}</highlight><highlight class="stringliteral">&quot;)</highlight></codeline>
<codeline lineno="33" refid="classcom_1_1gmp_1_1auth_1_1config_1_1JwtConfig_1a2c72be459b3267067b06b45ff52c58e7" refkind="member"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>private<sp/>String<sp/>issuer;</highlight></codeline>
<codeline lineno="34"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="35" refid="classcom_1_1gmp_1_1auth_1_1config_1_1JwtConfig_1af2ae36c23449ea5b6ec2438d6052a175" refkind="member"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>private<sp/>SecretKey<sp/>key;</highlight></codeline>
<codeline lineno="36"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="40" refid="classcom_1_1gmp_1_1auth_1_1config_1_1JwtConfig_1ae8a1516ee9e3ccf90331447e15e18f20" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>public<sp/>String<sp/>generateToken(String<sp/>username,<sp/>Collection&lt;String&gt;<sp/>roles,<sp/>List&lt;String&gt;<sp/>permissions)<sp/>{</highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Date<sp/>now<sp/>=<sp/>new<sp/>Date();</highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Date<sp/>expiryDate<sp/>=<sp/>new<sp/>Date(now.getTime()<sp/>+<sp/>expiration);</highlight></codeline>
<codeline lineno="43"><highlight class="normal"></highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Map&lt;String,<sp/>Object&gt;<sp/>claims<sp/>=<sp/>new<sp/>HashMap&lt;&gt;();</highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>claims.put(&quot;sub</highlight><highlight class="stringliteral">&quot;,<sp/>username);</highlight></codeline>
<codeline lineno="46"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>claims.put(&quot;</highlight><highlight class="normal">iat</highlight><highlight class="stringliteral">&quot;,<sp/>now.getTime()<sp/>/<sp/>1000);</highlight></codeline>
<codeline lineno="47"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>claims.put(&quot;</highlight><highlight class="normal">exp</highlight><highlight class="stringliteral">&quot;,<sp/>expiryDate.getTime()<sp/>/<sp/>1000);</highlight></codeline>
<codeline lineno="48"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>claims.put(&quot;</highlight><highlight class="normal">iss</highlight><highlight class="stringliteral">&quot;,<sp/>issuer);</highlight></codeline>
<codeline lineno="49"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>claims.put(&quot;</highlight><highlight class="normal">roles</highlight><highlight class="stringliteral">&quot;,<sp/>roles);</highlight></codeline>
<codeline lineno="50"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>claims.put(&quot;</highlight><highlight class="normal">permissions</highlight><highlight class="stringliteral">&quot;,<sp/>permissions);</highlight></codeline>
<codeline lineno="51"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="52"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>Jwts.builder()</highlight></codeline>
<codeline lineno="53"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.setClaims(claims)</highlight></codeline>
<codeline lineno="54"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.setIssuedAt(now)</highlight></codeline>
<codeline lineno="55"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.setExpiration(expiryDate)</highlight></codeline>
<codeline lineno="56"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.signWith(getSecretKey(),<sp/>SignatureAlgorithm.HS256)</highlight></codeline>
<codeline lineno="57"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.compact();</highlight></codeline>
<codeline lineno="58"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="59"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="63" refid="classcom_1_1gmp_1_1auth_1_1config_1_1JwtConfig_1a16442acfe673ab0cf3b918ffb27987d1" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>public<sp/>String<sp/>generateRefreshToken(String<sp/>username)<sp/>{</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Date<sp/>now<sp/>=<sp/>new<sp/>Date();</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Date<sp/>expiryDate<sp/>=<sp/>new<sp/>Date(now.getTime()<sp/>+<sp/>refreshExpiration);</highlight></codeline>
<codeline lineno="66"><highlight class="normal"></highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Map&lt;String,<sp/>Object&gt;<sp/>claims<sp/>=<sp/>new<sp/>HashMap&lt;&gt;();</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>claims.put(&quot;sub</highlight><highlight class="stringliteral">&quot;,<sp/>username);</highlight></codeline>
<codeline lineno="69"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>claims.put(&quot;</highlight><highlight class="normal">iat</highlight><highlight class="stringliteral">&quot;,<sp/>now.getTime()<sp/>/<sp/>1000);</highlight></codeline>
<codeline lineno="70"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>claims.put(&quot;</highlight><highlight class="normal">exp</highlight><highlight class="stringliteral">&quot;,<sp/>expiryDate.getTime()<sp/>/<sp/>1000);</highlight></codeline>
<codeline lineno="71"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>claims.put(&quot;</highlight><highlight class="normal">iss</highlight><highlight class="stringliteral">&quot;,<sp/>issuer);</highlight></codeline>
<codeline lineno="72"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>claims.put(&quot;</highlight><highlight class="normal">type</highlight><highlight class="stringliteral">&quot;,<sp/>&quot;</highlight><highlight class="normal">refresh</highlight><highlight class="stringliteral">&quot;);</highlight></codeline>
<codeline lineno="73"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="74"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>Jwts.builder()</highlight></codeline>
<codeline lineno="75"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.setClaims(claims)</highlight></codeline>
<codeline lineno="76"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.setIssuedAt(now)</highlight></codeline>
<codeline lineno="77"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.setExpiration(expiryDate)</highlight></codeline>
<codeline lineno="78"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.signWith(getSecretKey(),<sp/>SignatureAlgorithm.HS256)</highlight></codeline>
<codeline lineno="79"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.compact();</highlight></codeline>
<codeline lineno="80"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="81"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="85" refid="classcom_1_1gmp_1_1auth_1_1config_1_1JwtConfig_1af8deb49941cc01bbc0239583ffcdd1a4" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>public<sp/>String<sp/>extractUsername(String<sp/>token)<sp/>{</highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>extractClaim(token,<sp/>Claims::getSubject);</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="88"><highlight class="normal"></highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/>@SuppressWarnings(&quot;unchecked</highlight><highlight class="stringliteral">&quot;)</highlight></codeline>
<codeline lineno="93" refid="classcom_1_1gmp_1_1auth_1_1config_1_1JwtConfig_1ae9297ada70cc90ae5bbda66d21d5a271" refkind="member"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>public<sp/>Collection&lt;String&gt;<sp/>extractRoles(String<sp/>token)<sp/>{</highlight></codeline>
<codeline lineno="94"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>extractClaim(token,<sp/>claims<sp/>-&gt;<sp/>{</highlight></codeline>
<codeline lineno="95"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Object<sp/>rolesObj<sp/>=<sp/>claims.get(&quot;</highlight><highlight class="normal">roles</highlight><highlight class="stringliteral">&quot;);</highlight></codeline>
<codeline lineno="96"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(rolesObj<sp/>instanceof<sp/>Collection)<sp/>{</highlight></codeline>
<codeline lineno="97"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>(Collection&lt;String&gt;)<sp/>rolesObj;</highlight></codeline>
<codeline lineno="98"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="99"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>Collections.emptyList();</highlight></codeline>
<codeline lineno="100"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="101"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="102"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/>@SuppressWarnings(&quot;unchecked</highlight><highlight class="stringliteral">&quot;)</highlight></codeline>
<codeline lineno="107" refid="classcom_1_1gmp_1_1auth_1_1config_1_1JwtConfig_1a1fa82e0cc4e7aadeb932df3c4d891ac8" refkind="member"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>public<sp/>List&lt;String&gt;<sp/>extractPermissions(String<sp/>token)<sp/>{</highlight></codeline>
<codeline lineno="108"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>extractClaim(token,<sp/>claims<sp/>-&gt;<sp/>{</highlight></codeline>
<codeline lineno="109"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Object<sp/>permissionsObj<sp/>=<sp/>claims.get(&quot;</highlight><highlight class="normal">permissions</highlight><highlight class="stringliteral">&quot;);</highlight></codeline>
<codeline lineno="110"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(permissionsObj<sp/>instanceof<sp/>List)<sp/>{</highlight></codeline>
<codeline lineno="111"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>(List&lt;String&gt;)<sp/>permissionsObj;</highlight></codeline>
<codeline lineno="112"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="113"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>Collections.emptyList();</highlight></codeline>
<codeline lineno="114"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="115"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="116"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="120" refid="classcom_1_1gmp_1_1auth_1_1config_1_1JwtConfig_1a66412a3a6b5d4f6107063c00b10283c7" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>public<sp/>boolean<sp/>validateToken(String<sp/>token)<sp/>{</highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>try<sp/>{</highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Jwts.parserBuilder()</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.setSigningKey(getSecretKey())</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.build()</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.parseClaimsJws(token);</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>true;</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/>catch<sp/>(ExpiredJwtException<sp/>e)<sp/>{</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>log.warn(&quot;JWT令牌已过期:<sp/>{}</highlight><highlight class="stringliteral">&quot;,<sp/>e.getMessage());</highlight></codeline>
<codeline lineno="129"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/>catch<sp/>(UnsupportedJwtException<sp/>e)<sp/>{</highlight></codeline>
<codeline lineno="130"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>log.error(&quot;</highlight><highlight class="normal">不支持的JWT令牌:<sp/>{}</highlight><highlight class="stringliteral">&quot;,<sp/>e.getMessage());</highlight></codeline>
<codeline lineno="131"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/>catch<sp/>(MalformedJwtException<sp/>e)<sp/>{</highlight></codeline>
<codeline lineno="132"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>log.error(&quot;</highlight><highlight class="normal">JWT令牌格式错误:<sp/>{}</highlight><highlight class="stringliteral">&quot;,<sp/>e.getMessage());</highlight></codeline>
<codeline lineno="133"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/>catch<sp/>(SignatureException<sp/>e)<sp/>{</highlight></codeline>
<codeline lineno="134"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>log.error(&quot;</highlight><highlight class="normal">JWT令牌签名验证失败:<sp/>{}</highlight><highlight class="stringliteral">&quot;,<sp/>e.getMessage());</highlight></codeline>
<codeline lineno="135"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/>catch<sp/>(IllegalArgumentException<sp/>e)<sp/>{</highlight></codeline>
<codeline lineno="136"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>log.error(&quot;</highlight><highlight class="normal">JWT令牌参数异常:<sp/>{}</highlight><highlight class="stringliteral">&quot;,<sp/>e.getMessage());</highlight></codeline>
<codeline lineno="137"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="138"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>false;</highlight></codeline>
<codeline lineno="139"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="140"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="144" refid="classcom_1_1gmp_1_1auth_1_1config_1_1JwtConfig_1a646a2dea01e19445daedcd601dcb0fd3" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>public<sp/>boolean<sp/>isTokenNearExpiry(String<sp/>token,<sp/>long<sp/>thresholdSeconds)<sp/>{</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>try<sp/>{</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Claims<sp/>claims<sp/>=<sp/>extractAllClaims(token);</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Date<sp/>expiration<sp/>=<sp/>claims.getExpiration();</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>expiration.getTime()<sp/>-<sp/>System.currentTimeMillis()<sp/>&lt;=<sp/>thresholdSeconds<sp/>*<sp/>1000;</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/>catch<sp/>(Exception<sp/>e)<sp/>{</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>log.error(&quot;检查令牌过期状态失败:<sp/>{}</highlight><highlight class="stringliteral">&quot;,<sp/>e.getMessage());</highlight></codeline>
<codeline lineno="151"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>true;</highlight></codeline>
<codeline lineno="152"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="153"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="154"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="158" refid="classcom_1_1gmp_1_1auth_1_1config_1_1JwtConfig_1a1f437ebeab2cb6d6873dfa185aa64bdf" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>public<sp/>long<sp/>getRemainingValidity(String<sp/>token)<sp/>{</highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>try<sp/>{</highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Claims<sp/>claims<sp/>=<sp/>extractAllClaims(token);</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Date<sp/>expiration<sp/>=<sp/>claims.getExpiration();</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>Math.max(0,<sp/>(expiration.getTime()<sp/>-<sp/>System.currentTimeMillis())<sp/>/<sp/>1000);</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/>catch<sp/>(Exception<sp/>e)<sp/>{</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>log.error(&quot;获取令牌剩余有效时间失败:<sp/>{}</highlight><highlight class="stringliteral">&quot;,<sp/>e.getMessage());</highlight></codeline>
<codeline lineno="165"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>0;</highlight></codeline>
<codeline lineno="166"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="167"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="168"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="172" refid="classcom_1_1gmp_1_1auth_1_1config_1_1JwtConfig_1ad21636ca22a74cda2b04aa6ddb225428" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>public<sp/>String<sp/>refreshAccessToken(String<sp/>refreshToken,<sp/>Collection&lt;String&gt;<sp/>roles,<sp/>List&lt;String&gt;<sp/>permissions)<sp/>{</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(!validateToken(refreshToken))<sp/>{</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>throw<sp/>new<sp/>JwtException(&quot;无效的刷新令牌</highlight><highlight class="stringliteral">&quot;);</highlight></codeline>
<codeline lineno="175"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="176"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="177"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Claims<sp/>claims<sp/>=<sp/>extractAllClaims(refreshToken);</highlight></codeline>
<codeline lineno="178"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>String<sp/>username<sp/>=<sp/>claims.getSubject();</highlight></codeline>
<codeline lineno="179"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>String<sp/>tokenType<sp/>=<sp/>claims.get(&quot;</highlight><highlight class="normal">type</highlight><highlight class="stringliteral">&quot;,<sp/>String.class);</highlight></codeline>
<codeline lineno="180"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="181"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(!&quot;</highlight><highlight class="normal">refresh</highlight><highlight class="stringliteral">&quot;.equals(tokenType))<sp/>{</highlight></codeline>
<codeline lineno="182"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>throw<sp/>new<sp/>JwtException(&quot;</highlight><highlight class="normal">令牌类型不是刷新令牌</highlight><highlight class="stringliteral">&quot;);</highlight></codeline>
<codeline lineno="183"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="184"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="185"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>generateToken(username,<sp/>roles,<sp/>permissions);</highlight></codeline>
<codeline lineno="186"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="187"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="191" refid="classcom_1_1gmp_1_1auth_1_1config_1_1JwtConfig_1a1e08c8975c02302ea17484a4e27b1ac4" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>private<sp/>Claims<sp/>extractAllClaims(String<sp/>token)<sp/>{</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>Jwts.parserBuilder()</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.setSigningKey(getSecretKey())</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.build()</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.parseClaimsJws(token)</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.getBody();</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="198"><highlight class="normal"></highlight></codeline>
<codeline lineno="202" refid="classcom_1_1gmp_1_1auth_1_1config_1_1JwtConfig_1ae46ebf8ffed6863ae3d1d604e6047018" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>private<sp/>&lt;T&gt;<sp/>T<sp/>extractClaim(String<sp/>token,<sp/>ClaimsResolver&lt;T&gt;<sp/>claimsResolver)<sp/>{</highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>final<sp/>Claims<sp/>claims<sp/>=<sp/>extractAllClaims(token);</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>claimsResolver.resolve(claims);</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="206"><highlight class="normal"></highlight></codeline>
<codeline lineno="210" refid="classcom_1_1gmp_1_1auth_1_1config_1_1JwtConfig_1a4d990488a322c24b418d710cbe3c4a52" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>private<sp/>SecretKey<sp/>getSecretKey()<sp/>{</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(key<sp/>==<sp/>null)<sp/>{</highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>key<sp/>=<sp/>Keys.hmacShaKeyFor(secret.getBytes());</highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>key;</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="216"><highlight class="normal"></highlight></codeline>
<codeline lineno="220" refid="classcom_1_1gmp_1_1auth_1_1config_1_1JwtConfig_1a277ad04ecf5c1043fe996486a309cf6a" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>public<sp/>long<sp/>getExpiration()<sp/>{</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>expiration;</highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="223"><highlight class="normal"></highlight></codeline>
<codeline lineno="227" refid="classcom_1_1gmp_1_1auth_1_1config_1_1JwtConfig_1a2a4d346bc670fe7299da7ce8daed275d" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>public<sp/>long<sp/>getRefreshExpiration()<sp/>{</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>refreshExpiration;</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="230"><highlight class="normal"></highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/>@FunctionalInterface</highlight></codeline>
<codeline lineno="235" refid="interfacecom_1_1gmp_1_1auth_1_1config_1_1JwtConfig_1_1ClaimsResolver" refkind="compound"><highlight class="normal"><sp/><sp/><sp/><sp/>private<sp/>interface<sp/>ClaimsResolver&lt;T&gt;<sp/>{</highlight></codeline>
<codeline lineno="236" refid="interfacecom_1_1gmp_1_1auth_1_1config_1_1JwtConfig_1_1ClaimsResolver_1a2d011cfea5c6820549289ef2da177366" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T<sp/>resolve(Claims<sp/>claims);</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="238"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="auth-service/src/main/java/com/gmp/auth/config/JwtConfig.java"/>
  </compounddef>
</doxygen>

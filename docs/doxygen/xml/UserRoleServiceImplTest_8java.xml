<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.9.8" xml:lang="en-US">
  <compounddef id="UserRoleServiceImplTest_8java" kind="file" language="Java">
    <compoundname>UserRoleServiceImplTest.java</compoundname>
    <includes local="no">com.gmp.auth.entity.Role</includes>
    <incdepgraph>
      <node id="1">
        <label>auth-service/src/test/java/com/gmp/auth/service/impl/UserRoleServiceImplTest.java</label>
        <link refid="UserRoleServiceImplTest_8java"/>
        <childnode refid="2" relation="include">
        </childnode>
      </node>
      <node id="2">
        <label>com.gmp.auth.entity.Role</label>
      </node>
    </incdepgraph>
    <innerclass refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest" prot="public">com::gmp::auth::service::impl::UserRoleServiceImplTest</innerclass>
    <innernamespace refid="namespacecom_1_1gmp_1_1auth_1_1service_1_1impl">com::gmp::auth::service::impl</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="keyword">package<sp/></highlight><highlight class="normal">com.gmp.auth.service.impl;</highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>com.gmp.auth.entity.Role;</highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>com.gmp.auth.entity.UserRole;</highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>com.gmp.auth.repository.RoleRepository;</highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>com.gmp.auth.repository.UserRoleRepository;</highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>org.junit.jupiter.api.BeforeEach;</highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>org.junit.jupiter.api.Test;</highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>org.mockito.InjectMocks;</highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>org.mockito.Mock;</highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>org.mockito.MockitoAnnotations;</highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.lang.reflect.Field;</highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.*;</highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.stream.Collectors;</highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>org.junit.jupiter.api.Assertions.*;</highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>org.mockito.ArgumentMatchers.any;</highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>org.mockito.Mockito.*;</highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight></codeline>
<codeline lineno="24" refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest" kindref="compound">UserRoleServiceImplTest</ref><sp/>{</highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"><sp/><sp/><sp/><sp/>@Mock</highlight></codeline>
<codeline lineno="27" refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1aa07b477374353be4d31139d0f48771f6" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>UserRoleRepository<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1aa07b477374353be4d31139d0f48771f6" kindref="member">userRoleRepository</ref>;</highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight></codeline>
<codeline lineno="29"><highlight class="normal"><sp/><sp/><sp/><sp/>@Mock</highlight></codeline>
<codeline lineno="30" refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1ab682267e1c73d271704493b4e62dd775" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>RoleRepository<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1ab682267e1c73d271704493b4e62dd775" kindref="member">roleRepository</ref>;</highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight></codeline>
<codeline lineno="32"><highlight class="normal"><sp/><sp/><sp/><sp/>@InjectMocks</highlight></codeline>
<codeline lineno="33" refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a985a617a22d892ab34702d0b86516807" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImpl" kindref="compound">UserRoleServiceImpl</ref><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a985a617a22d892ab34702d0b86516807" kindref="member">userRoleService</ref>;</highlight></codeline>
<codeline lineno="34"><highlight class="normal"></highlight></codeline>
<codeline lineno="35" refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a22568da99d0dcd78708fa303bf25632a" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>Long<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a22568da99d0dcd78708fa303bf25632a" kindref="member">testUserId</ref><sp/>=<sp/>1L;</highlight></codeline>
<codeline lineno="36" refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1ab0f03942e775a94c25247009bc46d0b8" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>Long<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1ab0f03942e775a94c25247009bc46d0b8" kindref="member">testRoleId</ref><sp/>=<sp/>100L;</highlight></codeline>
<codeline lineno="37" refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a9794c2e2665da91e2c9e979511ee7bb9" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>Long<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a9794c2e2665da91e2c9e979511ee7bb9" kindref="member">testAssignedBy</ref><sp/>=<sp/>200L;</highlight></codeline>
<codeline lineno="38" refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a17bb21ceb27ca8519dd5e3c10eb12533" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a17bb21ceb27ca8519dd5e3c10eb12533" kindref="member">testRoleCode</ref><sp/>=<sp/></highlight><highlight class="stringliteral">&quot;ADMIN&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="39"><highlight class="normal"></highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/><sp/><sp/>@BeforeEach</highlight></codeline>
<codeline lineno="41" refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a43dc3f50880a9c79bc941c709953d8ed" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a43dc3f50880a9c79bc941c709953d8ed" kindref="member">setUp</ref>()<sp/>{</highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>MockitoAnnotations.openMocks(</highlight><highlight class="keyword">this</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="44"><highlight class="normal"></highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/>@Test</highlight></codeline>
<codeline lineno="49" refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1aadbc5f1d0dc98600c867c28b6f300192" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1aadbc5f1d0dc98600c867c28b6f300192" kindref="member">assignRoleToUser_Success</ref>()<sp/>{</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>执行测试</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>UserRole<sp/>result<sp/>=<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a985a617a22d892ab34702d0b86516807" kindref="member">userRoleService</ref>.<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImpl_1aee3b085f7e91bbe3001df12f42d40c7d" kindref="member">assignRoleToUser</ref>(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a22568da99d0dcd78708fa303bf25632a" kindref="member">testUserId</ref>,<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1ab0f03942e775a94c25247009bc46d0b8" kindref="member">testRoleId</ref>,<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a9794c2e2665da91e2c9e979511ee7bb9" kindref="member">testAssignedBy</ref>);</highlight></codeline>
<codeline lineno="52"><highlight class="normal"></highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>验证结果</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assertNotNull(result);</highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>注意：当前实现是简化版，所以不需要验证具体的设置值</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="57"><highlight class="normal"></highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/>@Test</highlight></codeline>
<codeline lineno="62" refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1ad3f313407d92c897e3318cfccaa5afcd" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1ad3f313407d92c897e3318cfccaa5afcd" kindref="member">assignRolesToUser_Success</ref>()<sp/>{</highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>准备测试数据</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;Long&gt;<sp/>roleIds<sp/>=<sp/>Arrays.asList(100L,<sp/>101L,<sp/>102L);</highlight></codeline>
<codeline lineno="65"><highlight class="normal"></highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>执行测试</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;UserRole&gt;<sp/>results<sp/>=<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a985a617a22d892ab34702d0b86516807" kindref="member">userRoleService</ref>.<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImpl_1ad36780030876ab6bced7c9605685b9c2" kindref="member">assignRolesToUser</ref>(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a22568da99d0dcd78708fa303bf25632a" kindref="member">testUserId</ref>,<sp/>roleIds,<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a9794c2e2665da91e2c9e979511ee7bb9" kindref="member">testAssignedBy</ref>);</highlight></codeline>
<codeline lineno="68"><highlight class="normal"></highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>验证结果</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assertNotNull(results);</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assertEquals(3,<sp/>results.size());</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="73"><highlight class="normal"></highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/>@Test</highlight></codeline>
<codeline lineno="78" refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1ac5bd3042a0ace7b44bdb83c88620c584" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1ac5bd3042a0ace7b44bdb83c88620c584" kindref="member">assignRolesToUser_RoleAlreadyExists</ref>()<sp/>{</highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>准备测试数据</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;Long&gt;<sp/>roleIds<sp/>=<sp/>Arrays.asList(100L,<sp/>101L);</highlight></codeline>
<codeline lineno="81"><highlight class="normal"></highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>执行测试</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;UserRole&gt;<sp/>results<sp/>=<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a985a617a22d892ab34702d0b86516807" kindref="member">userRoleService</ref>.<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImpl_1ad36780030876ab6bced7c9605685b9c2" kindref="member">assignRolesToUser</ref>(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a22568da99d0dcd78708fa303bf25632a" kindref="member">testUserId</ref>,<sp/>roleIds,<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a9794c2e2665da91e2c9e979511ee7bb9" kindref="member">testAssignedBy</ref>);</highlight></codeline>
<codeline lineno="84"><highlight class="normal"></highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>验证结果</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assertNotNull(results);</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assertEquals(2,<sp/>results.size());</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="89"><highlight class="normal"></highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/>@Test</highlight></codeline>
<codeline lineno="94" refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a3df855c395b7b485021d0c4b53f9b05a" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a3df855c395b7b485021d0c4b53f9b05a" kindref="member">assignRolesToUser_Exception</ref>()<sp/>{</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>准备测试数据</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;Long&gt;<sp/>roleIds<sp/>=<sp/>Arrays.asList(100L,<sp/>101L);</highlight></codeline>
<codeline lineno="97"><highlight class="normal"></highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>执行测试</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;UserRole&gt;<sp/>results<sp/>=<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a985a617a22d892ab34702d0b86516807" kindref="member">userRoleService</ref>.<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImpl_1ad36780030876ab6bced7c9605685b9c2" kindref="member">assignRolesToUser</ref>(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a22568da99d0dcd78708fa303bf25632a" kindref="member">testUserId</ref>,<sp/>roleIds,<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a9794c2e2665da91e2c9e979511ee7bb9" kindref="member">testAssignedBy</ref>);</highlight></codeline>
<codeline lineno="100"><highlight class="normal"></highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>验证结果</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assertNotNull(results);</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assertEquals(2,<sp/>results.size());</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="105"><highlight class="normal"></highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/>@Test</highlight></codeline>
<codeline lineno="110" refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a0efaf95c76c4a67c78d10d90981ec796" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a0efaf95c76c4a67c78d10d90981ec796" kindref="member">removeRoleFromUser_Success</ref>()<sp/>{</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>准备测试数据</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>UserRole<sp/>userRole<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>UserRole();</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>userRole.setUserId(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a22568da99d0dcd78708fa303bf25632a" kindref="member">testUserId</ref>);</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>userRole.setRoleId(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1ab0f03942e775a94c25247009bc46d0b8" kindref="member">testRoleId</ref>);</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>配置mock行为</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>when(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1aa07b477374353be4d31139d0f48771f6" kindref="member">userRoleRepository</ref>.findByUserIdAndRoleId(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a22568da99d0dcd78708fa303bf25632a" kindref="member">testUserId</ref>,<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1ab0f03942e775a94c25247009bc46d0b8" kindref="member">testRoleId</ref>)).thenReturn(Optional.of(userRole));</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>doNothing().when(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1aa07b477374353be4d31139d0f48771f6" kindref="member">userRoleRepository</ref>).delete(userRole);</highlight></codeline>
<codeline lineno="119"><highlight class="normal"></highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>执行测试</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a985a617a22d892ab34702d0b86516807" kindref="member">userRoleService</ref>.<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImpl_1a6b145b7b5e41428f43259cc595f94eab" kindref="member">removeRoleFromUser</ref>(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a22568da99d0dcd78708fa303bf25632a" kindref="member">testUserId</ref>,<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1ab0f03942e775a94c25247009bc46d0b8" kindref="member">testRoleId</ref>);</highlight></codeline>
<codeline lineno="122"><highlight class="normal"></highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>验证结果</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>verify(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1aa07b477374353be4d31139d0f48771f6" kindref="member">userRoleRepository</ref>,<sp/>times(1)).findByUserIdAndRoleId(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a22568da99d0dcd78708fa303bf25632a" kindref="member">testUserId</ref>,<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1ab0f03942e775a94c25247009bc46d0b8" kindref="member">testRoleId</ref>);</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>verify(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1aa07b477374353be4d31139d0f48771f6" kindref="member">userRoleRepository</ref>,<sp/>times(1)).delete(userRole);</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="127"><highlight class="normal"></highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/>@Test</highlight></codeline>
<codeline lineno="132" refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a0a22d77981c7effcc45887f258c5b1de" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a0a22d77981c7effcc45887f258c5b1de" kindref="member">removeRoleFromUser_UserNotHasRole</ref>()<sp/>{</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>配置mock行为</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>when(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1aa07b477374353be4d31139d0f48771f6" kindref="member">userRoleRepository</ref>.findByUserIdAndRoleId(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a22568da99d0dcd78708fa303bf25632a" kindref="member">testUserId</ref>,<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1ab0f03942e775a94c25247009bc46d0b8" kindref="member">testRoleId</ref>)).thenReturn(Optional.empty());</highlight></codeline>
<codeline lineno="135"><highlight class="normal"></highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>执行测试并验证异常</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>IllegalArgumentException<sp/>exception<sp/>=<sp/>assertThrows(IllegalArgumentException.class,<sp/>()<sp/>-&gt;<sp/>{</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>userRoleService.removeRoleFromUser(testUserId,<sp/>testRoleId);</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="140"><highlight class="normal"></highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>验证结果</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assertEquals(</highlight><highlight class="stringliteral">&quot;用户未拥有该角色&quot;</highlight><highlight class="normal">,<sp/>exception.getMessage());</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>verify(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1aa07b477374353be4d31139d0f48771f6" kindref="member">userRoleRepository</ref>,<sp/>times(1)).findByUserIdAndRoleId(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a22568da99d0dcd78708fa303bf25632a" kindref="member">testUserId</ref>,<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1ab0f03942e775a94c25247009bc46d0b8" kindref="member">testRoleId</ref>);</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>verify(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1aa07b477374353be4d31139d0f48771f6" kindref="member">userRoleRepository</ref>,<sp/>never()).delete(any(UserRole.class));</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="146"><highlight class="normal"></highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/>@Test</highlight></codeline>
<codeline lineno="151" refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a9b6178842769a4811e4736f60f1b61cd" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a9b6178842769a4811e4736f60f1b61cd" kindref="member">getUserRoles_Success</ref>()<sp/>{</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>准备测试数据</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;Role&gt;<sp/>roles<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>ArrayList&lt;&gt;();</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Role<sp/>role1<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>Role();</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>使用反射设置私有字段</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Field<sp/>idField<sp/>=<sp/>Role.class.getDeclaredField(</highlight><highlight class="stringliteral">&quot;id&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>idField.setAccessible(</highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>idField.set(role1,<sp/>100L);</highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Field<sp/>codeField<sp/>=<sp/>Role.class.getDeclaredField(</highlight><highlight class="stringliteral">&quot;code&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>codeField.setAccessible(</highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>codeField.set(role1,<sp/></highlight><highlight class="stringliteral">&quot;ADMIN&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Field<sp/>nameField<sp/>=<sp/>Role.class.getDeclaredField(</highlight><highlight class="stringliteral">&quot;name&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nameField.setAccessible(</highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nameField.set(role1,<sp/></highlight><highlight class="stringliteral">&quot;系统管理员&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(Exception<sp/>e)<sp/>{</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>忽略异常</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Role<sp/>role2<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>Role();</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>使用反射设置私有字段</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Field<sp/>idField<sp/>=<sp/>Role.class.getDeclaredField(</highlight><highlight class="stringliteral">&quot;id&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>idField.setAccessible(</highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>idField.set(role2,<sp/>101L);</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Field<sp/>codeField<sp/>=<sp/>Role.class.getDeclaredField(</highlight><highlight class="stringliteral">&quot;code&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>codeField.setAccessible(</highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>codeField.set(role2,<sp/></highlight><highlight class="stringliteral">&quot;USER&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Field<sp/>nameField<sp/>=<sp/>Role.class.getDeclaredField(</highlight><highlight class="stringliteral">&quot;name&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nameField.setAccessible(</highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nameField.set(role2,<sp/></highlight><highlight class="stringliteral">&quot;普通用户&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(Exception<sp/>e)<sp/>{</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>忽略异常</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>roles.add(role1);</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>roles.add(role2);</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>配置mock行为</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>when(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1ab682267e1c73d271704493b4e62dd775" kindref="member">roleRepository</ref>.findByUserId(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a22568da99d0dcd78708fa303bf25632a" kindref="member">testUserId</ref>)).thenReturn(roles);</highlight></codeline>
<codeline lineno="195"><highlight class="normal"></highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>执行测试</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;Role&gt;<sp/>result<sp/>=<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a985a617a22d892ab34702d0b86516807" kindref="member">userRoleService</ref>.<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImpl_1a6e814821fd28aed98175dec9e99150cb" kindref="member">getUserRoles</ref>(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a22568da99d0dcd78708fa303bf25632a" kindref="member">testUserId</ref>);</highlight></codeline>
<codeline lineno="198"><highlight class="normal"></highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>验证结果</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assertNotNull(result);</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assertEquals(2,<sp/>result.size());</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>verify(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1ab682267e1c73d271704493b4e62dd775" kindref="member">roleRepository</ref>,<sp/>times(1)).findByUserId(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a22568da99d0dcd78708fa303bf25632a" kindref="member">testUserId</ref>);</highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="204"><highlight class="normal"></highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/>@Test</highlight></codeline>
<codeline lineno="209" refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1adcab8b5403fc8d1c5b535a228fc08f96" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1adcab8b5403fc8d1c5b535a228fc08f96" kindref="member">getUserRoleCodes_ReturnsEmptySet</ref>()<sp/>{</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>执行测试</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Set&lt;String&gt;<sp/>result<sp/>=<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a985a617a22d892ab34702d0b86516807" kindref="member">userRoleService</ref>.<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImpl_1a4172a9e820a773630bbc740e7717d362" kindref="member">getUserRoleCodes</ref>(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a22568da99d0dcd78708fa303bf25632a" kindref="member">testUserId</ref>);</highlight></codeline>
<codeline lineno="212"><highlight class="normal"></highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>验证结果</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assertNotNull(result);</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assertTrue(result.isEmpty());</highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="217"><highlight class="normal"></highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/>@Test</highlight></codeline>
<codeline lineno="222" refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a745d4d8a7ba8a9fb1733307fc7c9a976" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a745d4d8a7ba8a9fb1733307fc7c9a976" kindref="member">hasRole_ReturnsFalse</ref>()<sp/>{</highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>执行测试</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/>result<sp/>=<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a985a617a22d892ab34702d0b86516807" kindref="member">userRoleService</ref>.<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImpl_1a1580e11fa4a1474d01f4ca23f6feb909" kindref="member">hasRole</ref>(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a22568da99d0dcd78708fa303bf25632a" kindref="member">testUserId</ref>,<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a17bb21ceb27ca8519dd5e3c10eb12533" kindref="member">testRoleCode</ref>);</highlight></codeline>
<codeline lineno="225"><highlight class="normal"></highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>验证结果</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assertFalse(result);</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="229"><highlight class="normal"></highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/>@Test</highlight></codeline>
<codeline lineno="234" refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a10d3b28601cac6633d49aaa889665acf" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a10d3b28601cac6633d49aaa889665acf" kindref="member">hasAnyRole_HasMatchingRole</ref>()<sp/>{</highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>准备测试数据</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;String&gt;<sp/>roleCodes<sp/>=<sp/>Arrays.asList(</highlight><highlight class="stringliteral">&quot;ADMIN&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;MANAGER&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Set&lt;String&gt;<sp/>userRoleCodes<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>HashSet&lt;&gt;(Arrays.asList(</highlight><highlight class="stringliteral">&quot;ADMIN&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;USER&quot;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>配置mock行为<sp/>-<sp/>使用spy来模拟getUserRoleCodes方法</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImpl" kindref="compound">UserRoleServiceImpl</ref><sp/>spy<sp/>=<sp/>spy(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a985a617a22d892ab34702d0b86516807" kindref="member">userRoleService</ref>);</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>doReturn(userRoleCodes).when(spy).getUserRoleCodes(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a22568da99d0dcd78708fa303bf25632a" kindref="member">testUserId</ref>);</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(Exception<sp/>e)<sp/>{</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>忽略异常</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="246"><highlight class="normal"></highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>执行测试</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/>result<sp/>=<sp/>spy.<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImpl_1a2081280997ee0557b5eb3bba4c95e1c3" kindref="member">hasAnyRole</ref>(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a22568da99d0dcd78708fa303bf25632a" kindref="member">testUserId</ref>,<sp/>roleCodes);</highlight></codeline>
<codeline lineno="249"><highlight class="normal"></highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>验证结果</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assertTrue(result);</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>verify(spy,<sp/>times(1)).getUserRoleCodes(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a22568da99d0dcd78708fa303bf25632a" kindref="member">testUserId</ref>);</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="254"><highlight class="normal"></highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/>@Test</highlight></codeline>
<codeline lineno="259" refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1aa2e72b78aa39ce6bedd0c101a63b6d62" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1aa2e72b78aa39ce6bedd0c101a63b6d62" kindref="member">hasAnyRole_NoMatchingRole</ref>()<sp/>{</highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>准备测试数据</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;String&gt;<sp/>roleCodes<sp/>=<sp/>Arrays.asList(</highlight><highlight class="stringliteral">&quot;ADMIN&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;MANAGER&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Set&lt;String&gt;<sp/>userRoleCodes<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>HashSet&lt;&gt;(Arrays.asList(</highlight><highlight class="stringliteral">&quot;USER&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;GUEST&quot;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>配置mock行为<sp/>-<sp/>使用spy来模拟getUserRoleCodes方法</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImpl" kindref="compound">UserRoleServiceImpl</ref><sp/>spy<sp/>=<sp/>spy(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a985a617a22d892ab34702d0b86516807" kindref="member">userRoleService</ref>);</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>when(spy.<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImpl_1a4172a9e820a773630bbc740e7717d362" kindref="member">getUserRoleCodes</ref>(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a22568da99d0dcd78708fa303bf25632a" kindref="member">testUserId</ref>)).thenReturn(userRoleCodes);</highlight></codeline>
<codeline lineno="267"><highlight class="normal"></highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>执行测试</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/>result<sp/>=<sp/>spy.<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImpl_1a2081280997ee0557b5eb3bba4c95e1c3" kindref="member">hasAnyRole</ref>(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a22568da99d0dcd78708fa303bf25632a" kindref="member">testUserId</ref>,<sp/>roleCodes);</highlight></codeline>
<codeline lineno="270"><highlight class="normal"></highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>验证结果</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assertFalse(result);</highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>verify(spy,<sp/>times(1)).getUserRoleCodes(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a22568da99d0dcd78708fa303bf25632a" kindref="member">testUserId</ref>);</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="275"><highlight class="normal"></highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/>@Test</highlight></codeline>
<codeline lineno="280" refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a47271ba286abd4c90e87c7d1da29ec34" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a47271ba286abd4c90e87c7d1da29ec34" kindref="member">refreshExpiredUserRoles_NoOperation</ref>()<sp/>{</highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>执行测试<sp/>-<sp/>不应该抛出异常</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assertDoesNotThrow(()<sp/>-&gt;<sp/>{</highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImplTest_1a985a617a22d892ab34702d0b86516807" kindref="member">userRoleService</ref>.<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1impl_1_1UserRoleServiceImpl_1ad9e985314eb4634dfd7c888ded2b6081" kindref="member">refreshExpiredUserRoles</ref>();</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="286"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="auth-service/src/test/java/com/gmp/auth/service/impl/UserRoleServiceImplTest.java"/>
  </compounddef>
</doxygen>

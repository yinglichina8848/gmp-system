<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.9.8" xml:lang="en-US">
  <compounddef id="PasswordPolicyService_8java" kind="file" language="Java">
    <compoundname>PasswordPolicyService.java</compoundname>
    <includes local="no">org.springframework.beans.factory.annotation.Autowired</includes>
    <incdepgraph>
      <node id="1">
        <label>auth-service/src/main/java/com/gmp/auth/service/PasswordPolicyService.java</label>
        <link refid="PasswordPolicyService_8java"/>
        <childnode refid="2" relation="include">
        </childnode>
      </node>
      <node id="2">
        <label>org.springframework.beans.factory.annotation.Autowired</label>
      </node>
    </incdepgraph>
    <innerclass refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService" prot="public">com::gmp::auth::service::PasswordPolicyService</innerclass>
    <innernamespace refid="namespacecom_1_1gmp_1_1auth_1_1service">com::gmp::auth::service</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="keyword">package<sp/></highlight><highlight class="normal">com.gmp.auth.service;</highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>org.springframework.beans.factory.annotation.Autowired;</highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>org.springframework.beans.factory.annotation.Value;</highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>org.springframework.security.crypto.password.PasswordEncoder;</highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>org.springframework.stereotype.Service;</highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>org.slf4j.Logger;</highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>org.slf4j.LoggerFactory;</highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.time.LocalDateTime;</highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.List;</highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.regex.Pattern;</highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal">@Service</highlight></codeline>
<codeline lineno="19" refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService" kindref="compound">PasswordPolicyService</ref><sp/>{</highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>密码策略常量</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="22" refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1afa134817a99fe3273d58e7f79b1c00f9" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1afa134817a99fe3273d58e7f79b1c00f9" kindref="member">MIN_PASSWORD_LENGTH</ref><sp/>=<sp/>8;</highlight></codeline>
<codeline lineno="23"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="24" refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1ab91b4e2ba7f74a216624128bf20ddfd4" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>Logger<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1ab91b4e2ba7f74a216624128bf20ddfd4" kindref="member">log</ref><sp/>=<sp/>LoggerFactory.getLogger(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService" kindref="compound">PasswordPolicyService</ref>.class);</highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"><sp/><sp/><sp/><sp/>@Autowired</highlight></codeline>
<codeline lineno="27" refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1a4aba987d9f54ef5d3c0da518a45d7e0d" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>PasswordEncoder<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1a4aba987d9f54ef5d3c0da518a45d7e0d" kindref="member">passwordEncoder</ref>;</highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight></codeline>
<codeline lineno="29"><highlight class="normal"><sp/><sp/><sp/><sp/>@Autowired</highlight></codeline>
<codeline lineno="30" refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1ab8fbf8cd22342db9d096e0fb5be46450" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/><ref refid="interfacecom_1_1gmp_1_1auth_1_1service_1_1UserPasswordHistoryService" kindref="compound">UserPasswordHistoryService</ref><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1ab8fbf8cd22342db9d096e0fb5be46450" kindref="member">userPasswordHistoryService</ref>;</highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight></codeline>
<codeline lineno="32"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>密码最小长度</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="33"><highlight class="normal"><sp/><sp/><sp/><sp/>@Value(</highlight><highlight class="stringliteral">&quot;${auth.password.min-length:10}&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="34" refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1adf75763f006b2504bc7c70dd1502557d" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>private<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1adf75763f006b2504bc7c70dd1502557d" kindref="member">minPasswordLength</ref>;</highlight></codeline>
<codeline lineno="35"><highlight class="normal"></highlight></codeline>
<codeline lineno="36"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>密码过期天数</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="37"><highlight class="normal"><sp/><sp/><sp/><sp/>@Value(&quot;${auth.password.expiry-days:90}</highlight><highlight class="stringliteral">&quot;)</highlight></codeline>
<codeline lineno="38" refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1a2b73bd2ba86b683235067ad230cd584a" refkind="member"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>private<sp/>int<sp/>passwordExpiryDays;</highlight></codeline>
<codeline lineno="39"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="40"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>//<sp/>历史密码记录数</highlight></codeline>
<codeline lineno="41"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>@Value(&quot;</highlight><highlight class="normal">${auth.password.history-count:5}</highlight><highlight class="stringliteral">&quot;)</highlight></codeline>
<codeline lineno="42" refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1ac3960bb06e717bcaadf2b2d0566f0898" refkind="member"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>private<sp/>int<sp/>passwordHistoryCount;</highlight></codeline>
<codeline lineno="43"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="44"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>//<sp/>复杂度要求：必须包含数字</highlight></codeline>
<codeline lineno="45" refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1ad33d3854feb8a92a6f29e0a263f82d94" refkind="member"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>private<sp/>static<sp/>final<sp/>Pattern<sp/>HAS_DIGIT<sp/>=<sp/>Pattern.compile(&quot;</highlight><highlight class="normal">\\d</highlight><highlight class="stringliteral">&quot;);</highlight></codeline>
<codeline lineno="46"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>//<sp/>复杂度要求：必须包含小写字母</highlight></codeline>
<codeline lineno="47" refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1a60a91299b99b0e946a7edaf6c1aa09df" refkind="member"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>private<sp/>static<sp/>final<sp/>Pattern<sp/>HAS_LOWERCASE<sp/>=<sp/>Pattern.compile(&quot;</highlight><highlight class="normal">[a-z]</highlight><highlight class="stringliteral">&quot;);</highlight></codeline>
<codeline lineno="48"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>//<sp/>复杂度要求：必须包含大写字母</highlight></codeline>
<codeline lineno="49" refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1a7654c0cee5e2b965bad7a66cfce38436" refkind="member"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>private<sp/>static<sp/>final<sp/>Pattern<sp/>HAS_UPPERCASE<sp/>=<sp/>Pattern.compile(&quot;</highlight><highlight class="normal">[A-Z]</highlight><highlight class="stringliteral">&quot;);</highlight></codeline>
<codeline lineno="50"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>//<sp/>复杂度要求：必须包含特殊字符</highlight></codeline>
<codeline lineno="51" refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1ab7646581301df3885199ae4a42067570" refkind="member"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>private<sp/>static<sp/>final<sp/>Pattern<sp/>HAS_SPECIAL<sp/>=<sp/>Pattern.compile(&quot;</highlight><highlight class="normal">[!@#$%^&amp;*(),.?\</highlight><highlight class="stringliteral">&quot;:{}|&lt;&gt;]&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="52"><highlight class="normal"></highlight></codeline>
<codeline lineno="58" refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1a4af68f51a2420407f8ea9127a98ce41f" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1a4af68f51a2420407f8ea9127a98ce41f" kindref="member">validatePasswordComplexity</ref>(String<sp/>password)<sp/>{</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(password<sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal"><sp/>||<sp/>password.length()<sp/>&lt;<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1adf75763f006b2504bc7c70dd1502557d" kindref="member">minPasswordLength</ref>)<sp/>{</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;密码长度必须至少为&quot;</highlight><highlight class="normal"><sp/>+<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1adf75763f006b2504bc7c70dd1502557d" kindref="member">minPasswordLength</ref><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;个字符&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="62"><highlight class="normal"></highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1ad33d3854feb8a92a6f29e0a263f82d94" kindref="member">HAS_DIGIT</ref>.matcher(password).find())<sp/>{</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;密码必须包含至少一个数字&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="66"><highlight class="normal"></highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1a60a91299b99b0e946a7edaf6c1aa09df" kindref="member">HAS_LOWERCASE</ref>.matcher(password).find())<sp/>{</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;密码必须包含至少一个小写字母&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="70"><highlight class="normal"></highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1a7654c0cee5e2b965bad7a66cfce38436" kindref="member">HAS_UPPERCASE</ref>.matcher(password).find())<sp/>{</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;密码必须包含至少一个大写字母&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="74"><highlight class="normal"></highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1ab7646581301df3885199ae4a42067570" kindref="member">HAS_SPECIAL</ref>.matcher(password).find())<sp/>{</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;密码必须包含至少一个特殊字符&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="78"><highlight class="normal"></highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">;<sp/></highlight><highlight class="comment">//<sp/>验证通过</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="81"><highlight class="normal"></highlight></codeline>
<codeline lineno="88" refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1a99b87b7a0be0a629c9d060b43d32669b" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1a99b87b7a0be0a629c9d060b43d32669b" kindref="member">isPasswordInHistory</ref>(Long<sp/>userId,<sp/>String<sp/>rawPassword)<sp/>{</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;String&gt;<sp/>passwordHistory<sp/>=<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1ab8fbf8cd22342db9d096e0fb5be46450" kindref="member">userPasswordHistoryService</ref>.<ref refid="interfacecom_1_1gmp_1_1auth_1_1service_1_1UserPasswordHistoryService_1af8d1062044557e0e45e8ffce1ddb5530" kindref="member">getPasswordHistory</ref>(userId,<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1ac3960bb06e717bcaadf2b2d0566f0898" kindref="member">passwordHistoryCount</ref>);</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(String<sp/>hashedPassword<sp/>:<sp/>passwordHistory)<sp/>{</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1a4aba987d9f54ef5d3c0da518a45d7e0d" kindref="member">passwordEncoder</ref>.matches(rawPassword,<sp/>hashedPassword))<sp/>{</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1ab91b4e2ba7f74a216624128bf20ddfd4" kindref="member">log</ref>.warn(</highlight><highlight class="stringliteral">&quot;密码与历史密码重复<sp/>-<sp/>用户ID:<sp/>{}&quot;</highlight><highlight class="normal">,<sp/>userId);</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="99"><highlight class="normal"></highlight></codeline>
<codeline lineno="104" refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1ac2f75b4ef053eed4d8b1f34faa888074" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>LocalDateTime<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1ac2f75b4ef053eed4d8b1f34faa888074" kindref="member">calculatePasswordExpiryTime</ref>()<sp/>{</highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>LocalDateTime.now().plusDays(<ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1a2b73bd2ba86b683235067ad230cd584a" kindref="member">passwordExpiryDays</ref>);</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="107"><highlight class="normal"></highlight></codeline>
<codeline lineno="113" refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1a944c862edd53e7c2d630307013a09eef" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1a944c862edd53e7c2d630307013a09eef" kindref="member">isPasswordExpiringSoon</ref>(LocalDateTime<sp/>passwordExpiredAt)<sp/>{</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(passwordExpiredAt<sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>LocalDateTime.now().plusDays(7).isAfter(passwordExpiredAt)<sp/>&amp;&amp;<sp/></highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>LocalDateTime.now().isBefore(passwordExpiredAt);</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="120"><highlight class="normal"></highlight></codeline>
<codeline lineno="126" refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1a3ce864d7fb8a0eec7baac83f790f70cf" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1a3ce864d7fb8a0eec7baac83f790f70cf" kindref="member">recordPasswordHistory</ref>(Long<sp/>userId,<sp/>String<sp/>hashedPassword)<sp/>{</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1ab8fbf8cd22342db9d096e0fb5be46450" kindref="member">userPasswordHistoryService</ref>.<ref refid="interfacecom_1_1gmp_1_1auth_1_1service_1_1UserPasswordHistoryService_1ae0ff379d4207f02ea53f7e9b91d98f4a" kindref="member">recordPasswordHistory</ref>(userId,<sp/>hashedPassword);</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="129"><highlight class="normal"></highlight></codeline>
<codeline lineno="135" refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1adb5da6ddfe92811aea02486017d75e17" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1adb5da6ddfe92811aea02486017d75e17" kindref="member">validatePassword</ref>(String<sp/>password)<sp/>{</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>使用现有的密码复杂度验证方法</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>String<sp/>errorMessage<sp/>=<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1a4af68f51a2420407f8ea9127a98ce41f" kindref="member">validatePasswordComplexity</ref>(password);</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>errorMessage<sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">;<sp/></highlight><highlight class="comment">//<sp/>null表示验证通过</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="145" refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1aa00ddba5053133c22b112230b56a8489" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1aa00ddba5053133c22b112230b56a8489" kindref="member">getPasswordComplexityRequirements</ref>()<sp/>{</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>String.format(</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;密码必须满足以下要求：\n&quot;</highlight><highlight class="normal"><sp/>+</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;1.<sp/>长度至少%d个字符\n&quot;</highlight><highlight class="normal"><sp/>+</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;2.<sp/>包含至少一个数字\n&quot;</highlight><highlight class="normal"><sp/>+</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;3.<sp/>包含至少一个小写字母\n&quot;</highlight><highlight class="normal"><sp/>+</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;4.<sp/>包含至少一个大写字母\n&quot;</highlight><highlight class="normal"><sp/>+</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;5.<sp/>包含至少一个特殊字符(!@#$%^&amp;*(),.?\&quot;{}\\|&lt;&gt;)&quot;</highlight><highlight class="normal">,<sp/></highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1afa134817a99fe3273d58e7f79b1c00f9" kindref="member">MIN_PASSWORD_LENGTH</ref></highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="161" refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1a07c0fe4d74be44f2f77b3bcfd6682dd7" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1a07c0fe4d74be44f2f77b3bcfd6682dd7" kindref="member">getPasswordRequirementsDescription</ref>()<sp/>{</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;密码必须至少包含&quot;</highlight><highlight class="normal"><sp/>+<sp/><ref refid="classcom_1_1gmp_1_1auth_1_1service_1_1PasswordPolicyService_1afa134817a99fe3273d58e7f79b1c00f9" kindref="member">MIN_PASSWORD_LENGTH</ref><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;个字符，包括大写字母、小写字母、数字和特殊字符。&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="164"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="auth-service/src/main/java/com/gmp/auth/service/PasswordPolicyService.java"/>
  </compounddef>
</doxygen>

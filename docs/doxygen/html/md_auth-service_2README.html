<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>GMP系统: GMP认证系统测试与初始化文档</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">GMP系统<span id="projectnumber">&#160;0.1.1</span>
   </div>
   <div id="projectbrief">GMP系统文档</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_auth-service_2README.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">GMP认证系统测试与初始化文档</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>1. 系统概述</h1>
<p>本模块提供GMP系统认证功能的初始化和测试脚本，支持组织结构定义、角色权限创建、用户初始化以及完整的认证测试流程。系统采用Spring Boot框架开发，集成在应用启动流程中，可通过配置灵活控制初始化和测试行为。</p>
<h1>2. 主要组件</h1>
<h2>2.1 初始化组件</h2>
<ul>
<li><b>OrganizationStructureInitializer</b>: 组织结构初始化器<ul>
<li>负责创建公司、部门、团队等组织单元</li>
<li>支持树状组织结构和层级关系</li>
</ul>
</li>
<li><b>RolePermissionInitializer</b>: 角色和权限初始化器<ul>
<li>创建系统预设角色（系统管理员、GMP管理员等13个角色）</li>
<li>定义功能权限（9个功能模块）</li>
<li>建立角色-权限关联关系</li>
</ul>
</li>
<li><b>UserInitializer</b>: 用户初始化器<ul>
<li>创建测试用户（15个不同类型用户）</li>
<li>建立用户-角色关联</li>
<li>建立用户-组织角色关联</li>
</ul>
</li>
<li><b>AuthSystemApplicationInitializer</b>: 应用启动初始化器<ul>
<li>在Spring Boot应用启动时协调执行各初始化器</li>
<li>根据配置控制初始化行为</li>
</ul>
</li>
</ul>
<h2>2.2 测试组件</h2>
<ul>
<li><b>AuthSystemTestScript</b>: 认证系统测试脚本<ul>
<li>提供组织结构验证测试</li>
<li>实现角色权限测试</li>
<li>支持用户登录测试</li>
<li>执行权限差异验证</li>
</ul>
</li>
<li><b>AuthSystemCommandLineRunner</b>: 命令行运行器<ul>
<li>提供独立命令行测试入口</li>
<li>支持参数化控制初始化和测试</li>
</ul>
</li>
<li><b>AuthTestErrorHandler</b>: 错误处理器<ul>
<li>统一的异常处理机制</li>
<li>支持错误重试和报告生成</li>
</ul>
</li>
<li><b>AuthSystemTestExecutor</b>: 测试执行器<ul>
<li>整合测试和错误处理</li>
<li>提供统一的测试执行环境</li>
</ul>
</li>
</ul>
<h2>2.3 配置组件</h2>
<ul>
<li><b>AuthSystemConfig</b>: 认证系统配置<ul>
<li>集中管理初始化和测试配置</li>
<li>支持灵活的配置选项</li>
</ul>
</li>
</ul>
<h1>3. 配置说明</h1>
<h2>3.1 核心配置属性</h2>
<p>在 <code>application.properties</code> 或 <code>application.yml</code> 中添加以下配置：</p>
<div class="fragment"><div class="line"># 认证系统初始化配置</div>
<div class="line">gmp:</div>
<div class="line">  auth:</div>
<div class="line">    initialization:</div>
<div class="line">      enabled: false          # 是否启用自动初始化</div>
<div class="line">      fail-fast: true         # 初始化失败时是否中断应用启动</div>
<div class="line">      run-tests: false        # 初始化后是否运行测试</div>
<div class="line">      skip-existing: true     # 是否跳过已存在的数据</div>
<div class="line">      timeout: 5m             # 初始化超时时间</div>
<div class="line">      batch-size: 100         # 批处理大小</div>
<div class="line">    test:</div>
<div class="line">      enabled: false          # 是否启用测试模式</div>
<div class="line">      user-prefix: &quot;test_&quot;    # 测试用户名前缀</div>
<div class="line">      data-expiry-hours: 24   # 测试数据过期时间（小时）</div>
<div class="line">      auto-cleanup: true      # 是否自动清理测试数据</div>
</div><!-- fragment --><h2>3.2 启用初始化的方法</h2>
<h3>方法1: 通过配置文件启用</h3>
<p>在 <code>application.properties</code> 中设置： </p><div class="fragment"><div class="line">gmp.auth.initialization.enabled=true</div>
</div><!-- fragment --><h3>方法2: 通过环境变量启用</h3>
<div class="fragment"><div class="line">export GMP_AUTH_INITIALIZATION_ENABLED=true</div>
</div><!-- fragment --><h3>方法3: 通过命令行参数启用</h3>
<div class="fragment"><div class="line">java -jar auth-service.jar --gmp.auth.initialization.enabled=true</div>
</div><!-- fragment --><h1>4. 使用方法</h1>
<h2>4.1 作为应用启动的一部分运行</h2>
<ol type="1">
<li>配置启用初始化: <code>gmp.auth.initialization.enabled=true</code></li>
<li>启动应用，初始化过程将在应用启动时自动执行</li>
</ol>
<h2>4.2 使用命令行运行器运行</h2>
<ol type="1">
<li>构建应用: <code>mvn clean package</code></li>
<li>使用命令行运行器执行:</li>
</ol>
<div class="fragment"><div class="line"># 运行并执行初始化</div>
<div class="line">java -jar auth-service.jar --command-line-runner=auth --reinitialize</div>
<div class="line"> </div>
<div class="line"># 跳过初始化，只运行测试</div>
<div class="line">java -jar auth-service.jar --command-line-runner=auth --skip-initialization --run-tests</div>
<div class="line"> </div>
<div class="line"># 运行特定测试</div>
<div class="line">java -jar auth-service.jar --command-line-runner=auth --skip-initialization --test=organization,role</div>
</div><!-- fragment --><h2>4.3 测试用户信息</h2>
<p>系统初始化后创建以下测试用户：</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">用户名   </th><th class="markdownTableHeadNone">密码   </th><th class="markdownTableHeadNone">角色   </th><th class="markdownTableHeadNone">所属组织    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">admin   </td><td class="markdownTableBodyNone">123456   </td><td class="markdownTableBodyNone">系统管理员   </td><td class="markdownTableBodyNone">公司总部    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">gmp_admin   </td><td class="markdownTableBodyNone">123456   </td><td class="markdownTableBodyNone">GMP管理员   </td><td class="markdownTableBodyNone">质量管理部    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">prod_manager   </td><td class="markdownTableBodyNone">123456   </td><td class="markdownTableBodyNone">生产经理   </td><td class="markdownTableBodyNone">生产部    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">quality_manager   </td><td class="markdownTableBodyNone">123456   </td><td class="markdownTableBodyNone">质量经理   </td><td class="markdownTableBodyNone">质量管理部    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">warehouse_manager   </td><td class="markdownTableBodyNone">123456   </td><td class="markdownTableBodyNone">仓库经理   </td><td class="markdownTableBodyNone">仓储部    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">procurement_manager   </td><td class="markdownTableBodyNone">123456   </td><td class="markdownTableBodyNone">采购经理   </td><td class="markdownTableBodyNone">采购部    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">hr_manager   </td><td class="markdownTableBodyNone">123456   </td><td class="markdownTableBodyNone">人力资源经理   </td><td class="markdownTableBodyNone">人力资源部    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">it_manager   </td><td class="markdownTableBodyNone">123456   </td><td class="markdownTableBodyNone">IT管理员   </td><td class="markdownTableBodyNone">IT部门    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">prod_supervisor   </td><td class="markdownTableBodyNone">123456   </td><td class="markdownTableBodyNone">生产主管   </td><td class="markdownTableBodyNone">生产一部    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">quality_inspector   </td><td class="markdownTableBodyNone">123456   </td><td class="markdownTableBodyNone">质量检验员   </td><td class="markdownTableBodyNone">质量检验组    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">warehouse_worker   </td><td class="markdownTableBodyNone">123456   </td><td class="markdownTableBodyNone">仓库管理员   </td><td class="markdownTableBodyNone">原材料库    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">procurement_specialist   </td><td class="markdownTableBodyNone">123456   </td><td class="markdownTableBodyNone">采购专员   </td><td class="markdownTableBodyNone">采购部    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">hr_staff   </td><td class="markdownTableBodyNone">123456   </td><td class="markdownTableBodyNone">人力资源专员   </td><td class="markdownTableBodyNone">人力资源部    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">it_support   </td><td class="markdownTableBodyNone">123456   </td><td class="markdownTableBodyNone">IT支持   </td><td class="markdownTableBodyNone">IT部门    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">general_user   </td><td class="markdownTableBodyNone">123456   </td><td class="markdownTableBodyNone">普通用户   </td><td class="markdownTableBodyNone">综合管理部   </td></tr>
</table>
<h1>5. 组织结构说明</h1>
<p>初始化的组织结构包括：</p>
<ul>
<li>公司总部（公司级）<ul>
<li>生产部（部门级）<ul>
<li>生产一部（团队级）</li>
<li>生产二部（团队级）</li>
</ul>
</li>
<li>质量管理部（部门级）<ul>
<li>质量检验组（团队级）</li>
<li>验证组（团队级）</li>
</ul>
</li>
<li>仓储部（部门级）<ul>
<li>原材料库（团队级）</li>
<li>成品库（团队级）</li>
</ul>
</li>
<li>采购部（部门级）</li>
<li>人力资源部（部门级）</li>
<li>IT部门（部门级）</li>
<li>综合管理部（部门级）</li>
</ul>
</li>
</ul>
<h1>6. 角色和权限说明</h1>
<h2>6.1 预设角色</h2>
<ol type="1">
<li><b>系统管理员</b> - 具有系统所有权限</li>
<li><b>GMP管理员</b> - 具有GMP相关所有权限</li>
<li><b>生产经理</b> - 生产管理权限</li>
<li><b>质量经理</b> - 质量管理权限</li>
<li><b>仓库经理</b> - 仓储管理权限</li>
<li><b>采购经理</b> - 采购管理权限</li>
<li><b>人力资源经理</b> - 人力资源管理权限</li>
<li><b>IT管理员</b> - IT系统管理权限</li>
<li><b>生产主管</b> - 生产执行权限</li>
<li><b>质量检验员</b> - 质量检验权限</li>
<li><b>仓库管理员</b> - 仓库操作权限</li>
<li><b>采购专员</b> - 采购执行权限</li>
<li><b>普通用户</b> - 基础访问权限</li>
</ol>
<h2>6.2 权限模块</h2>
<ol type="1">
<li><b>用户管理</b> - 用户增删改查、密码重置等</li>
<li><b>角色管理</b> - 角色创建、权限分配等</li>
<li><b>组织管理</b> - 组织结构维护等</li>
<li><b>GMP文档管理</b> - GMP文档的访问和操作</li>
<li><b>生产管理</b> - 生产计划、执行、记录等</li>
<li><b>质量管理</b> - 检验、审核、偏差管理等</li>
<li><b>仓库管理</b> - 库存管理、出入库操作等</li>
<li><b>采购管理</b> - 供应商管理、采购订单等</li>
<li><b>系统配置</b> - 系统参数配置等</li>
</ol>
<h1>7. 错误处理和日志</h1>
<h2>7.1 错误类型</h2>
<p>系统处理以下几类错误：</p>
<ul>
<li><b>初始化错误</b> - 组织结构、角色、用户初始化过程中的错误</li>
<li><b>数据库错误</b> - 数据库操作相关错误</li>
<li><b>认证错误</b> - 用户认证和权限检查错误</li>
<li><b>配置错误</b> - 配置参数不正确导致的错误</li>
<li><b>业务错误</b> - 业务逻辑验证失败</li>
</ul>
<h2>7.2 日志配置</h2>
<p>初始化和测试过程会生成详细日志，配置在 <code>logback-spring.xml</code> 中：</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">logger</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;com.gmp.auth.init&quot;</span> <span class="keyword">level</span>=<span class="stringliteral">&quot;INFO&quot;</span>/&gt;</div>
<div class="line">&lt;<span class="keywordtype">logger</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;com.gmp.auth.test&quot;</span> <span class="keyword">level</span>=<span class="stringliteral">&quot;INFO&quot;</span>/&gt;</div>
</div><!-- fragment --><h1>8. 性能优化建议</h1>
<ol type="1">
<li><b>批量操作</b> - 使用批处理模式提高初始化效率</li>
<li><b>跳过现有数据</b> - 在生产环境中启用 <code>skip-existing</code> 避免重复初始化</li>
<li><b>禁用测试</b> - 在生产环境中禁用测试模式</li>
<li><b>合理设置超时</b> - 根据数据量调整初始化超时时间</li>
<li><b>监控初始化过程</b> - 通过日志监控初始化进度和性能</li>
</ol>
<h1>9. 最佳实践</h1>
<h2>9.1 开发环境</h2>
<ul>
<li>启用自动初始化和测试</li>
<li>使用预设的测试用户进行功能测试</li>
</ul>
<h2>9.2 测试环境</h2>
<ul>
<li>定期重新初始化测试数据</li>
<li>完整运行测试套件验证系统完整性</li>
</ul>
<h2>9.3 生产环境</h2>
<ul>
<li>首次部署时启用初始化</li>
<li>后续更新时禁用初始化</li>
<li>避免在生产环境运行测试</li>
</ul>
<h1>10. 常见问题</h1>
<h2>10.1 初始化失败</h2>
<p>**症状**：应用启动时初始化失败</p>
<p>**解决方案**：</p><ul>
<li>检查数据库连接是否正常</li>
<li>查看日志中的详细错误信息</li>
<li>如非关键错误，可设置 <code>fail-fast=false</code> 允许应用继续启动</li>
</ul>
<h2>10.2 测试用户无法登录</h2>
<p>**症状**：使用预设密码无法登录</p>
<p>**解决方案**：</p><ul>
<li>确认初始化是否成功执行</li>
<li>检查密码加密方式是否正确</li>
<li>尝试重置密码</li>
</ul>
<h2>10.3 权限不正确</h2>
<p>**症状**：用户拥有的权限与预期不符</p>
<p>**解决方案**：</p><ul>
<li>重新运行初始化，清除现有数据</li>
<li>检查角色-权限映射配置</li>
</ul>
<h1>11. 更新日志</h1>
<ul>
<li><b>1.0.0</b> - 初始版本，支持组织结构、角色权限和用户的初始化和测试</li>
</ul>
<hr  />
<p><em>本文档由GMP系统认证模块自动生成，最后更新时间：${current.date}</em> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>

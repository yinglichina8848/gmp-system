<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>GMP系统: File服务合并到EDMS服务方案</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">GMP系统<span id="projectnumber">&#160;0.1.1</span>
   </div>
   <div id="projectbrief">GMP系统文档</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_edms-service_2MERGE__PLAN.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">File服务合并到EDMS服务方案</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>1. 背景与目标</h1>
<p>根据系统重构需求，需要将独立的File服务合并到现有的EDMS（Electronic Document Management System）服务中，以简化系统架构，减少服务间调用，并实现文件管理功能的统一维护。</p>
<h1>2. 当前系统分析</h1>
<h2>2.1 File服务现状</h2>
<ul>
<li>File服务目录为空，可能是待实现或已被移除的服务</li>
<li>假设其预期功能是提供通用文件存储和管理功能</li>
</ul>
<h2>2.2 EDMS服务现状</h2>
<ul>
<li>已实现完整的文件存储功能，通过MinioFileStorageServiceImpl实现FileStorageService接口</li>
<li>使用Minio作为底层对象存储</li>
<li>已支持文档管理、版本控制和文件操作</li>
<li>提供了丰富的文件操作API，包括：<ul>
<li>文件上传、下载、删除</li>
<li>预签名URL生成</li>
<li>文件信息获取</li>
<li>文件复制和移动</li>
<li>目录列表和桶管理</li>
</ul>
</li>
</ul>
<h1>3. 合并方案</h1>
<h2>3.1 功能整合策略</h2>
<h3>3.1.1 文件存储功能扩展</h3>
<ol type="1">
<li>保留现有的MinioFileStorageServiceImpl作为底层实现</li>
<li>扩展FileStorageService接口以支持更通用的文件操作需求</li>
<li>实现多租户隔离机制，确保不同业务模块的文件存储隔离</li>
</ol>
<h3>3.1.2 API整合方案</h3>
<ol type="1">
<li>为原File服务API创建兼容层，使用Spring MVC的控制器映射实现</li>
<li>现有的EDMS文档相关API保持不变</li>
<li>新增通用文件操作API，路径前缀为<code>/api/v1/files</code></li>
</ol>
<h3>3.1.3 存储结构设计</h3>
<div class="fragment"><div class="line">minio-bucket/</div>
<div class="line">├── edms-documents/          # 现有文档存储区</div>
<div class="line">│   └── versions/            # 文档版本存储</div>
<div class="line">├── common-files/            # 通用文件存储区（新增）</div>
<div class="line">│   ├── [module]/            # 模块标识</div>
<div class="line">│   ├── [year]/[month]/[day] # 按日期组织</div>
<div class="line">│   └── ...</div>
<div class="line">└── temp/                    # 临时文件存储区（新增）</div>
</div><!-- fragment --><h2>3.2 技术实现细节</h2>
<h3>3.2.1 服务层扩展</h3>
<ol type="1">
<li>创建通用文件管理服务接口<code>CommonFileService</code></li>
<li>实现<code>CommonFileServiceImpl</code>，委托<code>FileStorageService</code>完成实际存储操作</li>
<li>添加文件元数据管理，支持文件分类、标签和搜索</li>
</ol>
<h3>3.2.2 控制器层实现</h3>
<ol type="1">
<li>创建<code>FileController</code>提供通用文件操作API</li>
<li>实现原File服务的API兼容层，重定向到新的实现</li>
<li>为所有文件操作添加权限控制和审计日志</li>
</ol>
<h3>3.2.3 数据模型扩展</h3>
<ol type="1">
<li>创建<code>CommonFile</code>实体类存储文件元数据</li>
<li>添加<code>FileModule</code>枚举标识文件所属模块</li>
<li>设计文件索引结构支持快速检索</li>
</ol>
<h2>3.3 迁移策略</h2>
<h3>3.3.1 数据迁移</h3>
<ol type="1">
<li>如果有现有File服务数据，创建迁移脚本将其导入新结构</li>
<li>使用批处理方式迁移大量文件，最小化服务中断</li>
<li>迁移后进行校验确保数据完整性</li>
</ol>
<h3>3.3.2 服务部署</h3>
<ol type="1">
<li>更新EDMS服务配置，添加必要的Minio配置和文件路径设置</li>
<li>部署更新后的EDMS服务</li>
<li>更新API网关配置，将原File服务请求路由到EDMS服务</li>
</ol>
<h1>4. 兼容性保障</h1>
<h2>4.1 API兼容性</h2>
<ol type="1">
<li>实现API版本控制策略</li>
<li>为原File服务API提供兼容层</li>
<li>提供API文档和迁移指南</li>
</ol>
<h2>4.2 错误处理</h2>
<ol type="1">
<li>统一错误响应格式</li>
<li>添加详细的错误日志</li>
<li>实现重试机制和熔断保护</li>
</ol>
<h1>5. 实施计划</h1>
<h2>5.1 阶段一：准备工作</h2>
<ul>
<li>更新项目依赖和配置</li>
<li>创建开发分支</li>
<li>设计详细的API规范</li>
</ul>
<h2>5.2 阶段二：核心实现</h2>
<ul>
<li>扩展FileStorageService功能</li>
<li>实现CommonFileService</li>
<li>创建控制器层API</li>
</ul>
<h2>5.3 阶段三：测试与验证</h2>
<ul>
<li>编写单元测试和集成测试</li>
<li>性能测试和负载测试</li>
<li>安全审计</li>
</ul>
<h2>5.4 阶段四：部署与切换</h2>
<ul>
<li>数据迁移（如果需要）</li>
<li>更新服务配置</li>
<li>流量切换和监控</li>
</ul>
<h1>6. 风险评估</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">风险项   </th><th class="markdownTableHeadNone">可能性   </th><th class="markdownTableHeadNone">影响程度   </th><th class="markdownTableHeadNone">缓解措施    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">存储性能下降   </td><td class="markdownTableBodyNone">中   </td><td class="markdownTableBodyNone">高   </td><td class="markdownTableBodyNone">优化Minio配置，添加缓存层    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">API兼容性问题   </td><td class="markdownTableBodyNone">高   </td><td class="markdownTableBodyNone">高   </td><td class="markdownTableBodyNone">完整的API测试和兼容层实现    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">数据迁移失败   </td><td class="markdownTableBodyNone">中   </td><td class="markdownTableBodyNone">高   </td><td class="markdownTableBodyNone">备份机制，回滚计划，分批次迁移    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">服务不可用时间   </td><td class="markdownTableBodyNone">低   </td><td class="markdownTableBodyNone">高   </td><td class="markdownTableBodyNone">蓝绿部署，最小化切换窗口   </td></tr>
</table>
<h1>7. 成功标准</h1>
<ol type="1">
<li>EDMS服务能处理所有原File服务的请求</li>
<li>服务性能满足或超过当前水平</li>
<li>API兼容性测试通过</li>
<li>系统监控显示正常运行</li>
<li>开发和测试团队确认功能完整性 </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>

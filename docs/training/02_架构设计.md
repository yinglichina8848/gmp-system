# 培训管理模块（Training Management Module）架构设计

## 文档信息
- **版本号**: v1.0.0-draft
- **创建日期**: 2025-11-24
- **审核状态**: 待审核
- **保密级别**: 内部使用

## 目录
- [文档信息](#文档信息)
- [1. 架构概述](#1-架构概述)
  - [1.1 设计原则](#11-设计原则)
  - [1.2 架构风格](#12-架构风格)
  - [1.3 技术栈选择](#13-技术栈选择)
- [2. 系统架构图](#2-系统架构图)
- [3. 功能模块设计](#3-功能模块设计)
  - [3.1 培训需求管理模块](#31-培训需求管理模块)
  - [3.2 培训计划制定模块](#32-培训计划制定模块)
  - [3.3 培训执行管理模块](#33-培训执行管理模块)
  - [3.4 培训记录与评估模块](#34-培训记录与评估模块)
  - [3.5 证书与资质管理模块](#35-证书与资质管理模块)
  - [3.6 报表与分析模块](#36-报表与分析模块)
  - [3.7 系统管理模块](#37-系统管理模块)
- [4. 数据库设计](#4-数据库设计)
  - [4.1 数据模型](#41-数据模型)
  - [4.2 表结构](#42-表结构)
  - [4.3 关系图](#43-关系图)
  - [4.4 数据安全设计](#44-数据安全设计)
- [5. 接口设计](#5-接口设计)
  - [5.1 内部接口](#51-内部接口)
  - [5.2 外部接口](#52-外部接口)
  - [5.3 API规范](#53-api规范)
- [6. 安全设计](#6-安全设计)
  - [6.1 身份认证与授权](#61-身份认证与授权)
  - [6.2 数据加密](#62-数据加密)
  - [6.3 审计追踪](#63-审计追踪)
  - [6.4 安全防护](#64-安全防护)
- [7. 性能设计](#7-性能设计)
  - [7.1 性能目标](#71-性能目标)
  - [7.2 性能优化](#72-性能优化)
  - [7.3 缓存策略](#73-缓存策略)
  - [7.4 并发处理](#74-并发处理)
- [8. 扩展性设计](#8-扩展性设计)
  - [8.1 模块化设计](#81-模块化设计)
  - [8.2 组件复用](#82-组件复用)
  - [8.3 扩展接口](#83-扩展接口)
- [9. 灾备与恢复](#9-灾备与恢复)
  - [9.1 数据备份](#91-数据备份)
  - [9.2 恢复策略](#92-恢复策略)
  - [9.3 高可用性](#93-高可用性)
- [10. 部署架构](#10-部署架构)
  - [10.1 物理架构](#101-物理架构)
  - [10.2 网络拓扑](#102-网络拓扑)
  - [10.3 部署环境](#103-部署环境)
- [附录](#附录)
  - [术语定义](#术语定义)
  - [参考文档](#参考文档)
  - [联系方式](#联系方式)

## 1. 架构概述

### 1.1 设计原则
- **合规性优先**: 设计必须符合GMP等法规要求，确保培训记录的完整性、可追溯性和安全性
- **模块化设计**: 系统功能按照职责划分为独立模块，实现高内聚、低耦合
- **可扩展性**: 架构设计应具备良好的扩展性，支持未来功能扩展和系统集成
- **安全性**: 采用多层次安全措施，确保数据安全和系统安全
- **高性能**: 确保系统在大量数据和并发访问情况下的性能表现
- **可维护性**: 系统设计应便于维护、升级和故障排除

### 1.2 架构风格
采用分层架构和微服务架构相结合的方式：
- **表现层**: 提供Web界面，基于React实现
- **应用层**: 实现业务逻辑，包括各个功能模块的服务
- **数据访问层**: 负责数据持久化和检索
- **基础设施层**: 提供公共服务，如安全认证、日志记录、缓存等

### 1.3 技术栈选择
- **前端**: React、TypeScript、Ant Design、Axios
- **后端**: Spring Boot、Spring Cloud、Java 11+
- **数据库**: MySQL（关系型数据）、MongoDB（非结构化数据）
- **缓存**: Redis
- **消息队列**: RabbitMQ
- **搜索引擎**: Elasticsearch（用于文档全文搜索）
- **身份认证**: OAuth 2.0、JWT
- **容器化**: Docker、Kubernetes
- **CI/CD**: Jenkins、GitLab CI

## 2. 系统架构图
```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                            前端应用 (React/TypeScript)                            │
│  ┌─────────────────────┐   ┌─────────────────────┐   ┌──────────────────────┐     │
│  │   培训管理前端      │   │   报表分析前端      │   │    系统管理前端      │     │
│  └─────────────────────┘   └─────────────────────┘   └──────────────────────┘     │
└─────────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                          API网关 (Spring Cloud Gateway)                            │
│  ┌─────────────────────┐   ┌─────────────────────┐   ┌──────────────────────┐     │
│  │  请求路由           │   │  负载均衡           │   │  安全认证            │     │
│  └─────────────────────┘   └─────────────────────┘   └──────────────────────┘     │
└─────────────────────────────────────────────────────────────────────────────────┘
                                      │
       ┌──────────────────────────────┼──────────────────────────────┐
       │                              │                              │
       ▼                              ▼                              ▼
┌─────────────────┐           ┌─────────────────────────┐     ┌─────────────────┐
│ 认证授权服务    │           │ 培训管理核心服务         │     │ 报表分析服务    │
│  (Auth-Service) │           │ (Training-Core-Service) │     │ (Report-Service)│
└─────────────────┘           └─────────────────────────┘     └─────────────────┘
       │                              │                              │
       └─────────────────┬────────────┴──────────────────┬───────────┘
                         │                               │
       ┌─────────────────┴────────────┐      ┌───────────┴────────────────┐
       │                              │      │                            │
       ▼                              ▼      ▼                            ▼
┌─────────────────┐           ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│ 数据访问层      │           │ 缓存服务        │  │ 消息队列        │  │ 搜索引擎        │
│ (Spring Data)   │           │ (Redis)         │  │ (RabbitMQ)      │  │ (Elasticsearch) │
└─────────┬───────┘           └─────────────────┘  └─────────────────┘  └─────────────────┘
          │
          ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                               数据库集群                                          │
│  ┌─────────────────────┐           ┌─────────────────────┐                      │
│  │  MySQL 关系型数据库 │           │  MongoDB 文档数据库 │                      │
│  └─────────────────────┘           └─────────────────────┘                      │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 2.1 微服务边界

| 服务名称 | 职责描述 | 接口说明 | 依赖服务 |
|---------|---------|---------|----------|
| **认证授权服务** | 提供用户认证、授权和会话管理 | `/api/auth/*` | 无 |
| **培训管理核心服务** | 培训需求、计划、课程、执行和证书管理 | `/api/training/*` | 认证授权服务 |
| **报表分析服务** | 培训数据统计、报表生成和数据分析 | `/api/reports/*` | 培训管理核心服务 |
| **文件存储服务** | 培训资料、证书等文件的存储和管理 | `/api/files/*` | 认证授权服务 |
| **通知服务** | 培训提醒、通知消息发送 | `/api/notifications/*` | 培训管理核心服务 |

### 2.2 组件说明

- **前端应用**：基于React和TypeScript构建，提供用户交互界面，包含培训管理、报表分析和系统管理三个主要模块
- **API网关**：处理请求路由、负载均衡、安全认证等功能，是系统的统一入口
- **认证授权服务**：负责用户身份验证、权限控制和会话管理，与认证子系统集成
- **培训管理核心服务**：实现培训业务的核心逻辑，包括需求管理、计划制定、课程管理等
- **报表分析服务**：提供数据统计、报表生成和可视化功能
- **数据访问层**：封装数据操作，提供统一的数据访问接口
- **缓存服务**：使用Redis缓存热点数据，提高系统性能
- **消息队列**：处理异步任务和事件通知
- **搜索引擎**：提供全文搜索功能，支持培训资料和记录的快速检索
- **数据库集群**：存储系统数据，包括关系型数据和非结构化数据

## 3. 功能模块设计

### 3.1 培训需求管理模块

#### 3.1.1 功能描述
- 培训需求的提交、审核和管理
- 需求分类、评估和优先级排序
- 需求统计和分析

#### 3.1.2 组件设计
- **需求提交组件**: 提供需求录入界面和提交功能
- **需求审核组件**: 实现需求审核工作流
- **需求管理组件**: 需求列表查看、编辑、删除等功能
- **需求分析组件**: 需求数据分析和报表生成

#### 3.1.3 类图
```
需求管理模块类图:
- TrainingNeed (培训需求实体)
  - needId: String
  - title: String
  - description: String
  - submitter: User
  - department: Department
  - priority: String
  - status: String
  - createTime: Date
  - updateTime: Date
  - evaluateResult: String
  - approveResult: String

- NeedService (需求服务接口)
  - submitNeed(TrainingNeed): TrainingNeed
  - getNeedById(String): TrainingNeed
  - getNeedList(NeedQuery): Page<TrainingNeed>
  - evaluateNeed(String, Evaluation): TrainingNeed
  - approveNeed(String, Approval): TrainingNeed

- NeedRepository (需求数据访问接口)
  - save(TrainingNeed): TrainingNeed
  - findById(String): Optional<TrainingNeed>
  - findBySubmitter(User): List<TrainingNeed>
  - findByDepartment(Department): List<TrainingNeed>
  - findByStatus(String): List<TrainingNeed>
```

### 3.2 培训计划制定模块

#### 3.2.1 功能描述
- 培训计划的创建、审核和管理
- 资源分配和计划执行跟踪
- 计划变更管理

#### 3.2.2 组件设计
- **计划创建组件**: 培训计划制定和录入功能
- **计划审核组件**: 计划审核工作流
- **资源分配组件**: 培训资源的管理和分配
- **计划执行跟踪组件**: 监控计划执行进度

#### 3.2.3 类图
```
计划管理模块类图:
- TrainingPlan (培训计划实体)
  - planId: String
  - planName: String
  - period: String (年度/季度/月度)
  - startDate: Date
  - endDate: Date
  - creator: User
  - department: Department
  - status: String
  - createTime: Date
  - updateTime: Date
  - approveStatus: String

- PlanService (计划服务接口)
  - createPlan(TrainingPlan): TrainingPlan
  - getPlanById(String): TrainingPlan
  - getPlanList(PlanQuery): Page<TrainingPlan>
  - updatePlan(TrainingPlan): TrainingPlan
  - approvePlan(String, Approval): TrainingPlan
  - releasePlan(String): TrainingPlan

- PlanRepository (计划数据访问接口)
  - save(TrainingPlan): TrainingPlan
  - findById(String): Optional<TrainingPlan>
  - findByPeriodAndDepartment(String, Department): List<TrainingPlan>
  - findByStatus(String): List<TrainingPlan>
```

### 3.3 培训执行管理模块

#### 3.3.1 功能描述
- 培训课程创建和管理
- 培训报名和签到管理
- 培训实施和现场记录
- 讲师管理

#### 3.3.2 组件设计
- **课程管理组件**: 课程创建、编辑、发布等功能
- **报名管理组件**: 培训报名和审核
- **签到管理组件**: 培训签到和出勤记录
- **讲师管理组件**: 讲师信息管理

#### 3.3.3 类图
```
培训执行模块类图:
- TrainingCourse (培训课程实体)
  - courseId: String
  - courseName: String
  - description: String
  - contentOutline: String
  - duration: Integer
  - trainer: User
  - courseType: String
  - status: String
  - createTime: Date
  - updateTime: Date

- TrainingSession (培训场次实体)
  - sessionId: String
  - courseId: String
  - startTime: Date
  - endTime: Date
  - location: String
  - maxParticipants: Integer
  - currentParticipants: Integer
  - status: String

- RegistrationService (报名服务接口)
  - register(String, String): Registration
  - cancelRegistration(String): Boolean
  - getRegistrationsBySession(String): List<Registration>
  - getMyRegistrations(User): List<Registration>

- AttendanceService (出勤服务接口)
  - signIn(String, String): Attendance
  - markAbsent(String, String): Attendance
  - getAttendanceBySession(String): List<Attendance>
```

### 3.4 培训记录与评估模块

#### 3.4.1 功能描述
- 培训记录的生成和管理
- 培训评估和反馈收集
- 测验和考试管理
- 记录归档和查询

#### 3.4.2 组件设计
- **记录管理组件**: 培训记录的生成、编辑、归档
- **评估组件**: 培训评估和反馈收集
- **测验组件**: 知识测验的创建和管理
- **结果分析组件**: 评估和测验结果分析

#### 3.4.3 类图
```
培训记录模块类图:
- TrainingRecord (培训记录实体)
  - recordId: String
  - userId: String
  - courseId: String
  - sessionId: String
  - attendanceStatus: String
  - completionStatus: String
  - score: Double
  - completionDate: Date
  - createTime: Date
  - updateTime: Date

- Assessment (评估实体)
  - assessmentId: String
  - sessionId: String
  - userId: String
  - contentRating: Integer
  - trainerRating: Integer
  - organizationRating: Integer
  - satisfaction: Integer
  - suggestions: String
  - createTime: Date

- Test (测验实体)
  - testId: String
  - courseId: String
  - title: String
  - passingScore: Double
  - duration: Integer
  - questions: List<Question>
  - status: String

- TestResult (测验结果实体)
  - resultId: String
  - testId: String
  - userId: String
  - score: Double
  - passStatus: Boolean
  - answers: List<Answer>
  - testTime: Date
```

### 3.5 证书与资质管理模块

#### 3.5.1 功能描述
- 电子证书的生成和管理
- 证书模板配置
- 证书到期提醒
- 资质审核和管理

#### 3.5.2 组件设计
- **证书生成组件**: 电子证书的生成和签发
- **证书管理组件**: 证书的查询、下载、撤销
- **提醒组件**: 证书到期提醒
- **资质管理组件**: 资质审核和管理

#### 3.5.3 类图
```
证书管理模块类图:
- Certificate (证书实体)
  - certificateId: String
  - userId: String
  - courseId: String
  - certificateName: String
  - issueDate: Date
  - expiryDate: Date
  - status: String
  - certificateUrl: String
  - createTime: Date

- CertificateTemplate (证书模板实体)
  - templateId: String
  - templateName: String
  - content: String
  - status: String
  - createTime: Date
  - updateTime: Date

- Qualification (资质实体)
  - qualificationId: String
  - userId: String
  - qualificationName: String
  - issueOrganization: String
  - issueDate: Date
  - expiryDate: Date
  - documentUrl: String
  - status: String

- CertificateService (证书服务接口)
  - generateCertificate(String, String): Certificate
  - getCertificateById(String): Certificate
  - getUserCertificates(String): List<Certificate>
  - revokeCertificate(String): Boolean
  - sendExpiryReminders(): List<Certificate>
```

### 3.6 报表与分析模块

#### 3.6.1 功能描述
- 各类培训报表的生成
- 数据分析和可视化
- 趋势分析和预测
- 自定义报表

#### 3.6.2 组件设计
- **报表生成组件**: 预定义报表的生成
- **数据分析组件**: 数据处理和分析算法
- **可视化组件**: 图表展示和数据可视化
- **自定义报表组件**: 用户自定义报表功能

#### 3.6.3 类图
```
报表分析模块类图:
- Report (报表实体)
  - reportId: String
  - reportName: String
  - reportType: String
  - parameters: Map<String, Object>
  - createTime: Date
  - generatedBy: User
  - reportUrl: String

- Dashboard (仪表盘实体)
  - dashboardId: String
  - dashboardName: String
  - widgets: List<Widget>
  - userId: String
  - createTime: Date
  - updateTime: Date

- ReportService (报表服务接口)
  - generateReport(String, Map<String, Object>): Report
  - getReportHistory(User): List<Report>
  - exportReport(String, String): File
  - createCustomReport(CustomReport): Report

- AnalysisService (分析服务接口)
  - analyzeTrainingCompletion(String, String): Map<String, Object>
  - analyzeTrend(String, String): Map<String, Object>
  - analyzeDepartmentComparison(String, String): Map<String, Object>
  - analyzeEffectiveness(String, String): Map<String, Object>
```

### 3.7 系统管理模块

#### 3.7.1 功能描述
- 用户和权限管理
- 组织架构管理
- 系统配置
- 日志管理
- 数据备份与恢复

#### 3.7.2 组件设计
- **用户管理组件**: 用户账户的CRUD操作
- **权限管理组件**: 角色和权限配置
- **组织管理组件**: 部门、岗位管理
- **配置管理组件**: 系统参数配置
- **日志管理组件**: 系统日志查询和分析

#### 3.7.3 类图
```
系统管理模块类图:
- User (用户实体)
  - userId: String
  - username: String
  - password: String (加密存储)
  - realName: String
  - department: Department
  - position: Position
  - email: String
  - phone: String
  - status: String
  - createTime: Date
  - updateTime: Date

- Role (角色实体)
  - roleId: String
  - roleName: String
  - description: String
  - permissions: List<Permission>
  - status: String

- Permission (权限实体)
  - permissionId: String
  - permissionName: String
  - resourceType: String
  - resourceId: String
  - action: String
  - description: String

- Department (部门实体)
  - departmentId: String
  - departmentName: String
  - parentDepartment: Department
  - manager: User
  - description: String

- SystemLog (系统日志实体)
  - logId: String
  - userId: String
  - operationType: String
  - resourceType: String
  - resourceId: String
  - operationTime: Date
  - ipAddress: String
  - result: String
  - details: String
```

## 4. 数据库设计

### 4.1 数据模型
培训管理模块的数据模型包含以下主要实体：
- 用户（User）- 系统用户，包含员工基本信息和认证信息
- 部门（Department）- 组织架构中的部门信息
- 岗位（Position）- 部门中的岗位信息
- 角色（Role）- 用户角色定义，用于权限管理
- 权限（Permission）- 系统功能操作权限
- 培训需求（TrainingNeed）- 各部门提交的培训需求
- 培训计划（TrainingPlan）- 基于需求制定的培训计划
- 培训课程（TrainingCourse）- 培训课程详细信息
- 培训场次（TrainingSession）- 课程的具体开展场次
- 培训记录（TrainingRecord）- 员工参与培训的记录
- 评估（Assessment）- 培训效果评估信息
- 测验（Test）- 培训测验题目集
- 测验结果（TestResult）- 员工测验答题结果
- 证书（Certificate）- 培训合格后的证书信息
- 资质（Qualification）- 员工专业资质管理
- 报表（Report）- 系统生成的各类报表
- 仪表盘（Dashboard）- 自定义数据可视化界面
- 系统日志（SystemLog）- 系统操作日志记录

### 4.2 表结构

#### 4.2.1 用户表（t_user）
| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|-----|------|
| user_id | VARCHAR(36) | PRIMARY KEY | 用户ID |
| username | VARCHAR(50) | UNIQUE NOT NULL | 用户名 |
| password | VARCHAR(255) | NOT NULL | 密码（加密） |
| real_name | VARCHAR(50) | NOT NULL | 真实姓名 |
| department_id | VARCHAR(36) | FOREIGN KEY | 部门ID |
| position_id | VARCHAR(36) | FOREIGN KEY | 岗位ID |
| email | VARCHAR(100) | UNIQUE | 邮箱 |
| phone | VARCHAR(20) | | 电话 |
| status | VARCHAR(20) | NOT NULL | 状态（ACTIVE/INACTIVE/LOCKED） |
| create_time | DATETIME | NOT NULL | 创建时间 |
| update_time | DATETIME | NOT NULL | 更新时间 |

#### 4.2.2 部门表（t_department）
| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|-----|------|
| department_id | VARCHAR(36) | PRIMARY KEY | 部门ID |
| department_name | VARCHAR(100) | NOT NULL | 部门名称 |
| parent_department_id | VARCHAR(36) | FOREIGN KEY | 父部门ID |
| manager_id | VARCHAR(36) | FOREIGN KEY | 部门经理ID |
| description | TEXT | | 描述 |
| create_time | DATETIME | NOT NULL | 创建时间 |
| update_time | DATETIME | NOT NULL | 更新时间 |

#### 4.2.3 培训需求表（t_training_need）
| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|-----|------|
| need_id | VARCHAR(36) | PRIMARY KEY | 需求ID |
| title | VARCHAR(200) | NOT NULL | 需求标题 |
| description | TEXT | NOT NULL | 需求描述 |
| submitter_id | VARCHAR(36) | FOREIGN KEY | 提交人ID |
| department_id | VARCHAR(36) | FOREIGN KEY | 部门ID |
| priority | VARCHAR(20) | NOT NULL | 优先级（HIGH/MEDIUM/LOW） |
| need_type | VARCHAR(50) | NOT NULL | 需求类型 |
| status | VARCHAR(50) | NOT NULL | 状态 |
| evaluate_result | TEXT | | 评估结果 |
| approve_result | VARCHAR(50) | | 审批结果 |
| create_time | DATETIME | NOT NULL | 创建时间 |
| update_time | DATETIME | NOT NULL | 更新时间 |

#### 4.2.4 培训计划表（t_training_plan）
| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|-----|------|
| plan_id | VARCHAR(36) | PRIMARY KEY | 计划ID |
| plan_name | VARCHAR(200) | NOT NULL | 计划名称 |
| period | VARCHAR(20) | NOT NULL | 周期（年度/季度/月度） |
| start_date | DATE | NOT NULL | 开始日期 |
| end_date | DATE | NOT NULL | 结束日期 |
| creator_id | VARCHAR(36) | FOREIGN KEY | 创建人ID |
| department_id | VARCHAR(36) | FOREIGN KEY | 部门ID |
| status | VARCHAR(50) | NOT NULL | 状态 |
| approve_status | VARCHAR(50) | | 审批状态 |
| create_time | DATETIME | NOT NULL | 创建时间 |
| update_time | DATETIME | NOT NULL | 更新时间 |

#### 4.2.5 培训课程表（t_training_course）
| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|-----|------|
| course_id | VARCHAR(36) | PRIMARY KEY | 课程ID |
| course_name | VARCHAR(200) | NOT NULL | 课程名称 |
| description | TEXT | NOT NULL | 课程描述 |
| content_outline | TEXT | | 课程大纲 |
| duration | INTEGER | NOT NULL | 课程时长（分钟） |
| trainer_id | VARCHAR(36) | FOREIGN KEY | 讲师ID |
| course_type | VARCHAR(50) | NOT NULL | 课程类型 |
| status | VARCHAR(50) | NOT NULL | 状态 |
| create_time | DATETIME | NOT NULL | 创建时间 |
| update_time | DATETIME | NOT NULL | 更新时间 |

#### 4.2.6 培训记录表（t_training_record）
| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|-----|------|
| record_id | VARCHAR(36) | PRIMARY KEY | 记录ID |
| user_id | VARCHAR(36) | FOREIGN KEY | 用户ID |
| course_id | VARCHAR(36) | FOREIGN KEY | 课程ID |
| session_id | VARCHAR(36) | FOREIGN KEY | 场次ID |
| attendance_status | VARCHAR(20) | NOT NULL | 出勤状态 |
| completion_status | VARCHAR(20) | NOT NULL | 完成状态 |
| score | DOUBLE | | 成绩 |
| completion_date | DATE | | 完成日期 |
| create_time | DATETIME | NOT NULL | 创建时间 |
| update_time | DATETIME | NOT NULL | 更新时间 |

#### 4.2.7 培训评估表（t_training_assessment）
| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|-----|------|
| assessment_id | VARCHAR(36) | PRIMARY KEY | 评估ID |
| session_id | VARCHAR(36) | FOREIGN KEY | 培训场次ID |
| user_id | VARCHAR(36) | FOREIGN KEY | 评估人ID |
| score | DOUBLE | NOT NULL | 评估分数 |
| content_quality | INTEGER | | 内容质量评分(1-5) |
| trainer_ability | INTEGER | | 讲师能力评分(1-5) |
| practicality | INTEGER | | 实用性评分(1-5) |
| overall_satisfaction | INTEGER | | 总体满意度(1-5) |
| suggestions | TEXT | | 改进建议 |
| assessment_time | DATETIME | NOT NULL | 评估时间 |
| INDEX idx_session_user (session_id, user_id) | | | 场次和用户复合索引 |

#### 4.2.8 证书表（t_certificate）
| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|-----|------|
| certificate_id | VARCHAR(36) | PRIMARY KEY | 证书ID |
| user_id | VARCHAR(36) | FOREIGN KEY | 用户ID |
| course_id | VARCHAR(36) | FOREIGN KEY | 课程ID |
| certificate_name | VARCHAR(200) | NOT NULL | 证书名称 |
| certificate_no | VARCHAR(100) | UNIQUE | 证书编号 |
| issue_date | DATE | NOT NULL | 颁发日期 |
| expiry_date | DATE | | 过期日期 |
| status | VARCHAR(20) | NOT NULL | 状态(有效/过期/吊销) |
| certificate_url | VARCHAR(255) | | 证书文件URL |
| issuer | VARCHAR(100) | | 颁发人 |
| create_time | DATETIME | NOT NULL | 创建时间 |
| update_time | DATETIME | | 更新时间 |
| INDEX idx_user_expiry (user_id, expiry_date) | | | 用户和过期日期复合索引 |
| INDEX idx_status (status) | | | 状态索引

#### 4.2.9 测验表（t_test）
| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|-----|------|
| test_id | VARCHAR(36) | PRIMARY KEY | 测验ID |
| course_id | VARCHAR(36) | FOREIGN KEY | 课程ID |
| test_name | VARCHAR(200) | NOT NULL | 测验名称 |
| passing_score | INTEGER | NOT NULL | 及格分数 |
| duration | INTEGER | | 测验时长(分钟) |
| attempt_limit | INTEGER | | 尝试次数限制 |
| status | VARCHAR(20) | NOT NULL | 状态 |
| create_time | DATETIME | NOT NULL | 创建时间 |
| update_time | DATETIME | | 更新时间 |

#### 4.2.10 测验结果表（t_test_result）
| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|-----|------|
| result_id | VARCHAR(36) | PRIMARY KEY | 结果ID |
| test_id | VARCHAR(36) | FOREIGN KEY | 测验ID |
| user_id | VARCHAR(36) | FOREIGN KEY | 用户ID |
| score | INTEGER | NOT NULL | 得分 |
| is_passed | BOOLEAN | NOT NULL | 是否通过 |
| start_time | DATETIME | NOT NULL | 开始时间 |
| end_time | DATETIME | NOT NULL | 结束时间 |
| answers | TEXT | | 答题内容 |
| INDEX idx_test_user (test_id, user_id) | | | 测验和用户复合索引 |

#### 4.2.11 系统日志表（t_system_log）
| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|-----|------|
| log_id | VARCHAR(36) | PRIMARY KEY | 日志ID |
| user_id | VARCHAR(36) | FOREIGN KEY | 用户ID |
| username | VARCHAR(50) | | 操作用户名(冗余) |
| operation_type | VARCHAR(50) | NOT NULL | 操作类型 |
| resource_type | VARCHAR(50) | | 资源类型 |
| resource_id | VARCHAR(36) | | 资源ID |
| operation_time | DATETIME | NOT NULL | 操作时间 |
| ip_address | VARCHAR(50) | | IP地址 |
| browser_info | VARCHAR(255) | | 浏览器信息 |
| result | VARCHAR(20) | NOT NULL | 操作结果 |
| details | TEXT | | 详细信息 |
| INDEX idx_operation_time (operation_time) | | | 操作时间索引 |
| INDEX idx_user_operation (user_id, operation_type) | | | 用户和操作类型复合索引 |

### 4.3 关系图
```
用户 1 ---- 多 角色 多 ---- 1 权限
 |
多 ---- 1 部门 1 ---- 多 岗位
 |
1 ---- 多 培训需求
 |
1 ---- 多 培训记录 多 ---- 1 培训课程
 |              |
1 ---- 多 证书      |
                1 ---- 多 培训场次
                |
                1 ---- 多 评估
```

### 4.4 数据安全设计

#### 4.4.1 数据加密
- **传输加密**: 所有API通信采用HTTPS加密传输
- **存储加密**: 
  - 密码使用bcrypt算法加盐加密存储
  - 敏感个人信息（如身份证号）使用AES-256加密存储
  - 数据库透明数据加密(TDE)保护静态数据
- **密钥管理**: 实现密钥的安全生成、存储和定期轮换机制

#### 4.4.2 访问控制
- **基于角色的访问控制(RBAC)**: 实现细粒度的权限管理，控制到菜单、按钮和数据级别
- **最小权限原则**: 用户仅获得完成工作所需的最小权限
- **权限分离**: 关键操作需要多人审批，实现职责分离
- **会话管理**: 会话超时自动失效，支持多设备登录限制

#### 4.4.3 数据保护
- **数据脱敏**: 在报表、日志和非管理员界面中对敏感信息进行脱敏处理
- **数据分类**: 对数据进行敏感级别分类，实施不同级别的保护措施
- **数据生命周期管理**: 定义数据的创建、使用、归档和销毁策略
- **备份与恢复**: 
  - 每日全量备份+增量备份
  - 备份数据异地存储
  - 定期进行恢复演练

#### 4.4.4 审计与合规
- **全面审计**: 记录所有关键操作的详细信息，包括操作人、时间、内容和结果
- **不可篡改**: 审计日志采用防篡改机制，确保日志完整性
- **日志保留**: 关键审计日志保留至少1年，满足GMP合规要求
- **异常监控**: 实时监控和预警可疑操作模式

#### 4.4.5 数据库安全
- **参数化查询**: 防止SQL注入攻击
- **输入验证**: 对所有用户输入进行严格验证
- **数据库用户权限**: 最小化数据库账户权限
- **连接池安全**: 数据库连接使用加密和访问控制
- **补丁管理**: 定期更新数据库补丁，修复安全漏洞

## 5. 接口设计

### 5.1 内部接口

#### 5.1.1 用户管理接口
```
- GET /api/users - 获取用户列表
- GET /api/users/{userId} - 获取用户详情
- POST /api/users - 创建用户
- PUT /api/users/{userId} - 更新用户信息
- DELETE /api/users/{userId} - 删除用户
- GET /api/users/{userId}/roles - 获取用户角色
- POST /api/users/{userId}/roles - 分配角色给用户
```

#### 5.1.2 培训需求管理接口
```
- GET /api/training-needs - 获取培训需求列表
- GET /api/training-needs/{needId} - 获取培训需求详情
- POST /api/training-needs - 创建培训需求
- PUT /api/training-needs/{needId} - 更新培训需求
- DELETE /api/training-needs/{needId} - 删除培训需求
- POST /api/training-needs/{needId}/evaluate - 评估培训需求
- POST /api/training-needs/{needId}/approve - 审批培训需求
```

#### 5.1.3 培训课程管理接口
```
- GET /api/courses - 获取课程列表
- GET /api/courses/{courseId} - 获取课程详情
- POST /api/courses - 创建课程
- PUT /api/courses/{courseId} - 更新课程
- DELETE /api/courses/{courseId} - 删除课程
- POST /api/courses/{courseId}/publish - 发布课程
- GET /api/courses/{courseId}/materials - 获取课程资料
- POST /api/courses/{courseId}/materials - 上传课程资料
```

### 5.2 外部接口

#### 5.2.1 ERP系统集成接口
```
- GET /api/integration/erp/employees - 同步员工信息
- POST /api/integration/erp/feedback - 推送培训结果反馈
```

#### 5.2.2 QMS系统集成接口
```
- GET /api/integration/qms/compliance-requirements - 获取合规性培训要求
- POST /api/integration/qms/training-records - 推送培训记录
```

#### 5.2.3 LMS系统集成接口
```
- GET /api/integration/lms/courses - 获取在线课程
- POST /api/integration/lms/learning-records - 同步学习记录
- GET /api/integration/lms/user-progress/{userId} - 获取用户学习进度
```

### 5.3 API规范
- **RESTful风格**: 遵循RESTful API设计原则
- **统一响应格式**: 
  ```json
  {
    "code": "200",
    "message": "success",
    "data": {},
    "error": null
  }
  ```
- **认证授权**: 使用OAuth 2.0和JWT进行身份认证和授权
- **错误处理**: 采用统一的错误码和错误信息格式
- **版本控制**: API版本通过URL路径或请求头进行控制
- **文档化**: 使用Swagger/OpenAPI进行API文档自动生成

## 6. 安全设计

### 6.1 身份认证与授权
- **多因素认证**: 支持密码和验证码等多因素认证
- **基于角色的访问控制**: 实现细粒度的权限控制
- **权限继承机制**: 支持角色权限的继承
- **临时授权**: 支持临时权限的授予和自动失效
- **会话管理**: 实现安全的会话管理，包括超时控制和会话销毁

### 6.2 数据加密
- **传输加密**: 使用HTTPS确保数据传输安全
- **存储加密**: 敏感数据加密存储，如密码使用bcrypt加密
- **加密算法**: 使用AES-256等高强度加密算法
- **密钥管理**: 实现安全的密钥生成、存储和轮换机制

### 6.3 审计追踪
- **操作审计**: 记录所有关键操作的详细信息
- **数据变更审计**: 记录数据的所有变更历史
- **登录审计**: 记录用户登录的详细信息
- **审计日志保护**: 确保审计日志的完整性和不可篡改性

### 6.4 安全防护
- **XSS防护**: 实现输入验证和输出编码，防止XSS攻击
- **CSRF防护**: 实现CSRF令牌机制
- **SQL注入防护**: 使用参数化查询，防止SQL注入
- **请求频率限制**: 防止暴力破解和DoS攻击
- **敏感信息过滤**: 在日志和错误信息中过滤敏感信息

## 7. 性能设计

### 7.1 性能目标
- **响应时间**: 页面加载时间<2秒，API响应时间<500ms
- **并发用户数**: 支持500用户同时在线，50用户并发操作
- **吞吐量**: 每秒处理100个API请求
- **资源利用率**: CPU利用率<70%，内存利用率<80%

### 7.2 性能优化
- **代码优化**: 优化算法和数据结构，提高代码执行效率
- **数据库优化**: 索引优化、查询优化、分库分表
- **服务器优化**: JVM参数调优、Web服务器配置优化
- **网络优化**: CDN加速、网络路由优化

### 7.3 缓存策略
- **应用缓存**: 使用Redis缓存热点数据
- **数据库缓存**: 数据库查询缓存
- **前端缓存**: 浏览器缓存、CDN缓存
- **缓存一致性**: 实现缓存与数据库的数据一致性

### 7.4 并发处理
- **线程池优化**: 合理配置线程池参数
- **异步处理**: 使用异步处理非核心业务逻辑
- **分布式锁**: 解决并发访问冲突问题
- **事务管理**: 合理使用事务，避免长事务

## 8. 扩展性设计

### 8.1 模块化设计
- **功能模块化**: 按功能域划分为独立模块
- **服务模块化**: 按微服务架构实现服务独立部署和扩展
- **配置模块化**: 实现模块化的配置管理

### 8.2 组件复用
- **公共组件**: 封装可复用的UI组件和业务组件
- **服务组件**: 实现可复用的服务组件
- **工具组件**: 提供通用的工具方法和工具类

### 8.3 扩展接口
- **插件机制**: 实现插件化架构，支持功能扩展
- **事件机制**: 基于事件驱动，实现模块间松耦合
- **配置中心**: 实现动态配置，支持在线配置更新

## 9. 灾备与恢复

### 9.1 数据备份
- **全量备份**: 定期进行全量数据备份
- **增量备份**: 实现增量数据备份，减少备份时间和空间
- **备份验证**: 定期验证备份数据的可用性
- **备份存储**: 备份数据异地存储，确保安全性

### 9.2 恢复策略
- **RTO/RPO定义**: 明确恢复时间目标(RTO)和恢复点目标(RPO)
- **恢复流程**: 制定详细的数据恢复流程和操作手册
- **恢复测试**: 定期进行恢复测试，验证恢复流程的有效性

### 9.3 高可用性
- **集群部署**: 应用服务器集群部署
- **数据库主从**: 数据库主从复制，实现读写分离
- **负载均衡**: 使用负载均衡器分发请求
- **故障转移**: 实现自动故障检测和故障转移机制

## 10. 部署架构

### 10.1 物理架构
- **前端服务器**: Nginx集群
- **应用服务器**: Tomcat集群
- **数据库服务器**: MySQL主从集群，MongoDB集群
- **缓存服务器**: Redis集群
- **消息队列服务器**: RabbitMQ集群
- **搜索引擎服务器**: Elasticsearch集群

### 10.2 网络拓扑
```
外部访问 → 负载均衡器 → 防火墙 → 应用服务器集群 → 内部负载均衡器 → 数据库/缓存/消息队列
```

### 10.3 部署环境
- **开发环境**: Docker容器化开发环境
- **测试环境**: 与生产环境隔离的测试环境
- **预发布环境**: 与生产环境配置相同的预发布环境
- **生产环境**: 高可用集群环境

## 附录

### 术语定义
- **GMP**: 药品生产质量管理规范(Good Manufacturing Practice)
- **RESTful**: 一种软件架构风格，用于设计网络应用程序接口
- **微服务**: 一种架构风格，将应用程序构建为一系列独立部署的服务
- **API**: 应用程序编程接口(Application Programming Interface)
- **JWT**: JSON Web Token，一种基于JSON的开放标准，用于在各方之间安全地传输信息
- **OAuth 2.0**: 一种授权框架，允许第三方应用程序获取对用户账户的有限访问权限
- **RTO**: 恢复时间目标(Recovery Time Objective)，衡量从灾难发生到系统恢复所需的时间
- **RPO**: 恢复点目标(Recovery Point Objective)，衡量在灾难发生时可能丢失的数据量

### 参考文档
- 《药品生产质量管理规范》(GMP)
- 《21 CFR Part 11电子记录和电子签名法规》
- 《培训管理模块文档总览》
- 《培训管理模块总体需求》
- 《培训管理模块用户故事》
- 《培训管理模块角色权限矩阵》
- 《培训管理模块业务流程描述》

### 联系方式
- **系统管理员**: [系统管理员姓名] - [邮箱]
- **质量管理部**: [质量管理经理姓名] - [邮箱]
- **人力资源部**: [人力资源经理姓名] - [邮箱]
- **IT支持**: [IT支持联系人] - [邮箱]
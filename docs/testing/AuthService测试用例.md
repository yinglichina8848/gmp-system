# Auth Service 测试用例

## 1. 概述

本测试用例文档描述了Auth Service的测试用例，包括认证授权、用户管理、权限控制和操作日志等功能的测试。

## 2. 测试用例

### 2.1 认证授权测试

#### 2.1.1 登录测试

| 测试用例ID | 测试用例名称 | 测试目标 | 测试环境 | 测试数据 | 测试步骤 | 预期结果 |
|------------|--------------|----------|----------|----------|----------|----------|
| AUTH-001 | 正确用户名密码登录 | 验证用户使用正确的用户名和密码能够成功登录 | 测试环境 | 用户名：admin，密码：Admin@123 | 1. 发送POST请求到/api/auth/login<br>2. 请求体：{"username": "admin", "password": "Admin@123"} | 返回HTTP 200，包含JWT令牌和用户信息 |
| AUTH-002 | 错误用户名登录 | 验证用户使用错误的用户名登录失败 | 测试环境 | 用户名：invalid，密码：Admin@123 | 1. 发送POST请求到/api/auth/login<br>2. 请求体：{"username": "invalid", "password": "Admin@123"} | 返回HTTP 401，提示认证失败 |
| AUTH-003 | 错误密码登录 | 验证用户使用错误的密码登录失败 | 测试环境 | 用户名：admin，密码：Invalid@123 | 1. 发送POST请求到/api/auth/login<br>2. 请求体：{"username": "admin", "password": "Invalid@123"} | 返回HTTP 401，提示认证失败 |
| AUTH-004 | 空用户名登录 | 验证用户使用空用户名登录失败 | 测试环境 | 用户名：""，密码：Admin@123 | 1. 发送POST请求到/api/auth/login<br>2. 请求体：{"username": "", "password": "Admin@123"} | 返回HTTP 400，提示用户名不能为空 |
| AUTH-005 | 空密码登录 | 验证用户使用空密码登录失败 | 测试环境 | 用户名：admin，密码："" | 1. 发送POST请求到/api/auth/login<br>2. 请求体：{"username": "admin", "password": ""} | 返回HTTP 400，提示密码不能为空 |

#### 2.1.2 登出测试

| 测试用例ID | 测试用例名称 | 测试目标 | 测试环境 | 测试数据 | 测试步骤 | 预期结果 |
|------------|--------------|----------|----------|----------|----------|----------|
| AUTH-006 | 成功登出 | 验证用户能够成功登出 | 测试环境 | 有效的JWT令牌 | 1. 发送POST请求到/api/auth/logout<br>2. 携带有效的Authorization头 | 返回HTTP 200，提示登出成功 |
| AUTH-007 | 无效令牌登出 | 验证使用无效令牌登出失败 | 测试环境 | 无效的JWT令牌 | 1. 发送POST请求到/api/auth/logout<br>2. 携带无效的Authorization头 | 返回HTTP 401，提示令牌无效 |

#### 2.1.3 令牌刷新测试

| 测试用例ID | 测试用例名称 | 测试目标 | 测试环境 | 测试数据 | 测试步骤 | 预期结果 |
|------------|--------------|----------|----------|----------|----------|----------|
| AUTH-008 | 成功刷新令牌 | 验证用户能够使用有效的刷新令牌刷新访问令牌 | 测试环境 | 有效的刷新令牌 | 1. 发送POST请求到/api/auth/refresh<br>2. 请求体：{"refreshToken": "有效的刷新令牌"} | 返回HTTP 200，包含新的访问令牌和刷新令牌 |
| AUTH-009 | 无效刷新令牌 | 验证使用无效的刷新令牌刷新失败 | 测试环境 | 无效的刷新令牌 | 1. 发送POST请求到/api/auth/refresh<br>2. 请求体：{"refreshToken": "无效的刷新令牌"} | 返回HTTP 401，提示刷新令牌无效 |

### 2.2 用户管理测试

#### 2.2.1 创建用户测试

| 测试用例ID | 测试用例名称 | 测试目标 | 测试环境 | 测试数据 | 测试步骤 | 预期结果 |
|------------|--------------|----------|----------|----------|----------|----------|
| USER-001 | 成功创建用户 | 验证管理员能够成功创建新用户 | 测试环境 | 用户名：testuser，密码：Test@123，角色：USER | 1. 发送POST请求到/api/auth/users<br>2. 携带管理员JWT令牌<br>3. 请求体：{"username": "testuser", "password": "Test@123", "role": "USER"} | 返回HTTP 201，包含新创建的用户信息 |
| USER-002 | 重复用户名创建 | 验证创建重复用户名的用户失败 | 测试环境 | 用户名：admin，密码：Test@123，角色：USER | 1. 发送POST请求到/api/auth/users<br>2. 携带管理员JWT令牌<br>3. 请求体：{"username": "admin", "password": "Test@123", "role": "USER"} | 返回HTTP 400，提示用户名已存在 |
| USER-003 | 弱密码创建用户 | 验证使用弱密码创建用户失败 | 测试环境 | 用户名：weakuser，密码：123456，角色：USER | 1. 发送POST请求到/api/auth/users<br>2. 携带管理员JWT令牌<br>3. 请求体：{"username": "weakuser", "password": "123456", "role": "USER"} | 返回HTTP 400，提示密码强度不足 |

#### 2.2.2 查询用户测试

| 测试用例ID | 测试用例名称 | 测试目标 | 测试环境 | 测试数据 | 测试步骤 | 预期结果 |
|------------|--------------|----------|----------|----------|----------|----------|
| USER-004 | 查询所有用户 | 验证管理员能够查询所有用户 | 测试环境 | 无 | 1. 发送GET请求到/api/auth/users<br>2. 携带管理员JWT令牌 | 返回HTTP 200，包含所有用户列表 |
| USER-005 | 根据ID查询用户 | 验证管理员能够根据ID查询用户 | 测试环境 | 用户ID：1 | 1. 发送GET请求到/api/auth/users/1<br>2. 携带管理员JWT令牌 | 返回HTTP 200，包含指定ID的用户信息 |
| USER-006 | 查询不存在的用户 | 验证查询不存在的用户返回404 | 测试环境 | 用户ID：999 | 1. 发送GET请求到/api/auth/users/999<br>2. 携带管理员JWT令牌 | 返回HTTP 404，提示用户不存在 |

#### 2.2.3 更新用户测试

| 测试用例ID | 测试用例名称 | 测试目标 | 测试环境 | 测试数据 | 测试步骤 | 预期结果 |
|------------|--------------|----------|----------|----------|----------|----------|
| USER-007 | 成功更新用户 | 验证管理员能够成功更新用户信息 | 测试环境 | 用户ID：2，新角色：ADMIN | 1. 发送PUT请求到/api/auth/users/2<br>2. 携带管理员JWT令牌<br>3. 请求体：{"role": "ADMIN"} | 返回HTTP 200，包含更新后的用户信息 |
| USER-008 | 更新不存在的用户 | 验证更新不存在的用户返回404 | 测试环境 | 用户ID：999，新角色：ADMIN | 1. 发送PUT请求到/api/auth/users/999<br>2. 携带管理员JWT令牌<br>3. 请求体：{"role": "ADMIN"} | 返回HTTP 404，提示用户不存在 |

#### 2.2.4 删除用户测试

| 测试用例ID | 测试用例名称 | 测试目标 | 测试环境 | 测试数据 | 测试步骤 | 预期结果 |
|------------|--------------|----------|----------|----------|----------|----------|
| USER-009 | 成功删除用户 | 验证管理员能够成功删除用户 | 测试环境 | 用户ID：3 | 1. 发送DELETE请求到/api/auth/users/3<br>2. 携带管理员JWT令牌 | 返回HTTP 200，提示删除成功 |
| USER-010 | 删除不存在的用户 | 验证删除不存在的用户返回404 | 测试环境 | 用户ID：999 | 1. 发送DELETE请求到/api/auth/users/999<br>2. 携带管理员JWT令牌 | 返回HTTP 404，提示用户不存在 |
| USER-011 | 删除当前用户 | 验证用户不能删除自己 | 测试环境 | 用户ID：1（当前登录用户） | 1. 发送DELETE请求到/api/auth/users/1<br>2. 携带管理员JWT令牌 | 返回HTTP 400，提示不能删除当前用户 |

### 2.3 权限控制测试

#### 2.3.1 角色分配测试

| 测试用例ID | 测试用例名称 | 测试目标 | 测试环境 | 测试数据 | 测试步骤 | 预期结果 |
|------------|--------------|----------|----------|----------|----------|----------|
| PERM-001 | 成功分配角色 | 验证管理员能够成功为用户分配角色 | 测试环境 | 用户ID：4，角色：MANAGER | 1. 发送POST请求到/api/auth/users/4/roles<br>2. 携带管理员JWT令牌<br>3. 请求体：{"role": "MANAGER"} | 返回HTTP 200，提示角色分配成功 |
| PERM-002 | 分配不存在的角色 | 验证分配不存在的角色失败 | 测试环境 | 用户ID：4，角色：INVALID_ROLE | 1. 发送POST请求到/api/auth/users/4/roles<br>2. 携带管理员JWT令牌<br>3. 请求体：{"role": "INVALID_ROLE"} | 返回HTTP 400，提示角色不存在 |

#### 2.3.2 权限验证测试

| 测试用例ID | 测试用例名称 | 测试目标 | 测试环境 | 测试数据 | 测试步骤 | 预期结果 |
|------------|--------------|----------|----------|----------|----------|----------|
| PERM-003 | 管理员访问受限资源 | 验证管理员能够访问受限资源 | 测试环境 | 管理员JWT令牌 | 1. 发送GET请求到/api/auth/admin<br>2. 携带管理员JWT令牌 | 返回HTTP 200，包含管理员资源信息 |
| PERM-004 | 普通用户访问受限资源 | 验证普通用户不能访问管理员资源 | 测试环境 | 普通用户JWT令牌 | 1. 发送GET请求到/api/auth/admin<br>2. 携带普通用户JWT令牌 | 返回HTTP 403，提示权限不足 |

### 2.4 操作日志测试

#### 2.4.1 登录日志测试

| 测试用例ID | 测试用例名称 | 测试目标 | 测试环境 | 测试数据 | 测试步骤 | 预期结果 |
|------------|--------------|----------|----------|----------|----------|----------|
| LOG-001 | 登录操作日志记录 | 验证用户登录操作被记录到操作日志 | 测试环境 | 用户名：admin，密码：Admin@123 | 1. 用户登录成功<br>2. 查询操作日志 | 操作日志中包含该用户的登录记录 |
| LOG-002 | 登出操作日志记录 | 验证用户登出操作被记录到操作日志 | 测试环境 | 管理员JWT令牌 | 1. 用户登出成功<br>2. 查询操作日志 | 操作日志中包含该用户的登出记录 |

#### 2.4.2 用户管理操作日志测试

| 测试用例ID | 测试用例名称 | 测试目标 | 测试环境 | 测试数据 | 测试步骤 | 预期结果 |
|------------|--------------|----------|----------|----------|----------|----------|
| LOG-003 | 创建用户操作日志 | 验证创建用户操作被记录到操作日志 | 测试环境 | 用户名：logtest，密码：Log@123，角色：USER | 1. 管理员创建新用户<br>2. 查询操作日志 | 操作日志中包含创建用户的记录 |
| LOG-004 | 删除用户操作日志 | 验证删除用户操作被记录到操作日志 | 测试环境 | 用户ID：5 | 1. 管理员删除用户<br>2. 查询操作日志 | 操作日志中包含删除用户的记录 |

## 3. 测试执行结果

| 测试用例ID | 测试用例名称 | 测试状态 | 实际结果 | 测试人员 | 测试日期 | 备注 |
|------------|--------------|----------|----------|----------|----------|------|
| AUTH-001 | 正确用户名密码登录 |  |  |  |  |  |
| AUTH-002 | 错误用户名登录 |  |  |  |  |  |
| AUTH-003 | 错误密码登录 |  |  |  |  |  |
| AUTH-004 | 空用户名登录 |  |  |  |  |  |
| AUTH-005 | 空密码登录 |  |  |  |  |  |
| AUTH-006 | 成功登出 |  |  |  |  |  |
| AUTH-007 | 无效令牌登出 |  |  |  |  |  |
| AUTH-008 | 成功刷新令牌 |  |  |  |  |  |
| AUTH-009 | 无效刷新令牌 |  |  |  |  |  |
| USER-001 | 成功创建用户 |  |  |  |  |  |
| USER-002 | 重复用户名创建 |  |  |  |  |  |
| USER-003 | 弱密码创建用户 |  |  |  |  |  |
| USER-004 | 查询所有用户 |  |  |  |  |  |
| USER-005 | 根据ID查询用户 |  |  |  |  |  |
| USER-006 | 查询不存在的用户 |  |  |  |  |  |
| USER-007 | 成功更新用户 |  |  |  |  |  |
| USER-008 | 更新不存在的用户 |  |  |  |  |  |
| USER-009 | 成功删除用户 |  |  |  |  |  |
| USER-010 | 删除不存在的用户 |  |  |  |  |  |
| USER-011 | 删除当前用户 |  |  |  |  |  |
| PERM-001 | 成功分配角色 |  |  |  |  |  |
| PERM-002 | 分配不存在的角色 |  |  |  |  |  |
| PERM-003 | 管理员访问受限资源 |  |  |  |  |  |
| PERM-004 | 普通用户访问受限资源 |  |  |  |  |  |
| LOG-001 | 登录操作日志记录 |  |  |  |  |  |
| LOG-002 | 登出操作日志记录 |  |  |  |  |  |
| LOG-003 | 创建用户操作日志 |  |  |  |  |  |
| LOG-004 | 删除用户操作日志 |  |  |  |  |  |

## 4. 测试总结

- 测试用例覆盖了Auth Service的核心功能
- 测试用例包括正常流程和异常流程
- 测试用例覆盖了边界条件
- 测试用例可重复执行，易于维护

## 5. 版本控制

| 版本 | 日期 | 描述 | 作者 |
|------|------|------|------|
| 1.0 | 2025-11-28 | 初始版本 | GMP测试团队 |
| 1.1 | YYYY-MM-DD | 更新内容 | GMP测试团队 |

# 中药材检验子系统 - 接口设计文档

## 文档信息
- **文档版本**: v1.0
- **创建日期**: 2024-01-15
- **最后更新**: 2024-01-15
- **作者**: 系统设计团队
- **审核人**: 架构师、开发团队负责人、质量保证经理

## 1. 引言

### 1.1 文档目的

本文档详细描述中药材检验子系统的接口设计，包括接口规范、接口分类、接口详细定义、接口调用流程等内容。该文档旨在为系统开发提供明确的接口指导，确保前后端交互的一致性和规范性。

### 1.2 术语定义

| 术语 | 解释 |
|-----|------|
| API | Application Programming Interface，应用程序编程接口 |
| RESTful | 一种软件架构风格，用于设计网络应用接口 |
| HTTP | HyperText Transfer Protocol，超文本传输协议 |
| JSON | JavaScript Object Notation，一种轻量级的数据交换格式 |
| JWT | JSON Web Token，一种用于在网络应用间传递声明的基于JSON的开放标准 |
| 请求方法 | HTTP协议定义的操作方法，如GET、POST、PUT、DELETE等 |
| 状态码 | HTTP协议中表示请求处理结果的数字代码 |
| URL | Uniform Resource Locator，统一资源定位符 |
| 路径参数 | URL路径中的变量部分，用于标识特定资源 |
| 查询参数 | URL中?后的参数，用于过滤、排序等操作 |
| 请求体 | HTTP请求中包含的消息内容 |
| 响应体 | HTTP响应中包含的消息内容 |

## 2. 接口设计原则

### 2.1 RESTful设计原则

- **资源标识**：使用URL标识资源
- **统一接口**：使用标准的HTTP方法（GET、POST、PUT、DELETE）操作资源
- **状态无态**：服务器不存储客户端状态，每次请求都包含完整的认证信息
- **资源表现层**：使用JSON作为数据交换格式
- **超媒体作为应用状态引擎（HATEOAS）**：API响应包含导航信息

### 2.2 接口安全性

- **认证与授权**：使用JWT进行身份认证，基于RBAC模型进行授权控制
- **数据加密**：使用HTTPS协议加密传输数据
- **请求限流**：实施接口访问频率限制，防止恶意攻击
- **输入验证**：严格验证所有输入参数，防止注入攻击
- **敏感信息保护**：不在URL、日志中暴露敏感信息

### 2.3 接口可用性

- **接口版本控制**：在URL中包含版本号，支持API的平滑升级
- **错误处理**：返回清晰的错误信息和状态码
- **接口文档**：提供完整的接口文档，包括参数说明、响应示例等
- **接口测试**：每个接口都应有对应的单元测试和集成测试

## 3. 接口分类

根据功能模块和业务领域，中药材检验子系统的接口分为以下几类：

| 接口类别 | 主要功能 | 基础路径 |
|---------|---------|--------|
| 样品管理 | 样品的CRUD操作、样品查询等 | /api/v1/samples |
| 检验计划 | 检验计划的CRUD操作、计划审批等 | /api/v1/test-plans |
| 检验任务 | 检验任务的CRUD操作、任务分配等 | /api/v1/test-tasks |
| 检验项目 | 检验项目的CRUD操作、项目管理等 | /api/v1/test-items |
| 检验结果 | 检验结果的录入、查询、判定等 | /api/v1/test-results |
| 检验报告 | 检验报告的生成、审核、查询等 | /api/v1/test-reports |
| 不合格品 | 不合格品的记录、处理、跟踪等 | /api/v1/non-conforming |
| 质量标准 | 质量标准的管理、查询等 | /api/v1/quality-standards |
| 系统管理 | 用户、角色、权限管理等 | /api/v1/system |
| 数据统计 | 各类统计报表、数据分析等 | /api/v1/statistics |

## 4. 通用接口规范

### 4.1 请求规范

#### 4.1.1 认证信息

所有需要认证的接口都必须在请求头中包含以下信息：

```
Authorization: Bearer {token}
```

其中`{token}`为通过登录接口获取的JWT令牌。

#### 4.1.2 内容类型

请求体使用JSON格式，需要在请求头中指定：

```
Content-Type: application/json
```

#### 4.1.3 通用参数

分页查询接口通常包含以下通用参数：

| 参数名 | 类型 | 必填 | 描述 |
|-------|------|-----|------|
| page | Integer | 否 | 页码，从1开始 |
| size | Integer | 否 | 每页记录数 |
| sort | String | 否 | 排序字段，格式为`字段名,排序方向`，如`createdAt,desc` |
| search | String | 否 | 搜索关键词 |

### 4.2 响应规范

#### 4.2.1 响应格式

所有接口的响应采用统一的格式：

```json
{
  "code": 200,              // 业务状态码
  "message": "成功",      // 响应消息
  "data": {},              // 响应数据，根据接口不同而不同
  "timestamp": 1634567890000, // 响应时间戳
  "path": "/api/v1/samples" // 请求路径
}
```

#### 4.2.2 分页响应格式

分页查询接口的响应数据结构：

```json
{
  "code": 200,
  "message": "成功",
  "data": {
    "content": [],          // 数据列表
    "pageable": {
      "pageNumber": 1,      // 当前页码
      "pageSize": 10,       // 每页记录数
      "sort": {
        "sorted": true,     // 是否排序
        "unsorted": false,  // 是否未排序
        "empty": false      // 是否为空
      },
      "offset": 0,          // 偏移量
      "unpaged": false,     // 是否不分页
      "paged": true         // 是否分页
    },
    "totalPages": 10,       // 总页数
    "totalElements": 95,    // 总记录数
    "last": false,          // 是否最后一页
    "size": 10,             // 每页记录数
    "number": 0,            // 当前页码（从0开始）
    "sort": {
      "sorted": true,
      "unsorted": false,
      "empty": false
    },
    "numberOfElements": 10, // 当前页记录数
    "first": true,          // 是否第一页
    "empty": false          // 是否为空
  },
  "timestamp": 1634567890000,
  "path": "/api/v1/samples"
}
```

#### 4.2.3 错误响应格式

错误响应采用统一的格式：

```json
{
  "code": 400,              // 业务状态码
  "message": "请求参数错误", // 错误消息
  "error": {
    "field": "code",       // 错误字段
    "message": "样品编号不能为空" // 具体错误信息
  },
  "timestamp": 1634567890000,
  "path": "/api/v1/samples"
}
```

#### 4.2.4 状态码定义

| HTTP状态码 | 业务状态码 | 描述 |
|-----------|-----------|------|
| 200 | 200 | 成功 |
| 201 | 201 | 创建成功 |
| 204 | 204 | 无内容 |
| 400 | 400 | 请求参数错误 |
| 401 | 401 | 未授权 |
| 403 | 403 | 禁止访问 |
| 404 | 404 | 资源不存在 |
| 405 | 405 | 方法不允许 |
| 409 | 409 | 资源冲突 |
| 500 | 500 | 服务器内部错误 |
| 503 | 503 | 服务不可用 |

## 5. 详细接口定义

### 5.1 样品管理接口

#### 5.1.1 获取样品列表

- **请求URL**：`/api/v1/samples`
- **请求方法**：`GET`
- **功能描述**：获取样品列表，支持分页、搜索和排序
- **请求参数**：

| 参数名 | 类型 | 必填 | 描述 |
|-------|------|-----|------|
| page | Integer | 否 | 页码，默认1 |
| size | Integer | 否 | 每页记录数，默认10 |
| sort | String | 否 | 排序字段，默认"createdAt,desc" |
| code | String | 否 | 样品编号，模糊匹配 |
| medicineName | String | 否 | 中药材名称，模糊匹配 |
| batchNumber | String | 否 | 批次号，模糊匹配 |
| source | String | 否 | 来源 |
| status | String | 否 | 样品状态 |
| startDate | Date | 否 | 送样开始日期，格式：yyyy-MM-dd |
| endDate | Date | 否 | 送样结束日期，格式：yyyy-MM-dd |

- **成功响应示例**：

```json
{
  "code": 200,
  "message": "成功",
  "data": {
    "content": [
      {
        "id": 1,
        "code": "S2023010001",
        "medicineName": "人参",
        "latinName": "Panax ginseng",
        "variety": "野山参",
        "origin": "吉林省",
        "source": "供应商",
        "supplierId": 1,
        "supplierName": "XX药材公司",
        "batchNumber": "R2023001",
        "quantity": 5000,
        "unit": "克",
        "sampleDate": "2023-01-15 09:30:00",
        "sendDepartment": "采购部",
        "sender": "张三",
        "samplePurpose": "入库检验",
        "testType": "INCOMING",
        "status": "PENDING",
        "storageLocation": "样品室A区",
        "photoUrl": "/uploads/samples/1.jpg",
        "description": "",
        "remarks": "",
        "createdBy": 1,
        "createdAt": "2023-01-15 09:30:00",
        "updatedBy": 1,
        "updatedAt": "2023-01-15 09:30:00"
      }
    ],
    "pageable": {...},
    "totalPages": 10,
    "totalElements": 95,
    ...
  },
  "timestamp": 1634567890000,
  "path": "/api/v1/samples"
}
```

#### 5.1.2 获取样品详情

- **请求URL**：`/api/v1/samples/{id}`
- **请求方法**：`GET`
- **功能描述**：获取指定样品的详细信息
- **路径参数**：

| 参数名 | 类型 | 必填 | 描述 |
|-------|------|-----|------|
| id | Long | 是 | 样品ID |

- **成功响应示例**：

```json
{
  "code": 200,
  "message": "成功",
  "data": {
    "id": 1,
    "code": "S2023010001",
    "medicineName": "人参",
    "latinName": "Panax ginseng",
    "variety": "野山参",
    "origin": "吉林省",
    "source": "供应商",
    "supplier": {
      "id": 1,
      "name": "XX药材公司",
      "contactPerson": "李四",
      "contactPhone": "13800138000",
      "address": "北京市朝阳区"
    },
    "batchNumber": "R2023001",
    "quantity": 5000,
    "unit": "克",
    "sampleDate": "2023-01-15 09:30:00",
    "sendDepartment": "采购部",
    "sender": "张三",
    "samplePurpose": "入库检验",
    "testType": "INCOMING",
    "status": "PENDING",
    "storageLocation": "样品室A区",
    "photoUrl": "/uploads/samples/1.jpg",
    "description": "",
    "remarks": "",
    "createdBy": 1,
    "createdAt": "2023-01-15 09:30:00",
    "updatedBy": 1,
    "updatedAt": "2023-01-15 09:30:00",
    "relatedTasks": [
      {
        "id": 1,
        "code": "T2023010001",
        "status": "IN_PROGRESS",
        "assignDate": "2023-01-16 08:00:00"
      }
    ]
  },
  "timestamp": 1634567890000,
  "path": "/api/v1/samples/1"
}
```

#### 5.1.3 创建样品

- **请求URL**：`/api/v1/samples`
- **请求方法**：`POST`
- **功能描述**：创建新的样品记录
- **请求体**：

```json
{
  "medicineName": "人参",
  "latinName": "Panax ginseng",
  "variety": "野山参",
  "origin": "吉林省",
  "source": "供应商",
  "supplierId": 1,
  "batchNumber": "R2023001",
  "quantity": 5000,
  "unit": "克",
  "sampleDate": "2023-01-15 09:30:00",
  "sendDepartment": "采购部",
  "sender": "张三",
  "samplePurpose": "入库检验",
  "testType": "INCOMING",
  "storageLocation": "样品室A区",
  "description": "",
  "remarks": ""
}
```

- **成功响应示例**：

```json
{
  "code": 201,
  "message": "创建成功",
  "data": {
    "id": 1,
    "code": "S2023010001",
    "medicineName": "人参",
    // ... 其他字段与请求体一致
    "status": "PENDING",
    "createdAt": "2023-01-15 09:30:00",
    "updatedAt": "2023-01-15 09:30:00"
  },
  "timestamp": 1634567890000,
  "path": "/api/v1/samples"
}
```

#### 5.1.4 更新样品

- **请求URL**：`/api/v1/samples/{id}`
- **请求方法**：`PUT`
- **功能描述**：更新指定样品的信息
- **路径参数**：

| 参数名 | 类型 | 必填 | 描述 |
|-------|------|-----|------|
| id | Long | 是 | 样品ID |

- **请求体**：

```json
{
  "medicineName": "人参",
  "latinName": "Panax ginseng",
  "variety": "野山参",
  "origin": "吉林省",
  "source": "供应商",
  "supplierId": 1,
  "batchNumber": "R2023001",
  "quantity": 5000,
  "unit": "克",
  "storageLocation": "样品室B区",
  "description": "",
  "remarks": "已调整存储位置"
}
```

- **成功响应示例**：

```json
{
  "code": 200,
  "message": "更新成功",
  "data": {
    "id": 1,
    "code": "S2023010001",
    // ... 更新后的字段
    "updatedAt": "2023-01-15 10:30:00"
  },
  "timestamp": 1634567890000,
  "path": "/api/v1/samples/1"
}
```

#### 5.1.5 删除样品

- **请求URL**：`/api/v1/samples/{id}`
- **请求方法**：`DELETE`
- **功能描述**：删除指定的样品记录（逻辑删除）
- **路径参数**：

| 参数名 | 类型 | 必填 | 描述 |
|-------|------|-----|------|
| id | Long | 是 | 样品ID |

- **成功响应示例**：

```json
{
  "code": 200,
  "message": "删除成功",
  "data": null,
  "timestamp": 1634567890000,
  "path": "/api/v1/samples/1"
}
```

#### 5.1.6 上传样品照片

- **请求URL**：`/api/v1/samples/{id}/upload-photo`
- **请求方法**：`POST`
- **功能描述**：上传样品照片
- **路径参数**：

| 参数名 | 类型 | 必填 | 描述 |
|-------|------|-----|------|
| id | Long | 是 | 样品ID |

- **请求体**：multipart/form-data

| 参数名 | 类型 | 必填 | 描述 |
|-------|------|-----|------|
| file | File | 是 | 照片文件 |

- **成功响应示例**：

```json
{
  "code": 200,
  "message": "上传成功",
  "data": {
    "photoUrl": "/uploads/samples/1.jpg"
  },
  "timestamp": 1634567890000,
  "path": "/api/v1/samples/1/upload-photo"
}
```

### 5.2 检验计划接口

#### 5.2.1 获取检验计划列表

- **请求URL**：`/api/v1/test-plans`
- **请求方法**：`GET`
- **功能描述**：获取检验计划列表，支持分页、搜索和排序
- **请求参数**：

| 参数名 | 类型 | 必填 | 描述 |
|-------|------|-----|------|
| page | Integer | 否 | 页码，默认1 |
| size | Integer | 否 | 每页记录数，默认10 |
| sort | String | 否 | 排序字段，默认"createdAt,desc" |
| code | String | 否 | 计划编号，模糊匹配 |
| name | String | 否 | 计划名称，模糊匹配 |
| status | String | 否 | 计划状态 |
| creatorId | Long | 否 | 创建人ID |
| createDateStart | Date | 否 | 计划开始日期，格式：yyyy-MM-dd |
| createDateEnd | Date | 否 | 计划结束日期，格式：yyyy-MM-dd |

- **成功响应示例**：

```json
{
  "code": 200,
  "message": "成功",
  "data": {
    "content": [
      {
        "id": 1,
        "code": "P2023010001",
        "name": "2023年1月入库检验计划",
        "createDate": "2023-01-15 08:30:00",
        "dueDate": "2023-01-20 17:00:00",
        "creatorId": 1,
        "creatorName": "管理员",
        "approverId": 2,
        "approverName": "质量主管",
        "approveDate": "2023-01-15 10:00:00",
        "status": "APPROVED",
        "standardReference": "《中国药典》2020版",
        "sampleCount": 5,
        "description": "",
        "remarks": "",
        "createdAt": "2023-01-15 08:30:00",
        "updatedAt": "2023-01-15 10:00:00"
      }
    ],
    "pageable": {...},
    "totalPages": 5,
    "totalElements": 45,
    ...
  },
  "timestamp": 1634567890000,
  "path": "/api/v1/test-plans"
}
```

#### 5.2.2 获取检验计划详情

- **请求URL**：`/api/v1/test-plans/{id}`
- **请求方法**：`GET`
- **功能描述**：获取指定检验计划的详细信息
- **路径参数**：

| 参数名 | 类型 | 必填 | 描述 |
|-------|------|-----|------|
| id | Long | 是 | 计划ID |

- **成功响应示例**：

```json
{
  "code": 200,
  "message": "成功",
  "data": {
    "id": 1,
    "code": "P2023010001",
    "name": "2023年1月入库检验计划",
    "createDate": "2023-01-15 08:30:00",
    "dueDate": "2023-01-20 17:00:00",
    "creator": {
      "id": 1,
      "username": "admin",
      "realName": "管理员",
      "department": "质量管理部"
    },
    "approver": {
      "id": 2,
      "username": "quality_manager",
      "realName": "质量主管",
      "department": "质量管理部"
    },
    "approveDate": "2023-01-15 10:00:00",
    "status": "APPROVED",
    "standardReference": "《中国药典》2020版",
    "samples": [
      {
        "id": 1,
        "code": "S2023010001",
        "medicineName": "人参",
        "batchNumber": "R2023001"
      },
      {
        "id": 2,
        "code": "S2023010002",
        "medicineName": "当归",
        "batchNumber": "R2023002"
      }
    ],
    "description": "",
    "remarks": "",
    "createdAt": "2023-01-15 08:30:00",
    "updatedAt": "2023-01-15 10:00:00"
  },
  "timestamp": 1634567890000,
  "path": "/api/v1/test-plans/1"
}
```

#### 5.2.3 创建检验计划

- **请求URL**：`/api/v1/test-plans`
- **请求方法**：`POST`
- **功能描述**：创建新的检验计划
- **请求体**：

```json
{
  "name": "2023年1月入库检验计划",
  "createDate": "2023-01-15 08:30:00",
  "dueDate": "2023-01-20 17:00:00",
  "standardReference": "《中国药典》2020版",
  "sampleIds": [1, 2, 3],
  "description": "",
  "remarks": ""
}
```

- **成功响应示例**：

```json
{
  "code": 201,
  "message": "创建成功",
  "data": {
    "id": 1,
    "code": "P2023010001",
    "name": "2023年1月入库检验计划",
    // ... 其他字段与请求体一致
    "status": "DRAFT",
    "createdAt": "2023-01-15 08:30:00",
    "updatedAt": "2023-01-15 08:30:00"
  },
  "timestamp": 1634567890000,
  "path": "/api/v1/test-plans"
}
```

#### 5.2.4 审批检验计划

- **请求URL**：`/api/v1/test-plans/{id}/approve`
- **请求方法**：`POST`
- **功能描述**：审批指定的检验计划
- **路径参数**：

| 参数名 | 类型 | 必填 | 描述 |
|-------|------|-----|------|
| id | Long | 是 | 计划ID |

- **请求体**：

```json
{
  "approve": true,  // true: 批准, false: 拒绝
  "comments": "计划合理，同意执行"
}
```

- **成功响应示例**：

```json
{
  "code": 200,
  "message": "审批成功",
  "data": {
    "id": 1,
    "code": "P2023010001",
    "status": "APPROVED",
    "approverId": 2,
    "approveDate": "2023-01-15 10:00:00",
    "updatedAt": "2023-01-15 10:00:00"
  },
  "timestamp": 1634567890000,
  "path": "/api/v1/test-plans/1/approve"
}
```

#### 5.2.5 生成检验任务

- **请求URL**：`/api/v1/test-plans/{id}/generate-tasks`
- **请求方法**：`POST`
- **功能描述**：根据检验计划生成检验任务
- **路径参数**：

| 参数名 | 类型 | 必填 | 描述 |
|-------|------|-----|------|
| id | Long | 是 | 计划ID |

- **请求体**：

```json
{
  "taskAssignments": [
    {
      "sampleId": 1,
      "testerId": 3
    },
    {
      "sampleId": 2,
      "testerId": 4
    }
  ]
}
```

- **成功响应示例**：

```json
{
  "code": 200,
  "message": "生成成功",
  "data": {
    "taskCount": 2,
    "tasks": [
      {
        "id": 1,
        "code": "T2023010001",
        "sampleId": 1,
        "testerId": 3
      },
      {
        "id": 2,
        "code": "T2023010002",
        "sampleId": 2,
        "testerId": 4
      }
    ]
  },
  "timestamp": 1634567890000,
  "path": "/api/v1/test-plans/1/generate-tasks"
}
```

### 5.3 检验任务接口

#### 5.3.1 获取检验任务列表

- **请求URL**：`/api/v1/test-tasks`
- **请求方法**：`GET`
- **功能描述**：获取检验任务列表，支持分页、搜索和排序
- **请求参数**：

| 参数名 | 类型 | 必填 | 描述 |
|-------|------|-----|------|
| page | Integer | 否 | 页码，默认1 |
| size | Integer | 否 | 每页记录数，默认10 |
| sort | String | 否 | 排序字段，默认"assignDate,desc" |
| code | String | 否 | 任务编号，模糊匹配 |
| status | String | 否 | 任务状态 |
| testerId | Long | 否 | 检验员ID |
| sampleId | Long | 否 | 样品ID |
| medicineName | String | 否 | 中药材名称，模糊匹配 |
| assignDateStart | Date | 否 | 分配开始日期，格式：yyyy-MM-dd |
| assignDateEnd | Date | 否 | 分配结束日期，格式：yyyy-MM-dd |

- **成功响应示例**：

```json
{
  "code": 200,
  "message": "成功",
  "data": {
    "content": [
      {
        "id": 1,
        "code": "T2023010001",
        "planId": 1,
        "planCode": "P2023010001",
        "sampleId": 1,
        "sampleCode": "S2023010001",
        "medicineName": "人参",
        "batchNumber": "R2023001",
        "assignDate": "2023-01-15 10:30:00",
        "dueDate": "2023-01-18 17:00:00",
        "testerId": 3,
        "testerName": "李检验员",
        "status": "IN_PROGRESS",
        "startTime": "2023-01-15 13:00:00",
        "endTime": null,
        "completedItems": 2,
        "totalItems": 5,
        "description": "",
        "remarks": "",
        "createdAt": "2023-01-15 10:30:00",
        "updatedAt": "2023-01-15 13:00:00"
      }
    ],
    "pageable": {...},
    "totalPages": 8,
    "totalElements": 75,
    ...
  },
  "timestamp": 1634567890000,
  "path": "/api/v1/test-tasks"
}
```

#### 5.3.2 获取检验任务详情

- **请求URL**：`/api/v1/test-tasks/{id}`
- **请求方法**：`GET`
- **功能描述**：获取指定检验任务的详细信息
- **路径参数**：

| 参数名 | 类型 | 必填 | 描述 |
|-------|------|-----|------|
| id | Long | 是 | 任务ID |

- **成功响应示例**：

```json
{
  "code": 200,
  "message": "成功",
  "data": {
    "id": 1,
    "code": "T2023010001",
    "plan": {
      "id": 1,
      "code": "P2023010001",
      "name": "2023年1月入库检验计划"
    },
    "sample": {
      "id": 1,
      "code": "S2023010001",
      "medicineName": "人参",
      "batchNumber": "R2023001",
      "origin": "吉林省",
      "quantity": 5000,
      "unit": "克"
    },
    "assignDate": "2023-01-15 10:30:00",
    "dueDate": "2023-01-18 17:00:00",
    "tester": {
      "id": 3,
      "username": "tester1",
      "realName": "李检验员",
      "department": "检验部门"
    },
    "status": "IN_PROGRESS",
    "startTime": "2023-01-15 13:00:00",
    "endTime": null,
    "testItems": [
      {
        "id": 1,
        "code": "ITEM001",
        "name": "性状检查",
        "category": "性状",
        "hasResult": true,
        "result": {
          "judgment": "PASSED",
          "testTime": "2023-01-15 14:00:00"
        }
      },
      {
        "id": 2,
        "code": "ITEM002",
        "name": "水分测定",
        "category": "检查",
        "hasResult": false
      }
    ],
    "description": "",
    "remarks": "",
    "createdAt": "2023-01-15 10:30:00",
    "updatedAt": "2023-01-15 13:00:00"
  },
  "timestamp": 1634567890000,
  "path": "/api/v1/test-tasks/1"
}
```

#### 5.3.3 更新任务状态

- **请求URL**：`/api/v1/test-tasks/{id}/status`
- **请求方法**：`PUT`
- **功能描述**：更新指定检验任务的状态
- **路径参数**：

| 参数名 | 类型 | 必填 | 描述 |
|-------|------|-----|------|
| id | Long | 是 | 任务ID |

- **请求体**：

```json
{
  "status": "IN_PROGRESS", // 可选值: PENDING, IN_PROGRESS, COMPLETED, CANCELED
  "remarks": "开始检验"
}
```

- **成功响应示例**：

```json
{
  "code": 200,
  "message": "更新成功",
  "data": {
    "id": 1,
    "code": "T2023010001",
    "status": "IN_PROGRESS",
    "startTime": "2023-01-15 13:00:00",
    "updatedAt": "2023-01-15 13:00:00"
  },
  "timestamp": 1634567890000,
  "path": "/api/v1/test-tasks/1/status"
}
```

### 5.4 检验结果接口

#### 5.4.1 录入检验结果

- **请求URL**：`/api/v1/test-results`
- **请求方法**：`POST`
- **功能描述**：录入检验结果
- **请求体**：

```json
{
  "taskId": 1,
  "itemId": 1,
  "testValue": 12.5,  // 数值型结果，与textResult二选一
  "textResult": "",  // 文本型结果，与testValue二选一
  "judgment": "PASSED",
  "testingEquipment": "电子天平",
  "abnormalityDescription": "",
  "remarks": ""
}
```

- **成功响应示例**：

```json
{
  "code": 201,
  "message": "录入成功",
  "data": {
    "id": 1,
    "taskId": 1,
    "itemId": 1,
    "testValue": 12.5,
    "textResult": "",
    "judgment": "PASSED",
    "testTime": "2023-01-15 14:00:00",
    "testerId": 3,
    "testingEquipment": "电子天平",
    "abnormalityDescription": "",
    "remarks": "",
    "createdAt": "2023-01-15 14:00:00",
    "updatedAt": "2023-01-15 14:00:00"
  },
  "timestamp": 1634567890000,
  "path": "/api/v1/test-results"
}
```

#### 5.4.2 更新检验结果

- **请求URL**：`/api/v1/test-results/{taskId}/{itemId}`
- **请求方法**：`PUT`
- **功能描述**：更新指定任务和检验项目的检验结果
- **路径参数**：

| 参数名 | 类型 | 必填 | 描述 |
|-------|------|-----|------|
| taskId | Long | 是 | 任务ID |
| itemId | Long | 是 | 检验项目ID |

- **请求体**：

```json
{
  "testValue": 12.6,
  "judgment": "PASSED",
  "testingEquipment": "电子天平",
  "abnormalityDescription": "",
  "remarks": "重新测定"
}
```

- **成功响应示例**：

```json
{
  "code": 200,
  "message": "更新成功",
  "data": {
    "id": 1,
    "taskId": 1,
    "itemId": 1,
    "testValue": 12.6,
    "textResult": "",
    "judgment": "PASSED",
    "testTime": "2023-01-15 14:30:00",
    "testerId": 3,
    "testingEquipment": "电子天平",
    "abnormalityDescription": "",
    "remarks": "重新测定",
    "updatedAt": "2023-01-15 14:30:00"
  },
  "timestamp": 1634567890000,
  "path": "/api/v1/test-results/1/1"
}
```

#### 5.4.3 上传检验附件

- **请求URL**：`/api/v1/test-results/{id}/upload-attachment`
- **请求方法**：`POST`
- **功能描述**：上传检验结果相关的附件（如图片、文档等）
- **路径参数**：

| 参数名 | 类型 | 必填 | 描述 |
|-------|------|-----|------|
| id | Long | 是 | 检验结果ID |

- **请求体**：multipart/form-data

| 参数名 | 类型 | 必填 | 描述 |
|-------|------|-----|------|
| file | File | 是 | 附件文件 |

- **成功响应示例**：

```json
{
  "code": 200,
  "message": "上传成功",
  "data": {
    "attachmentUrl": "/uploads/results/1/photo.jpg"
  },
  "timestamp": 1634567890000,
  "path": "/api/v1/test-results/1/upload-attachment"
}
```

### 5.5 检验报告接口

#### 5.5.1 获取检验报告列表

- **请求URL**：`/api/v1/test-reports`
- **请求方法**：`GET`
- **功能描述**：获取检验报告列表，支持分页、搜索和排序
- **请求参数**：

| 参数名 | 类型 | 必填 | 描述 |
|-------|------|-----|------|
| page | Integer | 否 | 页码，默认1 |
| size | Integer | 否 | 每页记录数，默认10 |
| sort | String | 否 | 排序字段，默认"generateDate,desc" |
| code | String | 否 | 报告编号，模糊匹配 |
| sampleId | Long | 否 | 样品ID |
| medicineName | String | 否 | 中药材名称，模糊匹配 |
| batchNumber | String | 否 | 批次号，模糊匹配 |
| overallJudgment | String | 否 | 总体判定结果 |
| status | String | 否 | 报告状态 |
| generateDateStart | Date | 否 | 生成开始日期，格式：yyyy-MM-dd |
| generateDateEnd | Date | 否 | 生成结束日期，格式：yyyy-MM-dd |

- **成功响应示例**：

```json
{
  "code": 200,
  "message": "成功",
  "data": {
    "content": [
      {
        "id": 1,
        "code": "R2023010001",
        "taskId": 1,
        "sampleId": 1,
        "sampleCode": "S2023010001",
        "medicineName": "人参",
        "batchNumber": "R2023001",
        "generateDate": "2023-01-16 10:00:00",
        "status": "APPROVED",
        "overallJudgment": "PASSED",
        "generatorId": 3,
        "generatorName": "李检验员",
        "reviewerId": 4,
        "reviewerName": "王审核员",
        "reviewDate": "2023-01-16 14:00:00",
        "approverId": 2,
        "approverName": "质量主管",
        "approveDate": "2023-01-16 15:00:00",
        "reportUrl": "/reports/R2023010001.pdf",
        "remarks": "",
        "createdAt": "2023-01-16 10:00:00",
        "updatedAt": "2023-01-16 15:00:00"
      }
    ],
    "pageable": {...},
    "totalPages": 6,
    "totalElements": 58,
    ...
  },
  "timestamp": 1634567890000,
  "path": "/api/v1/test-reports"
}
```

#### 5.5.2 获取检验报告详情

- **请求URL**：`/api/v1/test-reports/{id}`
- **请求方法**：`GET`
- **功能描述**：获取指定检验报告的详细信息
- **路径参数**：

| 参数名 | 类型 | 必填 | 描述 |
|-------|------|-----|------|
| id | Long | 是 | 报告ID |

- **成功响应示例**：

```json
{
  "code": 200,
  "message": "成功",
  "data": {
    "id": 1,
    "code": "R2023010001",
    "task": {
      "id": 1,
      "code": "T2023010001",
      "startTime": "2023-01-15 13:00:00",
      "endTime": "2023-01-16 09:00:00"
    },
    "sample": {
      "id": 1,
      "code": "S2023010001",
      "medicineName": "人参",
      "batchNumber": "R2023001",
      "origin": "吉林省",
      "source": "供应商",
      "supplierName": "XX药材公司",
      "quantity": 5000,
      "unit": "克"
    },
    "generateDate": "2023-01-16 10:00:00",
    "status": "APPROVED",
    "overallJudgment": "PASSED",
    "generator": {
      "id": 3,
      "username": "tester1",
      "realName": "李检验员",
      "department": "检验部门"
    },
    "reviewer": {
      "id": 4,
      "username": "reviewer1",
      "realName": "王审核员",
      "department": "质量管理部"
    },
    "reviewDate": "2023-01-16 14:00:00",
    "reviewComments": "检验结果符合标准",
    "approver": {
      "id": 2,
      "username": "quality_manager",
      "realName": "质量主管",
      "department": "质量管理部"
    },
    "approveDate": "2023-01-16 15:00:00",
    "approveComments": "同意放行",
    "summary": "经检验，该批次人参符合《中国药典》2020版标准要求",
    "reportUrl": "/reports/R2023010001.pdf",
    "testResults": [
      {
        "itemId": 1,
        "itemName": "性状检查",
        "category": "性状",
        "testValue": null,
        "textResult": "本品呈纺锤形、圆柱形或圆锥形，表面灰黄色，上部或全体有疏浅断续的粗横纹及明显的纵皱",
        "judgment": "PASSED",
        "testTime": "2023-01-15 14:00:00"
      },
      {
        "itemId": 2,
        "itemName": "水分测定",
        "category": "检查",
        "testValue": 12.6,
        "textResult": "",
        "judgment": "PASSED",
        "testTime": "2023-01-15 14:30:00"
      }
    ],
    "remarks": "",
    "createdAt": "2023-01-16 10:00:00",
    "updatedAt": "2023-01-16 15:00:00"
  },
  "timestamp": 1634567890000,
  "path": "/api/v1/test-reports/1"
}
```

#### 5.5.3 生成检验报告

- **请求URL**：`/api/v1/test-reports/generate`
- **请求方法**：`POST`
- **功能描述**：根据检验任务生成检验报告
- **请求体**：

```json
{
  "taskId": 1,
  "summary": "经检验，该批次人参符合《中国药典》2020版标准要求",
  "remarks": ""
}
```

- **成功响应示例**：

```json
{
  "code": 201,
  "message": "生成成功",
  "data": {
    "id": 1,
    "code": "R2023010001",
    "taskId": 1,
    "sampleId": 1,
    "generateDate": "2023-01-16 10:00:00",
    "status": "DRAFT",
    "overallJudgment": "PASSED",
    "generatorId": 3,
    "summary": "经检验，该批次人参符合《中国药典》2020版标准要求",
    "reportUrl": "/reports/R2023010001.pdf",
    "createdAt": "2023-01-16 10:00:00",
    "updatedAt": "2023-01-16 10:00:00"
  },
  "timestamp": 1634567890000,
  "path": "/api/v1/test-reports/generate"
}
```

#### 5.5.4 审核检验报告

- **请求URL**：`/api/v1/test-reports/{id}/review`
- **请求方法**：`POST`
- **功能描述**：审核指定的检验报告
- **路径参数**：

| 参数名 | 类型 | 必填 | 描述 |
|-------|------|-----|------|
| id | Long | 是 | 报告ID |

- **请求体**：

```json
{
  "review": true,  // true: 通过审核, false: 拒绝审核
  "comments": "检验结果符合标准"
}
```

- **成功响应示例**：

```json
{
  "code": 200,
  "message": "审核成功",
  "data": {
    "id": 1,
    "code": "R2023010001",
    "status": "REVIEWED",
    "reviewerId": 4,
    "reviewDate": "2023-01-16 14:00:00",
    "reviewComments": "检验结果符合标准",
    "updatedAt": "2023-01-16 14:00:00"
  },
  "timestamp": 1634567890000,
  "path": "/api/v1/test-reports/1/review"
}
```

#### 5.5.5 批准检验报告

- **请求URL**：`/api/v1/test-reports/{id}/approve`
- **请求方法**：`POST`
- **功能描述**：批准指定的检验报告
- **路径参数**：

| 参数名 | 类型 | 必填 | 描述 |
|-------|------|-----|------|
| id | Long | 是 | 报告ID |

- **请求体**：

```json
{
  "approve": true,  // true: 批准, false: 拒绝
  "comments": "同意放行"
}
```

- **成功响应示例**：

```json
{
  "code": 200,
  "message": "批准成功",
  "data": {
    "id": 1,
    "code": "R2023010001",
    "status": "APPROVED",
    "approverId": 2,
    "approveDate": "2023-01-16 15:00:00",
    "approveComments": "同意放行",
    "updatedAt": "2023-01-16 15:00:00"
  },
  "timestamp": 1634567890000,
  "path": "/api/v1/test-reports/1/approve"
}
```

### 5.6 不合格品处理接口

#### 5.6.1 获取不合格品列表

- **请求URL**：`/api/v1/non-conforming`
- **请求方法**：`GET`
- **功能描述**：获取不合格品列表，支持分页、搜索和排序
- **请求参数**：

| 参数名 | 类型 | 必填 | 描述 |
|-------|------|-----|------|
| page | Integer | 否 | 页码，默认1 |
| size | Integer | 否 | 每页记录数，默认10 |
| sort | String | 否 | 排序字段，默认"discoveryDate,desc" |
| code | String | 否 | 不合格品编号，模糊匹配 |
| sampleId | Long | 否 | 样品ID |
| medicineName | String | 否 | 中药材名称，模糊匹配 |
| nonConformingType | String | 否 | 不合格类型 |
| severityLevel | String | 否 | 严重程度 |
| handlingStatus | String | 否 | 处理状态 |
| discoveryDateStart | Date | 否 | 发现开始日期，格式：yyyy-MM-dd |
| discoveryDateEnd | Date | 否 | 发现结束日期，格式：yyyy-MM-dd |

- **成功响应示例**：

```json
{
  "code": 200,
  "message": "成功",
  "data": {
    "content": [
      {
        "id": 1,
        "code": "NC2023010001",
        "reportId": 2,
        "reportCode": "R2023010002",
        "sampleId": 3,
        "sampleCode": "S2023010003",
        "medicineName": "甘草",
        "batchNumber": "R2023003",
        "discoveryDate": "2023-01-17 11:00:00",
        "discovererId": 3,
        "discovererName": "李检验员",
        "nonConformingType": "检验不合格",
        "defectDescription": "重金属含量超标",
        "severityLevel": "HIGH",
        "handlingStatus": "IN_PROGRESS",
        "reviewerId": 4,
        "reviewDate": "2023-01-17 13:00:00",
        "handlerId": 5,
        "handleDate": "2023-01-17 14:00:00",
        "remarks": "",
        "createdAt": "2023-01-17 11:00:00",
        "updatedAt": "2023-01-17 14:00:00"
      }
    ],
    "pageable": {...},
    "totalPages": 3,
    "totalElements": 25,
    ...
  },
  "timestamp": 1634567890000,
  "path": "/api/v1/non-conforming"
}
```

#### 5.6.2 获取不合格品详情

- **请求URL**：`/api/v1/non-conforming/{id}`
- **请求方法**：`GET`
- **功能描述**：获取指定不合格品的详细信息
- **路径参数**：

| 参数名 | 类型 | 必填 | 描述 |
|-------|------|-----|------|
| id | Long | 是 | 不合格品ID |

- **成功响应示例**：

```json
{
  "code": 200,
  "message": "成功",
  "data": {
    "id": 1,
    "code": "NC2023010001",
    "report": {
      "id": 2,
      "code": "R2023010002",
      "overallJudgment": "FAILED",
      "generateDate": "2023-01-17 10:30:00"
    },
    "sample": {
      "id": 3,
      "code": "S2023010003",
      "medicineName": "甘草",
      "batchNumber": "R2023003",
      "origin": "内蒙古",
      "supplierName": "XX中药材公司"
    },
    "discoveryDate": "2023-01-17 11:00:00",
    "discoverer": {
      "id": 3,
      "username": "tester1",
      "realName": "李检验员",
      "department": "检验部门"
    },
    "nonConformingType": "检验不合格",
    "defectDescription": "重金属含量超标，实测值为5.2mg/kg，标准值≤5.0mg/kg",
    "severityLevel": "HIGH",
    "handlingStatus": "IN_PROGRESS",
    "reviewer": {
      "id": 4,
      "username": "reviewer1",
      "realName": "王审核员",
      "department": "质量管理部"
    },
    "reviewDate": "2023-01-17 13:00:00",
    "handlingPlan": "退货处理",
    "handler": {
      "id": 5,
      "username": "handler1",
      "realName": "张处理员",
      "department": "采购部"
    },
    "handleDate": "2023-01-17 14:00:00",
    "handlingResult": "已联系供应商安排退货",
    "verifier": null,
    "verifyDate": null,
    "verifyResult": null,
    "remarks": "",
    "createdAt": "2023-01-17 11:00:00",
    "updatedAt": "2023-01-17 14:00:00"
  },
  "timestamp": 1634567890000,
  "path": "/api/v1/non-conforming/1"
}
```

#### 5.6.3 评审不合格品

- **请求URL**：`/api/v1/non-conforming/{id}/review`
- **请求方法**：`POST`
- **功能描述**：评审指定的不合格品
- **路径参数**：

| 参数名 | 类型 | 必填 | 描述 |
|-------|------|-----|------|
| id | Long | 是 | 不合格品ID |

- **请求体**：

```json
{
  "handlingPlan": "退货处理",
  "severityLevel": "HIGH",
  "comments": "重金属超标属于严重质量问题，建议退货处理"
}
```

- **成功响应示例**：

```json
{
  "code": 200,
  "message": "评审成功",
  "data": {
    "id": 1,
    "code": "NC2023010001",
    "severityLevel": "HIGH",
    "handlingPlan": "退货处理",
    "reviewerId": 4,
    "reviewDate": "2023-01-17 13:00:00",
    "updatedAt": "2023-01-17 13:00:00"
  },
  "timestamp": 1634567890000,
  "path": "/api/v1/non-conforming/1/review"
}
```

#### 5.6.4 处理不合格品

- **请求URL**：`/api/v1/non-conforming/{id}/handle`
- **请求方法**：`POST`
- **功能描述**：处理指定的不合格品
- **路径参数**：

| 参数名 | 类型 | 必填 | 描述 |
|-------|------|-----|------|
| id | Long | 是 | 不合格品ID |

- **请求体**：

```json
{
  "handlingResult": "已联系供应商安排退货",
  "handlingStatus": "COMPLETED",
  "remarks": "供应商已确认，将于明日安排退货事宜"
}
```

- **成功响应示例**：

```json
{
  "code": 200,
  "message": "处理成功",
  "data": {
    "id": 1,
    "code": "NC2023010001",
    "handlingResult": "已联系供应商安排退货",
    "handlingStatus": "COMPLETED",
    "handlerId": 5,
    "handleDate": "2023-01-17 14:00:00",
    "remarks": "供应商已确认，将于明日安排退货事宜",
    "updatedAt": "2023-01-17 14:00:00"
  },
  "timestamp": 1634567890000,
  "path": "/api/v1/non-conforming/1/handle"
}
```

#### 5.6.5 验证不合格品处理结果

- **请求URL**：`/api/v1/non-conforming/{id}/verify`
- **请求方法**：`POST`
- **功能描述**：验证指定不合格品的处理结果
- **路径参数**：

| 参数名 | 类型 | 必填 | 描述 |
|-------|------|-----|------|
| id | Long | 是 | 不合格品ID |

- **请求体**：

```json
{
  "verifyResult": "验证合格",
  "comments": "已确认退货完成，仓库已收到退货单"
}
```

- **成功响应示例**：

```json
{
  "code": 200,
  "message": "验证成功",
  "data": {
    "id": 1,
    "code": "NC2023010001",
    "verifyResult": "验证合格",
    "verifierId": 2,
    "verifyDate": "2023-01-18 10:00:00",
    "updatedAt": "2023-01-18 10:00:00"
  },
  "timestamp": 1634567890000,
  "path": "/api/v1/non-conforming/1/verify"
}
```

### 5.7 质量标准接口

#### 5.7.1 获取质量标准列表

- **请求URL**：`/api/v1/quality-standards`
- **请求方法**：`GET`
- **功能描述**：获取质量标准列表，支持分页、搜索和排序
- **请求参数**：

| 参数名 | 类型 | 必填 | 描述 |
|-------|------|-----|------|
| page | Integer | 否 | 页码，默认1 |
| size | Integer | 否 | 每页记录数，默认10 |
| sort | String | 否 | 排序字段，默认"createdAt,desc" |
| code | String | 否 | 标准编号，模糊匹配 |
| name | String | 否 | 标准名称，模糊匹配 |
| standardType | String | 否 | 标准类型 |
| reference | String | 否 | 参考标准，模糊匹配 |
| status | String | 否 | 标准状态 |
| effectiveDateStart | Date | 否 | 生效开始日期，格式：yyyy-MM-dd |
| effectiveDateEnd | Date | 否 | 生效结束日期，格式：yyyy-MM-dd |

- **成功响应示例**：

```json
{
  "code": 200,
  "message": "成功",
  "data": {
    "content": [
      {
        "id": 1,
        "code": "QS2023010001",
        "name": "人参质量标准",
        "standardType": "INTERNAL",
        "reference": "《中国药典》2020版一部",
        "effectiveDate": "2023-01-01 00:00:00",
        "expiryDate": null,
        "status": "ACTIVE",
        "version": "V1.0",
        "creatorId": 1,
        "creatorName": "管理员",
        "createdAt": "2023-01-01 08:00:00",
        "updatedAt": "2023-01-01 08:00:00"
      }
    ],
    "pageable": {...},
    "totalPages": 4,
    "totalElements": 38,
    ...
  },
  "timestamp": 1634567890000,
  "path": "/api/v1/quality-standards"
}
```

#### 5.7.2 获取质量标准详情

- **请求URL**：`/api/v1/quality-standards/{id}`
- **请求方法**：`GET`
- **功能描述**：获取指定质量标准的详细信息
- **路径参数**：

| 参数名 | 类型 | 必填 | 描述 |
|-------|------|-----|------|
| id | Long | 是 | 标准ID |

- **成功响应示例**：

```json
{
  "code": 200,
  "message": "成功",
  "data": {
    "id": 1,
    "code": "QS2023010001",
    "name": "人参质量标准",
    "standardType": "INTERNAL",
    "reference": "《中国药典》2020版一部",
    "effectiveDate": "2023-01-01 00:00:00",
    "expiryDate": null,
    "status": "ACTIVE",
    "version": "V1.0",
    "description": "本品为五加科植物人参Panax ginseng C. A. Mey.的干燥根和根茎",
    "items": [
      {
        "id": 1,
        "code": "ITEM001",
        "name": "性状检查",
        "category": "性状",
        "method": "取本品，观察其形状、大小、颜色、表面特征等",
        "standardValue": "本品呈纺锤形、圆柱形或圆锥形，表面灰黄色，上部或全体有疏浅断续的粗横纹及明显的纵皱",
        "unit": "",
        "maxValue": null,
        "minValue": null,
        "testValueType": "TEXT",
        "sortOrder": 1
      },
      {
        "id": 2,
        "code": "ITEM002",
        "name": "水分测定",
        "category": "检查",
        "method": "照水分测定法（通则0832第二法）测定",
        "standardValue": "",
        "unit": "%",
        "maxValue": 13.0,
        "minValue": 0.0,
        "testValueType": "NUMERIC",
        "sortOrder": 2
      }
    ],
    "creator": {
      "id": 1,
      "username": "admin",
      "realName": "管理员",
      "department": "质量管理部"
    },
    "createdAt": "2023-01-01 08:00:00",
    "updatedAt": "2023-01-01 08:00:00"
  },
  "timestamp": 1634567890000,
  "path": "/api/v1/quality-standards/1"
}
```

#### 5.7.3 创建质量标准

- **请求URL**：`/api/v1/quality-standards`
- **请求方法**：`POST`
- **功能描述**：创建新的质量标准
- **请求体**：

```json
{
  "name": "人参质量标准",
  "standardType": "INTERNAL",
  "reference": "《中国药典》2020版一部",
  "effectiveDate": "2023-01-01 00:00:00",
  "expiryDate": null,
  "description": "本品为五加科植物人参Panax ginseng C. A. Mey.的干燥根和根茎",
  "items": [
    {
      "code": "ITEM001",
      "name": "性状检查",
      "category": "性状",
      "method": "取本品，观察其形状、大小、颜色、表面特征等",
      "standardValue": "本品呈纺锤形、圆柱形或圆锥形，表面灰黄色，上部或全体有疏浅断续的粗横纹及明显的纵皱",
      "unit": "",
      "testValueType": "TEXT",
      "sortOrder": 1
    },
    {
      "code": "ITEM002",
      "name": "水分测定",
      "category": "检查",
      "method": "照水分测定法（通则0832第二法）测定",
      "unit": "%",
      "maxValue": 13.0,
      "minValue": 0.0,
      "testValueType": "NUMERIC",
      "sortOrder": 2
    }
  ]
}
```

- **成功响应示例**：

```json
{
  "code": 201,
  "message": "创建成功",
  "data": {
    "id": 1,
    "code": "QS2023010001",
    "name": "人参质量标准",
    // ... 其他字段与请求体一致
    "status": "DRAFT",
    "version": "V1.0",
    "createdAt": "2023-01-01 08:00:00",
    "updatedAt": "2023-01-01 08:00:00"
  },
  "timestamp": 1634567890000,
  "path": "/api/v1/quality-standards"
}
```

## 6. 接口调用流程

### 6.1 样品检验完整流程

1. **样品登记**：调用`POST /api/v1/samples`创建样品记录
2. **检验计划制定**：调用`POST /api/v1/test-plans`创建检验计划，调用`POST /api/v1/test-plans/{id}/approve`审批计划
3. **检验任务生成**：调用`POST /api/v1/test-plans/{id}/generate-tasks`生成检验任务
4. **检验执行**：调用`PUT /api/v1/test-tasks/{id}/status`更新任务状态为进行中，调用`POST /api/v1/test-results`录入检验结果
5. **任务完成**：调用`PUT /api/v1/test-tasks/{id}/status`更新任务状态为已完成
6. **报告生成**：调用`POST /api/v1/test-reports/generate`生成检验报告
7. **报告审核与批准**：调用`POST /api/v1/test-reports/{id}/review`审核报告，调用`POST /api/v1/test-reports/{id}/approve`批准报告
8. **不合格品处理（如需要）**：调用`POST /api/v1/non-conforming/{id}/review`评审不合格品，调用`POST /api/v1/non-conforming/{id}/handle`处理不合格品，调用`POST /api/v1/non-conforming/{id}/verify`验证处理结果

### 6.2 典型场景接口调用示例

#### 6.2.1 场景一：新增中药材样品并制定检验计划

1. 新增样品：
   ```
   POST /api/v1/samples
   ```

2. 创建检验计划：
   ```
   POST /api/v1/test-plans
   ```

3. 审批检验计划：
   ```
   POST /api/v1/test-plans/1/approve
   ```

#### 6.2.2 场景二：执行检验任务并录入结果

1. 获取待处理任务：
   ```
   GET /api/v1/test-tasks?status=PENDING&testerId=3
   ```

2. 更新任务状态为进行中：
   ```
   PUT /api/v1/test-tasks/1/status
   ```

3. 录入检验结果：
   ```
   POST /api/v1/test-results
   ```

4. 更新任务状态为已完成：
   ```
   PUT /api/v1/test-tasks/1/status
   ```

#### 6.2.3 场景三：生成并审批检验报告

1. 生成检验报告：
   ```
   POST /api/v1/test-reports/generate
   ```

2. 审核检验报告：
   ```
   POST /api/v1/test-reports/1/review
   ```

3. 批准检验报告：
   ```
   POST /api/v1/test-reports/1/approve
   ```

## 7. 接口安全与性能

### 7.1 安全措施

- **认证与授权**：使用JWT进行身份认证，基于RBAC模型进行权限控制，确保只有授权用户才能访问相应接口
- **数据加密**：使用HTTPS协议加密传输数据，保护数据在传输过程中的安全
- **输入验证**：严格验证所有输入参数，防止SQL注入、XSS等攻击
- **接口限流**：实施接口访问频率限制，防止恶意攻击和资源耗尽
- **敏感信息保护**：不在URL、日志中暴露敏感信息，如密码、令牌等
- **数据脱敏**：在响应中对敏感信息进行脱敏处理

### 7.2 性能优化

- **缓存机制**：对频繁访问且不常变化的数据实施缓存，如质量标准、用户信息等
- **分页查询**：所有列表查询接口均支持分页，避免一次性返回大量数据
- **异步处理**：对耗时操作采用异步处理，如生成PDF报告、批量导入等
- **数据库优化**：对常用查询条件建立索引，优化SQL查询语句
- **接口压缩**：对响应数据进行压缩，减少传输数据量
- **并发控制**：合理设计并发访问机制，避免数据竞争和锁竞争

## 8. 接口文档维护

### 8.1 文档更新流程

1. 接口设计变更时，应及时更新本接口设计文档
2. 接口实现完成后，应进行接口测试并验证文档的准确性
3. 接口上线前，应确保文档已更新至最新版本
4. 定期审查接口文档，确保其与实际实现一致

### 8.2 文档版本控制

| 版本 | 日期 | 修改人 | 修改内容 |
|-----|------|-------|--------|
| V1.0 | 2023-01-15 | 系统开发团队 | 初始版本 |

## 9. 附录

### 9.1 接口状态码参考

| 状态码 | 描述 |
|-------|------|
| 200 | 成功 |
| 201 | 创建成功 |
| 204 | 无内容 |
| 400 | 请求参数错误 |
| 401 | 未授权 |
| 403 | 禁止访问 |
| 404 | 资源不存在 |
| 405 | 方法不允许 |
| 409 | 资源冲突 |
| 500 | 服务器内部错误 |
| 503 | 服务不可用 |

### 9.2 常用枚举值

#### 9.2.1 样品状态枚举

| 枚举值 | 描述 |
|-------|------|
| PENDING | 待检验 |
| IN_TESTING | 检验中 |
| PASSED | 检验合格 |
| FAILED | 检验不合格 |
| CANCELED | 已取消 |

#### 9.2.2 任务状态枚举

| 枚举值 | 描述 |
|-------|------|
| PENDING | 待执行 |
| IN_PROGRESS | 进行中 |
| COMPLETED | 已完成 |
| CANCELED | 已取消 |
| DELAYED | 已延期 |

#### 9.2.3 检验判定枚举

| 枚举值 | 描述 |
|-------|------|
| PASSED | 合格 |
| FAILED | 不合格 |
| ABNORMAL | 异常 |
| NOT_JUDGED | 未判定 |

#### 9.2.4 报告状态枚举

| 枚举值 | 描述 |
|-------|------|
| DRAFT | 草稿 |
| SUBMITTED | 已提交 |
| REVIEWED | 已审核 |
| APPROVED | 已批准 |
| REJECTED | 已驳回 |
| CANCELED | 已取消 |

#### 9.2.5 不合格品处理状态枚举

| 枚举值 | 描述 |
|-------|------|
| DISCOVERED | 已发现 |
| REVIEWING | 评审中 |
| IN_PROGRESS | 处理中 |
| COMPLETED | 已完成 |
| VERIFIED | 已验证 |
| CANCELED | 已取消 |

### 9.3 常见错误信息

| 错误码 | 错误消息 | 解决方案 |
|-------|---------|--------|
| 40001 | 样品编号不能为空 | 请输入样品编号 |
| 40002 | 样品编号已存在 | 请使用其他样品编号 |
| 40003 | 无效的样品状态 | 请使用有效的样品状态值 |
| 40004 | 检验计划审批失败，当前状态不允许审批 | 请确认检验计划状态是否为待审批 |
| 40005 | 检验任务不存在或已被删除 | 请确认检验任务ID是否正确 |
| 40006 | 无权执行该操作 | 请检查您的权限设置 |
| 40007 | 数据库操作失败 | 请检查数据库连接和配置 |
| 40008 | 文件上传失败 | 请检查文件大小和格式是否符合要求 |
| 50001 | 服务器内部错误 | 请联系系统管理员 |
| 50002 | 系统繁忙，请稍后重试 | 请在系统负载较低时重试操作 |
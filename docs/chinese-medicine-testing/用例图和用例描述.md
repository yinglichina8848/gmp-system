# 中药材检验子系统用例图和用例描述

## 文档信息
- **版本号**：v1.0.0-draft
- **创建日期**：2025年11月23日
- **审核状态**：待审核
- **保密级别**：内部使用

## 目录
- [文档信息](#文档信息)
- [概述](#概述)
  - [文档目的](#文档目的)
  - [术语定义](#术语定义)
- [系统总体用例图](#系统总体用例图)
- [核心功能域用例图](#核心功能域用例图)
- [详细用例描述](#详细用例描述)
- [用户界面原型](#用户界面原型)
- [验收测试用例](#验收测试用例)
- [附录](#附录)
  - [术语定义](#术语定义-1)
  - [参考文档](#参考文档)

## 概述

### 文档目的
本文档通过用例图和详细用例描述的方式，全面展现中药材检验子系统的功能结构、业务流程和用户交互界面设计。用例图帮助开发团队和业务人员从不同视角理解系统功能，而详细的用例描述为开发、测试和验收提供具体的技术指导。

### 术语定义
- **用例图(Use Case Diagram)**：展示系统、参与者和用例之间关系的图形化表示
- **活动图(Activity Diagram)**：描述系统中各种活动的流程和顺序
- **序列图(Sequence Diagram)**：展示对象之间消息传递的时间顺序
- **用户界面原型(UI Prototype)**：系统界面的可视化设计原型
- **验收测试用例(Test Case)**：验证用例是否正确实现的具体测试步骤

## 系统总体用例图

```
┌─────────────────────────────────────────────────────────────────┐
│                     中药材检验子系统总体用例图                        │
│  +────────────────────────────────────────────────────────────+  │
│  │                        系统边界                               │  │
│  │  ┌─────────────────────────────────────────────────────────┐  │  │
│  │  │                                                         │  │  │
│  │  │  (中药材检验员)      (质量审核员)      (实验室主任)      (中药资源管理员) │  │  │
│  │  │                                                         │  │  │
│  │  │    │                   │                 │              │  │  │  │
│  │  │    │                   │                 │              │  │  │  │
│  │  │    ▼                   ▼                 ▼              ▼  │  │  │
│  │  │                                                         │  │  │
│  │  │  ┌─────────────────┬─────────────────┬─────────────────┐ │  │  │
│  │  │  │  样品管理         │  检测执行        │  质量审核        │ │  │  │
│  │  │  │                 │                 │                 │ │  │  │
│  │  │  │ ◆ 样品登记      │ ◆ 项目选择      │ ◆ 结果审核      │ │  │  │
│  │  │  │ ◆ 状态跟踪      │ ◆ 数据录入      │ ◆ 标准比对      │ │  │  │
│  │  │  │ ◆ 处置管理      │ ◆ 参数设置      │ ◆ 判定下发      │ │  │  │
│  │  │  │                 │ ◆ 仪器集成      │                 │ │  │  │
│  │  │  └─────────────────┴─────────────────┴─────────────────┘ │  │  │
│  │  │                                                         │  │  │
│  │  │  ┌─────────────────┬─────────────────┬─────────────────┐ │  │  │
│  │  │  │  方法管理         │  报告生成        │  统计分析        │ │  │  │
│  │  │  │                 │                 │                 │ │  │  │
│  │  │  │ ◆ 标准库维护    │ ◆ 模板管理      │ ◆ 趋势分析      │ │  │  │
│  │  │  │ ◆ 版本控制      │ ◆ 自动生成      │ ◆ 质量报告      │ │  │  │
│  │  │  │ ◆ 验证体系      │ ◆ 审核分发      │ ◆ 数据导出      │ │  │  │
│  │  │  └─────────────────┴─────────────────┴─────────────────┘ │  │  │
│  │  │                                                         │  │  │
│  │  └─────────────────────────────────────────────────────────┘  │  │
│  │                                                                │  │
│  │  次要参与者:                                                    │  │
│  │  ┌─────────────────────────────────────────────────────────────┐ │  │
│  │  │ 外部接口：                                                    │  │
│  │  │ ◆ ERP系统 (采购订单)                                       │  │
│  │  │ ◆ WMS系统 (库存信息)                                       │  │
│  │  │ ◆ MES系统 (生产批次)                                       │  │
│  │  │ ◆ QMS系统 (质量问题)                                       │  │
│  │  │ ◆ LIMS系统 (检测数据共享)                                 │  │
│  │  └─────────────────────────────────────────────────────────────┘ │  │
│  └────────────────────────────────────────────────────────────────────┘
│                                                                         │
│ <<include>> 包含关系                                                    │
│ <<extend>>  扩展关系                                                     │
│ <<extend>>  扩展关系  (检测执行 <<extend>> 质量审核)                  │
│ <<extend>>  扩展关系  (报告生成 <<extend>> 数据分析)                  │
│                                                                         │
│ 备注：用例间的关系通过<<include>>和<<extend>>表示系统功能模块的组织结构   │
└─────────────────────────────────────────────────────────────────────────┘
```

## 核心功能域用例图

### 1. 样品管理功能域用例图

```
样品管理功能域
├── 主参与者：中药材检验员、仓库管理员
├── 核心用例：
│   ├── 样品接收登记 (基本用例)
│   │   ├── 包含用例：
│   │   │   ├── 基本信息录入
│   │   │   ├── 供应商信息核对
│   │   │   └── 到货信息确认
│   ├── 样品状态跟踪 (查询用例)
│   │   ├── 扩展用例：
│   │   │   ├── 状态变更记录
│   │   │   ├── 进度可视化
│   │   │   └── 异常报警提醒
│   ├── 样品处置管理 (业务用例)
│   │   ├── 包含用例：
│   │   │   ├── 合格品入库
│   │   │   ├── 不合格品退货
│   │   │   └── 报废品销毁
│   └── 样品信息维护 (管理用例)
    ├── 包含用例：
        ├── 信息补录
        ├── 状态修改
        └── 历史查询
```

### 2. 检测执行功能域用例图

```
检测执行功能域
├── 主参与者：中药材检验员
├── 核心用例：
│   ├── 检测任务获取 (自动化用例)
│   │   ├── 包含用例：
│   │   │   ├── 任务推送通知
│   │   │   └── 优先级排序
│   ├── 检测准备 (前置用例)
│   │   ├── 包含用例：
│   │   │   ├── 样品准备
│   │   │   ├── 仪器校准
│   │   │   └── 试剂配制
│   ├── 检测执行 (核心用例)
│   │   ├── 扩展用例：
│   │   │   ├── 性状鉴定 <<extend>>
│   │   │   ├── 显微鉴别 <<extend>>
│   │   │   ├── 含量测定 <<extend>>
│   │   │   └── 限量检查 <<extend>>
│   ├── 数据录入 (录入用例)
│   │   ├── 包含用例：
│   │   │   ├── 手动录入
│   │   │   └── 仪器采集
│   └── 过程监控 (实时用例)
    ├── 包含用例：
        ├── 进度跟踪
        ├── 异常报警
        └── 参数监控
```

### 3. 质量审核功能域用例图

```
质量审核功能域
├── 主参与者：质量审核员、实验室主任
├── 核心用例：
│   ├── 审核任务接收 (触发用例)
│   │   ├── 包含用例：
│   │   │   ├── 任务自动分配
│   │   │   └── 审核提醒通知
│   ├── 技术审核 (核心用例)
│   │   ├── 包含用例：
│   │   │   ├── 数据完整性检查
│   │   │   ├── 方法合规性验证
│   │   │   └── 结果合理性评估
│   ├── 质量判定 (决策用例)
│   │   ├── 扩展用例：
│   │   │   ├── 合格判定 <<extend>>
│   │   │   ├── 不合格判定 <<extend>>
│   │   │   └── 复检判定 <<extend>>
│   ├── 审核意见录入 (记录用例)
│   │   ├── 包含用例：
│   │   │   ├── 文字意见
│   │   │   ├── 数字签名
│   │   │   └── 审核历史
│   └── 审核结果发布 (输出用例)
    ├── 包含用例：
        ├── 内部通知
        ├── 外部反馈
        └── 档案归档
```

## 详细用例描述

### 用例UC001：中药材样品接收登记

**用例标识**: UC001
**用例名称**: 中药材样品接收登记
**范围**: 中药材检验子系统
**级别**: 用户目标级
**主要参与者**: 检验员
**涉众**: 仓库管理员、质量部门、采购部门
**优先级**: 高

**前置条件**:
- 用户已成功登录系统
- 具备样品登记操作权限
- 中药材到货通知已接收

**后置条件**:
- 样品信息成功保存到数据库
- 生成唯一的样品编号
- 触发后续检验流程

**主场景** (成功路径):
1. 用户点击"样品管理" → "样品接收"菜单
2. 系统显示样品接收登记界面
3. 用户扫描或手动输入中药材名称
4. 系统自动填充药材基本信息（产地、质量标准等）
5. 用户补充录入供应商信息、批次号、生产日期、保质期
6. 用户检查并确认包装、外观、气味等现场信息
7. 用户上传样品包装照片和现场照片
8. 系统验证必填字段完整性
9. 系统自动生成样品编号（格式：CMT-20251123-001）
10. 用户确认提交，系统提示登记成功
11. 系统自动创建检验任务并分配给检验员
12. 系统发送检验通知给相关人员

**异常场景**:
- **场景E1**: 信息不完整
  - 系统检测到必填字段为空
  - 显示红色提示信息
  - 用户无法提交，直到补充完整信息
- **场景E2**: 中药材信息不存在
  - 系统未找到对应中药材标准信息
  - 提示"中药材信息不存在，请联系管理员维护"
  - 暂停登记流程，等待信息补全
- **场景E3**: 网络故障
  - 系统检测到网络连接异常
  - 允许离线暂存登记信息
  - 网络恢复后自动同步数据

**替代场景**:
- **场景A1**: 批量登记（5种以上中药材）
  - 用户选择"批量导入"功能
  - 上传Excel文件格式的样品清单
  - 系统批量验证并生成样品编号
  - 统一的检验任务分配策略

**业务规则**:
- BR1: 样品名称必须与标准库中药材名称完全匹配
- BR2: 生产日期不能超过当前日期，保质期必须大于等于当前日期+30天
- BR3: 样品编号在全系统中唯一，不可重复
- BR4: 所有登记信息必须有电子签名确认操作人身份
- BR5: 照片上传至少需要包装照片和外观照片各一张

### 用例UC010：含量测定检测执行

**用例标识**: UC010
**用例名称**: 含量测定检测执行
**范围**: 中药材检验子系统
**级别**: 子功能级
**主要参与者**: 检验员
**涉众**: 质量审核员、实验室主任
**优先级**: 高

**前置条件**:
- 含量测定任务已分配给当前检测员
- HPLC仪器已校准并处于正常工作状态
- 所需标准品和试剂材料已备齐

**后置条件**:
- 含量测定数据完整记录到系统
- 数据初步验证自动完成
- 检测任务状态更新为"完成待审核"

**主场景** (成功路径):
1. 用户打开"检测任务"列表页面
2. 选择分配给自己的含量测定任务
3. 系统显示任务详情和检测方法标准
4. 用户确认仪器状态和配备齐全性
5. 用户按照SOP进行检测准备：
   - 检查HPLC仪器的运行状态
   - 准备对照品和标准溶液
   - 配置分析参数（波长、流速、柱温等）
6. 用户执行样品制备：
   - 精确称量中药材粉末
   - 添加提取溶剂，超声提取或加热回流
   - 过滤和定容处理
   - 进样前过滤和稀释
7. 用户设置HPLC分析条件：
   - 选择色谱柱类型和规格
   - 配置流动相梯度程序
   - 设置检测波长和灵敏度
   - 设定运行时间和停止条件
8. 用户启动仪器分析：
   - 系统自动采集色谱数据
   - 实时显示色谱图和数据变化
   - 参数实时监控和异常报警
9. 用户记录分析结果：
   - 系统自动计算峰面积和保留时间
   - 用户校核检测结果合理性
   - 确认无数据异常后提交结果
10. 系统自动触发初步数据验证
11. 检测任务状态更新并通知审核人员

**异常场景**:
- **场景E1**: 仪器故障
  - HPLC仪器报警提示异常状态
  - 系统中断检测流程并记录异常
  - 检验员申请设备维护，任务暂停
- **场景E2**: 标准品过期
  - 系统检测标准品有效期即将过期
  - 提醒检验员更换标准品
  - 必要时重新校准标准曲线
- **场景E3**: 数据异常
  - 系统检测到峰形异常或浓度超标
  - 自动标记可疑数据
  - 提示检验员复检确认或重新制样

**业务规则**:
- BR1: 含量测定必须使用经校准的HPLC系统
- BR2: 标准曲线的相关系数R²必须≥0.9995
- BR3: 样品平行测定次数不少于2次，差异不超过±2%
- BR4: 检测数据必须实时记录，不允许事后补录
- BR5: 仪器运行参数必须与方法标准严格一致

## 用户界面原型

### 1. 中药材样品登记界面原型

```
┌─────────────────────────────────────────────────────────────────┐
│ 中药材检验子系统 - 样品接收登记                                     │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────────┬─────────────────┬─────────────────┐        │
│  │ 基本信息              │ 供应商信息          │ 到货信息          │        │
│  ├─────────────────┼─────────────────┼─────────────────┤        │
│  │ 药材名称: [    ]   │ 供应商: [    ]     │ 到货日期: [    ]   │        │
│  │ 批次号: [    ]     │ 联系人: [    ]     │ 运输方式: [    ]   │        │
│  │ 规格: [    ]       │ 电话: [    ]       │ 车牌号: [    ]     │        │
│  │ 数量: [    ]       │ 地址: [    ]       │ 司机: [    ]       │        │
│  └─────────────────┴─────────────────┴─────────────────┘        │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────┐      │
│  │ 质量初检                                                     │      │
│  ├─────────────────────────────────────────────────────────┤      │
│  │ □ 包装完整  □ 外观正常  □ 气味正常                        │      │
│  │ □ 水分合格  □ 杂质正常  □ 道地性可辨                      │      │
│  │ 备注: [                                               ]     │      │
│  └─────────────────────────────────────────────────────────┘      │
│                                                                     │
│  ┌─────────────────┬─────────────────┬─────────────────┐        │
│  │ [照片上传]           │ [照片上传]           │ [照片上传]       │        │
│  │ 包装照片             │ 外观照片             │ 现场照片         │        │
│  └─────────────────┴─────────────────┴─────────────────┘        │
│                                                                     │
│  ┌─────────────────┐  ┌─────────────────┐                       │
│  │    [登记]         │  │   [重置]         │                       │
│  └─────────────────┘  └─────────────────┘                       │
├─────────────────────────────────────────────────────────────────┤
│ 系统提示: 样品编号将自动生成: CMT-20251123-001                     │
└─────────────────────────────────────────────────────────────────┘
```

### 2. 检测执行界面原型

```
┌─────────────────────────────────────────────────────────────────┐
│ 中药材检验子系统 - 含量测定执行                                   │
├─────────────────────────────────────────────────────────────────┤
│ 任务信息: 当归(HPLC含量测定) 任务号: DET-20251123-001          │
│ 样品信息: 当归切片 批次: DG20251120-001                          │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────────┬─────────────────────────────────────┐       │
│  │ 检测准备            │ 样品制备                              │       │
│  ├─────────────────┼─────────────────────────────────────┤       │
│  │ □ 仪器检查         │ 1. 称量3.0g样品粉末                  │       │
│  │ □ 试剂备齐         │ 2. 添加50ml甲醇，超声提取30min       │       │
│  │ □ 方法确认         │ 3. 过滤，定容至100ml                 │       │
│  │ □ 数据系统准备     │ 4. 取上清液，0.45μm过滤             │       │
│  └─────────────────┴─────────────────────────────────────┘       │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────┐      │
│  │ HPLC分析参数设置                                            │      │
│  ├─────────────────────────────────────────────────────────┤      │
│  │ 色谱柱: C18 150×4.6mm    波长: 254nm     流速: 1.0ml/min │      │
│  │ 柱温: 25℃                进样量: 10μl     运行时间: 30min │      │
│  │ 流动相A: 水              流动相B: 乙腈                        │      │
│  │ 梯度程序: [编辑...]                                          │      │
│  └─────────────────────────────────────────────────────────┘      │
│                                                                     │
│  ┌─────────────────┬─────────────────────────────────────┐       │
│  │ 系统状态          │ 实时检测数据                           │       │
│  ├─────────────────┼─────────────────────────────────────┤       │
│  │ ● 仪器正常        │ 检测时间: 00:05:23                     │       │
│  │ ● 平衡完成        │ 当前峰数: 12个                        │       │
│  │ ● 检测中          │ 主峰面积: 2456789 mAU*min             │       │
│  └─────────────────┴─────────────────────────────────────┘       │
│                                                                     │
│  ┌─────────────┬─────────────┬─────────────┬─────────────┐        │
│  │ 暂停检测      │ 停止检测      │ 查看色谱图   │ 数据导出      │        │
│  └─────────────┴─────────────┴─────────────┴─────────────┘        │
├─────────────────────────────────────────────────────────────────┤
│ SOP指导: 当前步骤 - 执行仪器检测，观察色谱峰形是否正常           │
└─────────────────────────────────────────────────────────────────┘
```

## 验收测试用例

### 1. 功能测试用例

#### 测试用例TC001：样品登记功能测试

**用例ID**: TC001
**用例名称**: 样品登记功能完整性测试
**测试目标**: 验证样品登记功能的完整性和正确性
**测试环境**: 测试环境，样品数据库预加载标准数据
**前置条件**: 测试用户已登录，具有样品登记权限

**测试步骤**:
1. 登录系统，选择"样品管理">"样品接收"功能
2. 点击"新增样品"按钮
3. 输入以下信息：
   - 药材名称：当归
   - 批次号：DG20251120-001
   - 供应商：甘肃中医药研究所
   - 生产日期：2025-11-20
   - 保质期：2027-11-20
   - 数量：100kg
4. 上传包装照片一张，外观照片一张
5. 检查水分含量：合格
6. 点击"保存"按钮
7. 观察系统反应和界面变化
8. 验证数据库中是否正确保存了样品信息
9. 检查是否生成了检验任务

**预期结果**:
- 系统成功保存样品信息
- 自动生成样品编号格式为"CMT-20251123-XXX"
- 界面显示"登记成功"提示信息
- 数据库中新增一条完整样品记录
- 系统自动创建对应检验任务
- 相关人员收到检验通知

**实际结果**: [测试执行时填写]
**测试状态**: [通过/失败/阻塞]
**备注**: [发现的问题和建议]

#### 测试用例TC010：HPLC含量测定测试

**用例ID**: TC010
**用例名称**: HPLC含量测定功能测试
**测试目标**: 验证HPLC含量测定功能的自动化和准确性
**测试环境**: 测试环境，已连接HPLC模拟仪器的集成环境
**前置条件**: 含量测定任务已分配给测试用户

**测试步骤**:
1. 登录系统，进入"检测执行"模块
2. 选择含量测定任务（当归含量测定）
3. 验证仪器状态显示为"正常"
4. 检查系统显示的检测方法和参数
5. 开始检测准备流程
6. 执行样品制备步骤
7. 设置HPLC分析参数
8. 启动检测程序
9. 监控实时检测数据
10. 停止检测后查看检测结果
11. 提交检测结果进行审核

**预期结果**:
- SOP显示清晰完整
- 仪器参数设置正确无误
- 色谱数据实时采集正常
- 含量计算结果在预期范围内
- 检测报告自动生成完整
- 审核流程正确触发

**实际结果**: [测试执行时填写]
**测试状态**: [通过/失败/阻塞]
**备注**: [发现的问题和建议]

### 2. 性能测试用例

#### 测试用例TC_PERF_001：并发检测任务处理

**用例ID**: TC_PERF_001
**用例名称**: 多用户并发检测任务处理性能测试
**测试目标**: 验证系统在多用户并发操作下的性能表现
**测试环境**: 性能测试环境，配置8核CPU，16GB内存
**前置条件**: 系统已部署正常运行，预加载测试数据

**测试步骤**:
1. 使用LoadRunner工具配置20个虚拟用户
2. 每个用户执行完整的检测任务流程（从任务获取到结果提交）
3. 设置思考时间为2-5秒，模拟真实用户操作
4. 运行测试脚本持续执行30分钟
5. 监控系统资源使用情况：
   - CPU使用率
   - 内存使用率
   - 磁盘I/O
   - 网络I/O
6. 收集响应时间统计数据：
   - 页面加载时间
   - 数据提交时间
   - 查询响应时间
7. 统计事务成功率和错误率

**性能指标**:
- 平均响应时间：<3秒（90%事务）
- 事务成功率：≥99%
- CPU使用率：<70%
- 内存使用率：<80%
- 系统稳定性：无服务崩溃或重启

**性能瓶颈分析**: [测试执行时填写]

### 3. 安全性测试用例

#### 测试用例TC_SEC_001：数据访问权限控制测试

**用例ID**: TC_SEC_001
**用例名称**: 用户权限访问控制测试
**测试目标**: 验证不同角色用户的访问权限控制是否正确
**测试环境**: 安全测试环境，已配置不同权限的用户账户

**测试步骤**:
1. 使用检验员账户登录系统
2. 尝试访问所有功能模块，记录可访问和不可访问的功能
3. 切换到质量审核员账户，重复步骤2
4. 再次切换到实验室主任账户，重复步骤2
5. 最后使用中药资源管理员账户，重复步骤2
6. 验证数据查看权限：
   - 检验员只能查看自己负责的样品和检测数据
   - 审核员可以查看部门内所有数据
   - 主任可以查看实验室所有数据
   - 管理员可以查看系统所有数据
7. 测试越权访问操作：
   - 尝试修改不属于自己权限范围的数据
   - 尝试删除超出权限的数据记录

**安全要求检查**:
- ✅ 功能权限控制正确
- ✅ 数据查看权限隔离
- ✅ 操作权限控制有效
- ✅ 越权操作被拒绝并记录

---

**文档信息：**
- 版本：v1.0
- 更新日期：2025年11月23日
- 编制人员：中药检验子系统用例设计团队
- 审核状态：待审核
- 备注：提供系统开发的详细技术指导和验收测试依据

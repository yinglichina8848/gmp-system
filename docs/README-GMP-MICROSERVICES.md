# GMP系统微服务架构文档

## 1. 系统概述

GMP系统是一个基于微服务架构的企业级医药生产管理系统，严格遵循GMP（Good Manufacturing Practice）规范，确保药品生产全过程的质量控制和合规管理。

## 2. 微服务架构图

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                                    客户端                                      │
├─────────────────────────────────────────────────────────────────────────────────┤
│                              API网关 (Gateway)                               │
├─────────────────────────────────────────────────────────────────────────────────┤
│            服务注册发现         负载均衡         配置中心         消息总线       │
├─────────────────────────────────────────────────────────────────────────────────┤
│  认证服务  │  质量管理  │  生产执行  │  实验室信息  │  电子文档  │  设备管理  │  人力资源  │
│ (Auth)   │  (QMS)   │  (MES)   │  (LIMS)   │ (EDMS)  │ (Equip.) │  (HR)    │
├─────────────────────────────────────────────────────────────────────────────────┤
│  培训管理  │  仓库管理  │ CRM销售  │ 配置服务 │ 消息服务 │ 监控中心 │ 链路追踪 │
│ (Train.) │ (Wareh.) │ (CRM)   │ (Conf.) │ (Msg.) │ (Monit.) │ (Trace) │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 3. 服务目录结构

```
gmp-system/
├── infrastructure/                 # 基础设施
│   ├── docker-compose.yml         # Docker编排文件
│   ├── kubernetes/                # K8s部署配置
│   └── nginx/                     # Nginx配置
│
├── services/                      # 微服务模块
│   ├── auth-service/              # 认证服务
│   ├── qms-service/               # 质量管理服务
│   ├── mes-service/               # 生产执行服务
│   ├── lims-service/              # 实验室信息管理服务
│   ├── edms-service/              # 电子文档管理系统
│   ├── equipment-management/      # 设备管理服务
│   ├── hr-management/             # 人力资源管理服务
│   ├── training-management/       # 培训管理服务
│   ├── warehouse-service/         # 仓库管理服务
│   ├── crm-sales/                 # CRM销售服务
│   ├── config-service/            # 配置服务
│   ├── message-service/           # 消息服务
│   └── gateway/                   # 网关服务
│
├── docs/                          # 文档中心
│   ├── auth-service/              # 认证服务文档
│   ├── qms-service/               # 质量管理服务文档
│   ├── mes-service/               # 生产执行服务文档
│   ├── lims-service/              # 实验室信息管理文档
│   ├── edms/                     # 电子文档管理文档
│   ├── equipment-management/      # 设备管理文档
│   ├── hr-management/             # 人力资源管理文档
│   ├── training-management/       # 培训管理文档
│   ├── warehouse-service/         # 仓库管理文档
│   ├── crm-sales/                 # CRM销售文档
│   ├── config-service/            # 配置服务文档
│   ├── message-service/           # 消息服务文档
│   ├── 部署指南/                  # 部署指南文档
│   ├── 运维手册/                  # 运维手册文档
│   ├── API文档/                   # API接口文档
│   ├── 开发规范/                  # 开发规范文档
│   ├── 测试计划/                  # 测试计划文档
│   └── 测试报告/                  # 测试报告文档
│
├── scripts/                       # 脚本工具
│   ├── start-dev.sh              # 开发环境启动脚本
│   ├── stop-dev.sh               # 开发环境停止脚本
│   └── deploy.sh                 # 部署脚本
│
└── logs/                         # 日志目录
    ├── auth-service.log
    ├── qms-service.log
    └── ...                       # 各服务日志文件
```

## 4. 核心服务介绍

### 4.1 业务服务

1. **认证服务 (auth-service)**
   - 用户认证与授权
   - 角色权限管理
   - JWT令牌生成与验证

2. **质量管理服务 (qms-service)**
   - 质量标准管理
   - 质量检验流程
   - 不合格品处理

3. **生产执行服务 (mes-service)**
   - 生产计划管理
   - 工艺流程控制
   - 生产数据采集

4. **实验室信息管理服务 (lims-service)**
   - 实验任务管理
   - 检验数据记录
   - 质检报告生成

5. **电子文档管理系统 (edms-service)**
   - 文档生命周期管理
   - 版本控制与审批
   - 电子签名支持

6. **设备管理服务 (equipment-management)**
   - 设备台账管理
   - 校准维护计划
   - 故障维修记录

7. **人力资源管理服务 (hr-management)**
   - 员工信息管理
   - 组织架构维护
   - 薪酬福利管理

8. **培训管理服务 (training-management)**
   - 培训需求分析
   - 培训计划执行
   - 培训效果评估

9. **仓库管理服务 (warehouse-service)**
   - 库存管理
   - 出入库操作
   - 盘点作业

10. **CRM销售服务 (crm-sales)**
    - 客户信息管理
    - 销售机会跟踪
    - 订单处理

### 4.2 基础设施服务

1. **配置服务 (config-service)**
   - 集中配置管理
   - 配置动态刷新
   - 环境隔离配置

2. **消息服务 (message-service)**
   - 消息发布订阅
   - 异步通信支持
   - 消息持久化存储

3. **网关服务 (gateway)**
   - 请求路由转发
   - 负载均衡
   - 限流熔断

## 5. 技术栈

- **开发语言**: Java 17
- **框架**: Spring Boot 3.x, Spring Cloud 2022.x
- **数据库**: PostgreSQL, Redis
- **消息队列**: RabbitMQ
- **服务注册**: Eureka
- **配置中心**: Spring Cloud Config
- **API网关**: Spring Cloud Gateway
- **容器化**: Docker, Kubernetes
- **监控**: Prometheus + Grafana
- **链路追踪**: SkyWalking
- **文档**: Swagger/OpenAPI

## 6. 部署架构

### 6.1 开发环境
```
┌─────────────────────────────────────────────────────────────┐
│                    开发工作站 (Windows/Linux/Mac)           │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │   Docker    │  │   Docker    │  │   Docker    │         │
│  │ PostgreSQL  │  │   Redis     │  │  RabbitMQ   │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
│                                                             │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │            各微服务实例 (通过Docker Compose)           │ │
│  └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

### 6.2 生产环境
```
┌─────────────────────────────────────────────────────────────┐
│                        负载均衡器                           │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │ Kubernetes  │  │ Kubernetes  │  │ Kubernetes  │         │
│  │   Node 1    │  │   Node 2    │  │   Node 3    │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
│                                                             │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │             各微服务Pods (通过K8s部署)                 │ │
│  └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

## 7. 运行说明

### 7.1 环境准备
1. 安装JDK 17
2. 安装Docker和Docker Compose
3. 安装Maven 3.8+

### 7.2 启动服务
```bash
# 启动基础设施服务
docker-compose -f infrastructure/docker-compose.yml up -d

# 启动所有微服务
./scripts/start-dev.sh
```

### 7.3 停止服务
```bash
# 停止所有微服务
./scripts/stop-dev.sh

# 停止基础设施服务
docker-compose -f infrastructure/docker-compose.yml down
```

## 8. 文档说明

详细文档请参考 [docs](docs) 目录下的各服务文档。

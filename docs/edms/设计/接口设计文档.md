# EDMS接口设计文档

## 1. 概述

本文档详细描述了电子文档管理系统(EDMS)的接口设计，包括内部API接口和外部集成接口。接口设计基于RESTful API规范，提供统一、标准、易用的接口，支持EDMS系统的各项功能，同时便于与外部系统进行集成。

## 2. 接口设计原则

### 2.1 RESTful API设计原则

- **资源导向**: 以资源为中心设计API，使用名词表示资源
- **HTTP方法**: 使用标准HTTP方法(GET/POST/PUT/DELETE)表示操作
- **状态码**: 使用标准HTTP状态码表示响应状态
- **无状态**: API设计为无状态，便于水平扩展
- **版本控制**: API支持版本控制，确保向后兼容
- **HATEOAS**: 支持HATEOAS原则，提供资源间的导航

### 2.2 接口安全原则

- **认证授权**: 所有接口均需认证和授权
- **HTTPS传输**: 使用HTTPS确保数据传输安全
- **参数验证**: 严格验证所有输入参数
- **防注入攻击**: 防止SQL注入、XSS等攻击
- **接口限流**: 对接口进行限流，防止滥用
- **敏感信息保护**: 敏感信息加密传输和存储

### 2.3 接口性能原则

- **响应时间**: 接口响应时间控制在合理范围内
- **分页机制**: 列表接口支持分页，避免返回大量数据
- **压缩传输**: 支持数据压缩传输，减少带宽占用
- **缓存机制**: 合理使用缓存，提高接口响应速度
- **异步处理**: 非实时操作使用异步处理

## 3. API网关设计

### 3.1 网关功能

- **请求路由**: 将请求路由到相应的微服务
- **认证授权**: 统一的认证和授权机制
- **负载均衡**: 在多个服务实例间进行负载均衡
- **限流熔断**: 接口限流和服务熔断保护
- **日志记录**: 请求日志记录和跟踪
- **协议转换**: 支持不同协议间的转换
- **错误处理**: 统一的错误处理和响应格式

### 3.2 网关配置

- **路由配置**: 基于路径、请求头的路由规则
- **过滤器配置**: 前置过滤器、后置过滤器
- **安全配置**: 认证方式、加密算法
- **限流配置**: 基于IP、用户的限流规则
- **监控配置**: 指标收集、健康检查

## 4. 内部API接口设计

### 4.1 文档管理接口

#### 4.1.1 创建文档

- **API路径**: `/api/v1/documents`
- **方法**: `POST`
- **功能描述**: 创建新文档
- **请求体**:
```json
{
  "title": "文档标题",
  "description": "文档描述",
  "metadata": {"category": "技术文档", "author": "张三"},
  "templateId": 123
}
```
- **响应体**:
```json
{
  "id": 1,
  "title": "文档标题",
  "description": "文档描述",
  "status": "DRAFT",
  "currentVersion": 1,
  "createdBy": "user1",
  "createdAt": "2023-11-01T10:00:00Z",
  "links": {
    "self": "/api/v1/documents/1",
    "content": "/api/v1/documents/1/content"
  }
}
```
- **状态码**:
  - 201 Created: 创建成功
  - 400 Bad Request: 请求参数错误
  - 401 Unauthorized: 未认证
  - 403 Forbidden: 无权限

#### 4.1.2 获取文档详情

- **API路径**: `/api/v1/documents/{id}`
- **方法**: `GET`
- **功能描述**: 获取文档详细信息
- **路径参数**:
  - `id`: 文档ID
- **查询参数**:
  - `version`: 文档版本号(可选，默认为最新版本)
- **响应体**:
```json
{
  "id": 1,
  "title": "文档标题",
  "description": "文档描述",
  "contentType": "application/pdf",
  "size": 102400,
  "metadata": {"category": "技术文档", "author": "张三"},
  "status": "APPROVED",
  "currentVersion": 2,
  "createdBy": "user1",
  "createdAt": "2023-11-01T10:00:00Z",
  "updatedBy": "user2",
  "updatedAt": "2023-11-02T15:30:00Z",
  "links": {
    "self": "/api/v1/documents/1",
    "content": "/api/v1/documents/1/content",
    "versions": "/api/v1/documents/1/versions",
    "workflow": "/api/v1/documents/1/workflow"
  }
}
```
- **状态码**:
  - 200 OK: 获取成功
  - 401 Unauthorized: 未认证
  - 403 Forbidden: 无权限
  - 404 Not Found: 文档不存在

#### 4.1.3 上传文档内容

- **API路径**: `/api/v1/documents/{id}/content`
- **方法**: `PUT`
- **功能描述**: 上传文档内容
- **路径参数**:
  - `id`: 文档ID
- **请求体**:
  - MultipartFile: 文件内容
- **响应体**:
```json
{
  "id": 1,
  "title": "文档标题",
  "contentType": "application/pdf",
  "size": 102400,
  "currentVersion": 2,
  "updatedAt": "2023-11-02T15:30:00Z"
}
```
- **状态码**:
  - 200 OK: 上传成功
  - 400 Bad Request: 请求参数错误
  - 401 Unauthorized: 未认证
  - 403 Forbidden: 无权限
  - 404 Not Found: 文档不存在

#### 4.1.4 下载文档内容

- **API路径**: `/api/v1/documents/{id}/content`
- **方法**: `GET`
- **功能描述**: 下载文档内容
- **路径参数**:
  - `id`: 文档ID
- **查询参数**:
  - `version`: 文档版本号(可选，默认为最新版本)
- **响应体**:
  - 文件流
- **状态码**:
  - 200 OK: 下载成功
  - 401 Unauthorized: 未认证
  - 403 Forbidden: 无权限
  - 404 Not Found: 文档不存在

#### 4.1.5 查询文档列表

- **API路径**: `/api/v1/documents`
- **方法**: `GET`
- **功能描述**: 按条件查询文档列表
- **查询参数**:
  - `page`: 页码，默认1
  - `size`: 每页数量，默认20
  - `title`: 标题模糊匹配
  - `status`: 文档状态过滤
  - `category`: 分类过滤
  - `createdBy`: 创建者过滤
  - `createdFrom`: 创建开始时间
  - `createdTo`: 创建结束时间
  - `sort`: 排序字段和方向，如"createdAt,desc"
- **响应体**:
```json
{
  "content": [
    {
      "id": 1,
      "title": "文档标题1",
      "status": "APPROVED",
      "currentVersion": 2,
      "createdBy": "user1",
      "createdAt": "2023-11-01T10:00:00Z",
      "links": {
        "self": "/api/v1/documents/1",
        "content": "/api/v1/documents/1/content"
      }
    },
    {
      "id": 2,
      "title": "文档标题2",
      "status": "DRAFT",
      "currentVersion": 1,
      "createdBy": "user2",
      "createdAt": "2023-11-02T15:00:00Z",
      "links": {
        "self": "/api/v1/documents/2",
        "content": "/api/v1/documents/2/content"
      }
    }
  ],
  "page": 1,
  "size": 20,
  "totalElements": 156,
  "totalPages": 8,
  "first": true,
  "last": false,
  "links": {
    "self": "/api/v1/documents?page=1&size=20",
    "next": "/api/v1/documents?page=2&size=20",
    "last": "/api/v1/documents?page=8&size=20"
  }
}
```
- **状态码**:
  - 200 OK: 查询成功
  - 401 Unauthorized: 未认证
  - 403 Forbidden: 无权限

#### 4.1.6 更新文档信息

- **API路径**: `/api/v1/documents/{id}`
- **方法**: `PUT`
- **功能描述**: 更新文档信息
- **路径参数**:
  - `id`: 文档ID
- **请求体**:
```json
{
  "title": "更新后的文档标题",
  "description": "更新后的文档描述",
  "metadata": {"category": "更新后的分类", "author": "张三"}
}
```
- **响应体**:
```json
{
  "id": 1,
  "title": "更新后的文档标题",
  "description": "更新后的文档描述",
  "metadata": {"category": "更新后的分类", "author": "张三"},
  "updatedBy": "user1",
  "updatedAt": "2023-11-03T09:00:00Z",
  "links": {
    "self": "/api/v1/documents/1"
  }
}
```
- **状态码**:
  - 200 OK: 更新成功
  - 400 Bad Request: 请求参数错误
  - 401 Unauthorized: 未认证
  - 403 Forbidden: 无权限
  - 404 Not Found: 文档不存在

#### 4.1.7 删除文档

- **API路径**: `/api/v1/documents/{id}`
- **方法**: `DELETE`
- **功能描述**: 删除文档
- **路径参数**:
  - `id`: 文档ID
- **响应体**:
```json
{
  "success": true,
  "message": "文档删除成功"
}
```
- **状态码**:
  - 200 OK: 删除成功
  - 401 Unauthorized: 未认证
  - 403 Forbidden: 无权限
  - 404 Not Found: 文档不存在

### 4.2 版本控制接口

#### 4.2.1 创建新版本

- **API路径**: `/api/v1/documents/{id}/versions`
- **方法**: `POST`
- **功能描述**: 创建文档新版本
- **路径参数**:
  - `id`: 文档ID
- **请求体**:
```json
{
  "changeDescription": "版本变更说明",
  "versionName": "V2.0",
  "content": "文件内容(文件流)"
}
```
- **响应体**:
```json
{
  "id": 2,
  "documentId": 1,
  "versionNumber": 2,
  "versionName": "V2.0",
  "changeDescription": "版本变更说明",
  "createdBy": "user1",
  "createdAt": "2023-11-02T15:30:00Z",
  "links": {
    "self": "/api/v1/documents/1/versions/2",
    "content": "/api/v1/documents/1/versions/2/content"
  }
}
```
- **状态码**:
  - 201 Created: 创建成功
  - 400 Bad Request: 请求参数错误
  - 401 Unauthorized: 未认证
  - 403 Forbidden: 无权限
  - 404 Not Found: 文档不存在

#### 4.2.2 获取版本列表

- **API路径**: `/api/v1/documents/{id}/versions`
- **方法**: `GET`
- **功能描述**: 获取文档的所有版本
- **路径参数**:
  - `id`: 文档ID
- **响应体**:
```json
[
  {
    "id": 2,
    "documentId": 1,
    "versionNumber": 2,
    "versionName": "V2.0",
    "changeDescription": "版本变更说明",
    "createdBy": "user1",
    "createdAt": "2023-11-02T15:30:00Z",
    "isCurrent": true,
    "links": {
      "self": "/api/v1/documents/1/versions/2",
      "content": "/api/v1/documents/1/versions/2/content"
    }
  },
  {
    "id": 1,
    "documentId": 1,
    "versionNumber": 1,
    "versionName": "V1.0",
    "changeDescription": "初始版本",
    "createdBy": "user1",
    "createdAt": "2023-11-01T10:00:00Z",
    "isCurrent": false,
    "links": {
      "self": "/api/v1/documents/1/versions/1",
      "content": "/api/v1/documents/1/versions/1/content"
    }
  }
]
```
- **状态码**:
  - 200 OK: 获取成功
  - 401 Unauthorized: 未认证
  - 403 Forbidden: 无权限
  - 404 Not Found: 文档不存在

#### 4.2.3 版本对比

- **API路径**: `/api/v1/documents/{id}/versions/{versionId}/compare`
- **方法**: `GET`
- **功能描述**: 对比两个版本的差异
- **路径参数**:
  - `id`: 文档ID
  - `versionId`: 版本ID
- **查询参数**:
  - `targetVersionId`: 目标版本ID
- **响应体**:
```json
{
  "baseVersion": {
    "id": 1,
    "versionNumber": 1,
    "createdAt": "2023-11-01T10:00:00Z"
  },
  "targetVersion": {
    "id": 2,
    "versionNumber": 2,
    "createdAt": "2023-11-02T15:30:00Z"
  },
  "differences": [
    {
      "type": "INSERT",
      "line": 15,
      "content": "新增内容"
    },
    {
      "type": "DELETE",
      "line": 20,
      "content": "删除内容"
    },
    {
      "type": "MODIFY",
      "line": 25,
      "oldContent": "修改前内容",
      "newContent": "修改后内容"
    }
  ]
}
```
- **状态码**:
  - 200 OK: 对比成功
  - 400 Bad Request: 请求参数错误
  - 401 Unauthorized: 未认证
  - 403 Forbidden: 无权限
  - 404 Not Found: 文档或版本不存在

#### 4.2.4 版本回滚

- **API路径**: `/api/v1/documents/{id}/versions/{versionId}/rollback`
- **方法**: `POST`
- **功能描述**: 回滚到指定版本
- **路径参数**:
  - `id`: 文档ID
  - `versionId`: 版本ID
- **请求体**:
```json
{
  "reason": "回滚原因说明"
}
```
- **响应体**:
```json
{
  "id": 1,
  "title": "文档标题",
  "currentVersion": 3,
  "rolledBackFrom": 2,
  "rolledBackTo": 1,
  "rolledBackBy": "user1",
  "rolledBackAt": "2023-11-03T14:00:00Z",
  "links": {
    "self": "/api/v1/documents/1"
  }
}
```
- **状态码**:
  - 200 OK: 回滚成功
  - 400 Bad Request: 请求参数错误
  - 401 Unauthorized: 未认证
  - 403 Forbidden: 无权限
  - 404 Not Found: 文档或版本不存在

### 4.3 工作流接口

#### 4.3.1 创建工作流

- **API路径**: `/api/v1/workflows`
- **方法**: `POST`
- **功能描述**: 创建工作流定义
- **请求体**:
```json
{
  "name": "文档审批工作流",
  "description": "标准文档审批流程",
  "definition": {
    "start": "startEvent",
    "nodes": [
      {
        "id": "startEvent",
        "type": "START",
        "next": "reviewTask"
      },
      {
        "id": "reviewTask",
        "type": "TASK",
        "name": "技术审核",
        "assignee": "role:TECH_LEAD",
        "next": "approvalTask"
      },
      {
        "id": "approvalTask",
        "type": "TASK",
        "name": "管理层审批",
        "assignee": "role:MANAGER",
        "next": "endEvent"
      },
      {
        "id": "endEvent",
        "type": "END"
      }
    ]
  }
}
```
- **响应体**:
```json
{
  "id": 1,
  "name": "文档审批工作流",
  "description": "标准文档审批流程",
  "status": "DRAFT",
  "createdBy": "admin",
  "createdAt": "2023-11-01T09:00:00Z",
  "links": {
    "self": "/api/v1/workflows/1",
    "activate": "/api/v1/workflows/1/activate"
  }
}
```
- **状态码**:
  - 201 Created: 创建成功
  - 400 Bad Request: 请求参数错误
  - 401 Unauthorized: 未认证
  - 403 Forbidden: 无权限

#### 4.3.2 启动工作流实例

- **API路径**: `/api/v1/documents/{id}/workflows`
- **方法**: `POST`
- **功能描述**: 为文档启动工作流实例
- **路径参数**:
  - `id`: 文档ID
- **请求体**:
```json
{
  "workflowId": 1,
  "variables": {
    "reason": "文档发布审核"
  }
}
```
- **响应体**:
```json
{
  "id": 101,
  "workflowId": 1,
  "documentId": 1,
  "status": "ACTIVE",
  "startedBy": "user1",
  "startedAt": "2023-11-01T14:00:00Z",
  "links": {
    "self": "/api/v1/workflows/instances/101",
    "tasks": "/api/v1/workflows/instances/101/tasks"
  }
}
```
- **状态码**:
  - 201 Created: 启动成功
  - 400 Bad Request: 请求参数错误
  - 401 Unauthorized: 未认证
  - 403 Forbidden: 无权限
  - 404 Not Found: 文档或工作流不存在

#### 4.3.3 获取任务列表

- **API路径**: `/api/v1/tasks`
- **方法**: `GET`
- **功能描述**: 获取用户的任务列表
- **查询参数**:
  - `page`: 页码，默认1
  - `size`: 每页数量，默认20
  - `status`: 任务状态过滤
  - `workflowId`: 工作流ID过滤
  - `sort`: 排序字段和方向
- **响应体**:
```json
{
  "content": [
    {
      "id": 201,
      "workflowInstanceId": 101,
      "documentId": 1,
      "documentTitle": "文档标题",
      "name": "技术审核",
      "description": "请审核此文档",
      "status": "ASSIGNED",
      "assignee": "user2",
      "priority": 50,
      "createdAt": "2023-11-01T14:00:00Z",
      "dueDate": "2023-11-03T14:00:00Z",
      "links": {
        "self": "/api/v1/tasks/201",
        "complete": "/api/v1/tasks/201/complete",
        "document": "/api/v1/documents/1"
      }
    }
  ],
  "page": 1,
  "size": 20,
  "totalElements": 5,
  "totalPages": 1
}
```
- **状态码**:
  - 200 OK: 获取成功
  - 401 Unauthorized: 未认证

#### 4.3.4 完成任务

- **API路径**: `/api/v1/tasks/{id}/complete`
- **方法**: `POST`
- **功能描述**: 完成任务
- **路径参数**:
  - `id`: 任务ID
- **请求体**:
```json
{
  "action": "APPROVE",
  "comment": "审核通过",
  "signature": {
    "password": "******",
    "reason": "审核文档内容"
  }
}
```
- **响应体**:
```json
{
  "id": 201,
  "status": "COMPLETED",
  "completedBy": "user2",
  "completedAt": "2023-11-02T10:30:00Z",
  "action": "APPROVE",
  "comment": "审核通过",
  "links": {
    "nextTask": "/api/v1/tasks/202" // 下一个任务
  }
}
```
- **状态码**:
  - 200 OK: 完成成功
  - 400 Bad Request: 请求参数错误
  - 401 Unauthorized: 未认证
  - 403 Forbidden: 无权限
  - 404 Not Found: 任务不存在

### 4.4 用户与权限接口

#### 4.4.1 创建用户

- **API路径**: `/api/v1/users`
- **方法**: `POST`
- **功能描述**: 创建新用户
- **请求体**:
```json
{
  "username": "newuser",
  "password": "Password123",
  "fullName": "新用户",
  "email": "newuser@example.com",
  "phone": "13800138000",
  "department": "IT部门",
  "position": "开发工程师"
}
```
- **响应体**:
```json
{
  "id": 101,
  "username": "newuser",
  "fullName": "新用户",
  "email": "newuser@example.com",
  "phone": "13800138000",
  "department": "IT部门",
  "position": "开发工程师",
  "status": "ACTIVE",
  "createdBy": "admin",
  "createdAt": "2023-11-01T09:00:00Z",
  "links": {
    "self": "/api/v1/users/101",
    "roles": "/api/v1/users/101/roles"
  }
}
```
- **状态码**:
  - 201 Created: 创建成功
  - 400 Bad Request: 请求参数错误
  - 401 Unauthorized: 未认证
  - 403 Forbidden: 无权限

#### 4.4.2 分配角色

- **API路径**: `/api/v1/users/{id}/roles`
- **方法**: `PUT`
- **功能描述**: 为用户分配角色
- **路径参数**:
  - `id`: 用户ID
- **请求体**:
```json
{
  "roleIds": [1, 2, 3]
}
```
- **响应体**:
```json
{
  "id": 101,
  "username": "newuser",
  "roles": [
    {
      "id": 1,
      "name": "文档查看者",
      "code": "DOCUMENT_VIEWER"
    },
    {
      "id": 2,
      "name": "文档编辑者",
      "code": "DOCUMENT_EDITOR"
    }
  ],
  "updatedBy": "admin",
  "updatedAt": "2023-11-01T10:00:00Z"
}
```
- **状态码**:
  - 200 OK: 分配成功
  - 400 Bad Request: 请求参数错误
  - 401 Unauthorized: 未认证
  - 403 Forbidden: 无权限
  - 404 Not Found: 用户不存在

### 4.5 电子签名接口

#### 4.5.1 创建电子签名

- **API路径**: `/api/v1/documents/{id}/signatures`
- **方法**: `POST`
- **功能描述**: 为文档创建电子签名
- **路径参数**:
  - `id`: 文档ID
- **请求体**:
```json
{
  "signatureType": "APPROVAL",
  "reason": "文档审批",
  "password": "******",
  "versionId": 2
}
```
- **响应体**:
```json
{
  "id": 301,
  "documentId": 1,
  "versionId": 2,
  "userId": 101,
  "username": "user1",
  "signatureType": "APPROVAL",
  "reason": "文档审批",
  "timestamp": "2023-11-01T15:00:00Z",
  "ipAddress": "192.168.1.100",
  "links": {
    "self": "/api/v1/signatures/301",
    "verify": "/api/v1/signatures/301/verify"
  }
}
```
- **状态码**:
  - 201 Created: 创建成功
  - 400 Bad Request: 请求参数错误
  - 401 Unauthorized: 未认证
  - 403 Forbidden: 无权限
  - 404 Not Found: 文档不存在

#### 4.5.2 验证电子签名

- **API路径**: `/api/v1/signatures/{id}/verify`
- **方法**: `GET`
- **功能描述**: 验证电子签名
- **路径参数**:
  - `id`: 签名ID
- **响应体**:
```json
{
  "valid": true,
  "signatureId": 301,
  "documentId": 1,
  "versionId": 2,
  "userId": 101,
  "username": "user1",
  "timestamp": "2023-11-01T15:00:00Z",
  "verificationTime": "2023-11-03T09:00:00Z"
}
```
- **状态码**:
  - 200 OK: 验证成功
  - 401 Unauthorized: 未认证
  - 404 Not Found: 签名不存在

### 4.6 审计日志接口

#### 4.6.1 查询审计日志

- **API路径**: `/api/v1/audit-logs`
- **方法**: `GET`
- **功能描述**: 查询审计日志
- **查询参数**:
  - `page`: 页码，默认1
  - `size`: 每页数量，默认20
  - `username`: 用户名过滤
  - `action`: 操作类型过滤
  - `resourceType`: 资源类型过滤
  - `resourceId`: 资源ID过滤
  - `fromTime`: 开始时间
  - `toTime`: 结束时间
  - `status`: 操作状态过滤
  - `sort`: 排序字段和方向
- **响应体**:
```json
{
  "content": [
    {
      "id": 401,
      "username": "user1",
      "action": "DOCUMENT_CREATE",
      "resourceType": "DOCUMENT",
      "resourceId": "1",
      "details": {
        "title": "文档标题",
        "status": "DRAFT"
      },
      "status": "SUCCESS",
      "ipAddress": "192.168.1.100",
      "userAgent": "Mozilla/5.0...",
      "createdAt": "2023-11-01T10:00:00Z"
    }
  ],
  "page": 1,
  "size": 20,
  "totalElements": 500,
  "totalPages": 25
}
```
- **状态码**:
  - 200 OK: 查询成功
  - 401 Unauthorized: 未认证
  - 403 Forbidden: 无权限

#### 4.6.2 导出审计日志

- **API路径**: `/api/v1/audit-logs/export`
- **方法**: `GET`
- **功能描述**: 导出审计日志
- **查询参数**:
  - 同查询参数，用于过滤要导出的日志
  - `format`: 导出格式(CVS/EXCEL/PDF)
- **响应体**:
  - 文件流
- **状态码**:
  - 200 OK: 导出成功
  - 401 Unauthorized: 未认证
  - 403 Forbidden: 无权限

## 5. 外部集成接口设计

### 5.1 与认证系统集成接口

#### 5.1.1 用户同步接口

- **API路径**: `/api/v1/integration/auth/users/sync`
- **方法**: `POST`
- **功能描述**: 同步用户数据
- **请求体**:
```json
{
  "users": [
    {
      "id": "EXT-1001",
      "username": "extuser1",
      "fullName": "外部用户1",
      "email": "extuser1@example.com",
      "department": "财务部",
      "roles": ["ROLE_FINANCE", "ROLE_VIEWER"]
    }
  ],
  "operation": "SYNC" // SYNC/ADD/UPDATE/DELETE
}
```
- **响应体**:
```json
{
  "success": true,
  "total": 1,
  "successCount": 1,
  "failCount": 0,
  "errors": []
}
```
- **状态码**:
  - 200 OK: 同步成功
  - 400 Bad Request: 请求参数错误
  - 401 Unauthorized: 未认证

#### 5.1.2 获取SSO配置

- **API路径**: `/api/v1/integration/auth/sso/config`
- **方法**: `GET`
- **功能描述**: 获取SSO配置信息
- **响应体**:
```json
{
  "ssoEnabled": true,
  "provider": "SAML",
  "entityId": "https://edms.example.com/saml2/service-provider-metadata",
  "acsUrl": "https://edms.example.com/api/v1/integration/auth/sso/callback",
  "ssoUrl": "https://idp.example.com/saml2/sso",
  "certificate": "MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA..."
}
```
- **状态码**:
  - 200 OK: 获取成功
  - 401 Unauthorized: 未认证

### 5.2 与QMS系统集成接口

#### 5.2.1 创建变更控制文档

- **API路径**: `/api/v1/integration/qms/change-orders`
- **方法**: `POST`
- **功能描述**: 从QMS创建变更控制文档
- **请求体**:
```json
{
  "changeOrderId": "QMS-2023-001",
  "title": "系统升级变更",
  "description": "EDMS系统版本升级变更",
  "requester": "user1",
  "documents": [
    {
      "documentId": 1,
      "title": "系统架构文档",
      "version": 2
    }
  ],
  "deadline": "2023-12-01T00:00:00Z"
}
```
- **响应体**:
```json
{
  "id": 501,
  "changeOrderId": "QMS-2023-001",
  "title": "系统升级变更",
  "status": "PENDING",
  "createdAt": "2023-11-01T09:00:00Z",
  "links": {
    "self": "/api/v1/integration/qms/change-orders/501"
  }
}
```
- **状态码**:
  - 201 Created: 创建成功
  - 400 Bad Request: 请求参数错误
  - 401 Unauthorized: 未认证

#### 5.2.2 通知变更控制状态

- **API路径**: `/api/v1/integration/qms/change-orders/{id}/status`
- **方法**: `PUT`
- **功能描述**: 通知变更控制状态更新
- **路径参数**:
  - `id`: 变更控制ID
- **请求体**:
```json
{
  "status": "APPROVED",
  "approvedBy": "manager1",
  "approvedAt": "2023-11-15T14:30:00Z",
  "comments": "变更已批准"
}
```
- **响应体**:
```json
{
  "id": 501,
  "status": "APPROVED",
  "documents": [
    {
      "id": 1,
      "status": "UNDER_CHANGE",
      "updatedAt": "2023-11-15T14:30:00Z"
    }
  ]
}
```
- **状态码**:
  - 200 OK: 更新成功
  - 400 Bad Request: 请求参数错误
  - 401 Unauthorized: 未认证
  - 404 Not Found: 变更控制不存在

### 5.3 与MES系统集成接口

#### 5.3.1 创建批记录文档

- **API路径**: `/api/v1/integration/mes/batch-records`
- **方法**: `POST`
- **功能描述**: 从MES创建批记录文档
- **请求体**:
```json
{
  "batchNumber": "BATCH-2023-0001",
  "productCode": "PROD-001",
  "productionLine": "LINE-01",
  "startDate": "2023-11-01T08:00:00Z",
  "endDate": "2023-11-01T18:00:00Z",
  "operator": "user1",
  "documents": [
    {
      "fileName": "批生产记录.pdf",
      "content": "base64编码的文件内容",
      "metadata": {"type": "BATCH_RECORD"}
    }
  ]
}
```
- **响应体**:
```json
{
  "id": 601,
  "batchNumber": "BATCH-2023-0001",
  "documentId": 10,
  "status": "COMPLETED",
  "createdAt": "2023-11-01T18:30:00Z",
  "links": {
    "document": "/api/v1/documents/10"
  }
}
```
- **状态码**:
  - 201 Created: 创建成功
  - 400 Bad Request: 请求参数错误
  - 401 Unauthorized: 未认证

#### 5.3.2 查询批记录文档

- **API路径**: `/api/v1/integration/mes/batch-records/{batchNumber}`
- **方法**: `GET`
- **功能描述**: 查询批记录文档
- **路径参数**:
  - `batchNumber`: 批次号
- **响应体**:
```json
{
  "batchNumber": "BATCH-2023-0001",
  "productCode": "PROD-001",
  "productionLine": "LINE-01",
  "startDate": "2023-11-01T08:00:00Z",
  "endDate": "2023-11-01T18:00:00Z",
  "documents": [
    {
      "id": 10,
      "title": "BATCH-2023-0001 批生产记录",
      "status": "APPROVED",
      "currentVersion": 1,
      "createdAt": "2023-11-01T18:30:00Z",
      "contentUrl": "/api/v1/documents/10/content"
    }
  ]
}
```
- **状态码**:
  - 200 OK: 查询成功
  - 401 Unauthorized: 未认证
  - 404 Not Found: 批记录不存在

### 5.4 与ERP系统集成接口

#### 5.4.1 供应商文档管理

- **API路径**: `/api/v1/integration/erp/vendors/{vendorId}/documents`
- **方法**: `POST`
- **功能描述**: 管理供应商相关文档
- **路径参数**:
  - `vendorId`: 供应商ID
- **请求体**:
```json
{
  "documentType": "QUALIFICATION",
  "documentName": "供应商资质证书",
  "content": "base64编码的文件内容",
  "expiryDate": "2024-11-01T00:00:00Z",
  "metadata": {
    "certificateNumber": "CERT-001",
    "issuedBy": "认证机构"
  }
}
```
- **响应体**:
```json
{
  "id": 701,
  "documentId": 15,
  "vendorId": "VENDOR-001",
  "documentType": "QUALIFICATION",
  "status": "ACTIVE",
  "createdAt": "2023-11-01T10:00:00Z",
  "links": {
    "document": "/api/v1/documents/15"
  }
}
```
- **状态码**:
  - 201 Created: 创建成功
  - 400 Bad Request: 请求参数错误
  - 401 Unauthorized: 未认证

#### 5.4.2 查询供应商文档

- **API路径**: `/api/v1/integration/erp/vendors/{vendorId}/documents`
- **方法**: `GET`
- **功能描述**: 查询供应商文档
- **路径参数**:
  - `vendorId`: 供应商ID
- **查询参数**:
  - `documentType`: 文档类型过滤
  - `status`: 文档状态过滤
  - `expired`: 是否过期过滤
- **响应体**:
```json
[
  {
    "id": 701,
    "documentId": 15,
    "documentType": "QUALIFICATION",
    "documentName": "供应商资质证书",
    "status": "ACTIVE",
    "expiryDate": "2024-11-01T00:00:00Z",
    "createdAt": "2023-11-01T10:00:00Z",
    "contentUrl": "/api/v1/documents/15/content"
  }
]
```
- **状态码**:
  - 200 OK: 查询成功
  - 401 Unauthorized: 未认证

## 6. 接口测试与验证

### 6.1 接口测试策略

- **单元测试**: 对每个API接口进行单元测试
- **集成测试**: 测试接口间的集成和交互
- **性能测试**: 测试接口的性能和负载能力
- **安全测试**: 测试接口的安全性和防攻击能力
- **兼容性测试**: 测试接口在不同环境下的兼容性

### 6.2 接口验证标准

- **功能验证**: 接口功能是否符合需求规范
- **性能验证**: 接口响应时间是否满足性能要求
- **安全验证**: 接口是否符合安全要求，无安全漏洞
- **规范验证**: 接口是否符合RESTful API设计规范
- **文档验证**: 接口文档是否完整、准确、一致

### 6.3 API文档管理

- **使用Swagger**: 使用Swagger自动生成API文档
- **文档版本**: API文档与接口同步版本管理
- **文档更新**: 接口变更时及时更新文档
- **文档访问**: 提供API文档在线访问
- **SDK生成**: 基于API文档自动生成客户端SDK

## 7. 总结

本文档详细描述了电子文档管理系统(EDMS)的接口设计，包括内部API接口和外部集成接口。接口设计遵循RESTful API规范，提供了统一、标准、易用的接口，支持EDMS系统的各项功能，同时便于与外部系统进行集成。

接口设计考虑了安全性、性能、可扩展性等因素，确保接口的安全可靠和高效运行。通过这些接口，EDMS系统可以与企业的其他系统进行无缝集成，实现数据的共享和业务流程的协同。

在系统实施过程中，应严格按照本文档的接口设计进行开发和测试，确保接口的正确性和可用性。同时，应建立接口变更管理机制，确保接口的稳定性和向后兼容性。

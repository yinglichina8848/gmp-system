# 数据需求

## 1. 概述

本文档定义了电子文档管理系统(EDMS)的数据需求，包括数据实体、数据结构、数据关系、数据存储、数据访问和数据管理等方面的要求。这些数据需求旨在确保EDMS系统能够有效管理和处理各类文档数据，满足GMP环境下对数据完整性、安全性和可追溯性的严格要求。

## 2. 核心数据实体

### 2.1 文档(Document)
- **ID**: 唯一标识符
- **名称**: 文档名称
- **描述**: 文档描述
- **类别**: 文档分类（如标准操作规程、批记录、验证文档等）
- **类型**: 文档类型（如SOP、记录、报告、图纸等）
- **状态**: 文档状态（如草稿、审核中、已批准、已发布、已归档、已废止等）
- **版本**: 当前版本号
- **创建日期**: 文档创建时间
- **最后修改日期**: 文档最后修改时间
- **发布日期**: 文档发布时间
- **有效期至**: 文档有效期截止时间
- **创建人**: 文档创建者
- **最后修改人**: 最后修改文档的用户
- **当前负责人**: 文档的当前负责人
- **元数据**: 文档相关的元数据（如作者、关键词、标签等）
- **访问控制**: 文档的访问权限设置

### 2.2 文档内容(DocumentContent)
- **ID**: 唯一标识符
- **文档ID**: 关联到文档实体
- **版本ID**: 关联到文档版本实体
- **文件路径**: 文件存储路径
- **文件大小**: 文件大小（字节）
- **文件格式**: 文件格式（如.docx、.pdf、.xlsx等）
- **校验和**: 文件内容的校验和（用于完整性验证）
- **创建日期**: 内容创建时间
- **创建人**: 内容创建者

### 2.3 文档版本(DocumentVersion)
- **ID**: 唯一标识符
- **文档ID**: 关联到文档实体
- **版本号**: 版本号（如1.0、1.1、2.0等）
- **版本名称**: 版本名称或标题
- **版本说明**: 版本变更说明
- **创建日期**: 版本创建时间
- **创建人**: 版本创建者
- **状态**: 版本状态（如草稿、已审核、已发布等）
- **内容ID**: 关联到文档内容实体

### 2.4 目录(Folder)
- **ID**: 唯一标识符
- **名称**: 目录名称
- **路径**: 目录完整路径
- **父目录ID**: 父目录ID（用于构建层级结构）
- **描述**: 目录描述
- **创建日期**: 目录创建时间
- **创建人**: 目录创建者
- **最后修改日期**: 目录最后修改时间
- **访问控制**: 目录的访问权限设置

### 2.5 用户(User)
- **ID**: 唯一标识符
- **用户名**: 登录用户名
- **密码**: 密码（加密存储）
- **姓名**: 用户真实姓名
- **电子邮件**: 用户电子邮箱
- **电话**: 用户联系电话
- **部门**: 用户所属部门
- **职位**: 用户职位
- **状态**: 用户状态（如激活、禁用、锁定等）
- **创建日期**: 用户创建时间
- **最后登录日期**: 最后登录时间
- **角色ID**: 关联到用户角色实体
- **访问控制**: 用户的访问权限设置

### 2.6 用户角色(Role)
- **ID**: 唯一标识符
- **名称**: 角色名称（如管理员、编辑者、查看者等）
- **描述**: 角色描述
- **权限列表**: 角色拥有的权限列表
- **创建日期**: 角色创建时间
- **创建人**: 角色创建者

### 2.7 工作流(Workflow)
- **ID**: 唯一标识符
- **名称**: 工作流名称
- **描述**: 工作流描述
- **类型**: 工作流类型（如文档审批、版本发布等）
- **状态**: 工作流状态（如启用、禁用等）
- **创建日期**: 工作流创建时间
- **创建人**: 工作流创建者
- **流程定义**: 工作流步骤和转换定义

### 2.8 工作流实例(WorkflowInstance)
- **ID**: 唯一标识符
- **工作流ID**: 关联到工作流实体
- **文档ID**: 关联到文档实体
- **当前状态**: 工作流实例的当前状态
- **创建日期**: 实例创建时间
- **创建人**: 实例创建者
- **最后更新日期**: 实例最后更新时间
- **完成日期**: 实例完成时间

### 2.9 工作流任务(WorkflowTask)
- **ID**: 唯一标识符
- **工作流实例ID**: 关联到工作流实例实体
- **任务名称**: 任务名称
- **任务类型**: 任务类型（如审批、审阅、通知等）
- **分配给**: 任务分配的用户ID
- **状态**: 任务状态（如待处理、处理中、已完成、已拒绝等）
- **创建日期**: 任务创建时间
- **截止日期**: 任务截止时间
- **完成日期**: 任务完成时间
- **完成人**: 任务完成者
- **评论**: 任务处理评论

### 2.10 电子签名(ElectronicSignature)
- **ID**: 唯一标识符
- **用户ID**: 关联到用户实体
- **文档ID**: 关联到文档实体（可选，用于文档签名）
- **工作流任务ID**: 关联到工作流任务实体（可选，用于任务签名）
- **签名类型**: 签名类型（如审批签名、确认签名等）
- **签名时间**: 签名时间
- **签名原因**: 签名原因
- **IP地址**: 签名时的IP地址
- **签名验证数据**: 用于验证签名真实性的数据

### 2.11 审计日志(AuditLog)
- **ID**: 唯一标识符
- **用户ID**: 关联到用户实体（可选，系统操作可能无用户）
- **操作类型**: 操作类型（如登录、查看、创建、修改、删除、审批等）
- **操作对象**: 操作对象类型（如文档、目录、用户、角色等）
- **操作对象ID**: 操作对象的唯一标识符
- **操作详情**: 操作的详细信息
- **操作时间**: 操作执行时间
- **操作结果**: 操作结果（成功、失败等）
- **IP地址**: 操作时的IP地址

### 2.12 系统配置(SystemConfiguration)
- **ID**: 唯一标识符
- **配置项**: 配置项名称
- **配置值**: 配置项的值
- **描述**: 配置项描述
- **数据类型**: 配置值的数据类型
- **修改日期**: 配置修改时间
- **修改人**: 配置修改者

## 3. 数据关系

### 3.1 文档与内容关系
- **一对多**: 一个文档可以有多个文档内容（不同版本）
- **一对一**: 一个文档版本对应一个文档内容

### 3.2 文档与版本关系
- **一对多**: 一个文档可以有多个版本
- **一对一**: 一个版本对应一个文档

### 3.3 文档与目录关系
- **一对多**: 一个目录可以包含多个文档
- **多对一**: 一个文档属于一个目录

### 3.4 用户与角色关系
- **多对多**: 一个用户可以有多个角色，一个角色可以分配给多个用户

### 3.5 文档与权限关系
- **多对多**: 文档与用户/角色之间的权限关系

### 3.6 工作流与文档关系
- **一对多**: 一个工作流可以应用于多个文档
- **多对一**: 一个文档实例只能属于一个工作流实例

### 3.7 工作流与任务关系
- **一对多**: 一个工作流实例可以包含多个任务
- **多对一**: 一个任务属于一个工作流实例

### 3.8 电子签名与用户/文档/任务关系
- **一对一**: 一个电子签名关联一个用户
- **一对一**: 一个电子签名关联一个文档（可选）
- **一对一**: 一个电子签名关联一个工作流任务（可选）

## 4. 数据存储需求

### 4.1 数据存储架构
- **关系型数据库**: 存储结构化数据，如文档元数据、用户信息、角色权限、工作流定义等
- **文件存储系统**: 存储文档内容文件
- **搜索引擎**: 用于文档内容索引和搜索
- **缓存系统**: 用于缓存热点数据，提高系统性能
- **备份存储**: 用于数据备份和恢复

### 4.2 数据库技术要求
- **数据库管理系统**: PostgreSQL 14.0+
- **数据模型**: 关系型数据模型
- **事务支持**: 完全支持ACID事务
- **并发控制**: 支持多版本并发控制(MVCC)
- **数据完整性**: 支持主键、外键、约束等完整性机制
- **索引优化**: 支持B-tree、全文索引等多种索引类型
- **扩展性**: 支持水平扩展和读写分离（可选）

### 4.3 文件存储要求
- **存储技术**: 分布式文件系统或对象存储
- **存储容量**: 初始支持至少10TB，可扩展到100TB+
- **文件完整性**: 支持文件校验和验证
- **文件访问**: 支持高效的文件读写和流式传输
- **存储策略**: 支持分层存储，热数据和冷数据分离

### 4.4 搜索引擎要求
- **搜索引擎**: Elasticsearch 7.0+
- **索引内容**: 文档元数据和文档内容
- **搜索能力**: 支持全文搜索、模糊搜索、高级过滤等
- **性能要求**: 复杂搜索响应时间不超过3秒

### 4.5 缓存系统要求
- **缓存技术**: Redis 6.0+
- **缓存内容**: 热点数据、频繁访问的文档元数据、用户会话等
- **缓存策略**: 支持LRU、TTL等缓存淘汰策略
- **一致性**: 支持缓存更新和失效机制

## 5. 数据访问需求

### 5.1 数据访问模式
- **CRUD操作**: 支持对所有数据实体的创建、读取、更新和删除操作
- **批量操作**: 支持对文档、目录等的批量操作
- **分页查询**: 支持大数据量的分页查询
- **关联查询**: 支持多表关联查询
- **全文检索**: 支持文档内容和元数据的全文检索

### 5.2 API接口要求
- **REST API**: 提供标准化的REST API接口
- **API认证**: 支持JWT或OAuth2.0认证
- **API版本控制**: 支持API版本管理
- **请求限制**: 支持API请求频率限制
- **错误处理**: 提供标准化的错误响应

### 5.3 权限控制
- **RBAC模型**: 基于角色的访问控制
- **ABAC模型**: 基于属性的访问控制（可选，用于复杂权限场景）
- **权限粒度**: 支持到文档、目录、字段级别的权限控制
- **权限继承**: 支持目录权限继承到子目录和文档

## 6. 数据管理需求

### 6.1 数据备份与恢复
- **备份策略**: 支持全量备份和增量备份
- **备份频率**: 数据库每日全量备份，文件系统每周全量备份
- **备份存储**: 备份数据存储在独立的存储系统中
- **恢复测试**: 定期进行恢复测试，确保备份有效性
- **恢复时间目标(RTO)**: ≤1小时
- **恢复点目标(RPO)**: ≤15分钟

### 6.2 数据归档与清理
- **归档策略**: 制定文档归档策略，包括归档条件、归档时间等
- **归档存储**: 归档数据存储在低成本存储中
- **归档访问**: 提供归档数据的查询和检索功能
- **数据清理**: 制定数据清理策略，包括清理条件、清理流程等
- **数据保留期**: 根据法规要求和业务需求，设置不同数据的保留期
  - 审计日志: 至少7年
  - 电子签名记录: 至少7年
  - 文档内容和版本: 根据文档类型和业务需求设置，通常为5-10年

### 6.3 数据迁移
- **迁移工具**: 提供数据迁移工具和脚本
- **迁移流程**: 制定详细的数据迁移流程和计划
- **数据验证**: 提供迁移后数据验证机制
- **回滚机制**: 提供迁移失败的回滚机制

### 6.4 数据一致性
- **事务管理**: 确保数据操作的原子性、一致性、隔离性和持久性
- **数据同步**: 确保数据库、文件系统和搜索引擎之间的数据同步
- **冲突处理**: 处理并发操作可能导致的数据冲突
- **一致性检查**: 定期进行数据一致性检查

### 6.5 数据质量
- **数据验证**: 对输入数据进行验证，确保数据质量
- **数据清洗**: 定期进行数据清洗，处理无效、错误或重复数据
- **数据标准**: 制定数据命名和格式标准
- **质量监控**: 监控数据质量指标，及时发现和处理问题

## 7. 数据安全需求

### 7.1 数据加密
- **传输加密**: 使用TLS/SSL加密所有数据传输
- **存储加密**: 敏感数据加密存储
- **文件加密**: 重要文档内容文件加密存储（可选）
- **密钥管理**: 实施安全的密钥管理机制

### 7.2 数据访问控制
- **身份认证**: 支持多因素认证，确保用户身份真实
- **授权管理**: 严格的权限控制，确保用户只能访问其被授权的数据
- **访问审计**: 记录所有数据访问操作，支持审计和追踪
- **最小权限原则**: 遵循最小权限原则，仅授予必要的权限

### 7.3 数据完整性
- **完整性校验**: 对文件内容进行校验和验证
- **防篡改机制**: 防止数据被未授权修改
- **电子签名**: 支持电子签名，确保文档完整性和不可否认性
- **变更记录**: 记录所有数据变更，支持版本控制和回溯

### 7.4 合规性
- **GMP合规**: 符合GMP对数据完整性和可追溯性的要求
- **21 CFR Part 11**: 符合FDA 21 CFR Part 11对电子记录和电子签名的要求
- **数据保留**: 符合相关法规对数据保留期限的要求
- **审计追踪**: 提供满足法规要求的审计追踪功能

## 8. 总结

本文档详细定义了EDMS系统的数据需求，包括核心数据实体、数据关系、数据存储、数据访问和数据管理等方面的要求。这些数据需求是系统设计和开发的基础，确保EDMS系统能够有效管理和处理各类文档数据，满足GMP环境下对数据完整性、安全性和可追溯性的严格要求。

在系统设计和实施过程中，应严格遵循本文档中的数据需求，确保数据的安全性、完整性和可用性。同时，应建立数据管理和监控机制，定期进行数据备份、归档和清理，以适应业务需求的变化和数据量的增长。

随着业务需求的变化和技术的发展，数据需求可能需要定期审查和更新，以确保系统始终能够有效管理和处理各类文档数据。

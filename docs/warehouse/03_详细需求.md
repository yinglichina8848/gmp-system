# 仓库管理系统详细需求分析

## 1. 物料库存管理 (Inventory Management)

### 1.1 数据模型

#### 1.1.1 物料主数据表 (materials)
```sql
CREATE TABLE materials (
    id BIGSERIAL PRIMARY KEY,
    material_code VARCHAR(50) UNIQUE NOT NULL,
    material_name VARCHAR(200) NOT NULL,
    material_type VARCHAR(50), -- RAW_MATERIAL, PACKAGING, FINISHED_PRODUCT
    unit VARCHAR(20) DEFAULT 'KG',
    storage_condition VARCHAR(50), -- ROOM_TEMP, COLD_CHAIN, FROZEN
    expiry_months INTEGER,
    supplier VARCHAR(100),
    specifications TEXT,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    is_tcm BOOLEAN DEFAULT FALSE, -- 是否为中药材
    tcm_properties JSONB -- 中药材特有属性
);
```

#### 1.1.2 库存明细表 (inventory)
```sql
CREATE TABLE inventory (
    id BIGSERIAL PRIMARY KEY,
    material_id BIGINT REFERENCES materials(id),
    batch_number VARCHAR(50) NOT NULL,
    location VARCHAR(100) NOT NULL,
    quantity DECIMAL(15,3),
    unit VARCHAR(20),
    expiry_date DATE,
    received_date DATE,
    received_by VARCHAR(100),
    quality_status VARCHAR(20) DEFAULT 'PENDING',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(material_id, batch_number, location),
    tcm_batch_info JSONB -- 中药材批次特有信息
);
```

## 2. 批次追溯管理 (Batch Traceability)

### 2.1 功能需求

#### 2.1.1 入库批次追溯
- 批次号生成规则：按物料类型+日期+序列号
- 供应商批次信息记录
- 检验结果与批次关联
- 存储位置二维码绑定
- 中药材道地性信息记录

#### 2.1.2 出库批次追溯
- 先进先出原则 (FIFO)
- 批次选择算法优化
- 出库批次与生产批次关联
- 追溯记录完整保存
- 中药材炮制前后批次关联

#### 2.1.3 批次库存监控
- 批次过期提前预警
- 库存积压分原因类型
- 批次质量状态实时更新
- 中药材质量变化趋势分析

## 3. 中药材存储管理 (Chinese Herbal Medicine Storage)

### 3.1 中药材特殊存储要求

#### 3.1.1 存储环境控制
**温度控制：**
- 常温中药材：温度控制在0-30℃，湿度40-75%
- 阴凉中药材：温度控制在10-20℃，湿度35-65%
- 干燥中药材：温度控制在<25℃，相对湿度<50%
- 冷藏中药材：温度控制在2-8℃，湿度<60%

**通风要求：**
- 自然通风：中药材房间应有良好的通风系统
- 空气过滤：进风口安装过滤网，防止灰尘进入
- 空气监测：实时监控空气质量和洁净度

**光照控制：**
- 光敏中药材：使用不透光包装或置于暗藏处
- 光照监测：仓库光照度不得超过500Lx
- 包装保护：双层或多层包装阻挡光线

#### 3.1.2 质量状态管理
**中药材鉴别信息录入：**
- 原植物（中名、拉丁名）
- 药用部位（根、茎、叶、花等）
- 采收季节和方法
- 炮制方式
- 性状特征（形状、颜色、气味、性味）

**质量等级分级：**
- 一等品：符合《中国药典》标准
- 二等品：符合企业内控标准
- 三等品：不合格但可用于提取
- 报废品：严重不符合质量标准

### 3.2 中药材仓储业务流程

#### 3.2.1 到货验收流程
```
中药材到货 → 外包装检查 → 解包查验 → 鉴别确认 → 质量抽检 → 分级入库 → 电子标签绑定
```

#### 3.2.2 存储管理流程
```
定位存放 → 环境监测 → 定期盘点 → 质量复检 → 保质期监控 → 临近过期预警
```

#### 3.2.3 出库管理流程
```
生产需求 → 批次查询 → 质量确认 → 先进先出 → 出库单生成 → 重量复核 → 追溯记录
```

### 3.3 中草药追溯系统

#### 3.3.1 产地追溯
- 栽培基地信息：地理位置、土壤类型、生态环境
- 种植户信息：种植历史、品质信誉等级
- 采收信息：采收时间、最佳采收期、采收工艺
- 检疫信息：农药残留、重金属检测、病虫害防治

#### 3.3.2 加工追溯
- 炮制工艺：炒、炙、煮、蒸、煅等传统加工方法
- 参数记录：温度、时间、辅料使用、设备型号
- 质量监控：炮制前后质量对比、水分含量变化
- 检疫追溯：加热杀菌、霉菌毒素去除、干燥处理

#### 3.3.3 仓储追溯
- 入库批次：供应商、供应商批号、入库日期、验收结果
- 存储环境：温度、湿度、光照变化记录
- 库存状态：定期盘点、无害虫情况、变质检查
- 出库信息：领用单位、领用用途、出库批次、出库日期

### 3.4 RFID电子标签应用

#### 3.4.1 标签信息结构
```json
{
  "material_code": "YM202311001",
  "batch_code": "CP20231115001",
  "product_name": "当归切片",
  "supplier": "甘肃药材基地",
  "quantity": "100kg",
  "expiry_date": "2025-11-15",
  "storage_condition": "凉暗干燥",
  "qr_code": "YM202311001-CP20231115001",
  "tcm_info": {
    "origin": "甘肃岷县",
    "harvest_date": "2025-10-15",
    "processing_method": "切制",
    "grade": "一级"
  }
}
```

#### 3.4.2 标签应用场景
- **入库标签**: 绑定库位信息、过期预警
- **盘点标签**: 支持快速盘点、库存统计
- **出库标签**: 记录出库信息、追溯历史
- **质量标签**: 显示质量等级、品质信息
- **中药特色标签**: 记录道地性、炮制信息等特有属性

### 3.5 仓库环境监控系统

#### 3.5.1 传感器部署
- **温度传感器**: 分布均匀，实时采集温度数据
- **湿度传感器**: 监测相对湿度变化，保证水分控制
- **光照传感器**: 检测仓库光照强度，保护光敏中药材
- **烟雾传感器**: 消防安全监控，早期火警预警
- **中药特有传感器**: 如挥发油含量监测、霉菌孢子监测等

#### 3.5.2 预警机制
- **温度超标**: 超过设定临界值±2℃自动报警
- **湿度异常**: 偏离最适湿度范围±5%发送通知
- **光照过强**: 超过500Lx持续5分钟预警提示
- **烟雾报警**: 检测到烟雾立即启动消防联动
- **中药特有预警**: 如挥发油含量异常、霉变风险预警等

### 3.6 中药材库存管理算法

#### 3.6.1 药材质地分类存储
```
药材分类       | 存储属性       | 货架类型     | 搬运设备
---------------|---------------|-------------|----------
轻质粉末类     | 干燥、避风     | 可调式货架   | 叉车
块茎根类       | 通风、防潮     | 重型货架     | 托盘叉车
叶片花类类     | 遮光、防压     | 多层保温货架  | 小型载重叉车
矿物、贝壳类   | 防潮、防锈     | 防腐货架     | 手动搬运
种子果实类     | 低温、干燥     | 密闭货架     | 小推车
树脂类         | 避光、低温     | 冷藏货架     | 电动搬运车
```

#### 3.6.2 库存优化算法
- **ABC分类**: 按经济价值和供应风险进行库存分类管理
- **季节性储存**: 根据中药材的季节性特性优化存储容量
- **保质期管理**: 动态调整存储位置，确保临近过期品优先出库
- **立库管理**: 自动化的立体仓库，提升存储密度和效率
- **中药特有算法**: 根据药材性质和炮制要求优化存储策略

### 3.7 数据收集与报表

#### 3.7.1 关键绩效指标 (KPIs)
- **库存准确率**: 账实相符率≥98%
- **存放质量**: 不合格品率<1%
- **追溯完整率**: 全链条追溯成功率≥99.5%
- **环境合规率**: 符合存储条件的库存比例≥97%
- **中药特有指标**: 道地性符合率、炮制品合格率等

#### 3.7.2 管理报表体系
- **日报**: 库存收发日报、存储环境监控日报
- **月报**: 库存分析月报、中药材质量趋势月报
- **季报**: 供应商质量评估、存储效率分析
- **年报**: 仓库管理年度总结、全流通追溯分析
- **中药专项报告**: 道地性分析报告、炮制品质量报告等

## 4. 炮制中药材管理 (Processed TCM Management)

### 4.1 炮制中药材特殊管理要求

#### 4.1.1 炮制工艺信息管理
- **炮制方法记录**: 详细记录炮制方法（炒、炙、煮、蒸、煅等）
- **辅料使用**: 记录辅料种类、用量、添加时机
- **工艺参数**: 温度、时间、火力、搅拌速度等关键参数
- **设备信息**: 使用的炮制设备型号、批次信息

#### 4.1.2 炮制质量控制
- **外观性状**: 颜色、形态、气味等外观特征变化
- **理化指标**: 水分、灰分、浸出物等理化性质变化
- **有效成分**: 炮制前后有效成分含量变化监测
- **安全性指标**: 有害物质去除效果评估

### 4.2 炮制中药材业务流程

#### 4.2.1 炮制前准备流程
```
原药材验收 → 质量评估 → 炮制方案制定 → 辅料准备 → 设备检查 → 炮制开始
```

#### 4.2.2 炮制过程管理
```
参数监控 → 外观观察 → 中间检验 → 调整优化 → 炮制完成 → 质量评定
```

#### 4.2.3 炮制后存储管理
```
冷却处理 → 质量复检 → 分级包装 → 标识更新 → 定位存储 → 环境监控
```

### 4.3 炮制中药材追溯管理

#### 4.3.1 炮制全过程追溯
- **原料批次**: 原药材批次号、供应商、采收信息
- **工艺过程**: 炮制方法、参数记录、操作人员
- **质量数据**: 炮制前后质量检测结果
- **成品信息**: 炮制成品批次号、质量等级、存储位置

#### 4.3.2 炮制质量分析
- **工艺优化**: 基于历史数据的炮制工艺优化建议
- **质量趋势**: 炮制品质量变化趋势分析
- **成本分析**: 炮制成本效益分析
- **风险评估**: 炮制过程风险识别与控制

## 5. 系统集成需求

### 5.1 与QMS系统集成
- 质量检验结果同步
- 不合格品处理流程对接
- 质量趋势数据共享
- 中药材质量偏差管理

### 5.2 与MES系统集成
- 生产计划与库存匹配
- 物料需求计划同步
- 炮制工艺参数对接
- 中药材生产批次追溯

### 5.3 与LIMS系统集成
- 检验任务下发
- 检验结果接收
- 质量标准共享
- 中药材特有检验项目管理

### 5.4 与EDMS系统集成
- 仓储管理制度文档管理
- SOP文档查阅与更新
- 记录归档与检索
- 中药材仓储管理规范共享

## 6. 附录

### 6.1 参考文档
- 《中国药典》2020版
- GMP法规（2010版）
- 中药材生产质量管理规范（GAP）
- 药品经营质量管理规范（GSP）
- 中药材检验子系统需求文档

### 6.2 版本历史
| 版本 | 修改日期 | 修改内容 | 修改人 |
|------|---------|---------|--------|
| v1.0.0 | 2023-07-15 | 初始版本 | 仓库管理系统团队 |
| v1.1.0 | 2025-11-27 | 增加中药特色仓储管理功能 | 系统分析师 |
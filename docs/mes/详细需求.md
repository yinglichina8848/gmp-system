# MES子系统（生产执行系统）详细需求分析

## 1. 引言

### 1.1 文档目的
本文档详细描述生产执行系统(MES)的功能需求、技术要求和业务流程，专门针对中成药生产的炮制、提取、浓缩、干燥等工艺环节的电子化管理和智能化控制。

### 1.2 文档范围
- 生产订单管理
- 批次执行管理
- 中药生产工艺控制
- 设备监控管理
- 物料追溯管理
- 质量过程管控
- 生产数据采集
- 报告生成管理

### 1.3 业务背景
MES子系统是GMP信息管理系统的核心，专注管理中成药生产全过程，包括中药材炮制、提取分离、醇沉浓缩、干燥成型四大工艺阶段，支持从订单下发到成品入库的完整生产生命周期管控。

## 2. 系统总体设计

### 2.1 系统架构
```
MES子系统架构：
├── 生产订单管理模块
├── 批次执行管理模块
├── 中药工艺控制模块
├── 设备监控管理模块
├── 物料追溯管理模块
├── 质量过程管控模块
├── 数据采集管理模块
├── 生产报告管理模块
└── 系统配置管理模块
```

### 2.2 技术架构
- **前端技术：React + Ant Design**
- **后端技术：Spring Boot + Spring Cloud**
- **数据库：PostgreSQL + Redis缓存**
- **消息队列：RabbitMQ**
- **容器化：Docker + Kubernetes**
- **监控：Prometheus + Grafana**

## 3. 详细功能需求

### 3.1 生产订单管理模块

#### 3.1.1 功能概述
生产订单管理模块负责从ERP接收生产计划，创建和管理生产订单，确保生产任务的有效分配和跟踪。

#### 3.1.2 核心功能点

##### **生产计划导入**
- **功能描述**：从ERP系统自动导入或手动创建生产计划
- **输入参数**：
  - 产品代码
  - 计划产量
  - 交货日期
  - 生产工艺路线
- **业务规则**：
  - 计划产量必须大于0
  - 交货日期不能早于当前日期
  - 产品必须在系统中存在
- **输出结果**：
  - 生成生产订单号
  - 记录导入操作日志

##### **订单审核审批**
- **功能描述**：各级管理人员对生产订单进行审核和审批
- **审批流程**：
  ```
  订单创建 → 生产计划员初审 → 生产主管复审 → 质量经理终审 → 执行确认
  ```
- **权限控制**：
  - 生产计划员：创建、修改、删除订单
  - 生产主管：审核计划合理性
  - 质量经理：审核质量要求
  - 系统管理员：审批异常订单

##### **订单状态管理**
- **状态定义**：
  ```
  草稿状态 → 待审核 → 已审核 → 执行中 → 已完成 → 已关闭
  ```
- **状态变更规则**：
  - 草稿状态允许修改
  - 已审核状态不允许修改
  - 执行中状态允许部分调整
  - 已完成状态只读

#### 3.1.3 接口需求
```json
// 创建生产订单接口
POST /api/mes/production-orders
{
  "productCode": "string",
  "plannedQuantity": "number",
  "deliveryDate": "date",
  "processRoute": "string",
  "priority": "number",
  "requirements": "string"
}

// 审核生产订单接口
PUT /api/mes/production-orders/{id}/approve
{
  "approved": "boolean",
  "comments": "string",
  "approvedBy": "string"
}
```

### 3.2 中药生产工艺控制模块

#### 3.2.1 中药炮制管理子模块

##### **炮制工艺配置**
- **功能描述**：定义和管理中药材炮制工艺参数
- **核心参数**：
  - 炮制方法（炒、炙、煮、蒸、煅等）
  - 温度控制参数
  - 时间控制参数
  - 辅料添加配方
  - 质量控制指标

##### **实时炮制监控**
- **监控指标**：
  - 温度曲线跟踪
  - 时间进度监控
  - 辅料添加记录
  - 质量参数实时检测
- **报警机制**：
  - 温度超限报警
  - 时间偏离报警
  - 质量异常报警

##### **炮制效果评估**
- **评估指标**：
  - 炮制前后的重量变化
  - 有效成分含量变化
  - 性状外观变化
  - 水分含量变化
- **评估标准**：
  - 符合《中国药典》炮制品标准
  - 达到企业内控质量标准

#### 3.2.2 提取分离控制子模块

##### **提取工艺管理**
- **提取方法**：
  - 热浸提取
  - 渗漉提取
  - 超声波提取
  - 酶法提取
- **参数控制**：
  - 提取温度：50-100℃
  - 提取时间：1-8小时
  - 溶剂配比：1:5-1:15
  - 压力控制：常压/加压

##### **醇沉浓缩控制**
- **醇沉工艺**：
  - 乙醇浓度：60%-95%
  - 醇沉温度：0-10℃
  - 沉降时间：12-48小时
  - 过滤方式：自然过滤/离心过滤

##### **浓缩干燥控制**
- **浓缩工艺**：
  - 真空度：0.08-0.1 MPa
  - 温度：60-90℃
  - 浓缩倍数：2-10倍
  - 终端控制：相对密度、含量测定

#### 3.2.3 干燥成型控制子模块

##### **干燥工艺选择**
- **干燥方法**：
  - 喷雾干燥
  - 真空干燥
  - 冷冻干燥
  - 热风干燥
- **工艺参数**：
  - 进风温度：50-120℃
  - 出风温度：40-80℃
  - 风速控制：0.5-3 m/s
  - 干燥时间：2-24小时

##### **成型质量控制**
- **成型方式**：
  - 颗粒成型
  - 片剂成型
  - 丸剂成型
  - 散剂包装
- **质量监控**：
  - 水分含量：<5%
  - 粒度分布：合格率>95%
  - 硬度/脆碎度：符合标准
  - 外观一致性：合格

### 3.3 批次执行管理模块

#### 3.3.1 批次创建管理
- **批次号生成规则**：
  ```
  中药产品批号格式：ZY20251123-001
  其中：
  - ZY：中药产品标识
  - 20251123：生产日期
  - 001：当日批次序号
  ```
- **批次信息录入**：
  - 产品信息
  - 生产数量
  - 责任人员
  - 设备分配
  - 物料清单

#### 3.3.2 工序执行跟踪
- **工序状态管理**：
  ```
  待执行 → 执行中 → 已完成 → 已确认
  ```
- **过程参数记录**：
  - 实时参数采集
  - 自动数据存储
  - 历史数据查询
  - 趋势分析图表

#### 3.3.3 批次质量审核
- **过程质量检查**：
  - 中间产品取样
  - 在线质量检测
  - 过程参数验证
- **批次审核流程**：
  ```
  操作员工序确认 → 质检员审核 → 主管终审 → 批次关闭
  ```

### 3.4 设备监控管理模块

#### 3.4.1 设备状态监控
- **设备状态分类**：
  ```
  运行中 | 待机 | 维护中 | 故障 | 停用
  ```
- **关键参数监控**：
  - 温度、压力、转速
  - 能耗指标
  - 运行时间统计
  - 维护保养周期

#### 3.4.2 设备维护管理
- **预防性维护**：
  - 维护计划制定
  - 维护记录管理
  - 维护效果评估
- **故障处理流程**：
  ```
  故障发现 → 故障报告 → 维护派工 → 故障排除 → 设备复位 → 验收确认
  ```

### 3.5 物料追溯管理模块

#### 3.5.1 物料领用追溯
- **物料批次绑定**：
  - 生产批次与原料批次关联
  - 原辅料使用量统计
  - 物料消耗率计算
- **供应链追溯**：
  - 供应商信息记录
  - 采购批次跟踪
  - 供应商质量评估

#### 3.5.2 生产过程追溯
- **正向追溯**：物料 → 生产批次 → 成品
- **反向追溯**：成品 → 生产批次 → 物料
- **质量问题追溯**：快速定位质量问题源头

### 3.6 数据采集管理模块

#### 3.6.1 生产数据采集
- **自动采集**：
  - PLC设备数据采集
  - 传感器数据采集
  - 称重设备集成
- **手动录入**：
  - 操作参数记录
  - 质量检查数据
  - 异常事件记录

#### 3.6.2 数据验证处理
- **数据验证规则**：
  - 合理性检查
  - 完整性验证
  - 一致性校验
- **异常数据处理**：
  - 数据报警机制
  - 手动修正流程
  - 历史修正记录

## 4. 非功能需求

### 4.1 性能要求
- **并发处理能力**：支持100个并发生产批次
- **响应时间**：
  - 页面加载：<3秒
  - 数据查询：<2秒
  - 报表生成：<10秒
- **数据存储**：支持5年生产历史数据

### 4.2 可靠性要求
- **系统可用性**：99.9%全年可用
- **数据完整性**：生产数据0丢失
- **容错能力**：单点故障自动切换
- **恢复时间**：<30分钟

### 4.3 安全要求
- **用户认证**：双因子认证
- **数据加密**：敏感数据加密存储
- **操作审计**：完整操作日志记录
- **网络安全**：防火墙+入侵检测

## 5. 接口需求

### 5.1 外部系统接口
```json
// 与ERP系统接口
{
  "interface": "ERP_ORDER_SYNC",
  "method": "POST",
  "endpoint": "/api/mes/erp/sync-orders",
  "frequency": "每15分钟",
  "dataFormat": "MES订单格式"
}

// 与LIMS系统接口
{
  "interface": "LIMS_QUALITY_SYNC",
  "method": "GET",
  "endpoint": "/api/mes/lims/get-quality-results",
  "frequency": "实时",
  "dataFormat": "LIMS检测结果"
}
```

### 5.2 设备集成接口
- **PLC设备接口**：OPC UA协议
- **传感器接口**：Modbus协议
- **称重设备接口**：RS485串口通信
- **条码扫描器接口**：HID设备接口

## 6.验收标准

### 6.1 功能验收标准
1. **生产订单管理**：订单创建到执行全程可追溯
2. **工艺过程控制**：中药四大工艺参数自动控制精度±2%
3. **质量监控**：过程质量检查覆盖率100%
4. **数据追溯**：正反向追溯响应时间<5秒

### 6.2 性能验收标准
1. **并发处理**：支持100个批次同时运行稳定
2. **响应时间**：90%的操作响应时间<2秒
3. **数据准确性**：生产数据准确率99.99%


# 实验室信息管理系统接口需求

## 1. 概述

本文档详细描述实验室信息管理系统（LIMS）的接口需求，包括内部接口和外部接口，定义了接口的功能、数据格式、调用方式和安全要求，为系统接口设计和实现提供规范和指导。

## 2. 接口设计原则

### 2.1 标准化原则

- **RESTful API**：采用RESTful风格设计API
- **JSON格式**：统一使用JSON格式进行数据交换
- **标准HTTP方法**：使用GET、POST、PUT、DELETE等标准HTTP方法
- **标准状态码**：使用标准HTTP状态码表示接口调用结果

### 2.2 安全性原则

- **身份认证**：所有接口必须进行身份认证
- **授权控制**：基于角色的接口访问控制
- **数据加密**：敏感数据传输加密
- **请求限流**：防止接口滥用和DDoS攻击
- **防SQL注入**：输入参数严格校验

### 2.3 可用性原则

- **接口文档化**：提供详细的接口文档
- **版本控制**：接口版本化管理
- **错误处理**：统一的错误响应格式
- **幂等设计**：确保接口调用的幂等性
- **异步处理**：复杂操作采用异步处理机制

### 2.4 中药检验特色原则

- **批量操作接口**：支持批量样品、批量任务的处理
- **数据采集接口**：支持与检验仪器的数据采集接口
- **图谱数据接口**：支持中药检验图谱的上传、下载和分析接口
- **标准比对接口**：支持检验结果与标准的自动比对接口

## 3. 接口分类

### 3.1 内部接口

内部接口是系统内部各模块之间的接口，主要用于模块间的数据交换和功能调用。

### 3.2 外部接口

外部接口是系统与外部系统交互的接口，主要包括：

- 与认证子系统的接口
- 与生产管理系统的接口
- 与设备管理系统的接口
- 与仓库管理系统的接口
- 与报表系统的接口
- 与上级监管系统的接口
- 移动端接口

## 4. 内部接口设计

### 4.1 用户管理模块接口

#### 4.1.1 用户管理接口

- **接口路径**：/api/v1/users
- **方法**：GET
- **功能**：获取用户列表
- **参数**：
  - pageSize：每页条数
  - pageNum：页码
  - username：用户名（可选）
  - realName：真实姓名（可选）
  - departmentId：部门ID（可选）
  - status：状态（可选）
- **返回值**：用户列表，包含分页信息

- **接口路径**：/api/v1/users/{userId}
- **方法**：GET
- **功能**：获取用户详情
- **参数**：userId：用户ID
- **返回值**：用户详细信息

- **接口路径**：/api/v1/users
- **方法**：POST
- **功能**：新增用户
- **参数**：
  - username：用户名
  - password：密码
  - realName：真实姓名
  - email：邮箱
  - phone：手机号
  - departmentId：部门ID
  - position：职位
- **返回值**：创建成功的用户信息

- **接口路径**：/api/v1/users/{userId}
- **方法**：PUT
- **功能**：更新用户信息
- **参数**：userId：用户ID，用户信息
- **返回值**：更新后的用户信息

- **接口路径**：/api/v1/users/{userId}
- **方法**：DELETE
- **功能**：删除用户
- **参数**：userId：用户ID
- **返回值**：删除结果

#### 4.1.2 角色管理接口

- **接口路径**：/api/v1/roles
- **方法**：GET
- **功能**：获取角色列表
- **参数**：
  - pageSize：每页条数
  - pageNum：页码
  - roleName：角色名称（可选）
- **返回值**：角色列表

- **接口路径**：/api/v1/roles/{roleId}
- **方法**：GET
- **功能**：获取角色详情
- **参数**：roleId：角色ID
- **返回值**：角色详细信息，包含权限列表

- **接口路径**：/api/v1/roles
- **方法**：POST
- **功能**：新增角色
- **参数**：
  - roleName：角色名称
  - roleDesc：角色描述
  - permissions：权限ID列表
- **返回值**：创建成功的角色信息

- **接口路径**：/api/v1/roles/{roleId}
- **方法**：PUT
- **功能**：更新角色
- **参数**：roleId：角色ID，角色信息
- **返回值**：更新后的角色信息

- **接口路径**：/api/v1/roles/{roleId}
- **方法**：DELETE
- **功能**：删除角色
- **参数**：roleId：角色ID
- **返回值**：删除结果

### 4.2 样品管理模块接口

#### 4.2.1 样品管理接口

- **接口路径**：/api/v1/samples
- **方法**：GET
- **功能**：获取样品列表
- **参数**：
  - pageSize：每页条数
  - pageNum：页码
  - sampleCode：样品编号（可选）
  - sampleName：样品名称（可选）
  - batchNumber：批次号（可选）
  - source：来源（可选）
  - status：状态（可选）
  - receiveDateStart：接收开始日期（可选）
  - receiveDateEnd：接收结束日期（可选）
- **返回值**：样品列表

- **接口路径**：/api/v1/samples/{sampleId}
- **方法**：GET
- **功能**：获取样品详情
- **参数**：sampleId：样品ID
- **返回值**：样品详细信息

- **接口路径**：/api/v1/samples
- **方法**：POST
- **功能**：新增样品
- **参数**：
  - sampleCode：样品编号
  - sampleName：样品名称
  - batchNumber：批次号
  - specification：规格
  - quantity：数量
  - unit：单位
  - source：来源
  - sampleType：样品类型
  - testType：检验类型
  - storageLocation：存储位置
  - expiryDate：有效期
- **返回值**：创建成功的样品信息

- **接口路径**：/api/v1/samples/{sampleId}
- **方法**：PUT
- **功能**：更新样品信息
- **参数**：sampleId：样品ID，样品信息
- **返回值**：更新后的样品信息

- **接口路径**：/api/v1/samples/{sampleId}/status
- **方法**：PATCH
- **功能**：更新样品状态
- **参数**：sampleId：样品ID，status：新状态
- **返回值**：更新结果

#### 4.2.2 样品流转接口

- **接口路径**：/api/v1/samples/{sampleId}/flow-records
- **方法**：GET
- **功能**：获取样品流转记录
- **参数**：sampleId：样品ID
- **返回值**：流转记录列表

- **接口路径**：/api/v1/samples/flow-records
- **方法**：POST
- **功能**：记录样品流转
- **参数**：
  - sampleId：样品ID
  - fromLocation：出发位置
  - toLocation：目标位置
  - operatorId：操作人员ID
  - statusAfter：流转后状态
  - remark：备注
- **返回值**：流转记录

### 4.3 检验任务模块接口

#### 4.3.1 任务管理接口

- **接口路径**：/api/v1/test-tasks
- **方法**：GET
- **功能**：获取任务列表
- **参数**：
  - pageSize：每页条数
  - pageNum：页码
  - taskCode：任务编号（可选）
  - sampleId：样品ID（可选）
  - assignedTo：任务执行人（可选）
  - status：状态（可选）
  - assignDateStart：分配开始日期（可选）
  - assignDateEnd：分配结束日期（可选）
- **返回值**：任务列表

- **接口路径**：/api/v1/test-tasks/{taskId}
- **方法**：GET
- **功能**：获取任务详情
- **参数**：taskId：任务ID
- **返回值**：任务详细信息，包含检验项目列表

- **接口路径**：/api/v1/test-tasks
- **方法**：POST
- **功能**：创建检验任务
- **参数**：
  - sampleId：样品ID
  - taskName：任务名称
  - priority：优先级
  - assignedTo：分配给
  - dueDate：截止日期
  - testStandardId：检验标准ID
  - testMethodId：检验方法ID
  - itemIds：检验项目ID列表
- **返回值**：创建成功的任务信息

- **接口路径**：/api/v1/test-tasks/{taskId}
- **方法**：PUT
- **功能**：更新任务信息
- **参数**：taskId：任务ID，任务信息
- **返回值**：更新后的任务信息

- **接口路径**：/api/v1/test-tasks/{taskId}/status
- **方法**：PATCH
- **功能**：更新任务状态
- **参数**：taskId：任务ID，status：新状态
- **返回值**：更新结果

#### 4.3.2 检验项目接口

- **接口路径**：/api/v1/test-items
- **方法**：GET
- **功能**：获取检验项目列表
- **参数**：
  - pageSize：每页条数
  - pageNum：页码
  - itemCode：项目编码（可选）
  - itemName：项目名称（可选）
  - itemType：项目类型（可选）
- **返回值**：检验项目列表

- **接口路径**：/api/v1/test-items/{itemId}
- **方法**：GET
- **功能**：获取检验项目详情
- **参数**：itemId：项目ID
- **返回值**：检验项目详细信息

- **接口路径**：/api/v1/test-items
- **方法**：POST
- **功能**：新增检验项目
- **参数**：
  - itemCode：项目编码
  - itemName：项目名称
  - itemType：项目类型
  - unit：单位
  - standardMinValue：标准最小值
  - standardMaxValue：标准最大值
  - standardValue：标准值
  - testMethodId：检验方法ID
  - precisionRequirement：精度要求
- **返回值**：创建成功的检验项目信息

### 4.4 检验数据模块接口

#### 4.4.1 检验数据接口

- **接口路径**：/api/v1/test-data
- **方法**：GET
- **功能**：获取检验数据列表
- **参数**：
  - pageSize：每页条数
  - pageNum：页码
  - taskId：任务ID（可选）
  - itemId：检验项目ID（可选）
  - testDateStart：检验开始日期（可选）
  - testDateEnd：检验结束日期（可选）
  - resultStatus：结果状态（可选）
  - reviewStatus：审核状态（可选）
- **返回值**：检验数据列表

- **接口路径**：/api/v1/test-data/{dataId}
- **方法**：GET
- **功能**：获取检验数据详情
- **参数**：dataId：检验数据ID
- **返回值**：检验数据详细信息，包含图谱信息

- **接口路径**：/api/v1/test-data
- **方法**：POST
- **功能**：录入检验数据
- **参数**：
  - taskId：任务ID
  - itemId：检验项目ID
  - testValue：检验值
  - testDate：检验日期
  - instrumentId：仪器ID
  - rawDataFilePath：原始数据文件路径
- **返回值**：创建成功的检验数据

- **接口路径**：/api/v1/test-data/{dataId}
- **方法**：PUT
- **功能**：更新检验数据
- **参数**：dataId：检验数据ID，检验数据信息
- **返回值**：更新后的检验数据

- **接口路径**：/api/v1/test-data/{dataId}/review
- **方法**：PATCH
- **功能**：审核检验数据
- **参数**：dataId：检验数据ID，reviewStatus：审核状态，reviewComment：审核意见
- **返回值**：审核结果

#### 4.4.2 图谱数据接口

- **接口路径**：/api/v1/test-data/{dataId}/charts
- **方法**：GET
- **功能**：获取检验数据的图谱列表
- **参数**：dataId：检验数据ID
- **返回值**：图谱列表

- **接口路径**：/api/v1/test-data/{dataId}/charts
- **方法**：POST
- **功能**：上传图谱数据
- **参数**：
  - dataId：检验数据ID
  - chartName：图谱名称
  - chartType：图谱类型
  - chartData：图谱数据（文件上传或JSON数据）
- **返回值**：上传成功的图谱信息

- **接口路径**：/api/v1/charts/{chartId}
- **方法**：GET
- **功能**：获取图谱详情
- **参数**：chartId：图谱ID
- **返回值**：图谱详细信息

### 4.5 检验报告模块接口

#### 4.5.1 报告管理接口

- **接口路径**：/api/v1/test-reports
- **方法**：GET
- **功能**：获取报告列表
- **参数**：
  - pageSize：每页条数
  - pageNum：页码
  - reportCode：报告编号（可选）
  - taskId：任务ID（可选）
  - sampleId：样品ID（可选）
  - reportStatus：报告状态（可选）
  - generatedDateStart：生成开始日期（可选）
  - generatedDateEnd：生成结束日期（可选）
- **返回值**：报告列表

- **接口路径**：/api/v1/test-reports/{reportId}
- **方法**：GET
- **功能**：获取报告详情
- **参数**：reportId：报告ID
- **返回值**：报告详细信息

- **接口路径**：/api/v1/test-reports
- **方法**：POST
- **功能**：生成检验报告
- **参数**：
  - taskId：任务ID
  - templateId：模板ID
  - reportType：报告类型
- **返回值**：生成的报告信息

- **接口路径**：/api/v1/test-reports/{reportId}/review
- **方法**：PATCH
- **功能**：审核报告
- **参数**：reportId：报告ID，reviewStatus：审核状态，reviewComment：审核意见
- **返回值**：审核结果

- **接口路径**：/api/v1/test-reports/{reportId}/approve
- **方法**：PATCH
- **功能**：批准报告
- **参数**：reportId：报告ID，approvalComment：批准意见
- **返回值**：批准结果

- **接口路径**：/api/v1/test-reports/{reportId}/download
- **方法**：GET
- **功能**：下载报告
- **参数**：reportId：报告ID，format：格式（PDF/Excel等）
- **返回值**：报告文件

#### 4.5.2 报告模板接口

- **接口路径**：/api/v1/report-templates
- **方法**：GET
- **功能**：获取报告模板列表
- **参数**：
  - pageSize：每页条数
  - pageNum：页码
  - templateName：模板名称（可选）
  - templateType：模板类型（可选）
- **返回值**：模板列表

- **接口路径**：/api/v1/report-templates/{templateId}
- **方法**：GET
- **功能**：获取模板详情
- **参数**：templateId：模板ID
- **返回值**：模板详细信息

### 4.6 质量管理模块接口

#### 4.6.1 检验标准接口

- **接口路径**：/api/v1/test-standards
- **方法**：GET
- **功能**：获取检验标准列表
- **参数**：
  - pageSize：每页条数
  - pageNum：页码
  - standardCode：标准编号（可选）
  - standardName：标准名称（可选）
  - standardType：标准类型（可选）
  - status：状态（可选）
- **返回值**：标准列表

- **接口路径**：/api/v1/test-standards/{standardId}
- **方法**：GET
- **功能**：获取标准详情
- **参数**：standardId：标准ID
- **返回值**：标准详细信息

- **接口路径**：/api/v1/test-standards
- **方法**：POST
- **功能**：新增检验标准
- **参数**：
  - standardCode：标准编号
  - standardName：标准名称
  - standardType：标准类型
  - version：版本
  - effectiveDate：生效日期
  - expiryDate：失效日期
  - standardContent：标准内容
  - issuer：发布机构
- **返回值**：创建成功的标准信息

#### 4.6.2 检验方法接口

- **接口路径**：/api/v1/test-methods
- **方法**：GET
- **功能**：获取检验方法列表
- **参数**：
  - pageSize：每页条数
  - pageNum：页码
  - methodCode：方法编号（可选）
  - methodName：方法名称（可选）
  - methodType：方法类型（可选）
  - status：状态（可选）
- **返回值**：方法列表

- **接口路径**：/api/v1/test-methods/{methodId}
- **方法**：GET
- **功能**：获取方法详情
- **参数**：methodId：方法ID
- **返回值**：方法详细信息

#### 4.6.3 质量异常接口

- **接口路径**：/api/v1/quality-exceptions
- **方法**：GET
- **功能**：获取质量异常记录列表
- **参数**：
  - pageSize：每页条数
  - pageNum：页码
  - exceptionCode：异常编号（可选）
  - relatedType：关联类型（可选）
  - relatedId：关联ID（可选）
  - exceptionType：异常类型（可选）
  - status：状态（可选）
  - occurredTimeStart：发生开始时间（可选）
  - occurredTimeEnd：发生结束时间（可选）
- **返回值**：异常记录列表

- **接口路径**：/api/v1/quality-exceptions/{exceptionId}
- **方法**：GET
- **功能**：获取异常详情
- **参数**：exceptionId：异常ID
- **返回值**：异常详细信息

- **接口路径**：/api/v1/quality-exceptions
- **方法**：POST
- **功能**：报告质量异常
- **参数**：
  - relatedType：关联类型
  - relatedId：关联ID
  - exceptionType：异常类型
  - exceptionDesc：异常描述
  - occurredTime：发生时间
- **返回值**：创建成功的异常记录

- **接口路径**：/api/v1/quality-exceptions/{exceptionId}/handle
- **方法**：PATCH
- **功能**：处理质量异常
- **参数**：exceptionId：异常ID，handlingResult：处理结果
- **返回值**：处理结果

## 5. 外部接口设计

### 5.1 与认证子系统接口

- **接口路径**：/api/v1/auth/login
- **方法**：POST
- **功能**：用户登录
- **参数**：
  - username：用户名
  - password：密码
- **返回值**：
  - token：访问令牌
  - userInfo：用户信息
  - roles：用户角色列表

- **接口路径**：/api/v1/auth/logout
- **方法**：POST
- **功能**：用户登出
- **参数**：无
- **返回值**：登出结果

- **接口路径**：/api/v1/auth/validate
- **方法**：POST
- **功能**：验证令牌
- **参数**：token：访问令牌
- **返回值**：令牌是否有效

### 5.2 与生产管理系统接口

- **接口路径**：/api/v1/external/production/samples
- **方法**：POST
- **功能**：接收生产系统送样信息
- **参数**：
  - productCode：产品编码
  - productName：产品名称
  - batchNumber：批次号
  - productionDate：生产日期
  - quantity：数量
  - unit：单位
  - requestDept：申请部门
  - requestPerson：申请人
  - testRequirements：检验要求（JSON格式）
- **返回值**：
  - sampleId：样品ID
  - sampleCode：样品编号
  - status：处理状态

- **接口路径**：/api/v1/external/production/reports
- **方法**：GET
- **功能**：提供检验报告给生产系统
- **参数**：
  - batchNumber：批次号（可选）
  - reportId：报告ID（可选）
  - reportCode：报告编号（可选）
- **返回值**：报告详细信息

### 5.3 与设备管理系统接口

- **接口路径**：/api/v1/external/equipment/instruments
- **方法**：GET
- **功能**：获取设备列表
- **参数**：
  - pageSize：每页条数
  - pageNum：页码
  - instrumentCode：设备编码（可选）
  - instrumentName：设备名称（可选）
  - status：状态（可选）
- **返回值**：设备列表

- **接口路径**：/api/v1/external/equipment/maintenance-records
- **方法**：GET
- **功能**：获取设备维护记录
- **参数**：
  - instrumentId：设备ID
  - maintenanceDateStart：维护开始日期（可选）
  - maintenanceDateEnd：维护结束日期（可选）
- **返回值**：维护记录列表

- **接口路径**：/api/v1/external/equipment/usage-logs
- **方法**：POST
- **功能**：记录设备使用日志
- **参数**：
  - instrumentId：设备ID
  - usageStartTime：使用开始时间
  - usageEndTime：使用结束时间
  - operatorId：操作人员ID
  - testTaskId：检验任务ID（可选）
  - usageDescription：使用说明
- **返回值**：日志记录结果

### 5.4 与仓库管理系统接口

- **接口路径**：/api/v1/external/warehouse/reagents
- **方法**：GET
- **功能**：获取试剂列表
- **参数**：
  - pageSize：每页条数
  - pageNum：页码
  - reagentCode：试剂编码（可选）
  - reagentName：试剂名称（可选）
  - specification：规格（可选）
  - manufacturer：生产厂家（可选）
  - status：状态（可选）
- **返回值**：试剂列表

- **接口路径**：/api/v1/external/warehouse/reagents/usage
- **方法**：POST
- **功能**：记录试剂使用
- **参数**：
  - reagentId：试剂ID
  - quantity：使用数量
  - unit：单位
  - usageDate：使用日期
  - operatorId：操作人员ID
  - testTaskId：检验任务ID（可选）
  - purpose：用途
- **返回值**：使用记录结果

### 5.5 与移动端接口

- **接口路径**：/api/v1/mobile/login
- **方法**：POST
- **功能**：移动端用户登录
- **参数**：
  - username：用户名
  - password：密码
- **返回值**：
  - token：访问令牌
  - userInfo：用户信息

- **接口路径**：/api/v1/mobile/samples/scan
- **方法**：POST
- **功能**：移动端扫描样品条码
- **参数**：sampleCode：样品编号
- **返回值**：样品信息和相关任务

- **接口路径**：/api/v1/mobile/test-tasks/my
- **方法**：GET
- **功能**：获取移动端用户的任务列表
- **参数**：status：状态（可选）
- **返回值**：任务列表

- **接口路径**：/api/v1/mobile/test-data/quick-entry
- **方法**：POST
- **功能**：移动端快速录入检验数据
- **参数**：
  - taskId：任务ID
  - itemId：检验项目ID
  - testValue：检验值
  - testDate：检验日期
  - instrumentId：仪器ID（可选）
- **返回值**：录入结果

## 6. 接口安全要求

### 6.1 认证与授权

- **JWT认证**：使用JWT令牌进行身份认证
- **令牌有效期**：访问令牌有效期为8小时，刷新令牌有效期为7天
- **权限校验**：基于用户角色和权限进行接口访问控制
- **细粒度授权**：支持对具体操作的授权控制（如查看、编辑、删除等）

### 6.2 数据安全

- **HTTPS传输**：所有接口调用必须使用HTTPS加密传输
- **参数校验**：严格校验所有输入参数，防止SQL注入、XSS等攻击
- **敏感数据脱敏**：返回数据中对敏感信息进行脱敏处理
- **数据传输量限制**：限制单次接口调用的数据传输量

### 6.3 访问控制

- **IP白名单**：关键接口支持IP白名单限制
- **请求限流**：实现接口请求频率限制，防止DDoS攻击
- **会话管理**：支持会话过期和并发会话控制
- **操作日志**：记录所有关键接口调用的操作日志

## 7. 接口性能要求

### 7.1 响应时间

- **常规接口**：响应时间不超过500ms
- **复杂查询接口**：响应时间不超过2000ms
- **文件上传下载接口**：根据文件大小合理设置超时时间

### 7.2 并发处理

- **支持并发数**：系统同时支持的最大并发请求数不少于100
- **QPS要求**：系统每秒处理的查询请求数(QPS)不少于50
- **TPS要求**：系统每秒处理的事务请求数(TPS)不少于20

## 8. 接口文档化

- **Swagger文档**：提供Swagger格式的接口文档
- **接口测试工具**：集成接口测试工具，支持在线测试
- **变更日志**：维护接口变更日志，记录版本变更内容
- **示例代码**：提供各接口的调用示例代码

## 9. 文档维护

- **文档版本**：v1.0
- **编制日期**：2023年10月25日
- **编制人**：技术部
- **审核人**：系统架构师
- **批准人**：技术总监

---

本文档将随着系统设计的深入和业务需求的变化而定期更新，确保接口设计与实际需求保持一致。
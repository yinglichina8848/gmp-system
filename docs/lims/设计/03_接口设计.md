# LIMS子系统（实验室管理系统）接口设计

## 1. 接口设计概述

### 1.1 设计原则

- **RESTful架构**：遵循RESTful API设计规范，使用HTTP方法表示操作语义
- **标准化接口**：统一的接口命名、参数格式和返回结构
- **安全性优先**：实现完善的认证、授权和数据安全机制
- **可扩展性**：接口设计考虑未来业务增长和功能扩展
- **中药检验特色**：针对中药材检测业务的特殊需求进行定制
- **版本控制**：实现API版本管理，确保向后兼容

### 1.2 接口分类

- **核心业务接口**：处理样品管理、检测任务、检测数据等核心业务流程
- **中药特色接口**：支持传统鉴别、指纹图谱分析、道地性评估等特色功能
- **系统管理接口**：提供用户权限、系统配置等管理功能
- **集成接口**：与其他子系统进行数据交换的接口

## 2. 接口规范

### 2.1 基础信息

- **API前缀**：`/api/v1/lims`
- **请求方法**：GET、POST、PUT、DELETE、PATCH
- **数据格式**：JSON
- **字符编码**：UTF-8
- **认证方式**：OAuth 2.0 + JWT Token

### 2.2 响应格式

```json
{
  "code": 200,                     // 状态码
  "message": "操作成功",           // 状态消息
  "data": { ... },                 // 业务数据
  "pagination": {                  // 分页信息（可选）
    "total": 100,
    "page": 1,
    "pageSize": 20
  },
  "timestamp": 1623456789000       // 时间戳
}
```

### 2.3 错误响应

```json
{
  "code": 400,                     // 错误码
  "message": "参数错误",           // 错误消息
  "error": "InvalidParameter",    // 错误类型
  "details": [                     // 详细错误信息
    {
      "field": "sampleName",
      "message": "样品名称不能为空"
    }
  ],
  "timestamp": 1623456789000       // 时间戳
}
```

### 2.4 状态码定义

| 状态码 | 含义 | 描述 |
| :--- | :--- | :--- |
| 200 | OK | 请求成功 |
| 201 | Created | 资源创建成功 |
| 204 | No Content | 请求成功但无内容返回 |
| 400 | Bad Request | 请求参数错误 |
| 401 | Unauthorized | 未授权，请先登录 |
| 403 | Forbidden | 拒绝访问，权限不足 |
| 404 | Not Found | 请求的资源不存在 |
| 405 | Method Not Allowed | 请求方法不允许 |
| 500 | Internal Server Error | 服务器内部错误 |
| 502 | Bad Gateway | 网关错误 |
| 503 | Service Unavailable | 服务不可用 |

## 3. 核心业务接口

### 3.1 样品管理接口

#### 3.1.1 样品基础管理

##### **创建样品**
- **URL**: `/api/v1/lims/samples`
- **方法**: `POST`
- **描述**: 创建新的样品记录
- **请求体**:
  ```json
  {
    "sampleCode": "CMT-20251123-001",
    "sampleName": "黄芪",
    "scientificName": "Astragalus membranaceus",
    "variety": "蒙古黄芪",
    "origin": "内蒙古",
    "originStandard": "道地药材",
    "supplierId": "uuid-xxx-xxx",
    "batchNumber": "20251123-001",
    "productionDate": "2025-11-01",
    "expiryDate": "2026-11-01",
    "quantity": 500.00,
    "unit": "g",
    "storageCondition": "阴凉干燥",
    "qualityLevel": "一等品",
    "initialCheckResult": "外观良好，无霉变"
  }
  ```
- **成功响应**:
  ```json
  {
    "code": 201,
    "message": "样品创建成功",
    "data": {
      "sampleId": "uuid-xxx-xxx",
      "sampleCode": "CMT-20251123-001",
      "sampleName": "黄芪",
      // 其他样品信息
    },
    "timestamp": 1623456789000
  }
  ```

##### **查询样品列表**
- **URL**: `/api/v1/lims/samples`
- **方法**: `GET`
- **描述**: 分页查询样品列表，支持多种筛选条件
- **查询参数**:
  - `page`: 页码，默认1
  - `pageSize`: 每页数量，默认20
  - `sampleName`: 样品名称（模糊查询）
  - `sampleCode`: 样品编号
  - `origin`: 产地
  - `status`: 样品状态
  - `startDate`: 接收开始日期
  - `endDate`: 接收结束日期
- **成功响应**:
  ```json
  {
    "code": 200,
    "message": "查询成功",
    "data": [
      {
        "sampleId": "uuid-xxx-xxx",
        "sampleCode": "CMT-20251123-001",
        "sampleName": "黄芪",
        "origin": "内蒙古",
        "sampleStatus": "已接收",
        "receiveDate": "2025-11-23T10:30:00Z",
        // 其他信息
      }
    ],
    "pagination": {
      "total": 100,
      "page": 1,
      "pageSize": 20
    },
    "timestamp": 1623456789000
  }
  ```

##### **查询样品详情**
- **URL**: `/api/v1/lims/samples/{sampleId}`
- **方法**: `GET`
- **描述**: 获取单个样品的详细信息
- **路径参数**:
  - `sampleId`: 样品ID
- **成功响应**:
  ```json
  {
    "code": 200,
    "message": "查询成功",
    "data": {
      "sampleId": "uuid-xxx-xxx",
      "sampleCode": "CMT-20251123-001",
      "sampleName": "黄芪",
      "scientificName": "Astragalus membranaceus",
      "variety": "蒙古黄芪",
      "origin": "内蒙古",
      "originStandard": "道地药材",
      "supplier": {
        "supplierId": "uuid-xxx-xxx",
        "supplierName": "XX中药材公司"
      },
      "batchNumber": "20251123-001",
      "productionDate": "2025-11-01",
      "expiryDate": "2026-11-01",
      "quantity": 500.00,
      "unit": "g",
      "storageCondition": "阴凉干燥",
      "currentLocation": "样品库A区1号柜",
      "sampleStatus": "已接收",
      "receiveDate": "2025-11-23T10:30:00Z",
      "receivedBy": {
        "userId": "uuid-xxx-xxx",
        "realName": "张三"
      },
      "qualityLevel": "一等品",
      "initialCheckResult": "外观良好，无霉变",
      "createdAt": "2025-11-23T10:30:00Z",
      "updatedAt": "2025-11-23T10:30:00Z"
    },
    "timestamp": 1623456789000
  }
  ```

##### **更新样品信息**
- **URL**: `/api/v1/lims/samples/{sampleId}`
- **方法**: `PUT`
- **描述**: 更新样品信息
- **路径参数**:
  - `sampleId`: 样品ID
- **请求体**:
  ```json
  {
    "storageCondition": "阴凉干燥，防虫蛀",
    "currentLocation": "样品库B区3号柜",
    "qualityLevel": "特等品"
  }
  ```
- **成功响应**:
  ```json
  {
    "code": 200,
    "message": "样品信息更新成功",
    "data": {
      "sampleId": "uuid-xxx-xxx",
      "sampleCode": "CMT-20251123-001",
      // 更新后的样品信息
    },
    "timestamp": 1623456789000
  }
  ```

##### **更新样品状态**
- **URL**: `/api/v1/lims/samples/{sampleId}/status`
- **方法**: `PATCH`
- **描述**: 更新样品状态
- **路径参数**:
  - `sampleId`: 样品ID
- **请求体**:
  ```json
  {
    "sampleStatus": "检测中",
    "remark": "样品已转移至实验室"
  }
  ```
- **成功响应**:
  ```json
  {
    "code": 200,
    "message": "样品状态更新成功",
    "data": {
      "sampleId": "uuid-xxx-xxx",
      "sampleStatus": "检测中",
      "updatedAt": "2025-11-24T09:15:00Z"
    },
    "timestamp": 1623456789000
  }
  ```

#### 3.1.2 样品查询与统计

##### **样品统计分析**
- **URL**: `/api/v1/lims/samples/statistics`
- **方法**: `GET`
- **描述**: 获取样品统计信息
- **查询参数**:
  - `byStatus`: 是否按状态统计，默认true
  - `byOrigin`: 是否按产地统计，默认true
  - `byType`: 是否按类型统计，默认true
  - `startDate`: 统计开始日期
  - `endDate`: 统计结束日期
- **成功响应**:
  ```json
  {
    "code": 200,
    "message": "统计成功",
    "data": {
      "totalCount": 1500,
      "byStatus": [
        { "status": "已接收", "count": 120 },
        { "status": "检测中", "count": 450 },
        { "status": "已完成", "count": 930 }
      ],
      "byOrigin": [
        { "origin": "内蒙古", "count": 320 },
        { "origin": "浙江", "count": 280 },
        { "origin": "四川", "count": 450 }
      ],
      "byType": [
        { "type": "根及根茎类", "count": 680 },
        { "type": "果实种子类", "count": 420 },
        { "type": "全草类", "count": 400 }
      ]
    },
    "timestamp": 1623456789000
  }
  ```

### 3.2 检测任务管理接口

#### 3.2.1 检测任务基础管理

##### **创建检测任务**
- **URL**: `/api/v1/lims/test-tasks`
- **方法**: `POST`
- **描述**: 创建新的检测任务
- **请求体**:
  ```json
  {
    "sampleId": "uuid-xxx-xxx",
    "testType": "全项检测",
    "priority": "高",
    "assignedTo": "uuid-xxx-xxx",
    "dueDate": "2025-11-30T17:00:00Z",
    "testItems": [
      {
        "methodId": "uuid-xxx-xxx",
        "specification": "符合2020版中国药典",
        "unit": "%",
        "lowerLimit": 0.3,
        "upperLimit": 0.6
      }
    ]
  }
  ```
- **成功响应**:
  ```json
  {
    "code": 201,
    "message": "检测任务创建成功",
    "data": {
      "taskId": "uuid-xxx-xxx",
      "taskCode": "TK-20251123-001",
      "sampleId": "uuid-xxx-xxx",
      "testType": "全项检测",
      "taskStatus": "待执行",
      "createdAt": "2025-11-23T14:30:00Z"
    },
    "timestamp": 1623456789000
  }
  ```

##### **查询检测任务列表**
- **URL**: `/api/v1/lims/test-tasks`
- **方法**: `GET`
- **描述**: 分页查询检测任务列表
- **查询参数**:
  - `page`: 页码，默认1
  - `pageSize`: 每页数量，默认20
  - `sampleCode`: 样品编号
  - `sampleName`: 样品名称
  - `taskStatus`: 任务状态
  - `assignedTo`: 任务执行人ID
  - `startDate`: 创建开始日期
  - `endDate`: 创建结束日期
- **成功响应**:
  ```json
  {
    "code": 200,
    "message": "查询成功",
    "data": [
      {
        "taskId": "uuid-xxx-xxx",
        "taskCode": "TK-20251123-001",
        "sampleCode": "CMT-20251123-001",
        "sampleName": "黄芪",
        "testType": "全项检测",
        "taskStatus": "待执行",
        "priority": "高",
        "assignedTo": {
          "userId": "uuid-xxx-xxx",
          "realName": "李四"
        },
        "createdAt": "2025-11-23T14:30:00Z",
        "dueDate": "2025-11-30T17:00:00Z"
      }
    ],
    "pagination": {
      "total": 80,
      "page": 1,
      "pageSize": 20
    },
    "timestamp": 1623456789000
  }
  ```

##### **获取任务详情**
- **URL**: `/api/v1/lims/test-tasks/{taskId}`
- **方法**: `GET`
- **描述**: 获取检测任务的详细信息，包括检测项目
- **路径参数**:
  - `taskId`: 任务ID
- **成功响应**:
  ```json
  {
    "code": 200,
    "message": "查询成功",
    "data": {
      "taskId": "uuid-xxx-xxx",
      "taskCode": "TK-20251123-001",
      "sample": {
        "sampleId": "uuid-xxx-xxx",
        "sampleCode": "CMT-20251123-001",
        "sampleName": "黄芪"
      },
      "testType": "全项检测",
      "taskStatus": "待执行",
      "priority": "高",
      "assignedTo": {
        "userId": "uuid-xxx-xxx",
        "realName": "李四"
      },
      "createdBy": {
        "userId": "uuid-xxx-xxx",
        "realName": "张三"
      },
      "createdAt": "2025-11-23T14:30:00Z",
      "dueDate": "2025-11-30T17:00:00Z",
      "testItems": [
        {
          "itemId": "uuid-xxx-xxx",
          "methodId": "uuid-xxx-xxx",
          "methodName": "黄芪甲苷含量测定",
          "itemStatus": "待执行",
          "specification": "符合2020版中国药典",
          "unit": "%",
          "lowerLimit": 0.3,
          "upperLimit": 0.6
        }
      ]
    },
    "timestamp": 1623456789000
  }
  ```

##### **更新任务状态**
- **URL**: `/api/v1/lims/test-tasks/{taskId}/status`
- **方法**: `PATCH`
- **描述**: 更新检测任务状态
- **路径参数**:
  - `taskId`: 任务ID
- **请求体**:
  ```json
  {
    "taskStatus": "进行中",
    "remark": "任务开始执行"
  }
  ```
- **成功响应**:
  ```json
  {
    "code": 200,
    "message": "任务状态更新成功",
    "data": {
      "taskId": "uuid-xxx-xxx",
      "taskStatus": "进行中",
      "updatedAt": "2025-11-24T09:00:00Z"
    },
    "timestamp": 1623456789000
  }
  ```

##### **批量分配任务**
- **URL**: `/api/v1/lims/test-tasks/batch-assign`
- **方法**: `POST`
- **描述**: 批量分配检测任务
- **请求体**:
  ```json
  {
    "taskIds": ["uuid-xxx-1", "uuid-xxx-2", "uuid-xxx-3"],
    "assignedTo": "uuid-xxx-xxx",
    "dueDate": "2025-11-30T17:00:00Z",
    "remark": "批量分配本周任务"
  }
  ```
- **成功响应**:
  ```json
  {
    "code": 200,
    "message": "任务分配成功",
    "data": {
      "successCount": 3,
      "failedCount": 0,
      "taskIds": ["uuid-xxx-1", "uuid-xxx-2", "uuid-xxx-3"]
    },
    "timestamp": 1623456789000
  }
  ```

#### 3.2.2 检测方法管理

##### **查询检测方法列表**
- **URL**: `/api/v1/lims/test-methods`
- **方法**: `GET`
- **描述**: 查询检测方法列表
- **查询参数**:
  - `page`: 页码，默认1
  - `pageSize`: 每页数量，默认20
  - `methodName`: 方法名称（模糊查询）
  - `methodType`: 方法类型
  - `category`: 方法类别
  - `status`: 方法状态
- **成功响应**:
  ```json
  {
    "code": 200,
    "message": "查询成功",
    "data": [
      {
        "methodId": "uuid-xxx-xxx",
        "methodCode": "MTH-001",
        "methodName": "黄芪甲苷含量测定",
        "methodType": "含量测定",
        "category": "HPLC",
        "standardReference": "中国药典2020版一部",
        "status": "有效",
        "version": "1.0"
      }
    ],
    "pagination": {
      "total": 120,
      "page": 1,
      "pageSize": 20
    },
    "timestamp": 1623456789000
  }
  ```

### 3.3 检测数据管理接口

#### 3.3.1 检测结果录入

##### **录入检测结果**
- **URL**: `/api/v1/lims/test-results`
- **方法**: `POST`
- **描述**: 录入检测结果
- **请求体**:
  ```json
  {
    "itemId": "uuid-xxx-xxx",
    "actualValue": 0.45,
    "unit": "%",
    "isQualified": true,
    "testDate": "2025-11-24T10:30:00Z",
    "instrumentId": "uuid-xxx-xxx",
    "remark": "平行样测定结果一致"
  }
  ```
- **成功响应**:
  ```json
  {
    "code": 201,
    "message": "检测结果录入成功",
    "data": {
      "resultId": "uuid-xxx-xxx",
      "itemId": "uuid-xxx-xxx",
      "actualValue": 0.45,
      "isQualified": true,
      "testDate": "2025-11-24T10:30:00Z"
    },
    "timestamp": 1623456789000
  }
  ```

##### **批量录入结果**
- **URL**: `/api/v1/lims/test-results/batch`
- **方法**: `POST`
- **描述**: 批量录入检测结果
- **请求体**:
  ```json
  {
    "results": [
      {
        "itemId": "uuid-xxx-1",
        "actualValue": 0.45,
        "unit": "%",
        "isQualified": true,
        "testDate": "2025-11-24T10:30:00Z"
      },
      {
        "itemId": "uuid-xxx-2",
        "actualValue": 0.23,
        "unit": "%",
        "isQualified": true,
        "testDate": "2025-11-24T10:45:00Z"
      }
    ]
  }
  ```
- **成功响应**:
  ```json
  {
    "code": 200,
    "message": "批量录入成功",
    "data": {
      "successCount": 2,
      "failedCount": 0,
      "results": [
        {
          "itemId": "uuid-xxx-1",
          "resultId": "uuid-result-1"
        },
        {
          "itemId": "uuid-xxx-2",
          "resultId": "uuid-result-2"
        }
      ]
    },
    "timestamp": 1623456789000
  }
  ```

##### **查询检测结果**
- **URL**: `/api/v1/lims/test-results`
- **方法**: `GET`
- **描述**: 查询检测结果
- **查询参数**:
  - `page`: 页码，默认1
  - `pageSize`: 每页数量，默认20
  - `sampleCode`: 样品编号
  - `taskId`: 任务ID
  - `itemId`: 项目ID
  - `testDate`: 检测日期
  - `testedBy`: 检测人ID
  - `isQualified`: 是否合格
- **成功响应**:
  ```json
  {
    "code": 200,
    "message": "查询成功",
    "data": [
      {
        "resultId": "uuid-xxx-xxx",
        "itemId": "uuid-xxx-xxx",
        "sampleCode": "CMT-20251123-001",
        "sampleName": "黄芪",
        "methodName": "黄芪甲苷含量测定",
        "actualValue": 0.45,
        "unit": "%",
        "specification": "0.3-0.6%",
        "isQualified": true,
        "testDate": "2025-11-24T10:30:00Z",
        "testedBy": {
          "userId": "uuid-xxx-xxx",
          "realName": "李四"
        },
        "auditStatus": "待审核"
      }
    ],
    "pagination": {
      "total": 150,
      "page": 1,
      "pageSize": 20
    },
    "timestamp": 1623456789000
  }
  ```

#### 3.3.2 检测结果审核

##### **审核检测结果**
- **URL**: `/api/v1/lims/test-results/{resultId}/audit`
- **方法**: `POST`
- **描述**: 审核检测结果
- **路径参数**:
  - `resultId`: 结果ID
- **请求体**:
  ```json
  {
    "auditStatus": "通过",
    "auditComment": "检测结果符合标准",
    "auditedBy": "uuid-xxx-xxx"
  }
  ```
- **成功响应**:
  ```json
  {
    "code": 200,
    "message": "审核成功",
    "data": {
      "resultId": "uuid-xxx-xxx",
      "auditStatus": "通过",
      "auditDate": "2025-11-25T14:30:00Z",
      "auditedBy": {
        "userId": "uuid-xxx-xxx",
        "realName": "王五"
      }
    },
    "timestamp": 1623456789000
  }
  ```

##### **批量审核结果**
- **URL**: `/api/v1/lims/test-results/batch-audit`
- **方法**: `POST`
- **描述**: 批量审核检测结果
- **请求体**:
  ```json
  {
    "resultIds": ["uuid-xxx-1", "uuid-xxx-2"],
    "auditStatus": "通过",
    "auditComment": "批量审核通过",
    "auditedBy": "uuid-xxx-xxx"
  }
  ```
- **成功响应**:
  ```json
  {
    "code": 200,
    "message": "批量审核成功",
    "data": {
      "successCount": 2,
      "failedCount": 0
    },
    "timestamp": 1623456789000
  }
  ```

## 4. 中药特色接口

### 4.1 传统鉴别接口

#### 4.1.1 传统鉴别管理

##### **创建传统鉴别记录**
- **URL**: `/api/v1/lims/authentications`
- **方法**: `POST`
- **描述**: 创建传统鉴别记录
- **请求体**:
  ```json
  {
    "sampleId": "uuid-xxx-xxx",
    "authenticationType": "性状鉴别",
    "characteristics": {
      "externalFeatures": {
        "color": "棕色",
        "texture": "粗糙",
        "shape": "圆柱形",
        "size": "直径1-2cm",
        "odor": "特异",
        "taste": "苦"
      },
      "microscopicFeatures": {
        "cellTypes": ["纤维细胞", "导管细胞"],
        "crystalTypes": ["草酸钙簇晶"],
        "starchGrains": true
      }
    },
    "conclusion": "符合规定",
    "reference": "中国药典2020版一部"
  }
  ```
- **成功响应**:
  ```json
  {
    "code": 201,
    "message": "鉴别记录创建成功",
    "data": {
      "authenticationId": "uuid-xxx-xxx",
      "sampleId": "uuid-xxx-xxx",
      "authenticationType": "性状鉴别",
      "conclusion": "符合规定",
      "createdAt": "2025-11-24T11:00:00Z"
    },
    "timestamp": 1623456789000
  }
  ```

##### **上传鉴别图片**
- **URL**: `/api/v1/lims/authentications/{authenticationId}/images`
- **方法**: `POST`
- **描述**: 上传传统鉴别图片
- **路径参数**:
  - `authenticationId`: 鉴别记录ID
- **请求体**: Multipart/form-data
  - `images[]`: 图片文件数组
- **成功响应**:
  ```json
  {
    "code": 200,
    "message": "图片上传成功",
    "data": {
      "imageUrls": [
        "https://storage.example.com/authentications/img1.jpg",
        "https://storage.example.com/authentications/img2.jpg"
      ]
    },
    "timestamp": 1623456789000
  }
  ```

##### **查询传统鉴别记录**
- **URL**: `/api/v1/lims/authentications`
- **方法**: `GET`
- **描述**: 查询传统鉴别记录
- **查询参数**:
  - `page`: 页码，默认1
  - `pageSize`: 每页数量，默认20
  - `sampleCode`: 样品编号
  - `sampleName`: 样品名称
  - `authenticationType`: 鉴别类型
  - `conclusion`: 鉴别结论
  - `startDate`: 开始日期
  - `endDate`: 结束日期
- **成功响应**:
  ```json
  {
    "code": 200,
    "message": "查询成功",
    "data": [
      {
        "authenticationId": "uuid-xxx-xxx",
        "sampleCode": "CMT-20251123-001",
        "sampleName": "黄芪",
        "authenticationType": "性状鉴别",
        "conclusion": "符合规定",
        "reference": "中国药典2020版一部",
        "authenticatedBy": {
          "userId": "uuid-xxx-xxx",
          "realName": "赵六"
        },
        "authenticationDate": "2025-11-24T11:00:00Z",
        "imageCount": 3
      }
    ],
    "pagination": {
      "total": 60,
      "page": 1,
      "pageSize": 20
    },
    "timestamp": 1623456789000
  }
  ```

### 4.2 指纹图谱接口

#### 4.2.1 指纹图谱管理

##### **上传指纹图谱数据**
- **URL**: `/api/v1/lims/fingerprints`
- **方法**: `POST`
- **描述**: 上传指纹图谱数据
- **请求体**:
  ```json
  {
    "sampleId": "uuid-xxx-xxx",
    "methodId": "uuid-xxx-xxx",
    "chromatogramData": {
      "retentionTimes": [1.2, 1.5, 2.3, 3.1, 4.5],
      "peakAreas": [1234, 5678, 9012, 4321, 6789],
      "peakHeights": [123, 456, 789, 321, 567],
      "resolution": 1.5
    },
    "metadata": {
      "instrumentSettings": {
        "column": "C18",
        "mobilePhase": "乙腈-水",
        "flowRate": 1.0
      }
    }
  }
  ```
- **成功响应**:
  ```json
  {
    "code": 201,
    "message": "指纹图谱数据上传成功",
    "data": {
      "fingerprintId": "uuid-xxx-xxx",
      "sampleId": "uuid-xxx-xxx",
      "analysisDate": "2025-11-24T13:00:00Z"
    },
    "timestamp": 1623456789000
  }
  ```

##### **指纹图谱相似度计算**
- **URL**: `/api/v1/lims/fingerprints/{fingerprintId}/similarity`
- **方法**: `POST`
- **描述**: 计算指纹图谱相似度
- **路径参数**:
  - `fingerprintId`: 指纹图谱ID
- **请求体**:
  ```json
  {
    "standardFingerprintId": "uuid-standard-xxx",
    "algorithmType": "correlation" // correlation或cosine
  }
  ```
- **成功响应**:
  ```json
  {
    "code": 200,
    "message": "相似度计算成功",
    "data": {
      "similarityScore": 0.95,
      "algorithmType": "correlation",
      "characteristicPeaks": [
        {
          "peakNumber": 1,
          "retentionTime": 1.2,
          "areaRatio": 0.23
        },
        {
          "peakNumber": 2,
          "retentionTime": 2.3,
          "areaRatio": 0.45
        }
      ],
      "differentialPeaks": []
    },
    "timestamp": 1623456789000
  }
  ```

##### **查询指纹图谱列表**
- **URL**: `/api/v1/lims/fingerprints`
- **方法**: `GET`
- **描述**: 查询指纹图谱列表
- **查询参数**:
  - `page`: 页码，默认1
  - `pageSize`: 每页数量，默认20
  - `sampleCode`: 样品编号
  - `sampleName`: 样品名称
  - `methodId`: 方法ID
  - `minSimilarity`: 最小相似度
  - `startDate`: 开始日期
  - `endDate`: 结束日期
- **成功响应**:
  ```json
  {
    "code": 200,
    "message": "查询成功",
    "data": [
      {
        "fingerprintId": "uuid-xxx-xxx",
        "sampleCode": "CMT-20251123-001",
        "sampleName": "黄芪",
        "methodName": "HPLC指纹图谱",
        "analysisDate": "2025-11-24T13:00:00Z",
        "similarityScore": 0.95,
        "analyst": {
          "userId": "uuid-xxx-xxx",
          "realName": "孙七"
        }
      }
    ],
    "pagination": {
      "total": 45,
      "page": 1,
      "pageSize": 20
    },
    "timestamp": 1623456789000
  }
  ```

### 4.3 道地性评估接口

#### 4.3.1 道地性评估管理

##### **创建道地性评估记录**
- **URL**: `/api/v1/lims/geo-assessments`
- **方法**: `POST`
- **描述**: 创建道地性评估记录
- **请求体**:
  ```json
  {
    "sampleId": "uuid-xxx-xxx",
    "originInfo": {
      "declaredOrigin": "浙江省磐安县",
      "actualOrigin": "浙江省磐安县",
      "growingEnvironment": {
        "elevation": 800,
        "climateType": "亚热带季风气候",
        "soilType": "红壤"
      }
    },
    "characteristicComponents": [
      {
        "componentName": "有效成分A",
        "content": 1.2,
        "unit": "%",
        "referenceRange": "1.0-1.5%",
        "similarityScore": 0.98
      },
      {
        "componentName": "有效成分B",
        "content": 0.8,
        "unit": "%",
        "referenceRange": "0.5-1.0%",
        "similarityScore": 0.96
      }
    ],
    "traceElementsFingerprint": {
      "elementRatios": {
        "Cu/Zn": 0.5,
        "Fe/Mn": 2.3
      },
      "fingerprintSimilarity": 0.92
    }
  }
  ```
- **成功响应**:
  ```json
  {
    "code": 201,
    "message": "道地性评估记录创建成功",
    "data": {
      "geoAssessmentId": "uuid-xxx-xxx",
      "sampleId": "uuid-xxx-xxx",
      "assessmentDate": "2025-11-24T15:00:00Z",
      "geoAuthenticityScore": 0.94,
      "assessmentConclusion": "符合道地药材特征"
    },
    "timestamp": 1623456789000
  }
  ```

##### **查询道地性评估列表**
- **URL**: `/api/v1/lims/geo-assessments`
- **方法**: `GET`
- **描述**: 查询道地性评估列表
- **查询参数**:
  - `page`: 页码，默认1
  - `pageSize`: 每页数量，默认20
  - `sampleCode`: 样品编号
  - `sampleName`: 样品名称
  - `declaredOrigin`: 标称产地
  - `minScore`: 最小道地性评分
  - `startDate`: 开始日期
  - `endDate`: 结束日期
- **成功响应**:
  ```json
  {
    "code": 200,
    "message": "查询成功",
    "data": [
      {
        "geoAssessmentId": "uuid-xxx-xxx",
        "sampleCode": "CMT-20251123-001",
        "sampleName": "黄芪",
        "declaredOrigin": "浙江省磐安县",
        "actualOrigin": "浙江省磐安县",
        "geoAuthenticityScore": 0.94,
        "assessmentConclusion": "符合道地药材特征",
        "assessmentDate": "2025-11-24T15:00:00Z",
        "assessor": {
          "userId": "uuid-xxx-xxx",
          "realName": "周八"
        }
      }
    ],
    "pagination": {
      "total": 30,
      "page": 1,
      "pageSize": 20
    },
    "timestamp": 1623456789000
  }
  ```

## 5. 系统管理接口

### 5.1 用户管理接口

##### **查询用户列表**
- **URL**: `/api/v1/lims/users`
- **方法**: `GET`
- **描述**: 查询用户列表
- **查询参数**:
  - `page`: 页码，默认1
  - `pageSize`: 每页数量，默认20
  - `username`: 用户名（模糊查询）
  - `realName`: 真实姓名（模糊查询）
  - `departmentId`: 部门ID
  - `status`: 用户状态
- **成功响应**:
  ```json
  {
    "code": 200,
    "message": "查询成功",
    "data": [
      {
        "userId": "uuid-xxx-xxx",
        "username": "zhangsan",
        "realName": "张三",
        "department": {
          "departmentId": "uuid-xxx-xxx",
          "departmentName": "质量部"
        },
        "position": "质量经理",
        "role": {
          "roleId": "uuid-xxx-xxx",
          "roleName": "管理员"
        },
        "status": "启用",
        "lastLoginAt": "2025-11-24T08:30:00Z"
      }
    ],
    "pagination": {
      "total": 50,
      "page": 1,
      "pageSize": 20
    },
    "timestamp": 1623456789000
  }
  ```

### 5.2 日志管理接口

##### **查询操作日志**
- **URL**: `/api/v1/lims/operation-logs`
- **方法**: `GET`
- **描述**: 查询操作日志
- **查询参数**:
  - `page`: 页码，默认1
  - `pageSize`: 每页数量，默认20
  - `username`: 操作用户名
  - `operationType`: 操作类型
  - `entityType`: 实体类型
  - `startDate`: 开始日期
  - `endDate`: 结束日期
- **成功响应**:
  ```json
  {
    "code": 200,
    "message": "查询成功",
    "data": [
      {
        "logId": "uuid-xxx-xxx",
        "username": "zhangsan",
        "realName": "张三",
        "operationType": "CREATE",
        "entityType": "SAMPLE",
        "operationDetail": "创建样品：CMT-20251123-001",
        "operationIp": "192.168.1.100",
        "createdAt": "2025-11-23T10:30:00Z"
      }
    ],
    "pagination": {
      "total": 2000,
      "page": 1,
      "pageSize": 20
    },
    "timestamp": 1623456789000
  }
  ```

## 6. 集成接口

### 6.1 认证集成接口

##### **获取当前用户信息**
- **URL**: `/api/v1/lims/auth/current-user`
- **方法**: `GET`
- **描述**: 获取当前登录用户信息
- **成功响应**:
  ```json
  {
    "code": 200,
    "message": "查询成功",
    "data": {
      "userId": "uuid-xxx-xxx",
      "username": "zhangsan",
      "realName": "张三",
      "departmentId": "uuid-xxx-xxx",
      "departmentName": "质量部",
      "roleId": "uuid-xxx-xxx",
      "roleName": "管理员",
      "permissions": ["sample:view", "sample:create", "task:assign"]
    },
    "timestamp": 1623456789000
  }
  ```

### 6.2 外部系统集成

##### **与生产系统集成接口**
- **URL**: `/api/v1/lims/integration/production/samples`
- **方法**: `POST`
- **描述**: 从生产系统接收样品信息
- **请求体**:
  ```json
  {
    "batchCode": "P2025112301",
    "productCode": "CP001",
    "productName": "黄芪饮片",
    "productionDate": "2025-11-20",
    "quantity": 1000,
    "unit": "kg",
    "testRequirements": ["含量测定", "微生物限度检查", "重金属检查"]
  }
  ```
- **成功响应**:
  ```json
  {
    "code": 200,
    "message": "样品信息接收成功",
    "data": {
      "sampleId": "uuid-xxx-xxx",
      "sampleCode": "CMT-20251123-001",
      "taskId": "uuid-task-xxx"
    },
    "timestamp": 1623456789000
  }
  ```

## 7. 接口安全设计

### 7.1 认证与授权

- **认证方式**：OAuth 2.0 + JWT
- **Token管理**：
  - Access Token：有效期1小时
  - Refresh Token：有效期7天
  - Token续期机制
- **授权控制**：基于RBAC的细粒度权限控制
  - 菜单权限
  - 操作权限
  - 数据权限

### 7.2 数据安全

- **传输安全**：全程HTTPS加密传输
- **数据脱敏**：敏感数据脱敏展示
- **访问控制**：IP白名单、访问频率限制
- **SQL注入防护**：参数化查询、输入验证

### 7.3 审计与日志

- **操作审计**：记录所有关键操作
- **异常监控**：异常行为实时监控和告警
- **日志完整性**：日志防篡改机制

## 8. 性能要求

### 8.1 响应时间

- **常规查询**：≤ 500ms
- **复杂查询**：≤ 2s
- **批量操作**：≤ 10s（1000条以内）
- **文件上传**：≤ 30s（100MB以内）

### 8.2 并发处理

- **支持并发用户**：≥ 100人同时在线
- **支持并发请求**：≥ 200 QPS
- **数据库连接池**：根据负载动态调整

### 8.3 扩展性

- **水平扩展**：支持服务水平扩展
- **缓存策略**：多级缓存设计
- **负载均衡**：请求分发和负载均衡
# LIMS子系统（实验室管理系统）前端设计

## 1. 设计概述

### 1.1 设计理念

- **以用户为中心**：优化实验室人员工作流程，提高操作效率
- **符合GMP规范**：严格遵循药品GMP质量管理规范，确保数据完整性和可追溯性
- **中药特色设计**：针对中药材检测业务的特殊需求进行界面定制
- **直观易用**：简洁明了的界面设计，减少学习成本
- **高效交互**：减少重复操作，提高工作效率
- **响应式设计**：适配不同屏幕尺寸，支持桌面和移动设备访问

### 1.2 技术栈

- **前端框架**：React.js + TypeScript
- **状态管理**：Redux Toolkit + React Query
- **UI组件库**：Ant Design Pro v5
- **数据可视化**：AntV G2 + ECharts
- **工作流引擎**：BPMN.js
- **前端路由**：React Router v6
- **网络请求**：Axios + 拦截器设计
- **样式方案**：Less + CSS Modules
- **国际化**：i18next
- **表单处理**：Formik + Yup 校验

## 2. 前端架构

### 2.1 整体架构

```
├── src/
│   ├── access.ts          # 权限定义
│   ├── app.tsx            # 运行时配置
│   ├── components/        # 公共组件
│   ├── e2e/               # 端到端测试
│   ├── locales/           # 国际化资源
│   ├── models/            # 全局数据模型
│   ├── pages/             # 页面组件
│   ├── services/          # API 服务
│   ├── typings.d.ts       # 全局类型定义
│   ├── utils/             # 工具函数
│   └── hooks/             # 自定义 hooks
```

### 2.2 核心模块划分

- **布局模块**：提供整体页面布局，包括头部导航、侧边菜单、内容区和页脚
- **认证模块**：处理用户登录、注销、权限验证等
- **样品管理模块**：样品接收、信息维护、状态跟踪等功能
- **检测任务模块**：任务分配、进度跟踪、任务管理等
- **检测数据模块**：数据录入、结果审核、报告生成等
- **中药特色模块**：传统鉴别、指纹图谱分析、道地性评估等
- **系统管理模块**：用户管理、权限配置、系统参数设置等

### 2.3 数据流管理

- **全局状态**：使用Redux Toolkit管理全局共享状态
- **API请求**：使用React Query处理数据获取、缓存、同步和更新
- **组件间通信**：Props传递、Context API和自定义Hooks
- **表单状态**：Formik管理复杂表单状态

## 3. 页面设计

### 3.1 整体布局

- **导航系统**：
  - 顶部导航栏：展示系统名称、用户信息、全局搜索、通知中心
  - 左侧菜单：系统功能模块导航，支持多级菜单和折叠
  - 面包屑导航：显示当前页面路径，方便导航和定位
  - 快捷操作栏：常用功能快速入口

- **响应式设计**：
  - 桌面端（>1200px）：完整展示所有元素，三栏布局
  - 平板端（768px-1200px）：收起左侧菜单，二栏布局
  - 移动端（<768px）：抽屉式菜单，单栏布局

### 3.2 首页/工作台

#### 3.2.1 页面结构

- **顶部概览区**：
  - 待处理任务数量卡片
  - 今日到期任务提醒
  - 最近检测样品数量
  - 本月检测合格率统计

- **中间数据看板**：
  - 检测任务进度图表
  - 样品状态分布饼图
  - 检测类型趋势线图
  - 中药材产地分布图

- **下方任务列表区**：
  - 待办任务列表
  - 最近更新的检测结果
  - 系统通知和待审批事项

#### 3.2.2 页面原型

```
+--------------------------------------------------------------------------------+
|  系统名称     全局搜索   消息通知   用户头像/下拉菜单                         |
+--------------------------------------------------------------------------------+
|                                                                                |
|  +----------------+  +----------------+  +----------------+  +----------------+  |
|  | 待处理任务:15  |  | 今日到期:3     |  | 今日样品:28    |  | 合格率:98.5%   |  |
|  +----------------+  +----------------+  +----------------+  +----------------+  |
|                                                                                |
|  +--------------------------------+  +----------------------------------------+  |
|  | 检测任务进度图表               |  | 样品状态分布                             |  |
|  +--------------------------------+  +----------------------------------------+  |
|                                                                                |
|  +--------------------------------+  +----------------------------------------+  |
|  | 检测类型趋势                   |  | 中药材产地分布                           |  |
|  +--------------------------------+  +----------------------------------------+  |
|                                                                                |
|  +-----------------------------------+                                        |  |
|  | 待办任务列表                      |                                        |  |
|  | 任务名称    样品    截止日期  操作  |                                        |  |
|  +-----------------------------------+                                        |  |
|                                                                                |
+--------------------------------------------------------------------------------+
```

### 3.3 样品管理页面

#### 3.3.1 样品接收页面

- **功能**：录入新样品信息，生成样品编号，完成样品接收流程

- **页面结构**：
  - 样品基本信息表单
  - 样品来源信息
  - 样品特性信息
  - 样品图像上传区域
  - 提交和重置按钮

- **交互设计**：
  - 表单实时验证
  - 自动生成样品编号
  - 产地和品种联动选择
  - 上传图片预览和删除功能
  - 接收成功后自动跳转至样品详情页

#### 3.3.2 样品查询列表页面

- **功能**：查询、筛选、分页展示样品信息，支持批量操作

- **页面结构**：
  - 搜索和筛选条件区域
  - 批量操作工具栏
  - 样品数据列表（表格形式）
  - 分页控件

- **表格列信息**：
  - 复选框（用于批量操作）
  - 样品编号
  - 样品名称
  - 中药材名称
  - 产地
  - 供应商
  - 批次号
  - 样品状态
  - 接收日期
  - 操作（查看、编辑、删除等）

- **交互设计**：
  - 高级筛选条件展开/收起
  - 表格列排序和列宽调整
  - 批量选择和批量操作
  - 表格行内编辑（部分字段）
  - 点击查看详情

#### 3.3.3 样品详情页面

- **功能**：展示样品的详细信息，包括所有属性和关联数据

- **页面结构**：
  - 样品基本信息概览
  - 标签式内容展示（基本信息、检测任务、检测结果、相关图片等）
  - 操作按钮（编辑、添加任务等）

- **交互设计**：
  - 标签页切换
  - 相关数据展示和链接跳转
  - 信息更新后的自动刷新

### 3.4 检测任务管理页面

#### 3.4.1 任务分配页面

- **功能**：创建和分配检测任务，指定检测项目和要求

- **页面结构**：
  - 任务基本信息表单
  - 关联样品选择器
  - 检测项目选择和配置区域
  - 执行人分配组件
  - 提交和保存按钮

- **交互设计**：
  - 样品信息自动带出
  - 检测项目多选和规格配置
  - 优先级设置
  - 截止日期日历选择器

#### 3.4.2 任务列表页面

- **功能**：查询、筛选、分页展示检测任务，支持任务状态更新和管理

- **页面结构**：
  - 搜索和筛选条件区域
  - 任务状态统计卡片
  - 任务数据列表（表格形式）
  - 分页控件

- **表格列信息**：
  - 任务编号
  - 样品信息
  - 检测类型
  - 当前状态
  - 优先级
  - 执行人
  - 创建日期
  - 截止日期
  - 进度
  - 操作（查看、编辑、分配等）

- **交互设计**：
  - 拖拽排序
  - 状态快速更新
  - 进度条直观展示
  - 超时预警提醒

### 3.5 检测数据管理页面

#### 3.5.1 检测结果录入页面

- **功能**：录入检测数据，支持多种数据类型和批量录入

- **页面结构**：
  - 任务和样品信息概览
  - 检测项目列表
  - 检测数据录入表单
  - 数据上传区域（支持Excel导入）
  - 保存和提交按钮

- **交互设计**：
  - 自动计算结果判定
  - 数据格式验证
  - 批量复制粘贴
  - 历史数据查询参考

#### 3.5.2 结果审核页面

- **功能**：审核检测结果，支持批量审核和意见反馈

- **页面结构**：
  - 待审核结果筛选条件
  - 检测结果列表（表格形式）
  - 结果详情展示区域
  - 审核操作区域（通过/驳回按钮、审核意见输入框）

- **表格列信息**：
  - 复选框（用于批量审核）
  - 样品信息
  - 检测项目
  - 检测值
  - 标准范围
  - 判定结果
  - 检测人
  - 检测日期
  - 操作（查看、审核）

- **交互设计**：
  - 批量选择和批量审核
  - 审核历史记录查看
  - 异常结果高亮显示

### 3.6 中药特色功能页面

#### 3.6.1 传统鉴别页面

- **功能**：记录和管理中药材传统鉴别信息，支持图片和视频上传

- **页面结构**：
  - 鉴别样品信息
  - 鉴别类型选择器
  - 鉴别特征录入表单（性状特征、显微特征等）
  - 图片/视频上传和预览区域
  - 鉴别结论和参考标准
  - 保存和提交按钮

- **交互设计**：
  - 多图上传和预览
  - 图片放大查看
  - 视频播放控制
  - 鉴别特征模板选择

#### 3.6.2 指纹图谱分析页面

- **功能**：上传、管理和分析中药材指纹图谱数据，计算相似度

- **页面结构**：
  - 指纹图谱上传区域
  - 图谱可视化展示区域（色谱图）
  - 标准图谱选择器
  - 相似度计算参数设置
  - 结果分析和报告生成区域

- **交互设计**：
  - 图谱交互缩放和放大
  - 特征峰标记和标注
  - 相似度计算实时反馈
  - 多图谱对比分析

#### 3.6.3 道地性评估页面

- **功能**：评估中药材的道地性特征，管理产地信息

- **页面结构**：
  - 样品产地信息表单
  - 成分特征分析区域
  - 微量元素指纹图谱分析
  - 评估标准和参数设置
  - 评估结果展示和报告生成

- **交互设计**：
  - 产地地图可视化
  - 成分含量雷达图
  - 评估分数计算和展示
  - 历史评估数据对比

## 4. 组件设计

### 4.1 通用组件

#### 4.1.1 样品信息组件

- **功能**：展示样品的核心信息，可在多个页面复用

- **属性**：
  - `sampleId`: 样品ID
  - `showActions`: 是否显示操作按钮
  - `compact`: 是否使用紧凑模式

- **渲染内容**：样品编号、名称、产地、批次号等关键信息

#### 4.1.2 任务进度组件

- **功能**：可视化展示任务进度和状态

- **属性**：
  - `currentStep`: 当前步骤
  - `totalSteps`: 总步骤数
  - `stepNames`: 步骤名称数组
  - `stepStatuses`: 步骤状态数组

- **渲染内容**：进度条、步骤指示器、状态标签

#### 4.1.3 数据审核组件

- **功能**：统一的数据审核界面，支持审核操作和意见录入

- **属性**：
  - `recordId`: 待审核记录ID
  - `recordType`: 记录类型
  - `initialStatus`: 初始状态

- **渲染内容**：审核表单、历史记录、操作按钮

#### 4.1.4 数据可视化组件

- **功能**：统一的数据图表展示组件库

- **组件列表**：
  - `StatusPieChart`: 状态分布饼图
  - `TrendLineChart`: 趋势线图
  - `ComparisonBarChart`: 对比柱状图
  - `RadarChart`: 雷达图（用于多维数据展示）
  - `MapVisualization`: 地图可视化（用于产地分布）

### 4.2 中药特色组件

#### 4.2.1 中药材图像组件

- **功能**：专用的中药材图像展示和管理组件

- **属性**：
  - `images`: 图像URL数组
  - `allowUpload`: 是否允许上传
  - `maxImages`: 最大图片数量

- **渲染内容**：图片预览网格、上传按钮、查看器

#### 4.2.2 色谱图组件

- **功能**：专业的色谱图展示和交互组件

- **属性**：
  - `data`: 色谱数据数组
  - `showPeakLabels`: 是否显示峰值标签
  - `allowZoom`: 是否允许缩放

- **渲染内容**：色谱图、峰值标记、坐标轴

#### 4.2.3 道地性评估组件

- **功能**：道地性评估计算和结果展示组件

- **属性**：
  - `componentData`: 成分数据
  - `traceElementData`: 微量元素数据
  - `originData`: 产地数据

- **渲染内容**：评估分数、特征分析图、结论展示

## 5. 表单与数据验证

### 5.1 表单设计规范

- **布局规范**：
  - 两列布局为主，关键信息单列突出
  - 相关字段分组展示，使用Card或Collapse组件
  - 表单项间距统一，对齐方式一致
  - 必填字段明确标识

- **表单控件选择**：
  - 文本输入：单行/多行文本框
  - 数值输入：数字输入框（带单位选择）
  - 日期时间：日期选择器/时间选择器
  - 选项选择：下拉菜单、单选框、复选框、开关
  - 文件上传：上传组件（支持拖拽和预览）

### 5.2 数据验证规则

- **通用验证规则**：
  - 必填字段验证
  - 数据类型验证
  - 长度限制验证
  - 格式验证（如日期格式、数字范围等）

- **业务验证规则**：
  - 样品编号唯一性验证
  - 批次号格式验证
  - 含量数值范围验证
  - 日期逻辑验证（如生产日期不能晚于检测日期）

- **实时验证**：表单输入时实时验证，提供即时反馈

### 5.3 数据录入辅助功能

- **自动补全**：常用字段支持自动补全功能
- **关联选择**：相关字段联动选择
- **模板导入**：支持Excel模板批量导入数据
- **历史记录**：常用数据历史记录和快速选择

## 6. 数据可视化设计

### 6.1 图表类型与用途

- **饼图**：展示样品状态分布、检测类型占比
- **柱状图**：比较不同类别数据，如各产地样品数量
- **折线图**：展示趋势变化，如检测数量随时间变化
- **雷达图**：多维数据对比，如不同批次成分含量对比
- **散点图**：相关性分析，如含量与产地海拔关系
- **热力图**：矩阵数据可视化，如不同检测项结果分布
- **地图**：产地分布和道地药材地理信息展示

### 6.2 特色可视化功能

- **指纹图谱对比**：多色谱图叠加展示，支持交互分析
- **成分含量分布**：箱线图展示成分含量分布区间
- **道地性评分可视化**：雷达图展示多维度评分
- **检测流程状态图**：流程图展示检测任务进度

### 6.3 交互设计

- **图表交互**：缩放、平移、数据点提示
- **筛选联动**：图表与数据列表筛选联动
- **导出功能**：图表导出为图片或PDF
- **数据钻取**：从汇总数据钻取到明细数据

## 7. 响应式与兼容性设计

### 7.1 响应式断点设计

- **超大屏幕**：≥1600px
  - 完整功能展示，四列布局
  - 更多数据同时展示

- **大屏幕**：1400px-1599px
  - 三列布局
  - 精简部分非核心信息

- **中屏幕**：1200px-1399px
  - 强制三列布局
  - 优化组件间距和尺寸

- **小屏幕**：992px-1199px
  - 两列布局
  - 折叠侧边菜单
  - 优化表格显示

- **平板**：768px-991px
  - 强制两列布局
  - 简化头部导航
  - 表格支持横向滚动

- **移动设备**：<768px
  - 单栏布局
  - 抽屉式菜单
  - 卡片式展示数据
  - 简化操作流程

### 7.2 浏览器兼容性

- **支持浏览器**：
  - Chrome 90+
  - Firefox 88+
  - Safari 14+
  - Edge 90+

- **兼容性处理**：
  - 使用Autoprefixer处理CSS兼容性
  - 关键功能降级处理
  - 老旧浏览器提示升级

## 8. 前端安全设计

### 8.1 数据安全

- **防XSS攻击**：
  - 输入数据严格验证和过滤
  - 使用React内置HTML转义
  - 避免使用dangerouslySetInnerHTML

- **防CSRF攻击**：
  - API请求添加CSRF令牌
  - 敏感操作二次确认

- **数据脱敏**：
  - 敏感信息展示脱敏
  - 日志信息脱敏处理

### 8.2 访问控制

- **路由权限**：基于用户角色控制路由访问
- **操作权限**：细粒度的按钮和功能权限控制
- **数据权限**：基于用户权限过滤可访问数据

### 8.3 错误处理与日志

- **前端错误捕获**：全局错误边界处理
- **操作日志**：记录关键用户操作
- **错误上报**：前端错误自动上报机制

## 9. 性能优化

### 9.1 加载性能优化

- **代码分割**：按路由和组件进行代码分割
- **懒加载**：图片和非关键组件懒加载
- **资源优化**：压缩CSS、JS、图片等资源
- **CDN加速**：静态资源使用CDN分发

### 9.2 渲染性能优化

- **虚拟列表**：大数据量列表使用虚拟滚动
- **组件缓存**：使用React.memo等优化重渲染
- **状态管理优化**：合理使用全局状态，避免不必要的更新
- **计算优化**：复杂计算使用useMemo缓存结果

### 9.3 网络性能优化

- **请求合并**：批量API请求
- **数据缓存**：使用React Query缓存请求结果
- **条件请求**：使用ETag等机制减少不必要的数据传输
- **错误重试**：网络错误自动重试机制

## 10. 可访问性设计

### 10.1 WCAG合规性

- **遵循标准**：符合WCAG 2.1 AA级标准
- **色彩对比度**：确保文本与背景的对比度符合标准
- **键盘导航**：所有功能支持键盘操作
- **语义化HTML**：使用正确的HTML标签和ARIA属性

### 10.2 辅助功能

- **屏幕阅读器支持**：确保界面元素可被屏幕阅读器识别
- **字体大小调整**：支持文本缩放
- **高对比度模式**：提供高对比度主题选项
- **快捷键支持**：常用功能提供键盘快捷键

## 11. 国际化与本地化

### 11.1 多语言支持

- **语言切换**：支持中英文切换
- **文本提取**：使用i18next管理翻译资源
- **动态加载**：按需加载语言包

### 11.2 本地化适配

- **日期时间格式**：根据语言环境调整日期时间显示格式
- **数字格式**：根据语言环境调整数字显示格式
- **单位换算**：支持不同度量衡单位转换

## 12. 部署与构建

### 12.1 构建配置

- **开发环境**：热重载、开发工具支持
- **测试环境**：代码压缩、资源优化
- **生产环境**：代码混淆、资源合并、性能优化

### 12.2 部署策略

- **静态资源部署**：Nginx静态文件服务
- **CDN部署**：静态资源CDN分发
- **Docker部署**：容器化部署支持
- **CI/CD集成**：自动化构建和部署流程

### 12.3 监控与维护

- **前端监控**：页面性能监控、错误监控
- **用户行为分析**：关键操作跟踪分析
- **自动报警**：异常情况自动报警机制